!function(e){function t(t){for(var r,o,s=t[0],c=t[1],u=t[2],d=0,p=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&p.push(i[o][0]),i[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(l&&l(t);p.length;)p.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==i[c]&&(r=!1)}r&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},i={"web/calls":0},a=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/js/cmodules/";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=c;a.push([134,"vendors","common","6f6d6daf6e0bb130964cb726d59e9378","a240b08719d1f14dfcac1a97a3a5fde6"]),n()}({"+/AQ":function(e,t,n){"use strict";n.r(t),n.d(t,"getNativeOption",(function(){return i})),n.d(t,"setNativeOption",(function(){return a})),n.d(t,"createScroll",(function(){return u}));var r=n("ofcU");function i(e,t){return bodyNode[e]||document.documentElement[e]}function a(e,t,n){"scrollTop"===e&&window.scrollTo(0,t)}class o{constructor(e,t){this.el=e,this.opts=t,this.module=Object(r.createModule)({handlers:(e,t)=>{e(window,"scroll",this.onScroll.bind(this)),e(window,"resize",this.resize.bind(this))}}),this.innerHeight=window.innerHeight,this.prevScroll=this.scrollTop()}update(){}resize(){this.innerHeight=window.innerHeight}scrollTop(e){if(void 0===e)return i("scrollTop",this.el);a("scrollTop",e,this.el)}contHeight(){return i("scrollHeight")}smoothScroll(e){scrollToY(e+this.scrollTop(),300)}getContainer(){return this.el}getScroller(){return null}scrollBottom(e){if(void 0===e)return this.contHeight()-this.scrollTop()-this.getScrollHeight();var t=this.contHeight()-e-this.getScrollHeight();this.scrollTop(t)}scrollBottomFixSave(e){var t=()=>{Date.now()-n<500&&this.scrollBottom(e),window.removeEventListener("scroll",t)},n=Date.now();window.addEventListener("scroll",t),this.scrollBottom(e)}onScroll(e){var t=this.scrollTop(),n=t-this.prevScroll,r=this.contHeight();this.opts.onScroll&&this.opts.onScroll(-n,this),this.opts.scrollChange&&this.opts.scrollChange(t),this.opts.more&&r-t<2*this.innerHeight&&this.opts.more(this),this.prevScroll=t}getScrollHeight(){return this.innerHeight}destroy(){Object(r.destroyModule)(this.module)}}class s{constructor(e,t){this.prevTop=0,this.scroll=new uiScroll(e,{hidden:void 0===t.hidden||t.hidden,shadows:t.shadows,stopScrollPropagation:!1,theme:t.scrollTheme,onmore:()=>t.more&&t.more(this),onscroll:e=>{var n=this.scrollTop(),r=this.prevTop-n;this.prevTop=n,t.scrollChange&&t.scrollChange(n),t.onScroll&&t.onScroll(r,this)}})}update(){this.scroll.update("sync")}scrollTop(e){return void 0!==e?this.scroll.scrollTop(e):this.scroll.data.scrollTop}getContainer(){return this.scroll.content}getScroller(){return this.scroll.scroller}contHeight(){return this.scroll.data.scrollHeight}smoothScroll(e){this.scroll.scrollTop(this.scrollTop()+e,300)}scrollBottom(e){return void 0!==e?this.scroll.scrollBottom(e):this.scroll.data.scrollBottom}scrollBottomFixSave(e){var t=Date.now();this.scroll.emitter.addOnceListener("resize",()=>{Date.now()-t<500&&this.scroll&&this.scrollBottom(e)}),this.scrollBottom(e)}getScrollHeight(){return this.scroll.data.viewportHeight}destroy(){this.scroll.destroy()}}class c{constructor(e,t){this.el=e}update(){}getContainer(){return this.el}getScroller(){return null}scrollTop(e){return 0}contHeight(){return 0}smoothScroll(e){}scrollBottom(e){return 0}scrollBottomFixSave(e){}getScrollHeight(){return 0}destroy(){}}function u(e,t){return t.noScroll?new c(e):t.nativeScroll?new o(e,t):new s(e,t)}},"/eGY":function(e,t,n){"use strict";n.r(t),n.d(t,"VKPAY_APP_ID",(function(){return l})),n.d(t,"BUTTON_TYPE_TEXT",(function(){return d})),n.d(t,"BUTTON_TYPE_VKPAY",(function(){return p})),n.d(t,"BUTTON_TYPE_LOCATION",(function(){return h})),n.d(t,"BUTTON_TYPE_OPEN_APP",(function(){return f})),n.d(t,"BUTTON_TYPE_OPEN_LINK",(function(){return m})),n.d(t,"BUTTON_COLOR_DEFAULT",(function(){return g})),n.d(t,"BUTTON_COLOR_SECONDARY",(function(){return v})),n.d(t,"BUTTON_COLOR_PRIMARY",(function(){return _})),n.d(t,"BUTTON_COLOR_NEGATIVE",(function(){return b})),n.d(t,"BUTTON_COLOR_POSITIVE",(function(){return y})),n.d(t,"handleButtonClick",(function(){return O})),n.d(t,"getButtonAppearance",(function(){return C})),n.d(t,"getButtonLabel",(function(){return S})),n.d(t,"getActionObjectFromElement",(function(){return w})),n.d(t,"getAttributesFromActionObject",(function(){return I}));n("HEwt"),n("a1Th"),n("rE2o"),n("ioFf"),n("rGqo"),n("Btvt"),n("/8Fb"),n("pIFo");var r=n("t7n3"),i=n("nAFc"),a=n("/PiP"),o=n("EasH"),s=n("N4ZS");function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var l=6217559,d="text",p="vkpay",h="location",f="open_app",m="open_link",g="default",v="secondary",_="primary",b="negative",y="positive",E=["app-id","owner-id","type","payload","hash","label"];function O(e,t,n,r){var i=e.app_id,s=e.owner_id,c=e.type,u=e.payload,g=e.hash,v=void 0===g?"":g;switch(c){case m:break;case p:case f:var _="app"+(c===p?l:i)+(s?"_"+s:"");Object(a.showWiki)({w:_+encodeURIComponent("#"+v),from_keyboard:1,app_hash:n});break;case h:cur.sendLocation=function(e,n){n(),t({keyboardAuthorId:r,action:{label:"",attaches:[e],payload:u}})},Object(o.showBox)("al_places.php",{act:"a_choose_place_box",from_keyboard:1},{stat:["places.css","map.css","maps.js","ui_controls.css","ui_controls.js","boxes.css"],width:640,bodyStyle:"padding: 0px;",dark:1});break;case d:t({action:e,appHash:n,keyboardAuthorId:r});break;default:e.payload=JSON.stringify({command:"not_supported_button",button_type:c,payload:e.payload}),t({action:e,appHash:n,keyboardAuthorId:r})}}function C(e){return T(e)?_:e.color.toLowerCase().replace(g,v)}function S(e){var t=e.action,n=t.label;return t.type===h?getLang("mail_keyboard_label_location"):T(e)?getLang("mail_keyboard_label_vkpay").replace(/ VK Pay$/,""):function(e){var t=e;return t=Object(i.decodeHTMLEntities)(t||""),t=Object(r.clean)(t).replace(/\n(\r)?/gi," "),t=Emoji.emojiToHTML(t,!0)}(n)}function T(e){var t=e.action,n=t.app_id,r=t.type;return r===p||r===f&&n===l}function w(e){return E.reduce((t,n)=>(t[n.replace("-","_")]=e.getAttribute("data-"+n)||void 0,t),{})}function I(e){var t=Object.entries(e).reduce((e,t)=>{var n=c(t,2),i=n[0],a=n[1];return e+` data-${i.replace("_","-")}="${Object(r.clean)(""+a)}"`},"");e.type===m&&(t+=` href="${Object(s.wrapAwayIfExternal)(encodeURI(e.link),!0)}" target="_blank" rel="nofollow noopener"`);return t}},"/oKx":function(e,t,n){"use strict";var r=n("zMZw"),i=n("LQSR");function a(e){"number"==typeof e.mid&&(e.mid=e.mid.toString())}function o(){this.cache={mlB2UMap:{},mlU2BMap:{}}}e.exports=o,o.prototype.candidateToUnifiedPlan=function(e){var t=new RTCIceCandidate(e);return t.sdpMLineIndex=this.cache.mlB2UMap[t.sdpMLineIndex],t},o.prototype.candidateToPlanB=function(e){var t=new RTCIceCandidate(e);if(0===t.sdpMid.indexOf("audio"))t.sdpMid="audio";else{if(0!==t.sdpMid.indexOf("video"))throw new Error("candidate with "+t.sdpMid+" not allowed");t.sdpMid="video"}return t.sdpMLineIndex=this.cache.mlU2BMap[t.sdpMLineIndex],t},o.prototype.getFirstSendingIndexFromAnswer=function(e){if(!this.cache.answer)return null;var t=r.parse(this.cache.answer);if(t&&t.media&&Array.isArray(t.media))for(var n=0;n<t.media.length;n++)if(t.media[n].type==e&&(!t.media[n].direction||"sendrecv"===t.media[n].direction||"sendonly"===t.media[n].direction))return n;return null},o.prototype.toPlanB=function(e){var t=this;if("object"!=typeof e||null===e||"string"!=typeof e.sdp)return console.warn("An empty description was passed as an argument."),e;var n=r.parse(e.sdp);if(void 0===n.media||!Array.isArray(n.media)||0===n.media.length)return console.warn("The description has no media."),e;if(n.media.length<=3&&n.media.every((function(e){return-1!==["video","audio","data"].indexOf(e.mid)})))return console.warn("This description does not look like Unified Plan."),e;for(var o=e.sdp,c=!1,u=0;u<n.media.length;u++){n.media[u].rtp.forEach((function(e){if("NULL"===e.codec){c=!0;var n=r.parse(t.cache.offer);e.codec=n.media[u].rtp[0].codec}}))}c&&(o=r.write(n)),this.cache[e.type]=o;var l=n.media;n.media=[];var d={},p=[],h={};l.forEach((function(e){if(a(e),("string"!=typeof e.rtcpMux||"rtcp-mux"!==e.rtcpMux)&&"inactive"!==e.direction&&"application"!==e.type)throw new Error("Cannot convert to Plan B because m-lines without the rtcp-mux attribute were found.");void 0!==d[e.type]&&"inactive"!==d[e.type].direction||(d[e.type]=e)})),l.forEach((function(e){var t=e.type;if("application"===t)return e.mid="data",n.media.push(e),void p.push(e.mid);"object"==typeof e.sources&&Object.keys(e.sources).forEach((function(n){"object"!=typeof d[t].sources&&(d[t].sources={}),d[t].sources[n]=e.sources[n],void 0!==e.msid&&(d[t].sources[n].msid=e.msid)})),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&(void 0!==d[t].ssrcGroups&&Array.isArray(d[t].ssrcGroups)||(d[t].ssrcGroups=[]),i.apply(d[t].ssrcGroups,[e.ssrcGroups])||(d[t].ssrcGroups=d[t].ssrcGroups.concat(e.ssrcGroups)));var r=e.direction;h[t]=(h[t]||0)|s[r||"inactive"],d[t]===e&&(e.mid=t,delete e.bundleOnly,delete e.msid,"inactive"!==r&&p.push(t),n.media.push(e))})),n.groups.some((function(e){if("BUNDLE"===e.type)return e.mids=p.join(" "),!0})),n.msidSemantic={semantic:"WMS",token:"*"};var f=r.write(n);return new RTCSessionDescription({type:e.type,sdp:f})},o.prototype.toUnifiedPlan=function(e){var t=this;if("object"!=typeof e||null===e||"string"!=typeof e.sdp)return console.warn("An empty description was passed as an argument."),e;var n=r.parse(e.sdp);if(void 0===n.media||!Array.isArray(n.media)||0===n.media.length)return console.warn("The description has no media."),e;if(n.media.length>3||!n.media.every((function(e){return-1!==["video","audio","data"].indexOf(e.mid)})))return console.warn("This description does not look like Plan B."),e;var o=[];n.media.forEach((function(e){o.push(e.mid)}));var s,c=!1;if(void 0!==n.groups&&Array.isArray(n.groups)&&(c=n.groups.every((function(e){return"BUNDLE"!==e.type||i.apply(e.mids.sort(),[o.sort()])}))),!c)throw new Error("Cannot convert to Unified Plan because m-lines that are not bundled were found.");void 0!==this.cache[e.type]&&(s=r.parse(this.cache[e.type]));var u={audio:{},video:{}},l={},d=0,p=0;if(n.media.forEach((function(n){if(("string"!=typeof n.rtcpMux||"rtcp-mux"!==n.rtcpMux)&&"inactive"!==n.direction&&"application"!==n.type)throw new Error("Cannot convert to Unified Plan because m-lines without the rtcp-mux attribute were found.");if("application"===n.type){var r=null;return s&&s.media&&(r=s.media.find((function(e){return"application"===e.type}))),void(r?l[r.mid]=r:l[n.mid]=n)}var i=n.sources,o=n.ssrcGroups,c=n.candidates,h=n.iceUfrag,f=n.icePwd,m=n.fingerprint,g=n.port;delete n.sources,delete n.ssrcGroups,delete n.candidates,delete n.iceUfrag,delete n.icePwd,delete n.fingerprint,delete n.port,delete n.mid;var v={};void 0!==o&&Array.isArray(o)&&o.forEach((function(e){"SIM"!==e.semantics&&void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&e.ssrcs.forEach((function(t){void 0===v[t]&&(v[t]=[]),v[t].push(e)}))}));var _={};"object"==typeof i&&Object.keys(i).forEach((function(r){var o;if("offer"!==e.type||i[r].msid)if(void 0!==v[r]&&Array.isArray(v[r])&&v[r].some((function(e){return e.ssrcs.some((function(e){if("object"==typeof _[e])return o=_[e],!0}))})),"object"==typeof o)o.sources[r]=i[r],delete i[r].msid;else{if(o=Object.create(n),_[r]=o,void 0!==i[r].msid&&(o.msid=i[r].msid,delete i[r].msid),o.sources={},o.sources[r]=i[r],o.ssrcGroups=v[r],void 0!==s&&void 0!==s.media&&Array.isArray(s.media)&&s.media.forEach((function(e){"object"==typeof e.sources&&Object.keys(e.sources).forEach((function(t){t===r&&(o.mid=e.mid)}))})),a(o),void 0===o.mid){if("answer"===e.type)throw new Error("An unmapped SSRC was found.");o.mid=[n.type,"-",r].join("")}o.candidates=c,o.iceUfrag=h,o.icePwd=f,o.fingerprint=m,o.port=g,l[o.mid]=o,t.cache.mlU2BMap[p]=d,void 0===t.cache.mlB2UMap[d]&&(t.cache.mlB2UMap[d]=p),p++}else u[n.type][r]=i[r]})),d++})),n.media=[],o=[],"answer"===e.type)for(var h=0;h<s.media.length;h++){var f=s.media[h];a(f),void 0===l[f.mid]&&(delete f.msid,delete f.sources,delete f.ssrcGroups,f.direction&&"sendrecv"!==f.direction?"sendonly"===f.direction&&(f.direction="inactive"):f.direction="recvonly"),n.media.push(f),"string"==typeof f.mid&&o.push(f.mid)}else void 0!==s&&void 0!==s.media&&Array.isArray(s.media)&&s.media.forEach((function(e){a(e),o.push(e.mid),void 0!==l[e.mid]?n.media.push(l[e.mid]):(delete e.msid,delete e.sources,delete e.ssrcGroups,e.direction&&"sendrecv"!==e.direction||(e.direction="recvonly"),e.direction&&"sendonly"!==e.direction||(e.direction="inactive"),n.media.push(e))})),Object.keys(l).forEach((function(e){-1===o.indexOf(e)&&(o.push(e),"recvonly"===l[e].direction?n.media.some((function(t){if(("sendrecv"===t.direction||"sendonly"===t.direction)&&t.type===l[e].type)return Object.keys(l[e].sources).forEach((function(n){t.sources[n]=l[e].sources[n]})),!0})):n.media.push(l[e]))}));["audio","video"].forEach((function(e){if(n&&n.media&&Array.isArray(n.media)){var r=null;if(Object.keys(u[e]).length>0&&null===(r=t.getFirstSendingIndexFromAnswer(e)))for(var i=0;i<n.media.length;i++)if(n.media[i].type===e){r=i;break}if(r&&n.media.length>r){var a=n.media[r];Object.keys(u[e]).forEach((function(t){a.sources&&a.sources[t]&&console.warn("Replacing an existing SSRC."),a.sources||(a.sources={}),a.sources[t]=u[e][t]}))}}})),n.groups.some((function(e){if("BUNDLE"===e.type)return e.mids=o.join(" "),!0})),n.msidSemantic={semantic:"WMS",token:"*"};var m=r.write(n);return this.cache[e.type]=m,new RTCSessionDescription({type:e.type,sdp:m})};var s={inactive:0,recvonly:1,sendonly:2,sendrecv:3}},"0Rlc":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var r=n("q1tI"),i=(n("17x9"),n("ZxpX"));function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function o(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}class s extends r.Component{constructor(){super(...arguments),this.onChange=e=>{this.props.onChange&&this.props.onChange(this.props.name,e.target.checked,e)}}render(){var e=this.props,t=e.children,n=e.checked,s=e.disabled,c=e.indeterminate,u=e.name,l=e.id,d=o(e,["children","checked","disabled","indeterminate","name","id"]),p=Object(i.classNames)("CheckBox",d.className,{"CheckBox--disabled":s,"CheckBox--indeterminate":c});return r.createElement("label",{className:p},r.createElement("input",a({},d,{className:"CheckBox__input",id:l,type:"checkbox",checked:n,name:u,disabled:s,onChange:this.onChange})),r.createElement("span",{className:"CheckBox__indicator","aria-hidden":!0}),t)}}},"0toi":function(e,t,n){"use strict";n.r(t);n("91GP");var r=n("q1tI"),i=n.n(r),a=(n("17x9"),n("r7nW")),o=n("Xq7/"),s=n("6aSF"),c=function(e){var t=e.children,n=e.hasScroll;return void 0===n||n?i.a.createElement(s.default,{className:"ModalBody"},t):i.a.createElement("div",{className:"ModalBody"},t)},u=n("7ZXl"),l=n("ZxpX");function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var p=e=>{var t=e.className,n=e.appearance,i=void 0===n?"white":n,s=e.title,p=e.actionButtons,h=e.onClose,f=e.children,m=e.footerHint,g=e.hasScroll,v=Object(l.classNames)("Modal","Modal--"+i,t);return r.createElement(a.default,d({},e,{className:v}),r.createElement(o.ModalHeader,{title:s,onClose:h,appearance:i}),Boolean(f)&&r.createElement(c,{hasScroll:g},f),r.createElement(u.ModalFooter,{actionButtons:p,hint:m}))};p.Header=o.ModalHeader,p.Body=c,p.Footer=u.ModalFooter;t.default=p},134:function(e,t,n){e.exports=n("z10o")},"1y80":function(e,t,n){"use strict";function r(e,t,n,r,i){return window.statlogsValueEvent(e,t,n,r,i)}function i(e){return Math.random()<e}function a(e,t,n,a,o,s){i(e)&&r(t,n,a,o,s)}n.r(t),n.d(t,"statlogsValueEvent",(function(){return r})),n.d(t,"randEnabled",(function(){return i})),n.d(t,"statlogsProbValueEvent",(function(){return a}))},"2zsc":function(e,t,n){"use strict";n.r(t);var r=n("q1tI"),i=n.n(r),a=function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};t.default=function(e){var t=e.children,n=e.className,r=o(e,["children","className"]),s=t?String(t):"";return i.a.createElement("span",a({},r,{dangerouslySetInnerHTML:{__html:s},className:n||""}))}},"3UD+":function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},"6aSF":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return c}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var r=n("q1tI"),i=(n("17x9"),n("+/AQ")),a=n("ZxpX");function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}class c extends r.Component{constructor(){super(...arguments),this.getWrapperRef=e=>{this.wrapper=e}}componentDidMount(){var e=this.props,t=e.isNative,n=e.isShadows,r=e.neverHide,a=e.onScroll;this.scroller||(this.scroller=Object(i.createScroll)(this.wrapper,{shadows:n,nativeScroll:t,hidden:!r,onScroll:a}))}componentDidUpdate(){this.scroller.update()}componentWillUnmount(){this.scroller.destroy(),this.scroller=null}render(){var e=this.props,t=e.children,n=(e.isNative,e.isShadows,e.neverHide,e.className),i=void 0===n?"":n,c=s(e,["children","isNative","isShadows","neverHide","className"]);return r.createElement("div",o({},c,{className:Object(a.classNames)("Scroll",i),ref:this.getWrapperRef}),t)}}c.defaultProps={isNative:!1,isShadows:!1,neverHide:!1,onScroll:null}},"6krn":function(e,t,n){"use strict";n.r(t),n.d(t,"getLang",(function(){return o}));var r=n("nAFc"),i=n("4+be"),a={};function o(e,t,n){void 0===t&&(t=!1);var o="number"==typeof t,s=t||o,c=e+(s?".raw":"");if(void 0===a[c]){var u=s?Object(i.getLang)(e,"raw"):Object(i.getLang)(e);"string"==typeof u?a[c]=Object(r.decodeHTMLEntities)(u):Array.isArray(u)&&(a[c]=u.map(r.decodeHTMLEntities))}if(o){var l=t;return Object(i.langNumeric)(l,a[c],n)}return a[c]||""}t.default={getLang:o}},"754W":function(e,t,n){"use strict";n.r(t);n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var r=n("q1tI"),i=(n("17x9"),n("ZxpX"));function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function o(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}t.default=e=>{var t=e.children,n=e.className,s=o(e,["children","className"]),c=Object(i.classNames)("LinkButton",n),u=a({},s,{onMouseDown:e=>{e.preventDefault(),s.onMouseDown&&s.onMouseDown(e)}});return r.createElement("button",a({},u,{className:c}),t)}},"756/":function(e,t,n){"use strict";n.r(t),n.d(t,"ConversationNoPhoto",(function(){return c}));var r=n("q1tI"),i=n.n(r),a=n("ZxpX"),o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},s=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},c=function(e){var t=e.id,n=e.size,r=void 0===n?"m":n,c=e.text,u=e.specificType,l=e.className,d=s(e,["id","size","text","specificType","className"]),p=u||t%6+1,h=Object(a.classNames)("ConversationNoPhoto","ConversationNoPhoto--"+p,"ConversationNoPhoto--"+r,l);return i.a.createElement("figure",o({},d,{className:h,dangerouslySetInnerHTML:{__html:c}}))}},"7ZXl":function(e,t,n){"use strict";n.r(t),n.d(t,"ModalFooter",(function(){return a}));var r=n("q1tI"),i=n.n(r),a=function(e){var t=e.actionButtons,n=e.hint;return i.a.createElement("div",{className:"ModalFooter"},i.a.createElement("div",{className:"ModalFooter__inner"},n&&i.a.createElement("div",{className:"ModalFooter__hint"},n),t))}},"86+7":function(e,t,n){"use strict";n.r(t),n.d(t,"oCacheExists",(function(){return i})),n.d(t,"oCacheGet",(function(){return a})),n.d(t,"oCacheAdd",(function(){return o}));n("KKXr");var r=n("aong");function i(e,t){return t in Object(r.unpackStore)(e).oCache}function a(e,t){var n=Object(r.unpackStore)(e).oCache[t];return n&&!n._n&&(!function(e){if(!e.first_name){var t=e.name.split(" ",2);e.first_name=t[0],e.short_name=t[1]?t[0]+" "+t[1].substr(0,1)+".":t[0]}e.inv_name||(e.inv_name=e.name),e.kick_name||(e.kick_name=e.inv_name)}(n),n._n=1),n}function o(e,t){var n=Object(r.unpackStore)(e);n.oCache||(n.oCache={}),t.id&&(n.oCache[t.id]=t)}},"8D0k":function(e,t,n){"use strict";var r=n("KCt4");function i(e,t,n,i,a){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":a||"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var c="msid:"+(i?i.id:"-")+" "+s+"\r\n";o+="a="+c,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),o}function a(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){var a=r(e.parameters.apt,n),o=r(t.parameters.apt,i);return a&&o&&a.name.toLowerCase()===o.name.toLowerCase()};return e.codecs.forEach((function(r){for(var a=0;a<t.codecs.length;a++){var o=t.codecs[a];if(r.name.toLowerCase()===o.name.toLowerCase()&&r.clockRate===o.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&o.parameters.apt&&!i(r,o,e.codecs,t.codecs))continue;(o=JSON.parse(JSON.stringify(o))).numChannels=Math.min(r.numChannels,o.numChannels),n.codecs.push(o),o.rtcpFeedback=o.rtcpFeedback.filter((function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}})),n}function o(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function s(e,t){var n=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return n||e.addRemoteCandidate(t),!n}function c(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}e.exports=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function u(t,n,r,i){var a=new Event("track");a.track=n,a.receiver=r,a.transceiver={receiver:r},a.streams=i,e.setTimeout((function(){t._dispatchEvent("track",a)}))}var l=function(n){var i=this,a=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){i[e]=a[e].bind(a)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter((function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!n?(n=!0,!0):0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp")})),delete e.url,e.urls=i?r[0]:r,!!r.length}}))}(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var o=n.iceCandidatePoolSize;o>0;o--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=r.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(l.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(l.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),l.prototype.onicecandidate=null,l.prototype.onaddstream=null,l.prototype.ontrack=null,l.prototype.onremovestream=null,l.prototype.onsignalingstatechange=null,l.prototype.oniceconnectionstatechange=null,l.prototype.onconnectionstatechange=null,l.prototype.onicegatheringstatechange=null,l.prototype.onnegotiationneeded=null,l.prototype.ondatachannel=null,l.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},l.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},l.prototype.getConfiguration=function(){return this._config},l.prototype.getLocalStreams=function(){return this.localStreams},l.prototype.getRemoteStreams=function(){return this.remoteStreams},l.prototype._createTransceiver=function(e,t){var n=this.transceivers.length>0,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();r.iceTransport=i.iceTransport,r.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(r),r},l.prototype.addTrack=function(t,n){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r;if(this.transceivers.find((function(e){return e.track===t})))throw c("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(r=this.transceivers[i]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},l.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach((function(t){n.addTrack(t,e)}));else{var r=e.clone();e.getTracks().forEach((function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",(function(e){n.enabled=e.enabled}))})),r.getTracks().forEach((function(e){n.addTrack(e,r)}))}},l.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find((function(e){return e.rtpSender===t}));if(!n)throw c("InvalidAccessError","Sender was not created by this connection.");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(r)&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},l.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var n=t.getSenders().find((function(t){return t.track===e}));n&&t.removeTrack(n)}))},l.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},l.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},l.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},l.prototype._gather=function(t,n){var i=this,a=this.transceivers[n].iceGatherer;if(!a.onlocalcandidate){var o=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,a.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),a.onlocalcandidate=function(e){if(!(i.usingBundle&&n>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:n};var s=e.candidate,c=!s||0===Object.keys(s).length;if(c)"new"!==a.state&&"gathering"!==a.state||(a.state="completed");else{"new"===a.state&&(a.state="gathering"),s.component=1,s.ufrag=a.getLocalParameters().usernameFragment;var u=r.writeCandidate(s);o.candidate=Object.assign(o.candidate,r.parseCandidate(u)),o.candidate.candidate=u,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var l=r.getMediaSections(i._localDescription.sdp);l[o.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",i._localDescription.sdp=r.getDescription(i._localDescription.sdp)+l.join("");var d=i.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",o),d&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout((function(){o.forEach((function(e){a.onlocalcandidate(e)}))}),0)}},l.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},l.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},l.prototype._transceive=function(e,n,i){var o=a(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(o.encodings=e.sendEncodingParameters,o.rtcp={cname:r.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(o.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(o)),i&&e.rtpReceiver&&o.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?o.encodings=e.recvEncodingParameters:o.encodings=[{}],o.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(o.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(o.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(o))},l.prototype.setLocalDescription=function(e){var t,n,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!o("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=r.splitSections(e.sdp),n=t.shift(),t.forEach((function(e,t){var n=r.parseRtpParameters(e);i.transceivers[t].localCapabilities=n})),i.transceivers.forEach((function(e,t){i._gather(e.mid,t)}));else if("answer"===e.type){t=r.splitSections(i._remoteDescription.sdp),n=t.shift();var s=r.matchPrefix(n,"a=ice-lite").length>0;t.forEach((function(e,t){var o=i.transceivers[t],c=o.iceGatherer,u=o.iceTransport,l=o.dtlsTransport,d=o.localCapabilities,p=o.remoteCapabilities;if(!(r.isRejected(e)&&0===r.matchPrefix(e,"a=bundle-only").length)&&!o.rejected){var h=r.getIceParameters(e,n),f=r.getDtlsParameters(e,n);s&&(f.role="server"),i.usingBundle&&0!==t||(i._gather(o.mid,t),"new"===u.state&&u.start(c,h,s?"controlling":"controlled"),"new"===l.state&&l.start(f));var m=a(d,p);i._transceive(o,m.codecs.length>0,!1)}}))}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},l.prototype.setRemoteDescription=function(i){var l=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!o("setRemoteDescription",i.type,l.signalingState)||l._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+l.signalingState));var d={};l.remoteStreams.forEach((function(e){d[e.id]=e}));var p=[],h=r.splitSections(i.sdp),f=h.shift(),m=r.matchPrefix(f,"a=ice-lite").length>0,g=r.matchPrefix(f,"a=group:BUNDLE ").length>0;l.usingBundle=g;var v=r.matchPrefix(f,"a=ice-options:")[0];return l.canTrickleIceCandidates=!!v&&v.substr(14).split(" ").indexOf("trickle")>=0,h.forEach((function(o,c){var u=r.splitLines(o),h=r.getKind(o),v=r.isRejected(o)&&0===r.matchPrefix(o,"a=bundle-only").length,_=u[0].substr(2).split(" ")[2],b=r.getDirection(o,f),y=r.parseMsid(o),E=r.getMid(o)||r.generateIdentifier();if(v||"application"===h&&("DTLS/SCTP"===_||"UDP/DTLS/SCTP"===_))l.transceivers[c]={mid:E,kind:h,protocol:_,rejected:!0};else{var O,C,S,T,w,I,P,j,k;!v&&l.transceivers[c]&&l.transceivers[c].rejected&&(l.transceivers[c]=l._createTransceiver(h,!0));var A,R,L=r.parseRtpParameters(o);v||(A=r.getIceParameters(o,f),(R=r.getDtlsParameters(o,f)).role="client"),P=r.parseRtpEncodingParameters(o);var N=r.parseRtcpParameters(o),M=r.matchPrefix(o,"a=end-of-candidates",f).length>0,D=r.matchPrefix(o,"a=candidate:").map((function(e){return r.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===i.type||"answer"===i.type)&&!v&&g&&c>0&&l.transceivers[c]&&(l._disposeIceAndDtlsTransports(c),l.transceivers[c].iceGatherer=l.transceivers[0].iceGatherer,l.transceivers[c].iceTransport=l.transceivers[0].iceTransport,l.transceivers[c].dtlsTransport=l.transceivers[0].dtlsTransport,l.transceivers[c].rtpSender&&l.transceivers[c].rtpSender.setTransport(l.transceivers[0].dtlsTransport),l.transceivers[c].rtpReceiver&&l.transceivers[c].rtpReceiver.setTransport(l.transceivers[0].dtlsTransport)),"offer"!==i.type||v){if("answer"===i.type&&!v){C=(O=l.transceivers[c]).iceGatherer,S=O.iceTransport,T=O.dtlsTransport,w=O.rtpReceiver,I=O.sendEncodingParameters,j=O.localCapabilities,l.transceivers[c].recvEncodingParameters=P,l.transceivers[c].remoteCapabilities=L,l.transceivers[c].rtcpParameters=N,D.length&&"new"===S.state&&(!m&&!M||g&&0!==c?D.forEach((function(e){s(O.iceTransport,e)})):S.setRemoteCandidates(D)),g&&0!==c||("new"===S.state&&S.start(C,A,"controlling"),"new"===T.state&&T.start(R)),!a(O.localCapabilities,O.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&O.sendEncodingParameters[0].rtx&&delete O.sendEncodingParameters[0].rtx,l._transceive(O,"sendrecv"===b||"recvonly"===b,"sendrecv"===b||"sendonly"===b),!w||"sendrecv"!==b&&"sendonly"!==b?delete O.rtpReceiver:(k=w.track,y?(d[y.stream]||(d[y.stream]=new e.MediaStream),n(k,d[y.stream]),p.push([k,w,d[y.stream]])):(d.default||(d.default=new e.MediaStream),n(k,d.default),p.push([k,w,d.default])))}}else{(O=l.transceivers[c]||l._createTransceiver(h)).mid=E,O.iceGatherer||(O.iceGatherer=l._createIceGatherer(c,g)),D.length&&"new"===O.iceTransport.state&&(!M||g&&0!==c?D.forEach((function(e){s(O.iceTransport,e)})):O.iceTransport.setRemoteCandidates(D)),j=e.RTCRtpReceiver.getCapabilities(h),t<15019&&(j.codecs=j.codecs.filter((function(e){return"rtx"!==e.name}))),I=O.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var x,U=!1;if("sendrecv"===b||"sendonly"===b){if(U=!O.rtpReceiver,w=O.rtpReceiver||new e.RTCRtpReceiver(O.dtlsTransport,h),U)k=w.track,y&&"-"===y.stream||(y?(d[y.stream]||(d[y.stream]=new e.MediaStream,Object.defineProperty(d[y.stream],"id",{get:function(){return y.stream}})),Object.defineProperty(k,"id",{get:function(){return y.track}}),x=d[y.stream]):(d.default||(d.default=new e.MediaStream),x=d.default)),x&&(n(k,x),O.associatedRemoteMediaStreams.push(x)),p.push([k,w,x])}else O.rtpReceiver&&O.rtpReceiver.track&&(O.associatedRemoteMediaStreams.forEach((function(t){var n=t.getTracks().find((function(e){return e.id===O.rtpReceiver.track.id}));n&&function(t,n){n.removeTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(n,t)})),O.associatedRemoteMediaStreams=[]);O.localCapabilities=j,O.remoteCapabilities=L,O.rtpReceiver=w,O.rtcpParameters=N,O.sendEncodingParameters=I,O.recvEncodingParameters=P,l._transceive(l.transceivers[c],!1,U)}}})),void 0===l._dtlsRole&&(l._dtlsRole="offer"===i.type?"active":"passive"),l._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?l._updateSignalingState("have-remote-offer"):l._updateSignalingState("stable"),Object.keys(d).forEach((function(t){var n=d[t];if(n.getTracks().length){if(-1===l.remoteStreams.indexOf(n)){l.remoteStreams.push(n);var r=new Event("addstream");r.stream=n,e.setTimeout((function(){l._dispatchEvent("addstream",r)}))}p.forEach((function(e){var t=e[0],r=e[1];n.id===e[2].id&&u(l,t,r,[n])}))}})),p.forEach((function(e){e[2]||u(l,e[0],e[1],[])})),e.setTimeout((function(){l&&l.transceivers&&l.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},l.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},l.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},l.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},l.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},l.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},l.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var a=n.transceivers.filter((function(e){return"audio"===e.kind})).length,o=n.transceivers.filter((function(e){return"video"===e.kind})).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(a=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(o=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(n.transceivers.forEach((function(e){"audio"===e.kind?--a<0&&(e.wantReceive=!1):"video"===e.kind&&--o<0&&(e.wantReceive=!1)}));a>0||o>0;)a>0&&(n._createTransceiver("audio"),a--),o>0&&(n._createTransceiver("video"),o--);var u=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach((function(i,a){var o=i.track,s=i.kind,c=i.mid||r.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=n._createIceGatherer(a,n.usingBundle));var u=e.RTCRtpSender.getCapabilities(s);t<15019&&(u.codecs=u.codecs.filter((function(e){return"rtx"!==e.name}))),u.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),u.headerExtensions.forEach((function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var l=i.sendEncodingParameters||[{ssrc:1001*(2*a+1)}];o&&t>=15019&&"video"===s&&!l[0].rtx&&(l[0].rtx={ssrc:l[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,s)),i.localCapabilities=u,i.sendEncodingParameters=l})),"max-compat"!==n._config.bundlePolicy&&(u+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),u+="a=ice-options:trickle\r\n",n.transceivers.forEach((function(e,t){u+=i(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),u+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,u+="a="+r.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(u+="a=end-of-candidates\r\n"))}));var l=new e.RTCSessionDescription({type:"offer",sdp:u});return Promise.resolve(l)},l.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var o=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(o+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),o+="a=ice-options:trickle\r\n";var s=r.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach((function(e,r){if(!(r+1>s)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?o+="m=application 0 DTLS/SCTP 5000\r\n":o+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?o+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(o+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(o+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;if(e.stream)"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var u=a(e.localCapabilities,e.remoteCapabilities);!u.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,o+=i(e,u,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(o+="a=rtcp-rsize\r\n")}}));var u=new e.RTCSessionDescription({type:"answer",sdp:o});return Promise.resolve(u)},l.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(i,a){if(!n._remoteDescription)return a(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var u=0;u<n.transceivers.length;u++)if(n.transceivers[u].mid===e.sdpMid){o=u;break}var l=n.transceivers[o];if(!l)return a(c("OperationError","Can not add ICE candidate"));if(l.rejected)return i();var d=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if("tcp"===d.protocol&&(0===d.port||9===d.port))return i();if(d.component&&1!==d.component)return i();if((0===o||o>0&&l.iceTransport!==n.transceivers[0].iceTransport)&&!s(l.iceTransport,d))return a(c("OperationError","Can not add ICE candidate"));var p=e.candidate.trim();0===p.indexOf("a=")&&(p=p.substr(2)),(t=r.getMediaSections(n._remoteDescription.sdp))[o]+="a="+(d.type?p:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=r.getDescription(n._remoteDescription.sdp)+t.join("")}else for(var h=0;h<n.transceivers.length&&(n.transceivers[h].rejected||(n.transceivers[h].iceTransport.addRemoteCandidate({}),(t=r.getMediaSections(n._remoteDescription.sdp))[h]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=r.getDescription(n._remoteDescription.sdp)+t.join(""),!n.usingBundle));h++);i()}))},l.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)})),!n)throw c("InvalidAccessError","Invalid selector.");return n.getStats()}var r=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&r.push(e[t].getStats())}))})),Promise.all(r).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var r=n.prototype.getStats;n.prototype.getStats=function(){return r.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(n){var r;e[n].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(r=e[n]).type]||r.type,t.set(n,e[n])})),t}))}}}));var d=["createOffer","createAnswer"];return d.forEach((function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(d=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),l}},"8Lyy":function(e,t,n){var r=n("O6qx"),i=/%[sdv%]/g,a=function(e){var t=1,n=arguments,r=n.length;return e.replace(i,(function(e){if(t>=r)return e;var i=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},o=function(e,t,n){var r=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var o=t.names[i];t.name?r.push(n[t.name][o]):r.push(n[t.names[i]])}else r.push(n[t.name]);return a.apply(null,r)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var n=t.outerOrder||s,i=t.innerOrder||c,a=[];return n.forEach((function(t){r[t].forEach((function(n){n.name in e&&null!=e[n.name]?a.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){a.push(o(t,n,e))}))}))})),e.media.forEach((function(e){a.push(o("m",r.m[0],e)),i.forEach((function(t){r[t].forEach((function(n){n.name in e&&null!=e[n.name]?a.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){a.push(o(t,n,e))}))}))}))})),a.join("\r\n")+"\r\n"}},"9XzT":function(e,t,n){t.Interop=n("/oKx")},As6E:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));n("91GP"),n("rGqo"),n("Btvt");var r=n("q1tI"),i=n("i8i4"),a=(n("17x9"),n("ZxpX")),o=n("clTp");class s extends r.Component{constructor(e){super(e),this.onClick=()=>{if(!this.state.dropdown||this.state.dropdown.removed){var e=this.props,t=e.text,n=e.position,r=e.align,i=e.marginTop,a=e.marginLeft,s=Object(o.default)(this.el);this.update({text:t,position:n,align:r,rect:s,marginTop:i,marginLeft:a})}else this.update()},this.onMouseEnter=e=>{this.callerHovered=!0,this.timeouts.appear=setTimeout(()=>{if(this.el&&this.callerHovered){var e=this.props,t=e.position,n=e.align,r=e.marginTop,i=e.marginLeft,a=Object(o.default)(this.el);this.update({position:t,align:n,rect:a,marginTop:r,marginLeft:i})}},80)},this.onMouseLeave=e=>{this.callerHovered=!1,this.timeouts.callerDisappear=setTimeout(()=>{this.callerHovered||this.hovered||this.update()},250)},this.onDropdownMouseEnter=()=>{"hover"===this.props.trigger&&(this.hovered=!0)},this.onDropdownMouseLeave=e=>{"hover"===this.props.trigger&&(this.hovered=!1,this.timeouts.disappear=setTimeout(()=>{this.callerHovered||this.hovered||this.update()},250))},this.onDocumentClick=e=>{!this.state.dropdown||this.state.dropdown.removed||this.el.contains(e.target)||this.update()},this.onResize=e=>{if(this.state.dropdown&&!this.state.dropdown.removed){var t=this.props,n=t.text,r=t.position,i=t.align,a=t.marginTop,s=t.marginLeft,c=Object(o.default)(this.el);this.update({text:n,position:r,align:i,rect:c,marginTop:a,marginLeft:s})}},this.onTransitionEnd=e=>{"visibility"===e.propertyName&&this.state.dropdown&&this.state.dropdown.removed&&this.setState({dropdown:void 0})},this.onItemClick=(e,t)=>{t.separator||(this.update(),t.onClick(e))},this.state={},this.timeouts={}}componentDidMount(){this.el=i.findDOMNode(this),"click"===this.props.trigger?(this.el.addEventListener("click",this.onClick),document.addEventListener("mousedown",this.onDocumentClick),window.addEventListener("resize",this.onResize)):(this.el.addEventListener("mouseenter",this.onMouseEnter),this.el.addEventListener("mouseleave",this.onMouseLeave))}componentWillUnmount(){Object.keys(this.timeouts).forEach(e=>{clearTimeout(this.timeouts[e])}),"click"===this.props.trigger?(this.el.removeEventListener("click",this.onClick),document.removeEventListener("mousedown",this.onDocumentClick),window.removeEventListener("resize",this.onResize)):(this.el.removeEventListener("mouseenter",this.onMouseEnter),this.el.removeEventListener("mouseleave",this.onMouseLeave)),this.defaultNode&&(this.defaultNode.parentNode.removeChild(this.defaultNode),delete this.defaultNode)}update(e){if(!e)return this.setState({dropdown:Object.assign({},this.state.dropdown,{removed:!0})});var t=e.position,n=e.align,r=e.rect,i=e.marginTop,a=e.marginLeft,o=r.left,s=r.top;switch(t){case"t":o+=.5*r.width;break;case"r":o+=r.width,s+=.5*r.height;break;case"b":o+=.5*r.width,s+=r.height;break;case"l":s+=.5*r.height}o=Math.round(o+a),s=Math.round(s+i),this.setState({dropdown:{position:t,align:n,x:o,y:s}})}renderDropdown(){if(!this.state.dropdown)return null;var e=this.state.dropdown,t=e.x,n=e.y,i=e.position,o=e.align,s=e.removed,c=Object(a.classNames)("Dropdown","Dropdown--"+i,{"Dropdown--removed":!!s,["Dropdown--align-"+o]:"t"===i||"b"===i},this.props.className);return r.createElement("div",{className:c,style:{top:n,left:t},onTransitionEnd:e=>this.onTransitionEnd(e),onMouseEnter:this.onDropdownMouseEnter,onMouseLeave:this.onDropdownMouseLeave},r.createElement("ul",{className:"Dropdown__in"},this.props.data.map((e,t)=>r.createElement("li",{className:Object(a.classNames)("Dropdown__item",{Dropdown__item_separator:e.separator}),onClick:t=>this.onItemClick(t,e),key:void 0!==e.id?e.id:t},e.text))))}render(){var e=this.renderDropdown();return e?(this.defaultNode||"undefined"==typeof window||(this.defaultNode=document.createElement("div"),document.body.appendChild(this.defaultNode)),r.createElement(r.Fragment,null,this.props.children,i.createPortal(e,this.defaultNode))):this.props.children}}s.defaultProps={position:"b",align:"center",marginTop:0,marginLeft:0,trigger:"click",className:""}},"BN/X":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var r=n("q1tI"),i=(n("17x9"),n("ZxpX"));function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function o(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}class s extends r.Component{render(){var e=this.props,t=e.hovered,n=e.className,s=e.children,c=o(e,["hovered","className","children"]),u=Object(i.classNames)("Link",{"Link--hovered":!!t},n);return this.props.href?r.createElement("a",a({},c,{className:u}),s):r.createElement("span",a({},c,{className:u}),s)}}s.defaultProps={href:void 0,hovered:!1}},BxOC:function(e,t,n){"use strict";n.r(t),n.d(t,"post",(function(){return i})),n.d(t,"plainget",(function(){return a})),n.d(t,"plaingetCancelable",(function(){return o}));n("VRzm"),n("Btvt");var r=n("cGUQ");function i(e,t,n){return t&&(t.im_v=3),new Promise((r,i)=>{ajax.post(e,t,{timeout:n,onDone(){r.apply(null,[[...arguments]])},onFail(){return i.apply(null,arguments),!0}})})}function a(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=o(e,t,n),i=r.request;return i}function o(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};function a(){n.abort()}n=window.XDomainRequest?new XDomainRequest:ajax._getreq();var o=new Promise((a,o)=>{var s,c=Date.now(),u=i.timeout||60,l=Object(r.toQueryString)(t);if(window.XDomainRequest)n.open("get",`${e}?${l}`),n.ontimeout=function(e){o([e,{}])},n.onerror=function(e){o([e,{}])},n.onload=function(){a([n.responseText,{}])},setTimeout((function(){n.send()}),0);else{n.onreadystatechange=function(){4==n.readyState&&(clearInterval(s),n.status>=200&&n.status<300?a([n.responseText,n]):o([n.responseText,n]))};try{n.open("GET",`${e}?${l}`,!0)}catch(e){return o([e,n])}n.send()}s=setInterval((function(){Date.now()-c>1e3*u&&(window.browser.safari&&n.abort(),o(["",{}]),clearInterval(s))}),1e3)});return{request:o,cancel:a}}},ERyv:function(e,t,n){"use strict";n.r(t),n.d(t,"isWeirdLogging",(function(){return u})),n.d(t,"imWeirdLog",(function(){return l})),n.d(t,"imWeirdCatch",(function(){return d})),n.d(t,"startLoggingAllUnhandled",(function(){return p})),n.d(t,"stopLoggingAllUnhandled",(function(){return h}));n("VRzm"),n("Btvt");var r,i=n("BxOC"),a=n("DM26"),o=1;function s(e,t,n,i,a){if("Script error."!==e){var o=a?a.stack||a.message:null;l("unhandled_error",o?{err:e,stack:o}:{err:e})}r&&r.apply(this,arguments)}function c(e){e.preventDefault()}function u(){return!!window.imwl}function l(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];u()&&(n&&window.console&&(console.error(e,t),console.trace&&console.trace()),Object(a.retryFn)(i.post,3,()=>2)("al_im.php",{act:"a_weird_log",kind:e,data:JSON.stringify(extend({errIdx:o++,ua:navigator.userAgent},t))}))}function d(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return l(e,extend({err:t&&t.message||t},n)),Promise.reject(t)}function p(){r=window.onerror,window.onerror=s,window.addEventListener("unhandledrejection",c)}function h(){window.onerror=r,r=void 0,window.removeEventListener("unhandledrejection",c)}},FABD:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return h}));n("91GP"),n("ioFf"),n("rGqo"),n("a1Th"),n("Btvt");var r=n("q1tI"),i=(n("17x9"),n("ZxpX")),a=n("vRp6"),o=n("xGYt"),s=n("dt/K");function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function u(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function l(e){var t=e.id,n=e.name,a=e.tokens,o=e.onRemoveToken,l=e.removeTokenTooltip,d=e.removeTokenAriaLabel,p=e.renderToken,h=e.onChange,f=e.value,m=e.placeholder,g=e.onSubmit,v=e.className,_=u(e,["id","name","tokens","onRemoveToken","removeTokenTooltip","removeTokenAriaLabel","renderToken","onChange","value","placeholder","onSubmit","className"]),b=r.useRef(),y=r.useCallback(e=>h(e),[h]),E=r.useCallback(e=>{"Esc"===e.key&&b.current&&(b.current.value="",b.current.blur(),h(e),e.stopPropagation()),"Enter"===e.key&&g()},[g]),O=r.useCallback(e=>{var t=e.target.dataset.id;o(t),b.current&&b.current.focus()},[o]);return r.createElement("div",{className:Object(i.classNames)("TokenInput",v)},r.createElement("label",{htmlFor:t,className:"TokenInput__back"}),a.map(e=>r.createElement("span",{key:e.id,className:"TokenInput__token"},r.createElement("input",{type:"hidden",name:n+"[]",value:e.value||e.id}),r.createElement("span",{className:"TokenInput__label"},p?p(e):e.text),!e.locked&&l&&r.createElement(s.default,{text:l},r.createElement("button",{"data-id":e.id,className:"TokenInput__remove",onClick:O,"aria-label":d})),!e.locked&&!l&&r.createElement("button",{"data-id":e.id,className:"TokenInput__remove",onClick:O,"aria-label":d}))),r.createElement("div",{className:"TokenInput__caret"},r.createElement("div",{className:"TokenInput__caretIn"},r.createElement("input",c({},_,{id:t,type:"text",value:f,onChange:y,onPaste:y,placeholder:0===a.length?m:"",onKeyDown:E,className:"TokenInput__input",ref:b})))))}function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function p(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}l.defaultProps={id:"token-input",name:"tokens",removeTokenTooltip:"",removeTokenAriaLabel:"Remove item",placeholder:"",className:""};class h extends r.PureComponent{constructor(e){super(e),this.onRemoveToken=e=>{var t=this.searchContainer.offsetHeight;this.props.onRemoveToken(e.target.getAttribute("data-id")).then(()=>{this.updateScroll(t)})},this.onChange=e=>{var t=e.target.value;t!==this.value&&(this.value=t,this.props.onChange(e),this.scrollContainer.scrollTop=0)},this.onSelect=e=>{var t=this.searchContainer.offsetHeight;this.props.onSelect(e.currentTarget.getAttribute("data-id")).then(()=>{this.updateScroll(t)})},this.updateScroll=e=>{var t=this.searchContainer.offsetHeight;this.searchContainer.querySelector("#"+this.inputId).focus(),this.searchContainer.scrollTop=this.searchContainer.scrollHeight,e!==t&&(this.scrollContainer.scrollTop=this.scrollContainer.scrollTop+t-e)},this.searchContainerRef=e=>{this.searchContainer=e},this.scrollContainerRef=e=>{var t=e;if(e&&e.container)for(t=e;t.container;)t=t.container;this.scrollContainer=t},this.value=e.value,this.inputId="token-input-"+Math.floor(1e6*Math.random()).toString(16)}render(){var e=this.props,t=e.className,n=e.tokens,s=(e.onSelect,e.renderToken),c=e.onRemoveToken,u=e.removeTokenPlaceholder,h=e.value,f=e.placeholder,m=e.useInfiniteScroll,g=e.loadMore,v=e.hasMore,_=e.virtualized,b=e.notFoundText,y=e.children,E=e.emptyText,O=e.isSearching,C=e.renderSuggest,S=e.data,T=p(e,["className","tokens","onSelect","renderToken","onRemoveToken","removeTokenPlaceholder","value","placeholder","useInfiniteScroll","loadMore","hasMore","virtualized","notFoundText","children","emptyText","isSearching","renderSuggest","data"]),w=m?a.default:"div",I=m?{loadMore:g,hasMore:v,virtualized:_,useCapture:!1}:{},P=y?[].concat(y):[],j=!S&&0===P.length||!!S&&0===S.length&&(h||E)&&!O;return r.createElement("div",{className:Object(i.classNames)("MultiSelect",t)},r.createElement("div",{className:"MultiSelect__search",ref:this.searchContainerRef},r.createElement(l,d({id:this.inputId,tokens:n,onRemoveToken:c,removeTokenTooltip:u,removeTokenAriaLabel:u,placeholder:f,onChange:this.onChange,onSubmit:()=>{},renderToken:s,value:h},T))),j&&r.createElement("div",{className:"MultiSelect__empty"},r.createElement("div",{className:"MultiSelect__emptyIn"},h?b:E)),r.createElement(w,d({className:"MultiSelect__scroll",ref:this.scrollContainerRef},I),!!S&&S.map(e=>C(e,this.onSelect)),!S&&P.map(e=>C?C(e,this.onSelect):r.createElement(o.default,{className:"MultiSelect__suggestsItem","data-id":e.props["data-id"],onClick:this.onSelect,key:e.key},e))))}}h.defaultProps={removeTokenPlaceholder:"",placeholder:"",value:"",useInfiniteScroll:!1,notFoundText:"Not found"}},FEsp:function(e,t,n){"use strict";n.r(t);var r=n("q1tI"),i=n.n(r),a=n("ZxpX"),o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},s=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};t.default=function(e){var t=e.children,n=e.className,r=s(e,["children","className"]);return i.a.createElement("div",o({},r,{className:Object(a.classNames)("Stub",n)}),t||"No results.")}},KCt4:function(e,t,n){"use strict";var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},r.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]},r.getMediaSections=function(e){var t=r.splitSections(e);return t.shift(),t},r.matchPrefix=function(e,t){return r.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},r.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},r.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},r.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},r.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?r.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},r.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},r.getCryptoParameters=function(e,t){return r.matchPrefix(e+t,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(e,t){var n=r.matchPrefix(e+t,"a=ice-ufrag:")[0],i=r.matchPrefix(e+t,"a=ice-pwd:")[0];return n&&i?{usernameFragment:n.substr(12),password:i.substr(10)}:null},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var a=n[i],o=r.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(o){var s=r.parseRtpMap(o),c=r.matchPrefix(e,"a=fmtp:"+a+" ");switch(s.parameters=c.length?r.parseFmtp(c[0]):{},s.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(r.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(r.parseExtmap(e))})),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)}));var i=0;return t.codecs.forEach((function(e){e.maxptime>i&&(i=e.maxptime)})),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach((function(e){n+=r.writeExtmap(e)})),n},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),a=-1!==i.fecMechanisms.indexOf("RED"),o=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=s.length>0&&s[0].ssrc,u=r.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),i.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(r.rtx={ssrc:t}),n.push(r),a&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},n.push(r))}})),0===n.length&&c&&n.push({ssrc:c});var l=r.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,n.forEach((function(e){e.maxBitrate=l}))),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var a=r.matchPrefix(e,"a=rtcp-mux");return t.mux=a.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var i=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},r.parseSctpDescription=function(e){var t,n=r.parseMLine(e),i=r.matchPrefix(e,"a=max-message-size:");i.length>0&&(t=parseInt(i[0].substr(19),10)),isNaN(t)&&(t=65536);var a=r.matchPrefix(e,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substr(12),10),protocol:n.fmt,maxMessageSize:t};if(r.matchPrefix(e,"a=sctpmap:").length>0){var o=r.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(o[0],10),protocol:o[1],maxMessageSize:t}}},r.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,t,n){var i=void 0!==t?t:2;return"v=0\r\no="+(n||"thisisadapterortc")+" "+(e||r.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var a=r.writeRtpDescription(e.kind,t);if(a+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),a+="a=mid:"+e.mid+"\r\n",e.direction?a+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var o="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";a+="a="+o,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),a},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){var t=r.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},r.parseOLine=function(e){var t=r.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},r.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=r.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0},e.exports=r},LQSR:function(e,t){e.exports=function e(t){if(!t)return!1;if(this.length!=t.length)return!1;for(var n=0,r=this.length;n<r;n++)if(this[n]instanceof Array&&t[n]instanceof Array){if(!e.apply(this[n],[t[n]]))return!1}else if(this[n]!=t[n])return!1;return!0}},"MV/q":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var r=n("q1tI"),i=(n("17x9"),n("ZxpX"));function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function o(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}class s extends r.Component{constructor(e){super(e),this.getRef=e=>{this.element=e},this.resize=()=>{var e=this.element;if(e){var t=e.offsetHeight,n=e.scrollHeight,r=0;n+r<=t&&(r=0),e.value&&this.setState({height:n-r}),this.setState({height:0},()=>{var t=e.scrollHeight-r;this.setState({height:t}),this.props.onResize(e)})}},this.onChange=e=>{this.props.grow&&this.resize(),this.isControlledOutside||this.setState({value:e.target.value}),this.props.onChange&&this.props.onChange(e)},this.state={value:void 0===e.value?e.initialValue||"":void 0},void 0!==e.value&&(this.isControlledOutside=!0)}componentDidMount(){this.props.grow&&this.resize()}render(){var e=this.props,t=e.className,n=(e.initialValue,e.grow,e.style),s=(e.onResize,e.value),c=o(e,["className","initialValue","grow","style","onResize","value"]),u=this.isControlledOutside?s:this.state.value,l=this.state.height||n.height||66;return r.createElement("textarea",a({},c,{value:u,onChange:this.onChange,onInput:this.onChange,onPaste:this.onChange,ref:this.getRef,style:a({},n,{height:l}),className:Object(i.classNames)("Textarea",t)}))}}s.defaultProps={initialValue:"",grow:!0,onResize:()=>{},style:{}}},MhhX:function(e,t,n){"use strict";n.r(t),n.d(t,"isUnread",(function(){return a})),n.d(t,"isServiceMsg",(function(){return o})),n.d(t,"isCallMessage",(function(){return s})),n.d(t,"isActiveGroupCallMessage",(function(){return c})),n.d(t,"isOut",(function(){return u})),n.d(t,"hasReply",(function(){return l})),n.d(t,"isGraffiti",(function(){return p})),n.d(t,"isAudioMsg",(function(){return h})),n.d(t,"isSticker",(function(){return f})),n.d(t,"isGift",(function(){return m})),n.d(t,"isMoney",(function(){return g})),n.d(t,"isMoneyRequest",(function(){return v})),n.d(t,"isVKPay",(function(){return _})),n.d(t,"isImportant",(function(){return b})),n.d(t,"getUserId",(function(){return y})),n.d(t,"getAuthorId",(function(){return E})),n.d(t,"getAdminId",(function(){return O})),n.d(t,"wasEdited",(function(){return C})),n.d(t,"isMessageSelected",(function(){return S})),n.d(t,"isCasperMessage",(function(){return T})),n.d(t,"isMessageToBlockedCommunity",(function(){return w})),n.d(t,"hasPrivateStory",(function(){return I})),n.d(t,"isMessageEmpty",(function(){return P})),n.d(t,"getMessageTTL",(function(){return j})),n.d(t,"isExpiredCasperMessage",(function(){return k})),n.d(t,"MARKED_TYPE_MENTIONS",(function(){return A})),n.d(t,"MARKED_TYPE_CASPER",(function(){return R})),n.d(t,"getFromMessageMarkedDataByType",(function(){return L})),n.d(t,"getMentionsFromMessage",(function(){return N})),n.d(t,"hasUserMentions",(function(){return M}));n("OEbY");var r=n("f01n"),i=n("aong");function a(e,t){return"number"!=typeof t.messageId||(u(t)?t.messageId>e.out_up_to:t.messageId>e.in_up_to)}function o(e){return e.kludges&&void 0!==e.kludges.source_act}function s(e){return"call"===e.kludges.attach1_type}function c(e){return e&&e.attaches&&e.attaches[0]&&"group_call_in_progress"===e.attaches[0].type}function u(e){return e.flags&r.FLAG_OUTBOUND}function l(e){var t=e.attaches.filter(e=>"mail"===e.type).length>0;return e.attaches.filter(e=>"reply"===e.type).length>0||e.flags&r.FLAG_HAS_REPLY&&t}function d(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=e.attaches[0];return r&&(r.type===t||r.type===n)}function p(e){return d(e,"doc")&&"graffiti"===e.attaches[0].kind}function h(e){return Boolean(e.attaches.find(e=>"doc"===e.type&&"audiomsg"===e.kind))}function f(e){return Boolean(e.attaches.find(e=>"sticker"===e.type))}function m(e){return d(e,"gift")}function g(e){return d(e,"money_transfer","money_request")}function v(e){return d(e,"money_request")}function _(e){return d(e,"link","vkpay")&&6217559==e.kludges.attach1_app_id}function b(e){return e.flags&r.FLAG_IMPORTANT}function y(e){return u(e)?vk.id:e.userId}function E(e,t){var n=Object(i.unpackStore)(e);return u(t)?n.id:t.userId}function O(e,t){var n=Object(i.unpackStore)(e);return n.gid&&u(t)?+t.kludges.from_admin||-n.gid:0}function C(e){return e.update_time>0}function S(e,t){return(e.get().selectedMessages||[]).indexOf(t)>=0}function T(e){return Boolean(e.kludges.is_expired||e.kludges.expire_ttl||e.kludges.ttl&&e.flags&r.FLAG_DELETE_BY_TTL)}function w(e,t){return!(!e.blocked_community||!u(t))}function I(e){return!(!e||!e.kludges.has_private_story)}function P(e){return e.messageId<=0}function j(e){var t=e.kludges.ttl||e.kludges.expire_ttl;return t?Number(t):void 0}function k(e){return!(!e.kludges||!e.kludges.is_expired)}var A=1,R=2;function L(e,t){var n=e.kludges&&e.kludges.marked_users,r=n&&n.find(e=>e[0]===t);return r?r[1]:void 0}function N(e){if(!e.kludges&&!e.kludges.marked_users)return[];var t=L(e,A);return t?Array.isArray(t)?t:[t]:[]}function M(e,t){if(!e.kludges&&!e.kludges.mentions&&!e.kludges.marked_users)return!1;var n=e.kludges.marked_users?N(e):e.kludges.mentions;return!!n&&n.findIndex(e=>e===t||"all"===e)>-1}},N4ZS:function(e,t,n){"use strict";function r(e){return"https://vk.com/web/away.php?to="+e}function i(e,t){var n=decodeURIComponent(e);return/^\/[^/]/.test(n)||/^(https?:\/\/)?([a-z0-9_\-.]+\.)?vk.com(\/.*)?/.test(n)?e:"/away.php?to="+encodeURIComponent(n)+(t?"&utf=1":"")}n.r(t),n.d(t,"wrapAway",(function(){return r})),n.d(t,"wrapAwayIfExternal",(function(){return i}))},Nlxk:function(e,t,n){"use strict";n.r(t),n.d(t,"getProgress",(function(){return p})),n.d(t,"preloadImage",(function(){return h})),n.d(t,"preloadImagesFromResponse",(function(){return f})),n.d(t,"showCautionBox",(function(){return m})),n.d(t,"showPermissionsError",(function(){return g})),n.d(t,"showError",(function(){return v})),n.d(t,"showIncomingHandlingError",(function(){return _})),n.d(t,"pauseGlobalMedia",(function(){return b})),n.d(t,"resumeGlobalMedia",(function(){return y})),n.d(t,"tabIsMaster",(function(){return E})),n.d(t,"tabIsIdle",(function(){return O})),n.d(t,"navigateToConvo",(function(){return C}));n("rGqo"),n("VRzm"),n("Btvt");var r=n("VBqm"),i=n("zxIV"),a=n("kcIO"),o=n("EasH"),s=n("4+be"),c=n("PU8N"),u=n("/PiP"),l=n("P13b"),d=!1;function p(){var e=document.querySelector("#box_layer_wrap"),t=document.querySelector("#box_loader"),n=Object(i.isVisible)(e);return{showProgress(){Object(a.boxRefreshCoords)(t),Object(i.show)(t),n||Object(i.show)(e)},hideProgress(){Object(i.hide)(t),n||Object(i.hide)(e)}}}function h(e){return new Promise((t,n)=>{var r=new Image;r.src=e,r.onload=t,r.onerror=n})}function f(e){var t=[].concat(...e).map(e=>{var t=e.photo;return t?h(t):Promise.resolve()});return Promise.all(t).then(()=>e).catch(()=>e)}function m(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t?Object(s.getLang)("calls_reject_title"):Object(s.getLang)("calls_hangup_description"),r=t?Object(s.getLang)("calls_reject_description"):Object(s.getLang)("calls_hangup_description");return Object(o.showFastBox)(n,r,Object(s.getLang)("global_yes"),e,Object(s.getLang)("global_no"))}function g(e,t,n){var r="";e&&t?r=Object(s.getLang)("calls_error_no_cam_and_mic"):e?r=Object(s.getLang)("calls_error_no_cam"):t&&(r=Object(s.getLang)("calls_error_no_mic"));var i=Object(o.showFastBox)(Object(s.getLang)("global_error"),r,Object(s.getLang)("global_close"),()=>{i.hide(),n&&n()})}function v(e){return e&&Object(o.showFastBox)(Object(s.getLang)("global_error"),e)}function _(e){var t=Object(o.showFastBox)(Object(s.getLang)("global_error"),Object(s.getLang)("calls_incoming_process_error"),Object(s.getLang)("global_close"),()=>{t.hide(),e&&e()})}function b(){var e=!!Object(c.isMvk)(),t=e?audio:Object(u.getAudioPlayer)(),n=window.Videoview;Notifier&&(d=!0,Notifier.lcSend("video_start")),!e&&t&&t.isPlaying()&&(t.pause(),t.pausedByCalls=!0),!e&&n&&(n.togglePlay(!1),n.pausedByCalls=!0),e&&t.playing&&t.playing()&&(t.pause(),t.pausedByCalls=!0)}function y(){var e=!!Object(c.isMvk)(),t=e?audio:Object(u.getAudioPlayer)(),n=window.Videoview;Notifier&&d&&(d=!1,Notifier.lcSend("video_hide")),!e&&t&&t.pausedByCalls&&(t.play(),delete t.pausedByCalls),!e&&n&&n.pausedByCalls&&(n.togglePlay(!0),delete n.pausedByCalls),e&&t&&t.pausedByCalls&&(Object(r.wrapAudioPlay)(t).catch(()=>{}),delete window.audio.pausedByCalls)}function E(){return!(!window.curNotifier||!window.curNotifier.is_server)}function O(){return!!(curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle)}function C(e){nav.go(Object(l.getConvoLocation)(e))}},NsuH:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));var r=n("q1tI"),i=(n("17x9"),n("ZxpX")),a=n("BN/X");class o extends r.PureComponent{constructor(e){super(e),this.onError=()=>{this.setState({errored:!0})},this.state={}}getPhotoImage(){var e=this.props,t=e.photo,n=e.title;return r.createElement("img",{src:this.state.errored?"/images/camera_c.gif":t,alt:n,onError:this.onError,className:"Entity__photo"})}render(){var e=this.props,t=e.className,n=e.style,o=e.size,s=e.photo,c=e.href,u=e.title,l=e.description,d=e.target,p={["Entity--size"+o]:!!o};return r.createElement("div",{className:Object(i.classNames)("Entity",t,p),style:n},r.createElement("div",{className:"Entity__aside"},"string"==typeof s?c?r.createElement("a",{href:c,target:d},this.getPhotoImage()):this.getPhotoImage():s),r.createElement("div",{className:"Entity__main"},u&&c?r.createElement("div",{className:"Entity__title"},r.createElement(a.default,{href:c,dangerouslySetInnerHTML:{__html:u},target:d})):r.createElement("div",{className:"Entity__title",dangerouslySetInnerHTML:{__html:u}}),"string"!=typeof l?r.createElement("div",{className:"Entity__description"},l):r.createElement("div",{className:"Entity__description",dangerouslySetInnerHTML:{__html:l}})))}}o.defaultProps={size:null,photo:"",title:"",description:"",href:"",target:null}},O6qx:function(e,t){var n=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach((function(e){n[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},O8ze:function(e,t,n){"use strict";n.r(t),n.d(t,"statlogsForwardEvent",(function(){return h})),n.d(t,"statlogsForwardFromCommunityEvent",(function(){return f})),n.d(t,"statlogsCommunityTemplatesClickEvent",(function(){return m})),n.d(t,"statlogsForwardFromChannel",(function(){return g})),n.d(t,"statlogsSendingTime",(function(){return _})),n.d(t,"statlogsSendingTimeStart",(function(){return b})),n.d(t,"statlogsSendingTimeEnd",(function(){return y})),n.d(t,"statlogsSendingError",(function(){return E})),n.d(t,"statlogsSendingQueueLength",(function(){return S})),n.d(t,"statlogsSendingRetry",(function(){return T})),n.d(t,"statlogsBrowserNotificationsUser",(function(){return w})),n.d(t,"statlogsBrowserNotificationsOn",(function(){return I})),n.d(t,"statlogsBrowserNotificationsOff",(function(){return P}));n("pIFo");var r,i=n("1y80"),a=n("Bj12"),o=n("HLtZ"),s=function(){function e(){}return e.prototype.getCurrentTime=function(e){void 0===e&&(e=!0);var t=Date.now().toString(10);return e?t+"000":t},e.prototype.getIntId=function(){return Math.floor(Math.random()*e.MAX_INT32)},e.prototype.getBaseEvent=function(){return{id:this.getIntId(),timestamp:this.getCurrentTime()}},e.prototype.logEvent=function(e){e.type&&e[e.type]?Object(a.saveCustomStats)(e):Object(o.logError)(new Error("CustomStatCollector: invalid event."))},e.MAX_INT32=2147483647,e}();!function(e){e.TYPE_DEV_NULL_ITEM="type_dev_null_item"}(r||(r={}));var c=function(){return(c=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},u=function(){function e(e){this.customStatCollector=e}return e.prototype.logEvent=function(e){var t,n=c(c({},this.customStatCollector.getBaseEvent()),((t={type:r.TYPE_DEV_NULL_ITEM})[r.TYPE_DEV_NULL_ITEM]=e,t));this.customStatCollector.logEvent(n)},e}(),l=n("aong"),d=new u(new s),p={};function h(e){Object(i.statlogsProbValueEvent)(.1,"im_forward_stat",v(e),!!e.get().gid)}function f(e,t){Object(i.statlogsProbValueEvent)(.1,"im_forward_from_community_stat",v(e),!!e.get().gid,+t)}function m(){Object(i.statlogsProbValueEvent)(1,"im_apply_community_template_stat",1)}function g(){Object(i.statlogsProbValueEvent)(1,"messages_channel_forward_click",1)}function v(e){var t=e.get().pendingForward;return+(t&&t.msgIds&&t.msgIds.length)}function _(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=1;if(!Object(i.randEnabled)(o))return()=>{};var s=+new Date,c=O(e),u=C(e)?"sse":"longpoll";return function(){var e=+new Date-s;Object(a.saveStatlogEvents)({name:"messages_send_time_web",value:e,keys:[t,n,c,r,u]}),"opt_to_lp"===n&&d.logEvent({key:"messages_send_time_web",value_str:u,value:e})}}function b(e,t,n,r){if(t.messageId&&-1!==String(t.messageId).indexOf("rid")){var i=[t.messageId.replace("rid",""),n,r].join("_"),a=t.attaches.length>0;p[i]=_(e,n,r,a)}}function y(e,t,n,r){var i=[t.randomId,n,r].join("_"),a=p[i];a&&(a(),delete p[i])}function E(e,t,n,r){var a=O(e),o=""===t?"network":"unknown";Object(i.randEnabled)(1)&&Object(i.statlogsValueEvent)("messages_send_errors_web",o,n,r,a)}function O(e){var t=Object(l.unpackStore)(e);return Boolean(t.longpoll&&t.longpoll.isEnabled&&t.longpoll.isEnabled())}function C(e){var t=Object(l.unpackStore)(e);return Boolean(t.longpoll&&t.longpoll.isSSE)}function S(e){var t=Object(l.unpackStore)(e),n=t.imQueue(t.peer).length;Object(i.randEnabled)(1)&&Object(i.statlogsValueEvent)("messages_send_queue_size",n)}function T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unknown",n=1;Object(i.randEnabled)(n)&&Object(i.statlogsValueEvent)("messages_send_retry",1,t,e)}function w(){var e="im_browser_notifications_users";ls.get(e)||ls.get("im_ui_notify_off")||(ls.set(e,1),Object(i.statlogsValueEvent)(e,1))}function I(){Object(i.statlogsProbValueEvent)(1,"im_browser_notifications_on",1)}function P(){Object(i.statlogsProbValueEvent)(1,"im_browser_notifications_off",1)}},P13b:function(e,t,n){"use strict";n.r(t),n.d(t,"getFirstUnread",(function(){return o.getFirstUnread})),n.d(t,"isSearchShown",(function(){return o.isSearchShown})),n.d(t,"getPeer",(function(){return o.getPeer})),n.d(t,"getCurrentKeyboard",(function(){return o.getCurrentKeyboard})),n.d(t,"getKeyboard",(function(){return o.getKeyboard})),n.d(t,"getTab",(function(){return o.getTab})),n.d(t,"getCurrentTab",(function(){return o.getCurrentTab})),n.d(t,"getSelectedMessages",(function(){return o.getSelectedMessages})),n.d(t,"getMessageRangeFromSelection",(function(){return o.getMessageRangeFromSelection})),n.d(t,"countUnread",(function(){return o.countUnread})),n.d(t,"getMessageByRid",(function(){return o.getMessageByRid})),n.d(t,"isRidExist",(function(){return o.isRidExist})),n.d(t,"getLocalId",(function(){return o.getLocalId})),n.d(t,"getLastMessage",(function(){return o.getLastMessage})),n.d(t,"parserMessage",(function(){return o.parserMessage})),n.d(t,"getAuthorFullName",(function(){return o.getAuthorFullName})),n.d(t,"getMessage",(function(){return o.getMessage})),n.d(t,"getPreviousMessage",(function(){return o.getPreviousMessage})),n.d(t,"isClassicInterface",(function(){return o.isClassicInterface})),n.d(t,"isLocksAvailable",(function(){return o.isLocksAvailable})),n.d(t,"isFoldersAvailable",(function(){return o.isFoldersAvailable})),n.d(t,"isCommunityInterface",(function(){return o.isCommunityInterface})),n.d(t,"isChannelPeer",(function(){return o.isChannelPeer})),n.d(t,"getBareTab",(function(){return o.getBareTab})),n.d(t,"isReversedDialogs",(function(){return o.isReversedDialogs})),n.d(t,"isFullyLoadedTab",(function(){return o.isFullyLoadedTab})),n.d(t,"makeTabNotFullyLoaded",(function(){return o.makeTabNotFullyLoaded})),n.d(t,"isGoToEndVisible",(function(){return o.isGoToEndVisible})),n.d(t,"isGoToMentionVisible",(function(){return o.isGoToMentionVisible})),n.d(t,"getUnreadScrollBottom",(function(){return o.getUnreadScrollBottom})),n.d(t,"isSendingAvailable",(function(){return o.isSendingAvailable})),n.d(t,"isCommunityPeer",(function(){return o.isCommunityPeer})),n.d(t,"isCommunityBlocked",(function(){return o.isCommunityBlocked})),n.d(t,"checkVoiceMessageAvailable",(function(){return o.checkVoiceMessageAvailable})),n.d(t,"isSearching",(function(){return o.isSearching})),n.d(t,"getSearchText",(function(){return o.getSearchText})),n.d(t,"isSearchingValue",(function(){return o.isSearchingValue})),n.d(t,"isRecentSearchesActive",(function(){return o.isRecentSearchesActive})),n.d(t,"getPinnedMessage",(function(){return o.getPinnedMessage})),n.d(t,"doPopularSuggExist",(function(){return o.doPopularSuggExist})),n.d(t,"isAnyMessageBeingEdited",(function(){return o.isAnyMessageBeingEdited})),n.d(t,"getGroupId",(function(){return o.getGroupId})),n.d(t,"getTabDraft",(function(){return o.getTabDraft})),n.d(t,"getTemplates",(function(){return o.getTemplates})),n.d(t,"tabIsMessageRequest",(function(){return o.tabIsMessageRequest})),n.d(t,"tabIsMessageRequestToChat",(function(){return o.tabIsMessageRequestToChat})),n.d(t,"removeMessageRequestFolderFlags",(function(){return o.removeMessageRequestFolderFlags})),n.d(t,"isMessageRequestFolder",(function(){return o.isMessageRequestFolder})),n.d(t,"tabIsOutgoingMessageRequest",(function(){return o.tabIsOutgoingMessageRequest})),n.d(t,"existsIncomingMessageRequest",(function(){return o.existsIncomingMessageRequest})),n.d(t,"isMessageRequestChangedEvent",(function(){return o.isMessageRequestChangedEvent})),n.d(t,"isCommunityChat",(function(){return o.isCommunityChat})),n.d(t,"isCommunityChatDeleted",(function(){return o.isCommunityChatDeleted})),n.d(t,"isClosedChat",(function(){return o.isClosedChat})),n.d(t,"isCasperChat",(function(){return o.isCasperChat})),n.d(t,"isServiceChatTab",(function(){return o.isServiceChatTab})),n.d(t,"isCasperChatTab",(function(){return o.isCasperChatTab})),n.d(t,"isChatActive",(function(){return o.isChatActive})),n.d(t,"isTabMarkedUnread",(function(){return o.isTabMarkedUnread})),n.d(t,"SENDING_CLASS",(function(){return x})),n.d(t,"FAILED_CLASS",(function(){return U})),n.d(t,"ORIGINAL_CLASS",(function(){return B})),n.d(t,"RESTORE_CLASS",(function(){return F})),n.d(t,"TYPING_CLASS",(function(){return H})),n.d(t,"MESSAGE_KEYBOARD_BUTTON_CLASS",(function(){return G})),n.d(t,"MESSAGE_STACK_CLASS",(function(){return V})),n.d(t,"MESSAGE_CLASS",(function(){return q})),n.d(t,"CREATE_CHAT_ACTION",(function(){return z})),n.d(t,"CHAT_TITLE_ACTION",(function(){return K})),n.d(t,"CHAT_INVITE_USER",(function(){return W})),n.d(t,"CHAT_KICK_USER",(function(){return Y})),n.d(t,"CHAT_PHOTO_UPDATE",(function(){return $})),n.d(t,"CHAT_PHOTO_REMOVE",(function(){return J})),n.d(t,"CHAT_PIN_MESSAGE",(function(){return X})),n.d(t,"CHAT_UNPIN_MESSAGE",(function(){return Q})),n.d(t,"CHAT_INVITE_BY_LINK",(function(){return Z})),n.d(t,"CHAT_SCREENSHOT",(function(){return ee})),n.d(t,"CHAT_GROUP_CALL_STARTED",(function(){return te})),n.d(t,"CHAT_INVITE_TO_CALL",(function(){return ne})),n.d(t,"CHAT_INVITE_BY_CALL_LINK",(function(){return ie})),n.d(t,"ACCEPTED_MESSAGE_REQUEST",(function(){return ae})),n.d(t,"DESELECT_ALL_CLASS",(function(){return oe})),n.d(t,"HIDE_TOP_NOTICE_CLASS",(function(){return ce})),n.d(t,"HIDE_ASIDE_NOTICE_CLASS",(function(){return ue})),n.d(t,"HIDE_ASIDE_PROMO_BLOCK_CLASS",(function(){return le})),n.d(t,"INSTALL_VKADMIN_LINK",(function(){return de})),n.d(t,"CLEAR_RECENT_CLASS",(function(){return pe})),n.d(t,"TOGGLE_MR_TAB",(function(){return he})),n.d(t,"MESSAGE_SEARCH_CLASS",(function(){return fe})),n.d(t,"PINNED_CONTAINER_CLASS",(function(){return me})),n.d(t,"getClassicChatHeight",(function(){return ge})),n.d(t,"setClassicChatHeight",(function(){return ve})),n.d(t,"applyInnerHtml",(function(){return _e})),n.d(t,"compensateHistoryHeightChange",(function(){return be})),n.d(t,"renderSticker",(function(){return ye})),n.d(t,"isAlreadyDeleted",(function(){return Ee})),n.d(t,"replaceMessageAttrs",(function(){return Oe})),n.d(t,"isVoiceMessageAvailable",(function(){return Ce})),n.d(t,"getAvailableMicrophones",(function(){return Se})),n.d(t,"renderAttach",(function(){return Te})),n.d(t,"dayFromVal",(function(){return we})),n.d(t,"formatPhoneNumber",(function(){return Ie})),n.d(t,"getUserInitials",(function(){return Pe})),n.d(t,"prepareContactName",(function(){return je})),n.d(t,"showInvisibleBar",(function(){return ke})),n.d(t,"updateMessageInCache",(function(){return Ae})),n.d(t,"editAndReplaceMessage",(function(){return Re})),n.d(t,"setCasperMessageExpiringStatusDOM",(function(){return Le})),n.d(t,"renderMessage",(function(){return Ne})),n.d(t,"renderMessageMedia",(function(){return Me})),n.d(t,"ensureDomHasActions",(function(){return De})),n.d(t,"renderCallMessage",(function(){return xe})),n.d(t,"renderCallUserList",(function(){return Ue})),n.d(t,"appendToHistory",(function(){return Be})),n.d(t,"restoreQueue",(function(){return Fe})),n.d(t,"markMessagesAsRead",(function(){return He})),n.d(t,"replaceAttaches",(function(){return Ge})),n.d(t,"MSG_NEW",(function(){return Ve})),n.d(t,"MSG_DUPLICATE",(function(){return qe})),n.d(t,"MSG_LOCAL_DUPLICATE",(function(){return ze})),n.d(t,"getMessageStoreStatus",(function(){return Ke})),n.d(t,"isChatPeer",(function(){return u.isChatPeer})),n.d(t,"isUserPeer",(function(){return u.isUserPeer})),n.d(t,"isReservedPeer",(function(){return u.isReservedPeer})),n.d(t,"isContactPeer",(function(){return Ye})),n.d(t,"isEmailPeer",(function(){return We})),n.d(t,"isPeerActive",(function(){return $e})),n.d(t,"isFvkcomgroup",(function(){return Je})),n.d(t,"isTabLoaded",(function(){return Xe})),n.d(t,"isTabLoadedWithMessage",(function(){return Qe})),n.d(t,"parseMessage",(function(){return tt})),n.d(t,"convertPeerToUrl",(function(){return nt})),n.d(t,"unUrlPeer",(function(){return rt})),n.d(t,"simplifyCounter",(function(){return it})),n.d(t,"chatActions",(function(){return at})),n.d(t,"renderPhotos",(function(){return ct})),n.d(t,"renderPhotosFromTab",(function(){return ut})),n.d(t,"renderBtnSearchOnlyMessages",(function(){return lt})),n.d(t,"renderMessagesSep",(function(){return dt})),n.d(t,"renderConversationsSep",(function(){return pt})),n.d(t,"renderPopularSuggSep",(function(){return ht})),n.d(t,"renderClearRecent",(function(){return ft})),n.d(t,"renderPopularSuggestions",(function(){return mt})),n.d(t,"setMessageError",(function(){return gt})),n.d(t,"startResendMessage",(function(){return vt})),n.d(t,"removeMessages",(function(){return _t})),n.d(t,"removeExpiredMessagesStub",(function(){return bt})),n.d(t,"removeStartingFromMessage",(function(){return Et})),n.d(t,"removeMessagesWithRestore",(function(){return Ot})),n.d(t,"restoreMessage",(function(){return Ct})),n.d(t,"formatTyper",(function(){return St})),n.d(t,"loadSummaryActivityType",(function(){return Tt})),n.d(t,"renderEmptySearch",(function(){return It})),n.d(t,"serviceLink",(function(){return Pt})),n.d(t,"renderServiceMsg",(function(){return jt})),n.d(t,"addChatPhotoToUpdate",(function(){return kt})),n.d(t,"replaceSpecialSymbols",(function(){return At})),n.d(t,"isSelfMessage",(function(){return Rt})),n.d(t,"showVerifiedTooltip",(function(){return Lt})),n.d(t,"wrapLoading",(function(){return Nt})),n.d(t,"tabFromIds",(function(){return Mt})),n.d(t,"checkSelectClick",(function(){return Dt})),n.d(t,"renderGoTo",(function(){return xt})),n.d(t,"showFlushChat",(function(){return Ut})),n.d(t,"showLeaveDialog",(function(){return Bt})),n.d(t,"showUnpinDialog",(function(){return Ft})),n.d(t,"showMsgDeleteDialog",(function(){return Ht})),n.d(t,"cleanHistory",(function(){return Gt})),n.d(t,"inviteUser",(function(){return Vt})),n.d(t,"toggleMessageRequestsTab",(function(){return qt})),n.d(t,"showUnreadOnly",(function(){return zt})),n.d(t,"changeTab",(function(){return Kt})),n.d(t,"isImportant",(function(){return Wt})),n.d(t,"isUnrespond",(function(){return Yt})),n.d(t,"isPeerBlocked",(function(){return $t})),n.d(t,"isPendingForward",(function(){return Jt})),n.d(t,"isPeerBlockedByMe",(function(){return Xt})),n.d(t,"blockLatencyCompensation",(function(){return Qt})),n.d(t,"showSpamLayer",(function(){return Zt})),n.d(t,"getLastSeenTextInHeader",(function(){return en})),n.d(t,"getLastSeenText",(function(){return tn})),n.d(t,"showBlacklistBoxUser",(function(){return rn})),n.d(t,"showBlacklistBox",(function(){return an})),n.d(t,"getBaseLink",(function(){return on})),n.d(t,"showFavvedBox",(function(){return sn})),n.d(t,"isEditableFocused",(function(){return cn})),n.d(t,"updateStar",(function(){return un})),n.d(t,"removewNewUnreadBarAndMerge",(function(){return ln})),n.d(t,"isMessagesVisible",(function(){return dn})),n.d(t,"hideTopNotice",(function(){return pn})),n.d(t,"hideAsideNotice",(function(){return hn})),n.d(t,"hideAsidePromoBlock",(function(){return fn})),n.d(t,"installVKAdminApp",(function(){return mn})),n.d(t,"renderShortText",(function(){return vn})),n.d(t,"attachToText",(function(){return _n})),n.d(t,"lockButton",(function(){return bn})),n.d(t,"unlockButton",(function(){return yn})),n.d(t,"renderPinnedMessage",(function(){return En})),n.d(t,"renderPinnedMedia",(function(){return On})),n.d(t,"showMessageInfoTooltip",(function(){return Cn})),n.d(t,"showEditTimeTooltip",(function(){return Sn})),n.d(t,"showCasperExpiringTooltip",(function(){return Tn})),n.d(t,"getHistoryTopIndent",(function(){return wn})),n.d(t,"getPinnedMessageHeight",(function(){return In})),n.d(t,"boxHandleMessagesLabelsTooltips",(function(){return Pn})),n.d(t,"showPinnedBox",(function(){return jn})),n.d(t,"showRepliedBox",(function(){return kn})),n.d(t,"isUserAliveInChat",(function(){return An})),n.d(t,"getAliveMembersCount",(function(){return Rn})),n.d(t,"normalizeTab",(function(){return Ln})),n.d(t,"normalizeTabsGotFromServer",(function(){return Nn})),n.d(t,"splitMessageToParts",(function(){return Mn})),n.d(t,"isMessageTooLong",(function(){return Dn})),n.d(t,"showInvitationBox",(function(){return xn})),n.d(t,"showWaitUntilUploadedBox",(function(){return Bn})),n.d(t,"canMessageBeDeletedForAll",(function(){return Fn})),n.d(t,"getTopChatMembers",(function(){return Hn})),n.d(t,"getChatMembersByIds",(function(){return Gn})),n.d(t,"getChatMembers",(function(){return Vn})),n.d(t,"formatTimespan",(function(){return qn})),n.d(t,"focusOnMessage",(function(){return zn})),n.d(t,"getNowEditingMessage",(function(){return Kn})),n.d(t,"checkMessageRequestsTab",(function(){return Wn})),n.d(t,"updateMessageRequestsCounterInDOM",(function(){return Yn})),n.d(t,"hideAllBoxes",(function(){return $n})),n.d(t,"getMessageRequestDateText",(function(){return Jn})),n.d(t,"canPinMessage",(function(){return Xn})),n.d(t,"canForwardMessages",(function(){return Qn})),n.d(t,"canMarkImportant",(function(){return Zn})),n.d(t,"removeExpiredMessageIfNeed",(function(){return er})),n.d(t,"isPeerCurrentUser",(function(){return tr})),n.d(t,"isGiftOptionAvailableForPeer",(function(){return nr})),n.d(t,"isMoneyOptionAvailableForPeer",(function(){return rr})),n.d(t,"replaceExpiredMessageWithPlaceholder",(function(){return ir})),n.d(t,"replaceExpiredRepliedMessageWithPlaceholder",(function(){return cr})),n.d(t,"getChatMemberCount",(function(){return ur})),n.d(t,"CALL_ENTRY_POINT_SNIPPET",(function(){return lr})),n.d(t,"CALL_ENTRY_POINT_HEADER",(function(){return dr})),n.d(t,"CALL_ENTRY_POINT_LIST",(function(){return pr})),n.d(t,"startCallFromIm",(function(){return hr})),n.d(t,"handleCallLinkClick",(function(){return fr})),n.d(t,"isCallToPeerAvailable",(function(){return mr})),n.d(t,"joinCallFromIm",(function(){return gr})),n.d(t,"getConvoLocation",(function(){return vr}));n("rE2o"),n("ioFf"),n("HEwt"),n("Vd3H"),n("a1Th"),n("91GP"),n("rGqo"),n("pIFo"),n("SRfc"),n("KKXr"),n("VRzm"),n("Btvt");var r=n("f01n"),i=n("h++7"),a=n("bIHZ"),o=n("rHUl"),s=n("MhhX"),c=n("S2bU"),u=n("rudk"),l=n("ZxpX"),d=n("yqpO"),p=n("FWc3"),h=n("EasH"),f=n("1BRX"),m=n("v+DW"),g=n("vT4u"),v=n("ofcU");function _(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function y(e){return e.parentNode.getAttribute("data-receiver-chat-peer-id")}function E(e,t,n){var i=Object(v.createModule)({handlers:(i,a)=>{a(e,"click","_im_join_chat",e=>function(e,t){var n=domData(t,"chat-id"),i=domData(t,"hash");return Object(m.lockButton)(t),Object(g.joinChat)(n,i,e.get()).then(n=>{var i=_(n,1)[0];Object(m.unlockButton)(t);var a=e.get();a.longpoll.push([Object(r.changePeer)(i)]),a.onJoinChat&&a.onJoinChat(i)}).catch(e=>{Object(h.showFastBox)(getLang("mail_join_invite_error_title"),e),Object(m.unlockButton)(t)})}(t,e.target)),a(e,"click","_im_accept_mr",e=>function(e,t){var n=y(t);return Object(m.lockButton)(t),e.set(g.acceptMessageRequest.bind(null,n)).then(()=>{Object(m.unlockButton)(t),e.get().longpoll.push([Object(r.changePeer)(n)])}).catch(e=>{$n(),Object(h.showFastBox)(getLang("mail_join_invite_error_title"),e),Object(m.unlockButton)(t)})}(t,e.target)),a(e,"click","_im_reject_mr",e=>function(e,t,n){var r=y(n);return Object(m.lockButton)(n),e.set(g.rejectMessageRequest.bind(null,r)).then(()=>{t.updateMenu(),t.updateList(),Object(m.unlockButton)(n),$n()}).catch(e=>{$n(),Object(h.showFastBox)(getLang("mail_error"),e),Object(m.unlockButton)(n)})}(t,n,e.target))}});return{unmount(){Object(v.destroyModule)(i)}}}var O=n("aong"),C=n("86+7"),S=n("Wu9C"),T=n("wSs/"),w=n("ERyv"),I=n("lJdi"),P=n("t7n3");var j=n("/eGY"),k=n("ambf"),A=n("Syd7"),R=n("nAFc"),L=n("S6+Z");function N(){return(N=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function M(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var x="_im_mess_sending",U="_im_mess_failed",B="_im_mess_original",F="_im_mess_restore",H="_im_typing",G="_im_mess_btn",V="_im_mess_stack",q="_im_mess",z="chat_create",K="chat_title_update",W="chat_invite_user",Y="chat_kick_user",$="chat_photo_update",J="chat_photo_remove",X="chat_pin_message",Q="chat_unpin_message",Z="chat_invite_user_by_link",ee="chat_screenshot",te="chat_group_call_started",ne="chat_invite_user_by_call",ie="chat_invite_user_by_call_join_link",ae="accepted_message_request",oe="_im_deselect_all",ce="_im_top_notice_hide",ue="_im_aside_notice_hide",le="_im_aside_promo_block_hide",de="_im_vkadmin_promo_link",pe="_im_clear_recent",he="_im_toggle_mr_tab",fe="_im_mess_search",me="_im_pinned";function ge(){return ls.get("chatPosition")||0}function ve(e){e>=window.clientHeight()-30&&(e=0),ls.set("chatPosition",e)}function _e(e,t){e&&e.innerHTML!==t&&(e.innerHTML=t)}function be(e,t,n,r){var i=t&&!n?1:!t&&n?-1:0;i&&!Object(o.isClassicInterface)(e)&&r().compensateHistoryHeightChange(i)}function ye(e,t,n,r){var i=window.devicePixelRatio>=2?"256":"128",a="animation"===n,o="im_gift";a&&(o+=" sticker_img");var s=`<img height="128" class="${o}" src="${Stickers.getStickerUrl(intval(e),i)}"/>`;if(a){var c="animatedSticker"+r;s=`<div id="${c}" data-loop-count=3 data-animation-path="${"/stickers.php?act=proxy_animation&product_id="+t+"&sticker_id="+e}" onmouseenter="StickersAnimation.loadAndPlaySticker(this);"\n     data-uniq-id="${r}" data-sticker-id="${intval(e)}" class="sticker_animation sticker_animation_128 im_gift">${s}</div>`;var u=!1;browser.msie?(0^r)===r&&(u=!0):u=Number.isInteger(r),u&&window.StickersSettings.getAutoplay()&&window.StickersAnimation&&window.StickersAnimation.loadAndPlayStickerWithTimer(c,10)}return t&&(s=`<a onmouseover="return Emoji.stickerOver(${intval(e)}, this);"\n        onclick="return Emoji.clickSticker(${intval(t)}, this, event);">${s}</a>`),s=`<div class="im_sticker_row">${s}</div>`}function Ee(e,t,n){var r=e.get?e.get():e;if(Xe(r,t)){var i=r.tabs[t].deleted||[];return inArray(n,i)}return!1}function Oe(e,t,n){var r=n.randomId,i=geByClass1("_im_mess_rid"+r,t);return i&&(t=Be(e,n,t=yt([i],t),!0,!1)),t}function Ce(e){var t=Object(o.checkVoiceMessageAvailable)(e);return browser.mobile&&browser.safari?Promise.resolve(!1):void 0!==t?Promise.resolve(t):Se().then(e=>e.length>0).catch(e=>!1)}function Se(){return window.AudioContext&&navigator.mediaDevices?navigator.mediaDevices.enumerateDevices().then((function(e){for(var t=[],n=0;n<e.length;n++)"audioinput"==e[n].kind&&t.push(e[n]);return t})):Promise.reject(new Error("NotSupported"))}function Te(e){return Object(P.getTemplate)("im_preloader",{preloader:rs(vk.pr_tpl,{id:""}),cls:"im-preloader_attach im-preloader_visible im-preloader_"+e})}function we(e){var t=e.split(".");return(t[0]<10?"0":"")+t[0]+(t[1]<10?"0":"")+t[1]+t[2]}function Ie(e){var t=(""+e).replace(/\D/g,"").match(/^(7|8)?(\d{3})(\d{3})(\d{2})(\d{2})$/);return t?`+7 (${t[2]}) ${t[3]}-${t[4]}-${t[5]}`:""}function Pe(e){var t=Object(R.decodeHTMLEntities)(e),n=Object(L.emojiRegex)().exec(t);return n?0===n.index?Object(d.emojiReplace)(n[0]):t[0]:t.split(/\s/).reduce((e,t)=>e+t.slice(0,1),"").slice(0,2)}function je(e){return Object(d.emojiToHTML)(Object(P.clean)(Object(R.decodeHTMLEntities)(e)),!0)}function ke(e){var t=geByClass1("_im_invisible_bar",e);t&&(removeClass(t,"_im_invisible_bar"),removeClass(t,"im-page--history-new-bar_hide"))}function Ae(e,t,n){var r=domData(n,"msgid"),i=geByClass1("_im_mess_"+r,t),a=n.cloneNode(!0);return i&&(i.parentNode.replaceChild(a,i),De(t)),t}function Re(e,t,n){var r=Ne(e,t),i=geByClass1("_im_mess_"+t.messageId,n);return i&&(i.parentNode.replaceChild(se(r),i),De(n)),n}function Le(e,t,n){var r=geByClass1("_im_mess_"+n,e);if(r){var i=r.closest("._im_mess_stack"),a=i&&i.querySelector(".im-mess-stack--bomb");a&&a.classList.add(t?"im-mess-stack--bomb_expiring-soon":"im-mess-stack--bomb_expiring")}return e}function Ne(e,t){var n=[],r=Object(s.isUnread)(e.tabs[t.peerId],t),i=Object(s.isCallMessage)(t)||Object(s.isActiveGroupCallMessage)(t),a=Object(o.getPinnedMessage)(e),l=Object(s.hasReply)(t)?Object(P.getTemplate)("im_message_media",{type:"reply",messageId:t.messageId,attaches:Te("reply"),text:""}):"";i||n.push("_im_mess"),Object(s.isOut)(t)&&r&&!i&&n.push("im-mess_unread _im_mess_unread"),Object(s.isOut)(t)&&!i&&n.push("im-mess_out"),Object(s.wasEdited)(t)&&n.push("im-mess_was_edited"),Object(T.canMessageBeEdited)(e,t)&&n.push("im-mess_editable"),Object(s.isImportant)(t)&&n.push("im-mess_fav"),-1!==(e.selectedMessages||[]).indexOf(t.messageId)&&n.push("im-mess_selected"),a&&a.messageId===t.messageId&&n.push("_im_mess_pinned");var d=Date.now()-1e3*t.date>1e3;t.local&&d&&n.push("im-mess_sending"),t.local&&n.push(""+x),t.local&&Object(s.wasEdited)(t)&&!r&&n.push("im-mess_unread im-mess_nobg"),t.failed&&n.push("im-mess_failed "+U),Object(s.isGift)(t)&&n.push("im-mess_gift"),i&&n.push("_im_mess_callsnippet"),Object(s.isCasperMessage)(t)&&n.push("im-mess_casper");var p=Me(t).concat(function(e){if(e.kludges.keyboard&&e.kludges.keyboard.inline){var t=e.kludges.keyboard.buttons;return[].concat(Object(P.getTemplate)("sImMessageKeyboard",{content:t.map(e=>Object(P.getTemplate)("sImMessageKeyboardRow",{content:e.map(e=>Object(P.getTemplate)("sImMessageKeyboardButton",{label:Object(j.getButtonLabel)(e),appearance:Object(j.getButtonAppearance)(e),type:e.action.type,modifier:e.action.type.replace("_","-"),attributes:Object(j.getAttributesFromActionObject)(e.action),tagName:e.action.type===j.BUTTON_TYPE_OPEN_LINK?"a":"button"})).join("")})).join("")}))}return[]}(t)),h=function(e,t){var n="",r=Object(O.unpackStore)(e).sourceEnabled&&t.kludges&&t.kludges.from_widget&&t.kludges.ref_source;Object(s.wasEdited)(t)&&(n+=Object(P.getTemplate)("sImLblWasEdited",{update_time:t.update_time}));if(Object(o.isCommunityInterface)(e)&&r){var i=t.kludges.ref_source,a={};try{(a=JSON.parse(Object(P.unclean)(i))).link&&a.info&&(a.link=Object(c.replaceHyperLinks)(Object(P.clean)(a.link),c.linksReplacer.bind(null,!1)),a=Object(P.clean)(langStr(getLang("mail_source_info"),"link",a.link,"info",Object(P.clean)(a.info))),n+=Object(P.getTemplate)("sImLblWasSourceInfo",{source:a}))}catch(e){}}return n}(e,t),f=l+tt(e,t.text,t.kludges,!1,t.peerId);t.subject&&"..."!==t.subject.trim()&&!Object(u.isChatPeer)(t.peerId)&&(f=Object(P.getTemplate)("im_topic",{topic:t.subject})+f);var m=Object(s.isGift)(t)?`<div class="im-mess--gift-lbl">${f}</div>`:"",g=p.length>0?Object(P.getTemplate)("im_message_media",{type:"media",messageId:t.messageId,attaches:p.join(""),text:m}):"";if(Object(s.isGift)(t)||(g=f+g),Object(s.isCallMessage)(t)){var v=xe(t,!1,!0,e),_=!e.isCallsEnabled||Object(u.isUserPeer)(t.peerId)&&!e.isCalls1To1Enabled?"sImCallSnippetWithStub":"sImCallSnippet";g+=Object(P.getTemplate)(_,v)}return g+=h,Object(P.getTemplate)("im_msg_row",{msg_id:t.messageId,from_id:t.peerId,aria_hidden:t.local&&!t.failed?"true":"false",ts:t.date,marker_params:t.failed?`aria-label="${getLang("mail_send_message_error")}" role="link"`:"",unread_params:r?`aria-label="${getLang("mail_unread_message")}"`:"",cls:n.join(" ")}).replace("%text%",()=>g)}function Me(e){return e.attaches.reduce((t,n)=>!Object(s.hasReply)(e)||"mail"!==n.type&&"reply"!==n.type?("call"===n.type||("sticker"===n.type?e.messageId?t.push(ye(n.id,n.productId,n.kind,e.messageId)):t.push(ye(n.id,n.productId)):t.push(Te(n.type))),t):t,[])}function De(e){for(var t=e.querySelectorAll("._im_mess_noa:not(._im_mess_callsnippet):not(._im_mess_srv)"),n=t.length;n--;)hasClass(t[n],"im-mess_fwd")||t[n].insertAdjacentHTML("afterbegin",Object(P.getTemplate)("sImHistoryRowActions")),removeClass(t[n],"_im_mess_noa")}function xe(e,t,n,r){var i,a,o,s,c,l,d=vk.id,p=e.attaches[0],h=p.initiatorId,f=p.state,m=p.receiverId,g=d===h,v=Boolean(e.kludges.attach1_call_video),_=e.kludges.attach1_call_participants&&JSON.parse(e.kludges.attach1_call_participants)||{},b="group_call"===e.kludges.attach1_kind,y={title:"",description:"",modifier:""},E=v?getLang("mail_call_snippet_outgoing_video"):getLang("mail_call_snippet_outgoing"),O=v?getLang("mail_call_snippet_incoming_video"):getLang("mail_call_snippet_incoming"),S=!r.isCallsEnabled||Object(u.isUserPeer)(e.peerId)&&!r.isCalls1To1Enabled;switch(f){case"reached":var T=t?"":(a=p.duration,o=Math.floor(a/3600),s=Math.floor(a/60)-60*o,c=!1,l=!1,[o,s,a-3600*o-60*s].reduce((e,t)=>{if(0===t&&!l)return l=!0,e;c&&(t=t<10?"0"+t:t);var n=`${e}${""!==e?":":""}${t}`;return c=!0,l=!0,n},""));i=(i=g?getLang("mail_call_outgoing"):getLang("mail_call_incoming")).replace("{duration}",T),y.title=g?E:O,y.description=`${getLang("mail_call_snippet_finished")} · ${T}`;break;case"canceled_by_initiator":g?(i=getLang("mail_call_canceled"),y={title:E,description:getLang("mail_call_snippet_canceled")}):(i=getLang("mail_call_missed"),y=S?{title:getLang("mail_call_snippet_missed_call"),description:Object(P.getTemplate)("sImCallSnippetDMLink")}:{title:O,description:getLang("mail_call_snippet_missed")});break;case"canceled_by_receiver":if(g){if(t)return getLang("mail_call_declined");var w=Object(C.oCacheGet)(r,m);i=w?langSex(w.sex,getLang("mail_call_declined_by","raw")).replace("{user_name}",w.first_name):getLang("mail_call_declined"),y={title:E,description:getLang("mail_call_snippet_declined")}}else i=getLang("mail_call_canceled"),y={title:O,description:getLang("mail_call_snippet_canceled")};break;default:i=getLang("mail_added_call"),y.title=getLang("mail_added_call")}if(!n)return Object(P.getTemplate)("im_calls_link",{text:i});v&&(y.modifier="im-call-snippet_video"),y.type=v?"video":"audio",b&&(y.title=getLang("mail_call_snippet_group"));var I=Object.keys(_);return y.user_list=Ue(r,I),y.button="",y.classes="im-mess--call-snippet CallSnippet--interactive _im-call-snippet",y.attributes=`data-participants="${I.join(",")}"`,y}function Ue(e,t){if(!t.length)return"";var n=t.slice(0,3).reduce((t,n)=>{var r=Object(C.oCacheGet)(e,n);return r&&(t+=Object(P.getTemplate)("sImCallUser",{url:r.photo,name:r.name})),t},"");return Object(P.getTemplate)("sImCallUsers",{users:n})}function Be(e,t,n){!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=Date.now()-1e3*t.date>1e3,c=e.tabs[t.peerId];if(!n||geByClass1("_im_mess",n)||geByClass1("_im_bar_date",n)||(n.innerHTML=""),c.skipped>0)return n;var l=[];t.local||(l=e.imQueue(t.peerId,r)),l.length>0&&yt(l.map(e=>geByClass1("_im_mess_rid"+e.rid,n),n).filter(e=>e));var d=Ne(e,t),p=domLC(n);hasClass(p,"_im_mess_stack")||(p=domClosestSibling(p,"._im_mess_stack",-1));for(var h=Object(o.getLastMessage)(e,t.peerId,t.messageId);t.peerId===e.peer&&h&&!geByClass1("_im_mess_"+h.messageId);)h=Object(o.getLastMessage)(e,t.peerId,h.messageId);var m=geByClass1("_im_unread_bar_row",n),g=h?Ze(h.date,e):0,v=Object(u.isChatPeer)(t.peerId)&&Object(o.isCasperChat)(e,t.peerId);if(!h||et(c,h,t,e,i)){var _="",b=!1;if(m&&Object(s.isOut)(t)&&ln(e,n,t.peerId),1===c.unread&&!Object(s.isOut)(t)&&i&&(_+=Object(P.getTemplate)("im_mess_bar",{}),b=!0,ln(e,n,t.peerId)),!Object(f.isToday)(new Date(g))&&!v){var y=new Date,E=b?"im-page--history-new-bar_hide _im_invisible_bar":"";_+=Object(P.getTemplate)("im_day_bar",{day:getShortDate(t.date,e.timeshift,!0,getLang("months_of","raw"),!0),date:t.date,day_class:y.getDate()+y.getMonth()+y.getFullYear()+" "+E})}if(Object(s.isServiceMsg)(t))_+=Object(P.getTemplate)("im_service_row",{text:jt(e,t,c),type:"",date:t.date,from_id:"",message_id:t.messageId});else{var C=sr(e,t);_+=Object(P.getTemplate)("im_mess_stack",Object.assign(C,{messages:d}))}Object(O.toArray)(sech(_)).forEach(e=>n&&n.appendChild(e))}else m&&e.peer===t.peerId&&!c.inplaceSearch&&Object(s.isOut)(t)&&ln(e,n,t.peerId),geByClass1("_im_stack_messages",p).appendChild(se(d));return Object(s.isOut)(t)&&!a&&setTimeout(()=>{var e=geByClass1("_im_mess_"+t.messageId,n);hasClass(e,x)&&addClass(e,"im-mess_sending")},500),l=l.filter(e=>e.rid!==t.randomId),De(n),Fe(l,e,n)}function Fe(e,t,n){var r;return(r="object"==typeof e?e:t.imQueue(e,!1)).length>0&&r.map(e=>(e.mess.failed=!!e.failed,e.mess)).filter(e=>Object(o.getMessage)(t,e.peerId,e.messageId)).forEach(e=>Be(t,e,n,!1)),n}function He(e,t,n){var r=e.tabs[t];return Object(O.toArray)(geByClass("_im_mess_unread",n)).forEach(e=>{var t,n=intval(domData(e,"msgid"));n>0&&r.out_up_to>=n&&(removeClass(e,"_im_mess_unread"),removeClass(e,"im-mess_unread"),(t=geByClass1("_im_mess_blind_unread_marker",e))&&(t.removeAttribute("aria-label"),t.removeAttribute("role"),t.removeAttribute("tabindex")))}),n}function Ge(e,t,n){var r=t.peerId,i=t.messageId,a=geByClass1("_im_msg_reply"+i,e),o=geByClass1("_im_msg_media"+i,e),s=n.tabs[r].mediacontent[i][0];return a&&(a.innerHTML=s[0]),o&&(o.innerHTML=s[1]),e}var Ve=0,qe=1,ze=2;function Ke(e,t){if(!Object(o.isFullyLoadedTab)(t,e.peerId))return Ve;var n=t.tabs[e.peerId];return n.msgs[e.messageId]?qe:n.msgs["rid"+e.randomId]?ze:Ve}function We(e){return e<-2e9}function Ye(e){return e>19e8&&e<2e9}function $e(e,t){return e===t.peer}function Je(e,t){return Object(I.doesChatTabHaveFlag)(Object(o.getTab)(e,t),1024)}function Xe(e,t){return!!e.tabs[t]}function Qe(e,t){return!!Xe(e,t)&&null!==e.tabs[t].lastmsg}function Ze(e,t){return 1e3*e+1e3*t.timeshift}function et(e,t,n,r,i){if(Object(s.getUserId)(t)!==Object(s.getUserId)(n))return!0;var a=Ze(t.date,r),c=Ze(n.date,r);if(!isSameDate(a,c))return!0;if(Object(o.isCommunityInterface)(r)&&intval(t.kludges.from_admin)!==intval(n.kludges.from_admin))return!0;if(n.date-t.date>300)return!0;if(Object(s.isServiceMsg)(t)||Object(s.isServiceMsg)(n))return!0;var u=Object(s.isCasperMessage)(t),l=Object(s.isCasperMessage)(n);if(u!==l)return!0;var d=t.kludges.is_expired,p=n.kludges.is_expired;return!(!u||!l||d===p)||(!(!u||!l||d||p)||!(u&&l&&d&&p)&&(!(!Object(s.isCallMessage)(n)&&!Object(s.isCallMessage)(t))||(!(!Object(s.isActiveGroupCallMessage)(n)&&!Object(s.isActiveGroupCallMessage)(t))||(!(!Object(s.isGift)(t)&&!Object(s.isGift)(n))||(!(!Object(s.isGraffiti)(t)&&!Object(s.isGraffiti)(n))||(!!Object(s.hasReply)(n)||!(Object(s.isUnread)(e,t)===Object(s.isUnread)(e,n)||!i||Object(s.isOut)(n)||Rt(n.peerId,r.gid))))))))}function tt(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=Math.round(1e9*Math.random()).toString(16),s={},u=0;return t=(t=Object(c.replaceHyperLinks)(t||"",c.linksReplacer.bind(null,r))).replace(/(<a.+?<\/a>)/gi,e=>{var t=`!link_${u}_${a}!`;return s[t]=e,u++,t}),t=Object(c.replaceMentions)(t),e.isMassMentionsMessageAllowed&&(t=Object(c.replaceMassMentions)(t)),t=Object(c.replaceEmailLinks)(t),t=Object(c.replaceHashtags)(t,t=>{var n=Object(o.getGroupId)(e);return`<a href="/${n?"gim"+n:"im"}?sel=${i||Object(o.getPeer)(e)}&st=${encodeURIComponent(t)}">${t}</a>`}),Object.keys(s).forEach(e=>{t=t.replace(e,()=>s[e])}),n.emoji&&(t=Emoji.emojiToHTML(t,!0)),t}function nt(e){return Object(u.isChatPeer)(e)?"c"+(e-2e9):We(e)?"e"+Math.abs(e+2e9):Ye(e)?"mr"+(e-19e8):e}function rt(e){switch(e.substr(0,1)){case"e":return-2e9-intval(e.substr(1));case"c":return 2e9+intval(e.substr(1));default:return intval(e)}}function it(e){return e>9999999?Math.floor(e/1e6)+"M":e>9999?Math.floor(e/1e3)+"K":e>0?e.toString():""}function at(e,t){return{[g.CHAT_ACTION_SEARCH]:{name:getLang("mail_im_peer_search"),icon:"search"},[g.CHAT_ACTION_BLOCK_COMMUNITY]:{icon:"block",name:getLang("mail_block_comm_messages")},[g.CHAT_ACTION_BLOCK_NOTIFY]:{icon:"block",name:getLang("mail_block_notify_messages")},[g.CHAT_ACTION_ALLOW_COMMUNITY]:{icon:"unblock",name:getLang("mail_allow_comm_messages")},[g.CHAT_ACTION_CLEAR]:{name:We(e.peer)?getLang("mail_im_delete_email_contact"):getLang("mail_im_delete_all_history"),icon:"clear"},[g.CHAT_ACTION_MUTE]:{name:getLang("mail_im_mute"),icon:"mute"},[g.CHAT_ACTION_UNMUTE]:{name:getLang("mail_im_unmute"),icon:"unmute"},[g.CHAT_ACTION_MEDIA]:{name:Object(o.isCommunityInterface)(e)?getLang("mail_im_show_media_history_group"):getLang("mail_im_show_media_history"),icon:"media"},[g.CHAT_ACTION_BLOCK]:{icon:"block",name:getLang("mail_block_user")},[g.CHAT_ACTION_INVITE]:{icon:"invite",name:getLang("mail_im_create_chat_with")},[g.CHAT_ACTION_LEAVE]:{icon:"leave",name:t?getLang("mail_leave_channel"):getLang("mail_leave_chat")},[g.CHAT_ACTION_RETURN]:{icon:"return",name:t?getLang("mail_return_to_vkcomgroup"):getLang("mail_return_to_chat")},[g.CHAT_ACTION_PIN_HIDE]:{icon:"pin_hide",name:getLang("mail_menu_pin_hide")},[g.CHAT_ACTION_PIN_UNHIDE]:{icon:"pin_unhide",name:getLang("mail_menu_pin_show")},[g.CHAT_ACTION_UNPIN]:{icon:"unpin",name:getLang("mail_menu_unpin")},[g.CHAT_ACTION_SETTINGS]:{icon:"settings",name:t?getLang("mail_vkcomgroup_settings"):getLang("mail_settings")},[g.CHAT_ACTION_CALL_AUDIO]:{icon:"call_audio",name:getLang("mail_im_call_audio")},[g.CHAT_ACTION_CALL_VIDEO]:{icon:"call_video",name:getLang("mail_im_call_video")},[g.CHAT_ACTION_UNREAD]:{icon:"unread",name:getLang("mail_menu_mark_unread")}}}function ot(e,t){var n=`<img src="${e}" alt="" class="dialogs_inline_chatter dialogs_inline_chatter_half"/>`;return t&&(n=Object(P.getTemplate)("im_dialogs_link",{href:t,photo:n})),`<div class="im_grid">\n    <div class="dialogs_inline_chatter dialogs_inline_chatter_half">\n      ${n}\n    </div>\n  </div>`}function st(e,t){var n=`<img src="${e}" alt="" class="dialogs_inline_chatter"/>`;return t&&(n=Object(P.getTemplate)("im_dialogs_link",{href:t,photo:n})),`<div class="im_grid">\n    <div class="dialogs_inline_chatter">\n      ${n}\n    </div>\n  </div>`}function ct(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if("string"==typeof e)return`<div class="im_grid"><img src="${e}" alt=""/></div>`;switch(e.length){case 1:return`<div class="im_grid"><img src="${e[0]}" alt=""/></div>`;case 2:return e.map((e,n)=>ot(e,t[n])).join("");case 3:return ot(e[0],t[0])+e.slice(1).map((e,n)=>st(e,t[n+1])).join("");case 4:return e.map((e,n)=>st(e,t[n])).join("")}}function ut(e,t,n){if(Ye(t.peerId))return`<div class="nim-peer--contact-avatar nim-peer--contact-avatar_30">${Pe(t.tab)}</div>`;if("string"==typeof t.photo&&t.photo)return`<div class="im_grid"><img src="${t.photo}" alt=""></div>`;if(Object(u.isChatPeer)(t.peerId)&&t.membersCount<2)return`<div class="im_grid"><img src="${e.get().default_chat_photo}" alt=""></div>`;if(Array.isArray(t.photo))return ct(t.photo);var r=t.data.active.slice(0,4).map(C.oCacheGet.bind(null,e)).filter(e=>!!e);return ct(r.map(e=>e.photo),n?[]:r.map(e=>e.link))}function lt(e){var t=e.get().gid?getLang("mail_search_only_messages_comm"):getLang("mail_search_only_messages");return`<li class="im-page--mess-search-w">\n    <div class="im-page--mess-search ${fe}">\n      <button type="button" class="im-i--messages-search"></button>${t}\n    </div>\n  </li>`}function dt(){return`<li class="im-search-results-head">${getLang("mail_search_messages")}</li>`}function pt(){return`<li class="im-search-results-head">${getLang("mail_search_conversations_sep")}</li>`}function ht(){return`<li class="im-search-results-head">${getLang("mail_search_dialogs_sep")}</li>`}function ft(){return`<li class="im-search-results-head _im_recent_bar">\n    ${getLang("mail_recent_searches")}\n    <button type="button" class="${pe} im-page--clear-recent">${getLang("mail_clear_recent")}</button>\n  </li>`}function mt(e){var t=e.get().popular_sugg,n=Object(o.isClassicInterface)(e)?8:5;return t.length>n&&(t=t.slice(0,n)),'<li class="im-popular clear_fix">'+t.map(t=>{var n=t.peerId,r=Object(C.oCacheGet)(e,n)||t,i=e.get().tabs[n]||t,a=(e.get().mutedPeers||[]).indexOf(n)>=0;return`<div class="${["im-popular--item","fl_l","_im_dialog","_dont_add_recent","_im_sugg_"+n,i.unread>0&&"sugg-is_unread",a&&"sugg-is_muted"].filter(e=>!!e).join(" ")}" data-peer="${n}">\n    <a class="im-popular--avatar-w ${onlinePlatformClass(i.online)}" href="${r.link}"><img class="im-popular--avatar" src="${r.photo}"/></a>\n    <div class="im-popular--name-w"><a class="im-popular--name" href="${r.link}">${r.first_name||r.name}</a></div>\n    <span class="im-popular--unread _sugg_unread_ct">${it(i.unread)}</span>\n</div>`}).join("")+"</li>"}function gt(e,t,n){var r=geByClass1("_im_mess_"+t.messageId,n);if(r){attr(r,"aria-hidden","false"),addClass(r,"im-mess_failed "+U);var i=geByClass1("_im_mess_marker",r);attr(i,"aria-label",getLang("mail_send_message_error")),attr(i,"role","link")}return n}function vt(e,t,n){var r=geByClass1("_im_mess_"+t,n);if(r){removeClass(r,"im-mess_failed"),attr(r,"aria-hidden","true"),removeClass(r,U);var i=geByClass1("_im_mess_marker",r);attr(i,"aria-label",""),attr(i,"role","")}return n}function _t(e,t){return yt(e.map(e=>geByClass1("_im_mess_"+e,t)).filter(e=>e),t)}function bt(e,t){var n=t||document,r=[];return e.forEach(e=>{var t=n.querySelector("._im_expired_message_"+e);if(t){var i=+t.dataset.count;if(t.dataset.count=i-1,t.classList.remove("_im_expired_message_"+e),1===i)(!domNS(t)||hasClass(domNS(t),"_im_bar_date"))&&(hasClass(domPS(t),"_im_bar_date")&&re(domPS(t)),hasClass(domPS(t),"_im_unread_bar_row")&&re(domPS(t))),re(t);else r.includes(t)||r.push(t)}}),r.length&&r.forEach(e=>{var t=+e.dataset.count;if(t>0){var n=ar(t),r=se(n);r.classList.add(...e.classList),e.replaceWith(r)}}),t}function yt(e,t){var n=e.filter(e=>!hasClass(e,"im-mess_srv")).map(e=>e.parentNode);return e.forEach(e=>{hasClass(e,"im-mess_srv")?e.parentNode.parentNode.removeChild(e.parentNode):e.parentNode&&e.parentNode.removeChild(e)}),n.filter(e=>0===domChildren(e).length).map(e=>gpeByClass("_im_mess_stack",e)).forEach(e=>{hasClass(domPS(e),"_im_bar_date")&&re(domPS(e)),hasClass(domPS(e),"_im_unread_bar_row")&&re(domPS(e)),re(e)}),t}function Et(e){for(var t=e;t;){var n=t;if(null===(t=t.previousElementSibling)){hasClass(n,"mess_srv")&&(t=n.parentNode);var r=gpeByClass("_im_mess_stack",n);r&&(t=r.previousElementSibling,1===domChildren(n.parentNode).length&&r.parentNode.removeChild(r))}hasClass(n,"_im_unread_bar_row")||n.parentNode.removeChild(n)}}function Ot(e,t,n,r){return e.map(e=>geByClass1("_im_mess_"+e,r)).filter(e=>e).forEach(e=>{val(e,function(e,t,n){var r=t.innerHTML;return`<div class="im-mess--text">\n    ${getLang("delete"===n?"mail_deleted_stop":"mail_marked_as_spam")} <button type="button" data-peer="${e}" class="${F} im-mess--btn">${getLang("mail_restore")}</button>\n    <div class="${B} im-mess--original">${r}</div>\n  </div>`}(t,e,n)),addClass(e,"im-mess_light")}),r}function Ct(e,t,n){var r=geByClass1("_im_mess_"+e,n);if(r){var i=geByClass1(B,r);val(r,i.innerHTML),removeClass(r,"im-mess_light")}return n}function St(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(a)return wt(e,t,n,r,!0,i);var o=60,s=wt(e,t,n,r,!1,i);return s.length>o?wt(e,t,n,r,!0,i):s}function Tt(e){var t={[g.ACTIVITY_TYPE_TYPING]:1,[g.ACTIVITY_TYPE_RECORDING_AUDIO]:2},n=Object.keys(e).sort((e,n)=>t[n]-t[e]),r={},i=n.reduce((t,n)=>{var i=(e[n]||{}).userIds;return(void 0===i?[]:i).forEach(e=>{r[e]||(r[e]=!0,t[n]=!0)}),t},{}),a=n.filter(e=>!!i[e]);return a.length>1?"":a[0]}function wt(e,t,n,r,i,a){var s=function(e,t,n){var r=[],i={};return Object.keys(t).map(n=>{((t[n]||{}).userIds||[]).forEach(t=>{Object(C.oCacheExists)(e,t)?parseInt(t,10)!==e.id&&(i[t]=n):r.push(t)})}),r.length&&Object(g.loadChatMember)({[n]:r},e),Object.keys(i).sort((e,n)=>t[i[e]].ts-t[i[n]].ts)}(r,e,t);if(0===s.length)return"";var c=Object(u.isUserPeer)(t)||Object(o.isCommunityPeer)(t)?"first_name":i?"short_name":"name",l=Tt(e),d="";l===g.ACTIVITY_TYPE_RECORDING_AUDIO?d=getLang("mail_recording_audio_several",s.length):l===g.ACTIVITY_TYPE_TYPING&&(d=getLang("mail_typing_several",s.length));var p=s.slice(0,Math.min(s.length-1,a)),h=p.map(e=>Object(C.oCacheGet)(r,e)[c]).join(", ");if(s.length>a+1){var f=function(e){var t={};return Object.keys(e).forEach(n=>{var r=e[n].userIds;(void 0===r?[]:r).forEach(e=>{t[e]=1})}),Object.keys(t).length}(e);h+=" "+getLang("mail_and_peer").replace("{count}",f-a).replace("{typing}",d)}else{if(s.length>1&&(h+=" "+getLang("mail_and_peer_one")),!Object(u.isChatPeer)(t)&&n)h+=" "+d;else h+=` ${Object(C.oCacheGet)(r,s[p.length])[c]} ${d}`}return h.trim()}function It(){return`<div class="im-page--chat-search-empty">\n    ${getLang("mail_im_search_empty")}\n  </div>`}function Pt(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return n?`<a class="im_srv_lnk ${r}" target="_blank" rel="noopener" href="${e}">${t}</a>`:`<span class="${r}">${t}</span>`}function jt(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=t.kludges,a=i.source_act,o=intval(i.source_mid),s=intval(Object(u.isChatPeer)(n.peerId)?i.from:t.userId),c=s===o,l=Object(C.oCacheGet)(e,s),d="";switch(a){case z:d="mail_im_chat_created";break;case K:d=i.source_is_channel?"mail_im_title_updated_channel":"mail_im_title_updated_dot";break;case W:d=c?"mail_im_returned_to_chat":"mail_im_invited";break;case Y:d=c?"mail_im_left":"mail_im_kicked_from_chat";break;case $:d="mail_im_photo_set";break;case J:d=i.source_is_channel?"mail_im_photo_removed_channel":"mail_im_photo_removed";break;case X:d=i.source_message?"mail_im_pin_message":"mail_im_pin_message_empty2";break;case Q:d=i.source_message?"mail_im_unpin_message":"mail_im_unpin_message_empty2";break;case Z:d="mail_im_invite_by_link";break;case ee:d=Object(O.unpackStore)(e).id===o?"mail_im_chat_own_screenshot":"mail_im_chat_screenshot";break;case te:d="mail_im_start_group_call";break;case ne:d="mail_im_invited_to_call";break;case ie:d="mail_im_invite_by_call_link";break;case ae:d="mail_im_accepted_message_request";break;default:return"mail_no_support"}if(d=(d=(d=langSex(l.sex,getLang(d,"raw"))).replace("{from}",Pt(l.link,l.name,r))).replace("{contact}",Pt(l.link,l.name,r)),o&&!c){var p=i.source_email;if(p)d=d.replace("{user}",Pt("/im?email="+encodeURIComponent(p),"email",r));else{var h=Object(C.oCacheGet)(e,o),f=a===Y?h.inv_name:h.kick_name;d=d.replace("{user}",Pt(h.link,f,r))}}if(i.source_text){var m=i.source_old_text?`«<b class="im_srv_lnk">${i.source_old_text}</b>» &rarr; `:"";d=d.replace("{title}",m+`«<b class="im_srv_lnk">${i.source_text}</b>»`)}if(i.source_act===X||i.source_act===Q)if(i.source_message){var g=At(Emoji.emojiToHTML(stripHTML(i.source_message.replace(/<br\s?\/?>/gi," ")),!0)),v=Pt("",g,!1,"im_srv_mess_link");d=d.replace("{msg}",v)}else d=d.replace(/{link}(.+){\/link}/i,(e,t)=>Pt("",t,!1,"im_srv_mess_link"));return d}function kt(e,t,n,r){if(t===$){var i=geByClass1("_im_mess_"+e.messageId,r);if(i){var a=n.tabs[e.peerId];i.parentNode.innerHTML=Object(P.getTemplate)("im_msg_row",{msg_id:e.messageId,from_id:e.peerId,text:jt(n,e,a)+n.chat_photo_msg,ts:e.date,cls:"im-mess_srv _im_mess_srv"})}}return r}function At(e){return e.replace(/&lt;&lt;/g,"&laquo;").replace(/&gt;&gt;/g,"&raquo;").replace(/ \-\-/g," &mdash;").replace(/\-\- /g,"&mdash; ").replace(i.MENTION_RAW,"$1$4")}function Rt(e,t){return!t&&e===vk.id}function Lt(e,t){return Object(p.showTooltip)(e,{url:Object(o.isCommunityPeer)(t)?"al_groups.php":"al_profile.php",params:{act:"verified_tt",mid:t,gid:t},slide:15,ajxdt:200,showdt:200,hidedt:200,dir:"auto",shift:[94,7,7],className:"verified_tt"})}function Nt(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=se(Object(P.getTemplate)("im_preloader",{preloader:rs(vk.pr_tpl,{id:""}),cls:["bottom"===n?"im-preloader_bottom":"im-preloader_top",r].join(" ")})),a=!1;function o(){a=!0,removeClass(i,"im-preloader_visible"),i.parentNode&&i.parentNode.removeChild(i)}setTimeout(()=>{a||("bottom"===n?e.appendChild(i):e.insertBefore(i,domFC(e)),addClass(i,"im-preloader_visible"))},0),t.then(o).catch(e=>{Object(w.imWeirdCatch)("wrapLoading",e),o()})}}function Mt(e,t){return{0:{msgs:e.reduce((e,t)=>(e[t]=[t,r.FLAG_IMPORTANT,0,0,"",{},{},0,0,0],e),{}),hash:t,history:1}}}function Dt(e,t){if(!t&&!e)return!1;var n=e.target||e.srcElement,r=8,i=!1,a=/_im_mess|im_log_act|im_log_ract|_im_log_body|im_log_rspacer|_im_graffiti_w|_wall_post_cont/;do{if(!n||n.onclick||n.onmousedown||"A"==n.tagName||hasClass(n,"_im_no_select")||hasClass(n,"im_msg_media_link")||"IMG"==n.tagName&&!hasClass(n,"_im_graffiti")&&!hasClass(n,"emoji")&&!hasClass(n,"emoji_css")&&!hasClass(n,"im_gift")||"TEXTAREA"==n.tagName||hasClass(n,"play_new")||hasClass(n,"videoplayer")||(i=a.test(n.className)))break}while(r--&&(n=n.parentNode));return!i||!!trim((window.getSelection&&window.getSelection()||document.getSelection&&document.getSelection()||"").toString())}function xt(e,t){return`<div class="im-mess--text">\n      <span>${getLang("mail_restored")}</span>\n      <a class="_im_go_to" href="/im?sel=${nt(e)}&msgid=${t}">${getLang("mail_im_goto_conversation")}</a>\n    </div>`}function Ut(e,t,n){var r=getLang("mail_deleteall1"),i=getLang("mail_sure_to_delete_all"),a=getLang("mail_delete");return Object(u.isChatPeer)(t)&&(Object(I.doesChatTabHaveFlag)(e,1024)?(r=getLang("mail_leave_channel"),i=getLang("mail_unfollow_channel_confirmation"),a=getLang("mail_unfollow_channel")):i=getLang("mail_chat_sure_to_delete_all")),Object(o.isCommunityPeer)(t)&&(i=getLang("mail_group_sure_to_delete_all")),Object(h.showFastBox)(r,i,a,n,getLang("global_cancel"))}function Bt(e,t,n){var r=Object(o.getTab)(e,t),i=Object(u.isChatPeer)(t),a=i&&Object(o.isChannelPeer)(r),s=i&&Object(o.tabIsMessageRequestToChat)(r),c=getLang("mail_deleteall1"),l=getLang("mail_sure_to_delete_all"),d=getLang("mail_delete");if(i){if(!Object(o.isChatActive)(r))return Ut(r,t,n.bind(null,!0));a?(c=getLang("mail_leave_channel"),l=getLang("mail_vkcomgroup_leave_confirm"),d=getLang("mail_leave_channel")):s?(c=getLang("mail_reject_mr_confirmation_title"),l=getLang("mail_reject_mr_confirmation_text"),d=getLang("mail_message_request_reject")):(c=getLang("mail_leave_chat"),l=getLang("mail_chat_leave_confirm"),d=getLang("mail_leave_chat"))}Object(o.isCommunityPeer)(t)&&(l=getLang("mail_group_sure_to_delete_all"));var p=new MessageBox({title:c,width:a?450:500}).content(l).setButtons(d,()=>n(!!isChecked(geByClass1("_check_is_delete"))||!i),getLang("global_cancel")).show();return!i||a||s||p.setControlsText(`<div class="checkbox im-delete-forall-checkbox _check_is_delete" onclick="checkbox(this);" role="checkbox" aria-checked="false">${getLang("mail_deleteall1")}</div>`),p}function Ft(e){return Object(h.showFastBox)(getLang("mail_unpin_title"),getLang("mail_unpin_text"),getLang("mail_unpin"),e,getLang("global_cancel"))}function Ht(e,t,n,r){var i=getLang("mail_dialog_msg_delete_N",t),a=Object(h.showFastBox)(getLang("mail_dialog_msg_delete_title"),i,getLang("mail_delete"),()=>r(isChecked(geByClass1("_check_forall"))),getLang("global_cancel")),o="",s=!1;return n&&(o=`<div class="checkbox im-delete-forall-checkbox _check_forall" onclick="checkbox(this);" role="checkbox" aria-checked="false">${getLang("mail_delete_for_all")}</div>`,s=cur.imDb.selectByKey("del_forall_checked")),a.setControlsText(o),s&&checkbox(geByClass1("_check_forall")),a}function Gt(e,t,n,r,i){t.showProgress(),e.set(r.bind(null,i)).then(()=>{t.hideProgress(),t.hide(),n().removePeer(e,i),n().updateDialogFilters(e)})}function Vt(e,t,n,r){var i=e.get().tabs[t].memberIds;e.set(r.bind(null,"add_member",i)).then(n().showCreation)}function qt(e,t,n){var r=e.get();if(r.active_tab===i.FOLDER_ALL&&0===r.dialog_tab_cts.mr)return!1;var a=r.active_tab===i.FOLDER_MESSAGE_REQUEST?i.FOLDER_ALL:i.FOLDER_MESSAGE_REQUEST;return e.set(n.bind(null,a)).then(e=>{t().restoreDialogs(e,!0)})}function zt(e,t,n){if(e.get().active_tab===i.FOLDER_ALL&&0===e.get().unread_cnt)return!1;var r=e.get().active_tab===i.FOLDER_UNREAD?i.FOLDER_ALL:i.FOLDER_UNREAD;return e.set(n.bind(null,r)).then(e=>{t().restoreDialogs(e,!0)})}function Kt(e,t,n,r){if(t.get().active_tab===e)return Promise.resolve(t);var i=Object(o.isReversedDialogs)(t);return t.set(r.bind(null,e)).then(e=>(n().restoreDialogs(e,!0,i!==Object(o.isReversedDialogs)(e)),e))}function Wt(e,t){void 0===t&&(t=e.get().peer);var n=e.get().tabs[t];return i.FOLDER_MASKS[i.FOLDER_IMPORTANT]&n.folders}function Yt(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0===t&&(t=e.get().peer),!Object(o.isFoldersAvailable)(e))return!1;var r=n||e.get().tabs[t];return i.FOLDER_MASKS[i.FOLDER_UNRESPOND]&r.folders}function $t(e,t){return!1===((t.get().block_states||{})[e]||{}).free}function Jt(e){return null!=e.get().pendingForward}function Xt(e,t){return(t.get().block_states[e]||{}).who===vk.id}function Qt(e,t){var n=e.get().block_states;Object.keys(n).forEach(i=>{n[i].time?!1===n[i].free&&Date.now()-n[i].time>=5e4&&t.push([r.mutexEvent([,1,"gim"+e.get().gid,i,0,""])]):n[i].time=Date.now()})}function Zt(e,t,n){var r;return!showTabbedBox("al_im.php",{act:"a_spam",offset:"0",gid:e.get().gid},{onDone:(n,i)=>{i&&(r=t(n,e,i))},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0),r.unmount()}}},n)}function en(e,t){return tn(e.get(),t,Object(o.getTab)(e,t).last_seen)}function tn(e,t,n,r){if(n.platform)return getLang("mail_header_online_status")+(n.mobile?nn(t,!1,!1,!0):"");if(!n.can_see){var i=Object(C.oCacheGet)(e,t),a=i||e.tabs[t];return function(e,t){var n;switch(e){case"recently":n=getLang("global_online_was_recently","raw");break;case"last_week":n=getLang("global_online_was_week","raw");break;case"last_month":n=getLang("global_online_this_month","raw");break;case"long_ago":n=getLang("global_online_long_ago","raw");break;default:return""}return langSex(t,n)}(n.status,a.sex)}if(!n.time||Date.now()-1e3*n.time>7776e6)return"";var o=getDateText(n.time,e.timeshift),s=langSex(Object(C.oCacheGet)(e,t).sex,getLang("mail_last_activity_tip","raw")).replace("{user}","").replace("{time}",o);return n.mobile&&(s+=nn(t,!1,!1,r)),s}function nn(e,t,n,r){var i={mid:e};n||(i.was=1),t?i.forcetoup=!0:i.forcetodown=!0,i=Object.assign(i,r);var a=JSON.stringify(i).slice(1,-1).replace(/"/g,"&quot;");return Object(P.getTemplate)("im_wrap_mobile",{class:"im_status_mob_onl",params:a})}function rn(e,t){var n=t.get().tabs[e];return showBox("al_settings.php",{act:"blacklist_box",q:n.href},{stat:[jsc("web/settings.js"),"settings.css"],dark:1})}function an(e,t){return showBox("groupsedit.php",{act:"bl_edit",name:"/id"+e,gid:t.get().gid},{stat:["page.css","ui_controls.js","ui_controls.css"],dark:1})}function on(e){return e.get().gid?"/gim"+e.get().gid:"/im"}function sn(e,t,n,r){var i;Pn(showTabbedBox("al_im.php",{act:"a_important",offset:"0"},{onDone:(r,a)=>{a&&(i=n(r,e,t,a))},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{i&&i.unmount()}}},r),e)}function cn(){var e=document.activeElement;return null!==e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||e.getAttribute("contenteditable"))}function un(e,t,n){var r=geByClass1("_im_mess_"+e,n);return r&&toggleClass(r,"im-mess_fav",t),n}function ln(e,t,n){var r=geByClass1("_im_unread_bar_row",t);if(!r)return t;var i=domClosestSibling(r,"._im_mess_stack",-1),a=domClosestSibling(r,"._im_mess_stack"),s=i?geByClass("_im_mess",i).pop():null,c=a?geByClass1("_im_mess",a):null;if(re(r),ke(t),!c||!s)return t;var u=domData(c,"msgid"),l=Object(o.getPreviousMessage)(e,n,u),d=Object(o.getMessage)(e,n,u);if(!l||et(e.tabs[n],l,d,e))return t;var p=geByClass1("_im_stack_messages",i),h=geByClass1("_im_stack_messages",a).children;return Object(O.toArray)(h).forEach(e=>{re(e),p.appendChild(e)}),re(a),t}function dn(e,t,n){var r=Object(o.getFirstUnread)(e,e.get().peer);if(!r)return[!1,0];var i=geByClass1("_im_mess_"+r,t);if(!i){var a=Object(o.getLastMessage)(e,e.get().peer,r);if(!a)return[!0,0];i=geByClass1("_im_mess_"+a.messageId,t)}var s=hasClass(i,"_im_mess_srv")?i:gpeByClass("_im_mess_stack",i);if(!s)return[!0,0];var c=i?i.offsetTop:0,u=s.offsetTop+c,l=n.contHeight();return u<=n.scrollTop()+n.getScrollHeight()?[!0,0]:[!1,Math.max(0,l-u)]}function pn(e,t,n){cancelEvent(t);var r=gpeByClass("_im_top_notice",n);fadeOut(r,200,re.pbind(r));var i=gpeByClass("_im_page_dialogs",r);i&&hasClass(i,"im-page--dialogs-notice")&&removeClass(i,"im-page--dialogs-notice"),ajax.post("al_im.php",{act:"a_hide_top_notice",type:r.getAttribute("data-type"),hash:r.getAttribute("data-hash")})}function hn(e,t,n){cancelEvent(t);var r=gpeByClass("_im_aside_notice",n);slideUp(r,200,re.pbind(r)),ajax.post("al_im.php",{act:"a_hide_top_notice",type:r.getAttribute("data-type"),hash:r.getAttribute("data-hash")})}function fn(e,t){cancelEvent(e);var n=gpeByClass("_im_aside_promo_block",t);slideUp(n,200,re.pbind(n)),ajax.post("al_im.php",{act:"a_hide_promo_block",type:n.getAttribute("data-type"),hash:n.getAttribute("data-hash")})}function mn(e,t){gpeByClass("_im_aside_promo_block",t).classList.add("--action-called"),ajax.post("al_im.php",{act:"a_vkadmin_app_install",hash:domData(t,"hash"),platform:domData(t,"platform")})}function gn(e){return e.length>1?function(e){return[].concat(e).sort((e,t)=>"mail"!==e.type?"mail"===t.type?-1:1:0)}(e):e}function vn(e,t,n,r,i){if(n=n.replace(/\<br\s*\/?\>(\n)?/gi," ").replace(/[\n\r]/gi," "),n=Object(c.replaceMentions)(n,(e,t,n,r,i)=>i),r&&(n=Emoji.emojiToHTML(n,!0)),t&&"..."!==t.trim()&&!Object(u.isChatPeer)(e)&&(n=Object(P.getTemplate)("im_topic",{topic:t,cls:"im-topic_dialog"})+n),!n&&i.length>0){var a=gn(i);n=Object(P.getTemplate)("im_dialog_media",{name:_n(a[0],a)})}return n}function _n(e,t){var n={photo:getLang("mail_added_photos","raw"),video:getLang("mail_added_videos","raw"),audio:getLang("mail_added_audios","raw")};switch(e.type){case"mail":var r=e.object?e.object.fwd_count:e.id.split(";").length;return langNumeric(r,getLang("mail_fwd_msgs","raw"),!0);case"photo":case"video":case"audio":var i=t.filter(t=>t.type===e.type).length;return langNumeric(i,n[e.type],!0);case"audio_playlist":return"audio_album"===e.kind?getLang("mail_added_audio_album"):getLang("mail_added_audio_playlist");case"artist":return getLang("mail_added_artist");case"doc":switch(e.kind){case"graffiti":return getLang("mail_added_graffiti");case"audiomsg":return getLang("mail_added_audiomsg");default:return getLang("mail_added_docs")}case"geo":case"map":return getLang("mail_added_geo");case"wall":return getLang("mail_added_wall");case"wall_reply":return getLang("mail_added_wall_reply");case"gift":return getLang("mail_added_gift");case"link":case"share":return getLang("mail_added_link");case"sticker":return getLang("mail_added_sticker");case"market":return getLang("mail_added_market_item");case"money_transfer":return getLang("mail_added_money_transfer");case"money_request":return getLang("mail_added_money_request");case"story":return getLang("mail_added_story");case"mask":return getLang("mail_added_mask");case"article":return getLang("mail_added_article");case"call":case"group_call_in_progress":return getLang("mail_added_call");case"poll":return getLang("mail_added_poll");case"podcast":return getLang("mail_added_podcast");default:return getLang("mail_added_"+e.type)}return""}function bn(e){addClass(e,"im-send-btn_loading")}function yn(e){removeClass(e,"im-send-btn_loading")}function En(e){var t=e.get(),n=Object(o.getPinnedMessage)(e);if(!n||!Object(S.isPinnedMessageVisibleInTab)(e,Object(o.getPeer)(e)))return"";var r=Object(C.oCacheGet)(e,n.userId);if(!r)return"";var i=On(e,n);if(!i)if(!(i=n.text)&&n.attaches.length){var a=gn(n.attaches);i=Object(P.getTemplate)("im_pinned_message_media",{text:_n(a[0],a)})}else i=tt(e,i,n&&n.kludges||{})||"";return i=i.replace(/<br\s?\/?>/gi," "),Object(P.getTemplate)("im_pinned_message",{date:getSmDate(n.date,t.timeshift),content:i,link:r.link,name:r.name})}function On(e,t){var n="";if(t&&Object(s.isMoneyRequest)(t)&&void 0!==t.kludges.attach1_tr_amount){var r="%s "+t.kludges.attach1_currency;if("RUB"===t.kludges.attach1_currency&&(r=getLang("mail_money_amount_rub","raw")),t.kludges.attach1_total_amount){var i=langNumeric(t.kludges.attach1_tr_amount/1e3,"%s",!0),a=langNumeric(t.kludges.attach1_total_amount/1e3,r,!0);n=getLang("mail_money_request_collected_amount_from").replace("{amount}",i).replace("{total_amount}",a)}else{var o=langNumeric(t.kludges.attach1_tr_amount/1e3,r,!0);n=getLang("mail_money_request_collected_amount").replace("{amount}",o)}if(intval(t.kludges.attach1_held_amount)){var c=langNumeric(t.kludges.attach1_held_amount/1e3,r,!0);n+=" "+getLang("mail_money_request_held_amount").replace("{amount}",c)}t.text&&(n+='<span class="divider"></span>'+tt(e,t.text,t.kludges)),t.kludges.attach1_total_amount&&(n+=Object(P.getTemplate)("im_pinned_message_media_bar",{percent:Math.min(100,Math.floor(t.kludges.attach1_tr_amount/t.kludges.attach1_total_amount*100))}))}return n}function Cn(e,t,n){var r=n.getAttribute("data-info");r&&Object(p.showTooltip)(n,{text:r,className:"_im_history_tooltip",appendParentCls:"_im_mess_stack",black:1,hidedt:1e3,shift:[0,4]})}function Sn(e,t,n){var r=+n.getAttribute("data-time");r&&Object(p.showTooltip)(n,{text:getLang("mail_message_edited")+" "+getSmDate(r,e.get().timeshift),className:"_im_history_tooltip",appendParentCls:"_im_mess_stack",black:1,shift:[0,4]})}function Tn(e,t,n){var r=n.target,i=r.closest("."+V),a=i.querySelector("."+q);if(a){var o,s=Number(a.getAttribute("data-msgid")),c=k.casperMessagesStore.getExpireTime(s),u="_im_bomb_tooltip_"+Math.round(1e4*Math.random()).toString(16);if(window.tooltips){var l=t.querySelectorAll(".im-mess-stack--bomb");Array.from(l).forEach(e=>{e!==r&&tooltips.hide(e,{fasthide:!0})})}var d=wn(e);Object(p.showTooltip)(r,{text:f(formatTime(c)),className:"_im_history_tooltip "+u,appendParentCls:V,black:1,shift:[12,4],onShowStart:h,onShowEnd(){o=setTimeout(h,500)},onHide(){clearTimeout(o)},force:!0,toup:r.getBoundingClientRect().top>d+37,hasover:!0}),setTimeout(h,500)}function h(){var e=i.querySelector(`.${u} .tt_text`);e&&(e.innerHTML=f(formatTime(k.casperMessagesStore.getExpireTime(s)))),o=setTimeout(h,500)}function f(e){return`<div class="wrapped">${e}</div>`}}function wn(e){var t=Object(o.getPeer)(e),n=Object(o.getTab)(e,t),r=Object(S.isPinnedMessageVisibleInTab)(e,Object(o.getPeer)(e))||n&&n.top_banner,i=Object(A.getPeerProfileHeight)();return 105+(r?In(e):0)+i}function In(e){var t=Object(o.getPinnedMessage)(e);return t&&Object(s.isMoneyRequest)(t)?62:52}function Pn(e,t){e.bodyNode.addEventListener("mouseover",e=>{hasClass(e.target,"_im_edit_time")?Sn(t,0,e.target):hasClass(e.target,"_im_page_info")&&Cn(0,0,e.target)})}function jn(e,t,n,r,i){var a,o=e.get();Pn(showTabbedBox("al_im.php",{act:"a_get_pinned_message_box",chat:n,gid:e.get().gid,hash:o.tabs[n].hash},{onDone:(n,i)=>{i&&(a=r(n,e,t,i))},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{a&&a.unmount()}}},i),e)}function kn(e,t,n){var r=e.get();Pn(showTabbedBox("al_im.php",{act:"a_get_replied_message_box",chat:r.peer,msgid:t,gid:r.gid,hash:r.tabs[r.peer].hash},{onDone:(e,t)=>{},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{}}},n),e)}function An(e,t){return!(!Object(u.isChatPeer)(e.peerId)||!e.memberIds)&&e.memberIds.indexOf(t)>=0}function Rn(e){return!Object(u.isChatPeer)(e.peerId)||e.data.kicked?0:e.membersCount}function Ln(e,t){var n=Object(C.oCacheGet)(e,t.peerId),r=Object(o.getTab)(e,t.peerId)||{};return n&&(t.photo=t.photo||n.photo,t.name=t.name||n.name,t.href=t.link||n.link,t.sex=t.sex||n.sex),t.last_touched=r.last_touched||0,t.verified=!!t.verified,t.lastmsg=t.lastmsg||t.lastmsg_meta&&t.lastmsg_meta[0]||!1,t.folders=t.folders||null,t.unread=t.unread||0,t.last_seen=t.last_seen||{platform:0,time:0,mobile:0,can_see:0},t.online=t.last_seen&&t.last_seen.platform||0,t.out_up_to=null!=t.out_up_to?t.out_up_to:t.in_up_to||0,Object(u.isChatPeer)(t.peerId)&&(t.memberIds=t.memberIds||r.memberIds||null),t}function Nn(e,t){for(var n in t)t.hasOwnProperty(n)&&Ln(e,t[n])}function Mn(e,t){var n=[],r=t.find(e=>"mail"===e[0]),i=r?r[1].split(";"):[];for(i.length>100&&(r[1]=i.slice(0,100).join(";"));e.length>4096;){var a=e.substr(0,4096).lastIndexOf(" ");-1==a&&(a=4096),n.push({msgText:trim(e.substr(0,a))}),e=trim(e.substr(a))}for(e.length&&n.push({msgText:e,attaches:t}),n.length||n.push({attaches:t}),i=i.slice(100);i.length;i=i.slice(100))n.push({attaches:[["mail",i.slice(0,100).join(";")]]});return n}function Dn(e){return e.length>4096}function xn(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=Object.assign(Un(t,r),{act:"a_chat_preview"}),o=!1;showBox("al_im.php",a,{stat:["boxes.css"],params:{dark:1,hideButtons:!0,onHide(){e.set(n),o&&o.unmount()}},onFail:e=>(setTimeout(()=>Object(h.showFastBox)(getLang("global_error"),e),0),!0),onDone(t){o=E(t.bodyNode,e,i)}},{})}function Un(e,t){return t?{chat_id:e.invite_chat_id,hash:e.invite_hash}:e}function Bn(){Object(h.showFastBox)(getLang("global_error"),getLang("mail_message_wait_until_uploaded"))}function Fn(e,t){var n=Object(o.getTab)(e,t.peerId)||{},r=e.get(),i=Object(u.isChatPeer)(t.peerId)&&Object(I.isUserAdminInChat)(n,r.id),a=Object(u.isChatPeer)(t.peerId)&&Object(I.isUserAdminInChat)(n,t.userId);if(!t)return!1;if(!Object(s.isOut)(t)&&(!i||a))return!1;if(333==t.peerId)return!1;if(Date.now()/1e3-t.date>86400)return!1;if(Ee(e,t.peerId,t.messageId))return!1;if(Object(u.isChatPeer)(t.peerId)){if(!Object(o.isChatActive)(n))return!1}else if(n.block_error>0)return!1;return!0}function Hn(e,t){var n=Object(o.getTab)(e,t),r=-1!==n.memberIds.indexOf(n.ownerId),i=r?[n.ownerId]:[];return(i=i.concat(n.memberIds.filter(t=>t!==n.ownerId&&Object(C.oCacheExists)(e,t)).slice(0,r?4:5))).map(t=>Object(C.oCacheGet)(e,t))}function Gn(e,t){return t.map(t=>Object(C.oCacheGet)(e,t))}function Vn(e,t){return Object(o.getTab)(e,t).memberIds.reduce((t,n)=>{var r=Object(C.oCacheGet)(e,n);return t[r.id]=r,t},{})}function qn(e,t){if("number"!=typeof e||0===e)return"";var n,r=[[31536e3,t?getLang("global_years_accusative","raw"):getLang("global_age_years","raw")],[2592e3,t?getLang("global_months_accusative","raw"):getLang("global_age_months","raw")],[604800,t?getLang("global_weeks_accusative","raw"):getLang("global_age_weeks","raw")],[86400,t?getLang("global_days_accusative","raw"):getLang("global_age_days","raw")],[3600,t?getLang("global_hours_accusative","raw"):getLang("global_hours","raw")],[60,t?getLang("global_minutes_accusative","raw"):getLang("global_minutes","raw")],[1,t?getLang("global_seconds_accusative","raw"):getLang("global_age_seconds","raw")]],i=e,a=[];if(r.forEach(e=>{var t=M(e,2),n=t[0],r=t[1],o=Math.floor(i/n);i%=n,o>=1&&a.push(langNumeric(o,r))}),1===(n=a.length))return a.pop();var o=a.slice(0,n-1).join(", "),s=a.pop();return getLang("global_and").replace(/{before}/gi,o).replace(/{after}/gi,s)}function zn(e,t,n,i){i&&!Ee(e,n,i)&&(Object(o.getMessage)(e,n,i)?(e.setState({msgid:i}),Object(a.updateLocation)({msgid:i}),t()):e.get().longpoll.push([r.changePeer(n,i)]))}function Kn(e){var t=geByClass1("im-mess_is_editing");if(!t)return null;var n=e.get().tabs[e.get().peer],r=Object(o.parserMessage)(n.msgs[domData(t,"msgid")]);return r&&r.peerId==e.get().peer?r:null}function Wn(e,t){if(Object(o.isClassicInterface)(e)){var n=document.getElementById("ui_rmenu_mr");n&&(Object(o.existsIncomingMessageRequest)(e)?n.classList.remove("unshown"):n.classList.add("unshown"))}else t(e)}function Yn(e){var t=Object(O.unpackStore)(e),n=Number(t.dialog_tab_cts[i.FOLDER_MESSAGE_REQUEST]),r=n>0?n:"",a=document.querySelector('._im_right_menu_counter[data-tab="mr"]');a&&(a.innerHTML=r)}function $n(){for(var e=curBox();e;)e.hide(),e=curBox()}function Jn(e,t){return getLang("mail_invitation_sended_ago").replace("{when}",getDateText(e,t))}function Xn(e,t){var n=Object(o.getPeer)(e),r=Object(o.getMessage)(e,n,t);return Object(I.canPinOrUnpin)(e,n)&&!Object(s.hasPrivateStory)(r)&&!Object(s.isCasperMessage)(r)}function Qn(e,t){var n=Object(o.getPeer)(e);return!t.find(t=>{var r=Object(o.getMessage)(e,n,t);return Object(s.hasPrivateStory)(r)||Object(s.isCasperMessage)(r)})}function Zn(e,t){var n=Object(o.getPeer)(e);return!t.find(t=>{var r=Object(o.getMessage)(e,n,t);return Object(s.isCasperMessage)(r)})}function er(e,t){var n=k.casperMessagesStore.isProcessed(e.messageId),r=k.casperMessagesStore.has(e.messageId),i=k.casperMessagesStore.getExpireTime(e.messageId)>k.MAX_DEVIATION;(!r&&!n||r&&i)&&t(e),r&&i&&k.casperMessagesStore.remove(e.messageId)}function tr(e){return e===vk.id}function nr(e,t){return Object(u.isUserPeer)(t)&&!tr(t)&&!Object(o.isCommunityInterface)(e)&&!Ye(t)}function rr(e,t){var n=e.get(),r=Object(o.isCommunityInterface)(e);return Object(u.isUserPeer)(t)&&!tr(t)&&!r&&!inArray(t,n.moneyTransferExcept)&&!Ye(t)||Object(o.isCommunityPeer)(t)&&n.moneyTransferCommAvail&&Object(o.getCurrentTab)(e).moneyTransferAvail&&!r||r&&n.moneyRequestAvail&&!Object(u.isChatPeer)(t)||Object(u.isChatPeer)(t)&&Object(o.getCurrentTab)(e).moneyRequestAvail&&!Object(o.isCasperChat)(e,t)}function ir(e,t,n){var r=geByClass1("_im_mess_"+n.messageId,t),i=r&&r.closest("._im_mess_stack");if(!r||!i)return t;var a,o,s,c=Array.from(i.querySelectorAll("._im_mess")),u=M((o=(a=i).previousElementSibling,s=a.nextElementSibling,[o&&1===o.nodeType?o:null,s&&1===s.nodeType?s:null]),2),l=u[0],d=u[1],p=l&&l.classList.contains("im-expired-message"),h=d&&d.classList.contains("im-expired-message"),f=p&&0===c.findIndex(e=>+e.getAttribute("data-msgid")===n.messageId),m=h&&c.findIndex(e=>+e.getAttribute("data-msgid")===n.messageId)===c.length-1,g=ar((f?+l.getAttribute("data-count"):0)+(m?+d.getAttribute("data-count"):0)+1,"_im_expired_message_"+n.messageId),v=se(g);if(f&&(v.classList.add(...l.classList),l.remove()),m&&(v.classList.add(...d.classList),d.remove()),1===c.length)i.replaceWith(v);else{var _=M(c.reduce((e,t)=>{var r=+t.getAttribute("data-msgid");return r<n.messageId&&e[0].push(t),r>n.messageId&&e[1].push(t),e},[[],[]]),2),b=_[0],y=_[1];i.replaceWith(se(or(e,b))||"",v,se(or(e,y))||"")}return t}function ar(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(P.getTemplate)("sImExpiredMessagePlaceholder",{text:langNumeric(e,getLang("mail_messages_expired","raw")).replace("{count}",e),count:e,id_classes:Object(l.classNames)(t)})}function or(e,t){if(0===t.length)return"";var n=+t[0].getAttribute("data-peer"),r=+t[0].getAttribute("data-msgid"),i=Object(o.getMessage)(e,n,r);return Object(P.getTemplate)("im_mess_stack",Object.assign(sr(e,i),{messages:t.reduce((e,t)=>e+t.outerHTML,"")}))}function sr(e,t){var n=Object(O.unpackStore)(e),r=t.peerId,i=t.messageId,a=Object(o.getTab)(e,r),c=Object(s.getUserId)(t),d=Object(s.getAdminId)(e,t),p=Object(C.oCacheGet)(n,d?-n.gid:c)||a,h=Object(u.isChatPeer)(r)?p.name:p.first_name,f=p.link||a.href,m=Object(u.isChatPeer)(r)&&p.image_status?p.image_status:"",g=Object(P.getTemplate)("im_mess_stack_name",{name:h+m,link:f,class:Object(s.isMoney)(t)?" im-mess-stack--lnk-money-transfer":""});if(Object(s.isGift)(t)&&(g+=Object(P.getTemplate)("sImGiftLabel",{content:langSex(p.sex||0,getLang("mail_gift_message_sent","raw"))})),Object(s.isMoney)(t)){var v=Object(s.isMoneyRequest)(t)?getLang("mail_money_request_message_sent","raw"):getLang("mail_money_tranfer_message_sent","raw");g+=Object(P.getTemplate)("sImMoneyTransferLabel",{content:langSex(p.sex||0,v)})}var _=function(e,t){var n=Object(O.unpackStore)(e),r=t.peerId,i=t.messageId,a=Object(u.isChatPeer)(r)&&Object(o.isCasperChat)(n,r),c=Object(s.getAdminId)(e,t),d=Object(o.isCommunityInterface)(e)?"/gim"+n.gid:"/im",p=a?"":Object(P.getTemplate)("im_stack_date",{date:(h=t.date,f=n.timeshift,langDate(1e3*h,"{hour}:{minute} {am_pm}",1e3*f,[],!0)),link:`${d}?sel=${r}&msgid=${i}`});var h,f;if(c&&n.admins[c]){var m=n.admins[c],g=c===vk.id?getLang("mail_by_you"):m[0];p+=" "+Object(P.getTemplate)("im_admin_link",{name:g,href:m[1]})}return p+function(e,t){if(!Object(s.isCasperMessage)(t))return"";var n=M(k.casperMessagesStore.getTimings(t.messageId),3),r=n[0],i=n[1],a=n[2],c=Math.max(r+i-a,0);return Object(P.getTemplate)("sImBomb",{classnames:Object(l.classNames)({"im-mess-stack--bomb_hidden":Object(o.isCasperChat)(e,t.peerId),"im-mess-stack--bomb_expiring":c<=k.EXPIRING_TIME,"im-mess-stack--bomb_expiring-soon":c<=k.EXPIRING_SOON_TIME})})}(n,t)}(e,t);return{photo:p.photo,href:f,cls:"",date_attr:"",link:`/im?sel=${r}&msgid=${i}`,name:stripHTML(g),stack_name:g,peerId:c,messageMeta:_,admin:d}}function cr(e,t){var n=`._im_replied_message[data-msgid="${t.messageId}"] .im-replied--text`;Array.from(e.querySelectorAll(n)).forEach(e=>{e.innerHTML=Object(P.getTemplate)("im_dialog_media",{name:getLang("mail_expired_message")})})}function ur(e){return Object(u.isChatPeer)(e.peerId)&&e.membersCount?langNumeric(e.membersCount,getLang("mail_im_n_chat_members","raw")):""}var lr="im_message",dr="im_header",pr="im_list_header";function hr(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(window.Calls&&window.Calls.call){if(!t)return void window.Calls.startCall(n,i);var a=Object(u.isChatPeer)(t);if(a){var s=Object(o.getTab)(e,t),c=N({},s,{canAddMembers:Object(I.canInviteUser)(e,t,void 0)});window.Calls.startGroupCall(t,[c],r,n,i)}else{var l=Object(C.oCacheGet)(e,t),d=N({},l,{canAddMembers:!0});window.Calls.call(t,n,[d,[l]],i)}}}function fr(e){var t=decodeURIComponent(e.target.getAttribute("href")).match(/^\/away\.php\?to=(.+)&(.+)?$/),n=t&&t[1];if(n&&window.Calls&&window.Calls.showJoinPopup)return cancelEvent(e),window.Calls.showJoinPopup(n)}function mr(e,t){var n=e.get(),r=Object(o.getTab)(e,t);return!!n.isCallsEnabled&&(!(Object(u.isUserPeer)(t)&&!n.isCalls1To1Enabled)&&(!Object(o.isCommunityInterface)(e)&&!!r.can_start_call))}function gr(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(window.Calls&&window.Calls.call){var i=Object(o.getTab)(e,t);if(!Object(o.isChatActive)(i))return;window.Calls.joinCallByLink(t,n,[i],r)}}function vr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=t?"&msgid="+t:"";return`/im?sel=${nt(e)}${n}`}},PU8N:function(e,t,n){"use strict";function r(){return!!window.isMVK}function i(e){return void 0===e&&(e=""),new Promise((function(t,n){var r=document.createElement("video");r.addEventListener("loadedmetadata",(function(){return t(r.duration)}),{once:!0}),r.addEventListener("error",n,{once:!0}),r.crossOrigin="anonymous",r.preload="metadata",r.src=e}))}function a(e){return new Promise((function(t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="blob",r.onload=function(){if(404===r.response.status)return n();t(r.response)},r.onerror=n,r.send()}))}function o(e){try{return e.type.split("/").splice(-1)[0]}catch(e){return null}}n.r(t),n.d(t,"isMvk",(function(){return r})),n.d(t,"getVideoDuration",(function(){return i})),n.d(t,"getMediaBlob",(function(){return a})),n.d(t,"getBlobType",(function(){return o})),n.d(t,"noop",(function(){return s})),n.d(t,"getAverageRGB",(function(){return c})),n.d(t,"loadImage",(function(){return u}));var s=function(){};function c(e){var t,n={r:0,g:0,b:0};try{t=e.getImageData(0,0,e.canvas.width,e.canvas.height)}catch(e){return n}for(var r=-4,i=0;(r+=20)<t.data.length;)++i,n.r+=t.data[r],n.g+=t.data[r+1],n.b+=t.data[r+2];return n.r=~~(n.r/i),n.g=~~(n.g/i),n.b=~~(n.b/i),n}function u(e){return new Promise((function(t,n){var r=new Image;r.crossOrigin="anonymous",r.onerror=function(){return n(new Error("Failed to load image's URL: "+e))},r.onload=function(){return t(r)},r.src=e}))}},PjZB:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));n("rGqo"),n("a1Th"),n("Btvt");var r=n("q1tI"),i=(n("17x9"),n("ZxpX"));class a extends r.Component{constructor(e){super(e),this.id=Math.round(1e6*Math.random()).toString(16),this.setSpinnerParams(e)}componentWillReceiveProps(e){this.setSpinnerParams(e)}setSpinnerParams(e){this.offset=Math.round(Math.PI*e.size),this.c=.5*e.size,this.animation=function(e,t){if(!e||!t)return"";var n=Object.keys(t).map(e=>e+" {"+Object.keys(t[e]).map(n=>n+":"+t[e][n]).join(";")+"}").join("");return`@-webkit-keyframes ${e} {${n}} @keyframes ${e} {${n}}`}("dash"+this.id,{"0%":{"stroke-dashoffset":this.offset},"50%":{"stroke-dashoffset":Math.round(.25*this.offset),transform:"rotate(135deg)"},"100%":{"stroke-dashoffset":this.offset,transform:"rotate(360deg)"}})}render(){var e=this.props,t=e.style,n=e.color,a=e.size,o=e.duration,s=e.strokeWidth,c=e.className,u=this.id,l=this.offset,d=this.animation,p=Object(i.classNames)("Spinner",c);return r.createElement("div",{className:p,style:t},r.createElement("svg",{className:"Spinner__svg",width:a,height:a,viewBox:`0 0 ${a} ${a}`,xmlns:"http://www.w3.org/2000/svg"},r.createElement("g",{style:{width:a,height:a,transformOrigin:.5*a+"px "+.5*a+"px"}},r.createElement("style",{dangerouslySetInnerHTML:{__html:d}}),r.createElement("circle",{className:"Spinner__path",fill:"none",stroke:n,strokeDasharray:l,strokeDashoffset:l,strokeWidth:s,style:{animationName:"dash"+u,animationTimingFunction:"ease-in-out",animationDuration:o+"s",animationIterationCount:"infinite"},cx:.5*a,cy:.5*a,r:.5*a-.5*s}))))}}a.defaultProps={color:"#5181b8",size:19,strokeWidth:2,duration:1.4,className:""}},RdBX:function(e,t,n){"use strict";n.r(t),n.d(t,"vkIndexer",(function(){return r}));n("Vd3H"),n("OG14"),n("a1Th"),n("Btvt"),n("KKXr"),n("Oyvg");function r(e,t,n){this.list=e,this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=n||function(){},this.prepareFunc=t||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}r.prototype.delimiter=r.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),r.prototype.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),r.prototype.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},r.prototype.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},r.prototype.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},r.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),t=this.iterCur;t<e;t++){var n=this.list[t];try{n._order=t}catch(e){}this.add(n)}this.iterCur=t,t>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},r.prototype.strToPrefixes=function(e){for(var t={},n=winToUtf(e).toLowerCase().split(this.delimiter),r=n.length;r--;){var i=n[r],a="";if(i){for(var o=0;o<6;o++){var s=i.charCodeAt(o);if(s){var c=this.toTranslit[s],u=i.substr(o,1);a+=null!=c?c:u}}t[a]=1}}return t},r.prototype.strToSearchPrefixes=function(e){for(var t=[],n=e.toLowerCase().split(this.delimiter),r=n.length;r--;){var i={},a=n[r],o="",s="",c="",u=a.length>1;if(a){for(var l=0;l<6;l++){var d=a.charCodeAt(l);if(d){var p=this.toTranslit[d],h=a.substr(l,1);if(o+=null!=p?p:h,u){var f=this.toLocalCase[h],m=this.toLocalTranslit[d];s+=null!=f?f:h,c+=null!=m?m:h}}}i[o]=1,u&&(i[s]=2,i[c]=3),t.push(i)}}return t},r.prototype.toIndexTree=function(e,t){for(var n=this.index,r=0;r<6;r++){var i=e.substr(r,1)||-1;n=n[i]?n[i]:n[i]=5==r?[]:{}}n.push(t)},r.prototype.remove=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var r in n)if(n.hasOwnProperty(r)){for(var i=this.index,a=0;a<6;a++){var o=r.substr(a,1)||-1;if(!i[o])break;i=i[o]}if(i.length)for(var s in i)if(this.equals(i[s],e)){i.splice(s,1);break}}},r.prototype.equals=function(e,t){for(var n in e)if(e.hasOwnProperty(n))switch(typeof e[n]){case"object":if(!this.equals(e[n],t[n]))return!1;break;case"function":if(void 0===e[n]||e[n].toString()!=t[n].toString())return!1;break;default:if(e[n]!=t[n])return!1}for(var r in t)if(void 0===t[r])return!1;return!0},r.prototype.intersect=function(e,t){var n=[];if(isNumeric(e[0])||isNumeric(t[0]))return e.filter((function(e){return-1!==t.indexOf(e)}));for(;e.length>0&&t.length>0;)e[0]._order<t[0]._order?e.shift():(e[0]._order>t[0]._order||this.equals(e[0],t[0])&&n.push(e.shift()),t.shift());return n},r.prototype.add=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var r in n)n.hasOwnProperty(r)&&this.toIndexTree(r,e)},r.prototype.search=function(e){var t=this.index,n=this.strToSearchPrefixes(e),r=[],i=!1;for(var a in n)if(n.hasOwnProperty(a)){if(i&&!r)break;var o=this.localSearch(n[a],0,t);o.sort((function(e,t){return e._order-t._order})),r=i?this.intersect(r,o):o,i=!0}for(var s=r[0],c=r.length+1,u=[],l=1;l<c;l++){var d=r[l];d!=s&&(u.push(s),s=d)}return u},r.prototype.localSearch=function(e,t,n){if(!n)return[];var r={};for(var i in e)if(e.hasOwnProperty(i)){var a=i.substr(t,1)||-1;r[a]||(r[a]={}),r[a][i]=1}if(6==t++||!n)return n;var o=[];for(var s in r)if(-1==s)for(var c in n)n.hasOwnProperty(c)&&o.push.apply(o,this.localSearch(r[s],t,n[c]));else{var u=this.localSearch(r[s],t,n[s]);o.push.apply(o,u)}return o}},S2bU:function(e,t,n){"use strict";n.r(t),n.d(t,"replaceHyperLinks",(function(){return o})),n.d(t,"replaceEmailLinks",(function(){return s})),n.d(t,"replaceMentions",(function(){return c})),n.d(t,"replaceMassMentions",(function(){return u})),n.d(t,"replaceHashtags",(function(){return p})),n.d(t,"linksReplacer",(function(){return h}));var r,i=n("h++7"),a=n("t7n3");function o(e,t){for(var n,r=0,a=e;null!==(n=i.MESSAGE_REGEXP.exec(e));){var o=(n=l(n))[0].length,s=n.index+o,c=e[n.index-1],u=e[s-1],p=void 0!==c&&/([\w\$А-Яа-яёЁєЄҐґЇїІіЈј\—\-\_@;.])/i.test(c),h=void 0!==u&&/([:;$])/i.test(u);if(!p&&!h){var f=d(n),m=f.domain.toLowerCase();if(m.length<=i.MAX_DOMAIN_LENGTH&&i.TOP_DOMAINS.includes(m)){var g=t(f);a=a.slice(0,n.index+r)+g+a.slice(s+r),r+=g.length-o}}}return a}function s(e,t){return e.replace(i.EMAIL,t||function(e){return'<a href="mailto:'+e+'">'+e+"</a>"})}function c(e,t){return e.replace(i.MENTION,t||function(e,t,n,r,i){return'<a href="/'+(t+n)+'" class="mem_link" mention="'+Object(a.clean)(r||"")+'" mention_id="'+Object(a.clean)(t+n)+'" onclick="return mentionClick(this, event)" onmouseover="mentionOver(this)">'+i+"</a>"})}function u(e,t){return e.replace(i.RE_MASSMENTION,(function(e){return t?t(e,"","",e,e):'<span class="mem_pseudolink" data-mention="'+e.slice(1).toLowerCase()+'">'+e+"</span>"}))}function l(e){if(!e[0]||!e[6])return e;var t=e[0].length-1,n=e[6].length-1;return"."===e[0][t]&&"."===e[6][n]&&(e[0]=e[0].slice(0,t),e[6]=e[6].slice(0,n)),e}function d(e){return{full:e[0],protocol:e[1]||"http://",url:e[2],domain:e[4],query:e[6]||""}}function p(e,t){return e.replace((r||(r=new RegExp(i.RE_HASHTAG_EXTRACTION_PATTERN,"ig")),r),(function(e,n,r,i,a){return(n||"")+t(r+(a||""))}))}function h(e,t){var n=t.url,r=t.full,o=t.protocol,s=t.query,c=t.domain;try{r=decodeURIComponent(r)}catch(e){}if(r.length>55&&(r=r.substr(0,53)+".."),r=Object(a.clean)(r).replace(/&amp;/g,"&"),!e&&c.match(i.OUR_DOMAINS)){var u=n=Object(a.replaceEntities)(n).replace(i.ENTITIES,encodeURIComponent),l=n.indexOf("#/"),d="";l>=0?u=n.substr(l+1):(l=n.indexOf("#!"))>=0&&(u="/"+n.substr(l+2).replace(/^\//,""));var p=u.match(i.VK_DOMAIN);return p&&p[1].length<32&&(d=' mention_id="'+p[1]+'" onclick="return mentionClick(this, event)" onmouseover="mentionOver(this)"'),'<a href="'+function(e){return e.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}(o+n+s)+'" target="_blank" rel="noopener"'+d+">"+r+"</a>"}var h=Object(a.replaceEntities)(n+s).toString();return'<a href="'+("away.php?utf=1&to="+encodeURIComponent(o+h))+'" target="_blank" rel="noopener" onclick="'+("return goAway('"+Object(a.clean)((o+n+s).replace(/'/g,"\\'"))+"', {}, event);")+'">'+r+"</a>"}},SLVX:function(e,t,n){"use strict";function r(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}n.r(t),n.d(t,"default",(function(){return r}))},Syd7:function(e,t,n){"use strict";n.r(t),n.d(t,"getPeerProfileHeight",(function(){return J})),n.d(t,"mount",(function(){return Q}));var r=n("q1tI"),i=n("i8i4"),a=n("rHUl"),o=n("P13b"),s=(n("91GP"),n("17x9"),n("ZxpX")),c=n("ErRf"),u=n("nAFc"),l=n("ERyv"),d=n("4+be"),p=n("6krn"),h=n("754W"),f=n("6aSF"),m=n("dt/K"),g=n("vT4u"),v=n("EasH"),_=p.default.getLang;class b extends r.Component{constructor(){super(...arguments),this.onAdTagAlertClick=()=>{Object(v.showFastBox)(_("mail_ad_tag_no_access_box_title"),_("mail_ad_tag_no_access_box_text"))}}render(){var e=this.props.data;if(e.adId){var t=`ads?act=office&union_id=${e.adId}&utm_medium=community_messages_ad_tag&utm_source=dialog`;return r.createElement("div",{className:"PeerProfileTagsListItem PeerProfileTagsListItem--adTag"},e.hasAdAccess&&r.createElement("a",{className:"PeerProfileTagsListItem__adTagLink",href:t,target:"_blank"},r.createElement("span",{className:"PeerProfileTagsListItem__adTagText"},_("mail_ad_tag_text_prefix")," ",e.adId)),!e.hasAdAccess&&r.createElement("button",{className:"PeerProfileTagsListItem__adTagAlert",onClick:this.onAdTagAlertClick},r.createElement("span",{className:"PeerProfileTagsListItem__adTagText"},_("mail_ad_tag_no_access_text"))))}return r.createElement("div",{className:"PeerProfileTagsListItem",style:{backgroundColor:e.color}},r.createElement("span",null,Object(u.decodeHTMLEntities)(e.name)))}}var y=b,E=p.default.getLang;class O extends r.Component{constructor(e){super(e),this.onExtraClick=()=>{this.setState({isTagsCollapsed:!1})},this.state={isTagsCollapsed:!0}}render(){var e=this.props,t=e.peerTags,n=e.tags,i=e.isPeerProfileCollapsed,a=e.adId,o=e.hasAdAccess,s=e.toggleProfile,c=n.filter(e=>t.includes(e.id));a&&c.unshift({adId:a,hasAdAccess:o});var u=0;i&&this.state.isTagsCollapsed&&c.length>5&&(u=c.splice(5).length);return c=c.map((e,t)=>r.createElement(y,{key:t,data:e})),r.createElement("div",{className:"PeerProfileTagsList"},c.length>0&&c,u>0&&r.createElement("div",{className:"PeerProfileTagsListItem PeerProfileTagsListItem--extra",onClick:this.onExtraClick},"+ "+E("mail_im_peer_profile_extra_tags",u)),!c.length&&r.createElement("div",{className:"PeerProfileTagsListItem--empty"},E("mail_im_peer_profile_tags_empty")," ",r.createElement("span",{className:"PeerProfileTagsList__linkDivider"},"·")," ",r.createElement(h.default,{className:"PeerProfileTagsList__toggleProfileLink",onClick:s},E(i?"mail_im_peer_profile_toggle_tags_on":"mail_im_peer_profile_toggle_tags_off"))))}}var C=O,S=n("0Rlc");var T=function(e){var t=e.data,n=e.onCheckboxChange;return r.createElement("div",{className:"PeerProfileTagsGridItem",onClick:e=>{e&&e.preventDefault(),n(t.id,!t.isChecked)}},r.createElement(S.default,{className:"PeerProfileTagsGridItem__checkbox",checked:t.isChecked,onChange:(e,r)=>n(t.id,r)},r.createElement("span",{className:"PeerProfileTagsGridItem__color",style:{backgroundColor:t.color}}),r.createElement("span",{className:"PeerProfileTagsGridItem__name",title:t.name},Object(u.decodeHTMLEntities)(t.name))))};class w extends r.Component{constructor(){super(...arguments),this.onCheckboxChange=(e,t)=>{this.props.onPeerTagsChange(e,t)}}render(){var e=this.props.tags;return r.createElement("div",{className:"PeerProfileTagsGrid"},e.map((e,t)=>r.createElement(T,{key:t,data:e,onCheckboxChange:this.onCheckboxChange})))}}var I=w,P=n("r7nW"),j=n("Ht+d"),k=n("6raB"),A=n("0toi"),R=p.default.getLang;class L extends r.Component{constructor(e){super(e),this.onKeyDown=e=>"Enter"!==e.key||(e.preventDefault(),!1),this.inputRef=r.createRef()}componentDidMount(){this.props.data.id||this.inputRef.current.focus()}render(){var e=this.props,t=e.index,n=e.data,i=e.onNameChange,a=e.onRemove;return r.createElement("div",{className:"PeerProfileTagsModalField"},r.createElement("input",{type:"hidden",value:n.id?n.id:""}),r.createElement("input",{type:"text",className:"PeerProfileTagsModalField__input",value:Object(u.decodeHTMLEntities)(n.name),ref:this.inputRef,onChange:e=>i(e,t),onKeyDown:this.onKeyDown,maxLength:20,placeholder:R("mail_im_peer_profile_manage_tags_placeholder")}),r.createElement("span",{className:"PeerProfileTagsModalField__color",style:{backgroundColor:n.color}}),r.createElement(m.default,{position:"t",text:R("mail_im_peer_profile_manage_tags_remove")},r.createElement("span",{className:"PeerProfileTagsModalField__remove",onClick:()=>a(t)})))}}var N=L;function M(){return(M=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var D=p.default.getLang,x=["#4bb34b","#5c9ce6","#e64646","#792ec0","#63b9ba","#ffa000","#ffc107","#76787a","#9e8d6b","#45678f","#539b9c","#454647","#7a6c4f","#6bc76b","#5181b8","#ff5c5c","#a162de","#7ececf","#aaaeb3","#bbaa84"],U=x[0];class B extends r.Component{constructor(e){var t;super(e),t=this,this.generateEmptyTag=()=>({name:"",color:this.state&&this.state.tags.length?this.getAvailableColor():U,state:"new"}),this.getAvailableColor=()=>{var e=[...this.state.tags].reduce((e,t)=>("deleted"!==t.state&&(e[t.color]=!0),e),{});return x.find(t=>!e[t])},this.onAddLinkClick=e=>{e&&e.preventDefault(),this.state.tags.filter(e=>"deleted"!==e.state).length>=20||this.setState(e=>({tags:[...e.tags,this.generateEmptyTag()]}),()=>{this.inputsRef.current.scrollIntoView({block:"end"})})},this.onNameChange=(e,t)=>{var n=e.target.value;this.setState({tags:this.state.tags.map((e,r)=>r===t?M({},e,{name:n,state:e.state||"changed"}):e)})},this.onRemove=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t.state.tags,i=r[e];!n&&i.id&&i.uses>0?t.setState({isConfirmationModalOpen:!0,indexToRemove:e}):t.setState({tags:t.state.tags.filter((t,n)=>n!==e),deletedTags:[...t.state.deletedTags,M({},i,{state:"deleted"})]})},this.onSubmit=e=>{e&&e.preventDefault();var t=[...this.state.tags,...this.state.deletedTags].reduce((e,t)=>(t.name.trim()&&t.state&&e.push({id:t.id,name:t.name,color:t.color,state:t.state}),e),[]);this.setState({isLoading:!0}),this.props.onSave(t)},this.toggleConfirmationModal=(e,t)=>{e&&e.preventDefault(),this.setState({isConfirmationModalOpen:t})},this.state={tags:e.tags.length?e.tags.map(e=>M({},e)):[this.generateEmptyTag()],deletedTags:[],isLoading:!1,isConfirmationModalOpen:!1,indexToRemove:null},this.inputsRef=r.createRef()}render(){var e=this.state,t=e.tags,n=e.isConfirmationModalOpen,i=t[e.indexToRemove],a=Object(s.classNames)("PeerProfileTagsModal",{"PeerProfileTagsModal--hidden":n});return r.createElement(r.Fragment,null,r.createElement(P.default,{onClose:this.props.onClose,className:a,disableBackdropClick:!0,disableEscapeClose:!0},r.createElement("form",{onSubmit:this.onSubmit},r.createElement(A.default.Header,{title:D("mail_im_peer_profile_manage_tags_box_title"),onClose:this.props.onClose,appearance:"blue"}),r.createElement(A.default.Body,null,r.createElement(f.default,{className:"PeerProfileTagsModal__scroll",neverHide:!0},r.createElement("div",{className:"PeerProfileTagsModal__tagsInputs",ref:this.inputsRef},this.state.tags.map((e,t)=>r.createElement(N,{index:t,key:t,data:e,onNameChange:this.onNameChange,onRemove:this.onRemove})),this.state.tags.length<20?r.createElement(h.default,{className:"PeerProfileTagsModal__addLink",onClick:this.onAddLinkClick},D("mail_im_peer_profile_manage_tags_add_link")):""))),r.createElement(A.default.Footer,{actionButtons:[r.createElement(j.default,{key:"cancel",appearance:"tertiary",onClick:this.props.onClose},D("global_cancel")),r.createElement(k.default,{key:"save",onClick:this.onSubmit,loading:this.state.isLoading},D("global_save"))]}))),n&&r.createElement(A.default,{title:D("global_warning"),appearance:"blue",actionButtons:[r.createElement(j.default,{key:"cancel",appearance:"tertiary",onClick:e=>this.toggleConfirmationModal(e,!1)},D("global_cancel")),r.createElement(j.default,{key:"delete",onClick:e=>{this.toggleConfirmationModal(e,!1),this.onRemove(this.state.indexToRemove,!0)}},D("global_delete"))],onClose:e=>this.toggleConfirmationModal(e,!1),className:"PeerProfileConfirmationModal"},Object(d.langStr)(1===i.uses?D("mail_im_peer_profile_tag_delete_confirmation_text_single"):D("mail_im_peer_profile_tag_delete_confirmation_text",i.uses,!0),"tag_name",Object(u.decodeHTMLEntities)(i.name))))}}var F=B,H=n("MV/q"),G=p.default.getLang;class V extends r.Component{constructor(e){var t;super(e),t=this,this.onChange=e=>{var t=e.target.value;this.setState({note:t})},this.onSubmit=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&e.preventDefault();var r=t.state.note&&t.state.note.trim();n||r?(t.setState({isLoading:!0}),t.props.onNoteSave(r)):t.setState({note:""})},this.toggleConfirmationModal=(e,t)=>{e&&e.preventDefault(),this.setState({isConfirmationModalOpen:t})},this.state={note:e.note||"",isLoading:!1,isConfirmationBoxOpen:!1,isConfirmationModalOpen:!1},this.inputRef=r.createRef()}componentDidMount(){this.inputRef.current.element.focus()}render(){var e=Object(s.classNames)("PeerProfileNoteModal",{"PeerProfileNoteModal--hidden":this.state.isConfirmationModalOpen}),t=[...this.props.note?[r.createElement(j.default,{key:"delete",appearance:"link",onClick:e=>this.toggleConfirmationModal(e,!0),className:"PeerProfileNoteModal__deleteButton"},G("mail_im_peer_profile_note_delete_link"))]:[],r.createElement(j.default,{key:"cancel",appearance:"tertiary",onClick:this.props.onClose},G("global_cancel")),r.createElement(k.default,{key:"save",onClick:this.onSubmit,loading:this.state.isLoading},G("global_save"))];return r.createElement(r.Fragment,null,r.createElement(P.default,{onClose:this.props.onClose,className:e,disableBackdropClick:!0,disableEscapeClose:!0},r.createElement("form",{onSubmit:this.onSubmit},r.createElement(A.default.Header,{title:G("mail_im_peer_profile_note_box_title"),onClose:this.props.onClose,appearance:"blue"}),r.createElement(A.default.Body,null,r.createElement(H.default,{className:"PeerProfileNoteModal__input",value:Object(u.decodeHTMLEntities)(this.state.note),placeholder:G("mail_im_peer_profile_note_box_placeholder"),onChange:this.onChange,style:{height:21},maxLength:96,ref:this.inputRef})),r.createElement(A.default.Footer,{actionButtons:t}))),this.state.isConfirmationModalOpen&&r.createElement(A.default,{title:G("global_warning"),appearance:"blue",actionButtons:[r.createElement(j.default,{key:"cancel",appearance:"tertiary",onClick:e=>this.toggleConfirmationModal(e,!1)},G("global_cancel")),r.createElement(j.default,{key:"delete",onClick:e=>{this.toggleConfirmationModal(e,!1),this.setState({note:""},()=>this.onSubmit(null,!0))}},G("global_delete"))],onClose:e=>this.toggleConfirmationModal(e,!1),className:"PeerProfileConfirmationModal"},G("mail_im_peer_profile_note_delete_confirmation_text")))}}var q=V;function z(){return(z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var K=p.default.getLang;class W extends r.PureComponent{constructor(e){super(e),this.toggleProfile=()=>{this.setState({isCollapsed:!this.state.isCollapsed})},this.onPeerTagsChange=(e,t)=>{var n=this.props.store,r=n.get().peer;this.setState(n=>({peerTags:t?[].concat(n.peerTags,e):n.peerTags.filter(t=>t!==e)}),()=>{n.set(g.peerProfileToggleTag.bind(null,e,t,t?"bind":"unbind",r,[...this.state.peerTags])).catch(e=>Object(l.imWeirdCatch)("PeerProfile.toggleTag",e))})},this.onSave=e=>{this.setState({tags:e},()=>{this.props.store.set(g.peerProfileManageTags.bind(null,[...this.state.tags])).then(e=>{var t=e.get().peer_profile_tags;this.setState({isCollapsed:0===t.length,tags:t,isTagsModalOpened:!1}),showDoneBox(K("mail_im_peer_profile_manage_tags_success"),{out:1e3})}).catch(e=>Object(l.imWeirdCatch)("PeerProfile.manageTags",e))})},this.onNoteSave=e=>{var t=this.props.store,n=t.get().peer;t.set(g.peerProfileSaveNote.bind(null,n,e)).then(()=>{this.setState({note:e,isNoteModalOpened:!1}),showDoneBox(K(e?"mail_im_peer_profile_save_note_success":"mail_im_peer_profile_delete_note_success"),{out:1e3})}).catch(e=>Object(l.imWeirdCatch)("PeerProfile.saveNote",e))},this.toggleModal=(e,t,n)=>{switch(e&&e.preventDefault(),n){case"tags":this.setState({isTagsModalOpened:t});break;case"note":this.setState({isNoteModalOpened:t})}t&&Object(c.cancelStackPush)("peer_profile_modal",()=>{Object(c.cancelStackFilter)("peer_profile_modal"),this.toggleModal(null,!1,n)})};var t=e.store.get(),n=t.peer,r=Object(a.getTab)(t,n),i=r.peer_profile_info||{};this.state={isCollapsed:!0,tags:t.peer_profile_tags||[],peerTags:r.peer_tags||[],note:i.note,isTagsModalOpened:!1,isNoteModalOpened:!1}}render(){var e=this.props.store.get(),t=Object(a.getTab)(e,e.peer),n=this.state,i=n.isCollapsed,o=n.tags,c=n.peerTags,l=n.note,p=n.isTagsModalOpened,g=n.isNoteModalOpened,v=o.length>0,_=v?o.reduce((e,t)=>(e[t.id]=!0,e),{}):[],b=c.filter(e=>_[e]),y=t.peer_profile_info,E=y&&(y.city||y.age),O=Object(s.classNames)("PeerProfile__wrapper",{"PeerProfile__wrapper--collapsed":i});return r.createElement("div",{className:O},r.createElement(f.default,{className:"PeerProfile__scroll",neverHide:!0},r.createElement("dl",{className:"PeerProfile__container"},r.createElement("dt",{className:"PeerProfile__label"},K("mail_im_peer_profile_tags_label_text")),r.createElement("dd",{className:"PeerProfile__content PeerProfile__tags"},i&&!v&&!t.ad_id&&r.createElement(h.default,{className:"PeerProfile__manageTagsLink",onClick:e=>this.toggleModal(e,!0,"tags")},K("mail_im_peer_profile_manage_tags")),(v||t.ad_id)&&r.createElement(C,{tags:o,peerTags:b,isPeerProfileCollapsed:i,adId:t.ad_id,hasAdAccess:t.has_ad_access,toggleProfile:this.toggleProfile}),!i&&r.createElement(I,{tags:[...o].map(e=>z({},e,{isChecked:c.includes(e.id)})),onPeerTagsChange:this.onPeerTagsChange}),!i&&r.createElement(h.default,{className:"PeerProfile__manageTagsLink",onClick:e=>this.toggleModal(e,!0,"tags")},K("mail_im_peer_profile_manage_tags")),p&&r.createElement(F,{tags:o,onSave:this.onSave,onClose:e=>this.toggleModal(e,!1,"tags")})),r.createElement("dt",{className:"PeerProfile__label"},K("mail_im_peer_profile_info_label_text")),r.createElement("dd",{className:"PeerProfile__content PeerProfile__info"},E&&r.createElement(r.Fragment,null,y.city&&r.createElement("span",{className:"PeerProfile__infoItem"},Object(u.decodeHTMLEntities)(y.city)),y.age&&r.createElement("span",{className:"PeerProfile__infoItem"},Object(u.decodeHTMLEntities)(y.age)),y.likes_cnt&&r.createElement(m.default,{className:"PeerProfile__infoTooltip",position:"t",text:K("mail_peer_profile_likes_replies_tooltip"),appearance:"light"},r.createElement("span",{className:"PeerProfile__infoItem"},y.likes_cnt&&r.createElement("span",{className:"PeerProfile__infoItem"},Object(u.decodeHTMLEntities)(y.likes_cnt)),y.replies_cnt&&r.createElement("span",{className:"PeerProfile__infoItem"},Object(u.decodeHTMLEntities)(y.replies_cnt))))),!E&&r.createElement("span",null,K("mail_im_peer_profile_info_empty"))),e.is_peer_profile_note_enabled&&r.createElement(r.Fragment,null,r.createElement("dt",{className:"PeerProfile__label"},K("mail_im_peer_profile_note_label_text")),r.createElement("dd",{className:"PeerProfile__content PeerProfile__note"},!l&&r.createElement(h.default,{onClick:e=>this.toggleModal(e,!0,"note")},K("mail_im_peer_profile_note_add_link")),!!l&&r.createElement(r.Fragment,null,r.createElement("span",{className:"PeerProfile__noteText"},Object(u.decodeHTMLEntities)(l)),r.createElement("span",{className:"PeerProfile__noteDivider"}," · "),r.createElement(h.default,{onClick:e=>this.toggleModal(e,!0,"note")},K("mail_im_peer_profile_note_edit_link"))),g&&r.createElement(q,{note:l,onNoteSave:this.onNoteSave,onClose:e=>this.toggleModal(e,!1,"note")}))),r.createElement("dt",{className:"PeerProfile__label"},K("mail_im_peer_profile_join_date_label_text")),r.createElement("dd",{className:"PeerProfile__content"},y&&y.join_date?Object(u.decodeHTMLEntities)(y.join_date):Object(d.langSex)(t.sex,K("mail_im_peer_profile_join_date_empty_text","raw"))))),(v||t.ad_id)&&r.createElement("button",{className:"PeerProfile__toggler",onClick:this.toggleProfile}))}}var Y=W;function $(){return document.querySelector("#PeerProfile")}function J(){var e=$();return e?e.offsetHeight:0}function X(e,t){if(t){var n=parseInt(getStyle(e,"padding-top"));e.style.paddingTop=n+J()+"px"}else e.style.removeProperty("padding-top")}function Q(e){return{render(t){var n=t.get(),s=$(),c=n.peer,u=Object(a.getTab)(n,c);n.is_peer_profile_enabled&&s&&Object(o.isFullyLoadedTab)(n,c)&&!Object(a.isChannelPeer)(u)&&!Object(a.isCommunityChat)(t,c)&&(s.innerHTML&&i.unmountComponentAtNode(s),i.render(r.createElement(Y,{store:t}),s,()=>{X(e,!0)}))},destroy(){var t=$();t&&(i.unmountComponentAtNode(t),X(e,!1))}}}},UlUB:function(e,t,n){"use strict";function r(e,t){var n,r,i=!1;return function a(){if(i)return n=arguments,void(r=this);e.apply(this,arguments),i=!0,setTimeout((function(){i=!1,n&&(a.apply(r,n),n=r=null)}),t)}}n.r(t),n.d(t,"throttle",(function(){return r}))},Wu9C:function(e,t,n){"use strict";n.r(t),n.d(t,"isPinnedMessageVisibleInTab",(function(){return p})),n.d(t,"pinnedMessageHide",(function(){return h})),n.d(t,"pinnedMessageUnHide",(function(){return f})),n.d(t,"pinnedMessageUnpin",(function(){return m})),n.d(t,"mount",(function(){return y}));var r=n("ofcU"),i=n("vT4u"),a=n("P13b");function o(e){return{unmount(){Object(r.destroyModule)(e)}}}function s(e,t,n,i){var s=Object(r.createMutations)(o).bindMutations,c=t=>{n().messageKeyboardButtonClick(t),e.hide()};return s(Object(r.createModule)({handlers:(t,n)=>{n(e.bodyNode,"click",a.MESSAGE_KEYBOARD_BUTTON_CLASS,c)}}))}var c=n("rHUl"),u=n("aong"),l=n("uytb"),d=n("FWc3");function p(e,t){if(Object(u.unpackStore)(e).searchShown)return!1;var n=Object(c.getTab)(e,t),r=n&&Object(c.parserMessage)(n.pinned);return!!r&&n.pinHideId!=r.chat_local_id}function h(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=Object(c.getTab)(e,t),a=i&&Object(c.parserMessage)(i.pinned);i&&a&&(i.pinHideId=a.chat_local_id,cur.imDb.update(l.PIN_HIDDEN_ID_OP,[i.peerId,i.pinHideId]),v(n,t,e),re(geByClass1("_im_pinned_tt")),r&&window.Notifier&&Notifier.lcSend("pin_hide",{hide:1,peer:t}),statlogsValueEvent("im_pinned_messages","hide"))}function f(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=Object(c.getTab)(e,t);i&&i.pinHideId&&(delete i.pinHideId,cur.imDb.update(l.PIN_HIDDEN_ID_OP,[i.peerId,void 0]),v(n,t,e),r&&window.Notifier&&Notifier.lcSend("pin_hide",{hide:0,peer:t}),statlogsValueEvent("im_pinned_messages","show"))}function m(e,t,n){var r=v.bind(null,n,t),o=Object(a.showUnpinDialog)(()=>{o.hideProgress(),o.hide(),e.set(i.unpinMessageOptimistic.bind(null,t)).then(r).then(e=>e.set(i.unpinMessage.bind(null,t))).then(r)})}function g(e,t,n){var r=e.get().peer,i=Object(c.parserMessage)(Object(c.getTab)(e,r).pinned);if(n.target.classList.contains("_im_pin_hide"))i&&h(e,r,t);else if("A"!==n.target.tagName){var o=i&&i.messageId;o&&!Object(a.isAlreadyDeleted)(e,r,o)?Object(a.focusOnMessage)(e,t().focusOnMessage,r,o):Object(a.showPinnedBox)(e,t,r,s,n),statlogsValueEvent("im_pinned_messages","open")}}function v(e,t,n){return e().updateChatTopic(t,n),Object(i.setActions)(n.get()),e().updateActions(n),n}function _(e){Object(d.showTooltip)(e.target,{text:getLang("mail_hide_unpin_hover"),black:1,needLeft:1,shift:[8,4],forcetoup:!0,className:"_im_pinned_tt",appendEl:bodyNode})}function b(e){return{unmount(){Object(r.destroyModule)(e)}}}function y(e,t,n){var i=Object(r.createMutations)(b).bindMutations,a=g.bind(null,t,n),o=_.bind(null);return i(Object(r.createModule)({handlers:(t,n)=>{n(e,"click","_im_pinned_message",a),n(e,"mouseover","_im_pin_hide",o)}}))}},XTb9:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var r=n("q1tI"),i=(n("17x9"),n("ZxpX"));function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function o(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}class s extends r.Component{constructor(e){super(e),this.onTransitionEnd=e=>{this.state.shown&&"opacity"===e.propertyName&&(this.timeout=setTimeout(()=>{this.setState({shown:!1}),this.props.callback()},this.props.duration))},this.state={shown:e.shown}}componentWillReceiveProps(e){!this.props.shown&&e.shown&&this.setState({shown:!0})}componentWillUnmount(){this.timeout&&clearTimeout(this.timeout)}render(){var e=this.props,t=(e.shown,e.callback,e.duration,e.className),n=e.children,s=o(e,["shown","callback","duration","className","children"]),c=Object(i.classNames)("BlinkText",{"BlinkText--shown":this.state.shown},t);return r.createElement("span",a({},s,{className:c,onTransitionEnd:this.onTransitionEnd,"aria-hidden":!0}),n)}}s.defaultProps={duration:2e3}},"Xq7/":function(e,t,n){"use strict";n.r(t),n.d(t,"ModalHeader",(function(){return o}));var r=n("q1tI"),i=n.n(r),a=n("ZxpX"),o=function(e){var t=e.title,n=e.onClose,r=e.appearance,o=void 0===r?"white":r,s=e.backText,c=e.onBack,u=Object(a.classNames)("ModalHeader","ModalHeader--"+o);return i.a.createElement("div",{className:u},s&&i.a.createElement("button",{className:"ModalHeader__back",onClick:c},s),i.a.createElement("h1",{className:"ModalHeader__title"},t),i.a.createElement("button",{className:"ModalHeader__cross",type:"button",onClick:n},"Закрыть"))}},YuTi:function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},ambf:function(e,t,n){"use strict";n.r(t),n.d(t,"MAX_DEVIATION",(function(){return o})),n.d(t,"EXPIRING_TIME",(function(){return s})),n.d(t,"EXPIRING_SOON_TIME",(function(){return c})),n.d(t,"EXPIRING",(function(){return u})),n.d(t,"EXPIRING_SOON",(function(){return l})),n.d(t,"EXPIRED",(function(){return d})),n.d(t,"casperMessagesStore",(function(){return g}));n("HEwt"),n("a1Th"),n("Btvt"),n("rGqo"),n("rE2o"),n("ioFf");var r=n("MhhX");function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var o=2e3,s=6e4,c=1e4,u="expiring",l="expiring_soon",d="expired",p=[],h={},f={},m=0,g={add(e){var t=i(_(e),3),n=t[0],r=t[1],a=t[2],o=Math.max(n+r-s-a,0),p=Math.max(n+r-c-a,0),m=Math.max(n+r-a,0),g=setTimeout(()=>{v({type:u,message:e})},o),b=setTimeout(()=>{v({type:l,message:e})},p),y=setTimeout(()=>{v({type:d,message:e}),f[e.messageId]=!0,delete h[e.messageId]},m);h[e.messageId]={message:e,expiringTime:o,expiredTime:m,timers:[g,b,y]}},remove(e){this.has(e)&&(h[e].timers.forEach(clearTimeout),delete h[e])},setTimeshift(e){m=1e3*(e||0)},getTimings:e=>h[e]?_(h[e].message):[0,0,0],getExpireTime(e){if(!h[e])return 0;var t=i(_(h[e].message),3),n=t[0],r=t[1],a=t[2];return Math.max(Math.floor((n+r-a)/1e3),0)},isProcessed:e=>!!f[e],subscribe(e){p.push(e)},unsubscribe(e){p=p.filter(t=>t!==e)},has:e=>!!h[e],destroy(){h={},p=[],f={}}};function v(e){p.forEach(t=>t(e))}function _(e){return[1e3*e.date+m,1e3*(Object(r.getMessageTTL)(e)||0),Date.now()]}},bCCX:function(e,t,n){"use strict";n.r(t),function(e,r){var i,a=n("SLVX");i="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:r;var o=Object(a.default)(i);t.default=o}.call(this,n("yLpj"),n("3UD+")(e))},bIHZ:function(e,t,n){"use strict";n.r(t),n.d(t,"updateLocation",(function(){return i})),n.d(t,"updateLazyLocation",(function(){return a}));var r=n("t7n3");function i(e){var t=Object(r.extend)({},window.nav.objLoc,e);Object.keys(t).filter((function(e){return""===t[e]})).forEach((function(e){delete t[e]}));var n=window.nav.toStr(t);window.nav.setLoc(n)}function a(){var e={};return{scheduleNav:function(t){e=Object(r.extend)(e,t)},commitNav:function(){i(e),e={}},scheduleNavWithTimeOut:function(t,n){void 0===n&&(n=100),e=Object(r.extend)(e,t),setTimeout((function(){i(e),e={}}),n)}}}},clTp:function(e,t,n){"use strict";function r(e){var t=e.getBoundingClientRect(),n=document.body,r=document.documentElement,i=window.pageYOffset||r.scrollTop||n.scrollTop,a=window.pageXOffset||r.scrollLeft||n.scrollLeft,o=r.clientTop||n.clientTop||0,s=r.clientLeft||n.clientLeft||0;return{top:Math.round(t.top+i-o),left:Math.round(t.left+a-s),width:e.offsetWidth,height:e.offsetHeight}}n.r(t),n.d(t,"default",(function(){return r}))},dAlA:function(e,t,n){(function(e){var r,i=function(e){"use strict";var t=1e7,n=9007199254740992,r=d(n),a="function"==typeof BigInt;function o(e,t,n,r){return void 0===e?o[0]:void 0!==t&&(10!=+t||n)?F(e,t,n,r):z(e)}function s(e,t){this.value=e,this.sign=t,this.isSmall=!1}function c(e){this.value=e,this.sign=e<0,this.isSmall=!0}function u(e){this.value=e}function l(e){return-n<e&&e<n}function d(e){return e<1e7?[e]:e<1e14?[e%1e7,Math.floor(e/1e7)]:[e%1e7,Math.floor(e/1e7)%1e7,Math.floor(e/1e14)]}function p(e){h(e);var n=e.length;if(n<4&&P(e,r)<0)switch(n){case 0:return 0;case 1:return e[0];case 2:return e[0]+e[1]*t;default:return e[0]+(e[1]+e[2]*t)*t}return e}function h(e){for(var t=e.length;0===e[--t];);e.length=t+1}function f(e){for(var t=new Array(e),n=-1;++n<e;)t[n]=0;return t}function m(e){return e>0?Math.floor(e):Math.ceil(e)}function g(e,n){var r,i,a=e.length,o=n.length,s=new Array(a),c=0,u=t;for(i=0;i<o;i++)c=(r=e[i]+n[i]+c)>=u?1:0,s[i]=r-c*u;for(;i<a;)c=(r=e[i]+c)===u?1:0,s[i++]=r-c*u;return c>0&&s.push(c),s}function v(e,t){return e.length>=t.length?g(e,t):g(t,e)}function _(e,n){var r,i,a=e.length,o=new Array(a),s=t;for(i=0;i<a;i++)r=e[i]-s+n,n=Math.floor(r/s),o[i]=r-n*s,n+=1;for(;n>0;)o[i++]=n%s,n=Math.floor(n/s);return o}function b(e,t){var n,r,i=e.length,a=t.length,o=new Array(i),s=0;for(n=0;n<a;n++)(r=e[n]-s-t[n])<0?(r+=1e7,s=1):s=0,o[n]=r;for(n=a;n<i;n++){if(!((r=e[n]-s)<0)){o[n++]=r;break}r+=1e7,o[n]=r}for(;n<i;n++)o[n]=e[n];return h(o),o}function y(e,t,n){var r,i,a=e.length,o=new Array(a),u=-t;for(r=0;r<a;r++)i=e[r]+u,u=Math.floor(i/1e7),i%=1e7,o[r]=i<0?i+1e7:i;return"number"==typeof(o=p(o))?(n&&(o=-o),new c(o)):new s(o,n)}function E(e,t){var n,r,i,a,o=e.length,s=t.length,c=f(o+s);for(i=0;i<o;++i){a=e[i];for(var u=0;u<s;++u)n=a*t[u]+c[i+u],r=Math.floor(n/1e7),c[i+u]=n-1e7*r,c[i+u+1]+=r}return h(c),c}function O(e,n){var r,i,a=e.length,o=new Array(a),s=t,c=0;for(i=0;i<a;i++)r=e[i]*n+c,c=Math.floor(r/s),o[i]=r-c*s;for(;c>0;)o[i++]=c%s,c=Math.floor(c/s);return o}function C(e,t){for(var n=[];t-- >0;)n.push(0);return n.concat(e)}function S(e,n,r){return new s(e<t?O(n,e):E(n,d(e)),r)}function T(e){var t,n,r,i,a=e.length,o=f(a+a);for(r=0;r<a;r++){n=0-(i=e[r])*i;for(var s=r;s<a;s++)t=i*e[s]*2+o[r+s]+n,n=Math.floor(t/1e7),o[r+s]=t-1e7*n;o[r+a]=n}return h(o),o}function w(e,t){var n,r,i,a,o=e.length,s=f(o);for(i=0,n=o-1;n>=0;--n)i=(a=1e7*i+e[n])-(r=m(a/t))*t,s[n]=0|r;return[s,0|i]}function I(e,n){var r,i=z(n);if(a)return[new u(e.value/i.value),new u(e.value%i.value)];var l,g=e.value,v=i.value;if(0===v)throw new Error("Cannot divide by zero");if(e.isSmall)return i.isSmall?[new c(m(g/v)),new c(g%v)]:[o[0],e];if(i.isSmall){if(1===v)return[e,o[0]];if(-1==v)return[e.negate(),o[0]];var _=Math.abs(v);if(_<t){l=p((r=w(g,_))[0]);var y=r[1];return e.sign&&(y=-y),"number"==typeof l?(e.sign!==i.sign&&(l=-l),[new c(l),new c(y)]):[new s(l,e.sign!==i.sign),new c(y)]}v=d(_)}var E=P(g,v);if(-1===E)return[o[0],e];if(0===E)return[o[e.sign===i.sign?1:-1],o[0]];l=(r=g.length+v.length<=200?function(e,n){var r,i,a,o,s,c,u,l=e.length,d=n.length,h=t,m=f(n.length),g=n[d-1],v=Math.ceil(h/(2*g)),_=O(e,v),b=O(n,v);for(_.length<=l&&_.push(0),b.push(0),g=b[d-1],i=l-d;i>=0;i--){for(r=h-1,_[i+d]!==g&&(r=Math.floor((_[i+d]*h+_[i+d-1])/g)),a=0,o=0,c=b.length,s=0;s<c;s++)a+=r*b[s],u=Math.floor(a/h),o+=_[i+s]-(a-u*h),a=u,o<0?(_[i+s]=o+h,o=-1):(_[i+s]=o,o=0);for(;0!==o;){for(r-=1,a=0,s=0;s<c;s++)(a+=_[i+s]-h+b[s])<0?(_[i+s]=a+h,a=0):(_[i+s]=a,a=1);o+=a}m[i]=r}return _=w(_,v)[0],[p(m),p(_)]}(g,v):function(e,t){for(var n,r,i,a,o,s=e.length,c=t.length,u=[],l=[];s;)if(l.unshift(e[--s]),h(l),P(l,t)<0)u.push(0);else{i=1e7*l[(r=l.length)-1]+l[r-2],a=1e7*t[c-1]+t[c-2],r>c&&(i=1e7*(i+1)),n=Math.ceil(i/a);do{if(P(o=O(t,n),l)<=0)break;n--}while(n);u.push(n),l=b(l,o)}return u.reverse(),[p(u),p(l)]}(g,v))[0];var C=e.sign!==i.sign,S=r[1],T=e.sign;return"number"==typeof l?(C&&(l=-l),l=new c(l)):l=new s(l,C),"number"==typeof S?(T&&(S=-S),S=new c(S)):S=new s(S,T),[l,S]}function P(e,t){if(e.length!==t.length)return e.length>t.length?1:-1;for(var n=e.length-1;n>=0;n--)if(e[n]!==t[n])return e[n]>t[n]?1:-1;return 0}function j(e){var t=e.abs();return!t.isUnit()&&(!!(t.equals(2)||t.equals(3)||t.equals(5))||!(t.isEven()||t.isDivisibleBy(3)||t.isDivisibleBy(5))&&(!!t.lesser(49)||void 0))}function k(e,t){for(var n,r,a,o=e.prev(),s=o,c=0;s.isEven();)s=s.divide(2),c++;e:for(r=0;r<t.length;r++)if(!e.lesser(t[r])&&!(a=i(t[r]).modPow(s,e)).isUnit()&&!a.equals(o)){for(n=c-1;0!=n;n--){if((a=a.square().mod(e)).isUnit())return!1;if(a.equals(o))continue e}return!1}return!0}s.prototype=Object.create(o.prototype),c.prototype=Object.create(o.prototype),u.prototype=Object.create(o.prototype),s.prototype.add=function(e){var t=z(e);if(this.sign!==t.sign)return this.subtract(t.negate());var n=this.value,r=t.value;return t.isSmall?new s(_(n,Math.abs(r)),this.sign):new s(v(n,r),this.sign)},s.prototype.plus=s.prototype.add,c.prototype.add=function(e){var t=z(e),n=this.value;if(n<0!==t.sign)return this.subtract(t.negate());var r=t.value;if(t.isSmall){if(l(n+r))return new c(n+r);r=d(Math.abs(r))}return new s(_(r,Math.abs(n)),n<0)},c.prototype.plus=c.prototype.add,u.prototype.add=function(e){return new u(this.value+z(e).value)},u.prototype.plus=u.prototype.add,s.prototype.subtract=function(e){var t=z(e);if(this.sign!==t.sign)return this.add(t.negate());var n=this.value,r=t.value;return t.isSmall?y(n,Math.abs(r),this.sign):function(e,t,n){var r;return P(e,t)>=0?r=b(e,t):(r=b(t,e),n=!n),"number"==typeof(r=p(r))?(n&&(r=-r),new c(r)):new s(r,n)}(n,r,this.sign)},s.prototype.minus=s.prototype.subtract,c.prototype.subtract=function(e){var t=z(e),n=this.value;if(n<0!==t.sign)return this.add(t.negate());var r=t.value;return t.isSmall?new c(n-r):y(r,Math.abs(n),n>=0)},c.prototype.minus=c.prototype.subtract,u.prototype.subtract=function(e){return new u(this.value-z(e).value)},u.prototype.minus=u.prototype.subtract,s.prototype.negate=function(){return new s(this.value,!this.sign)},c.prototype.negate=function(){var e=this.sign,t=new c(-this.value);return t.sign=!e,t},u.prototype.negate=function(){return new u(-this.value)},s.prototype.abs=function(){return new s(this.value,!1)},c.prototype.abs=function(){return new c(Math.abs(this.value))},u.prototype.abs=function(){return new u(this.value>=0?this.value:-this.value)},s.prototype.multiply=function(e){var n,r,i,a=z(e),c=this.value,u=a.value,l=this.sign!==a.sign;if(a.isSmall){if(0===u)return o[0];if(1===u)return this;if(-1===u)return this.negate();if((n=Math.abs(u))<t)return new s(O(c,n),l);u=d(n)}return r=c.length,i=u.length,new s(-.012*r-.012*i+15e-6*r*i>0?function e(t,n){var r=Math.max(t.length,n.length);if(r<=30)return E(t,n);r=Math.ceil(r/2);var i=t.slice(r),a=t.slice(0,r),o=n.slice(r),s=n.slice(0,r),c=e(a,s),u=e(i,o),l=e(v(a,i),v(s,o)),d=v(v(c,C(b(b(l,c),u),r)),C(u,2*r));return h(d),d}(c,u):E(c,u),l)},s.prototype.times=s.prototype.multiply,c.prototype._multiplyBySmall=function(e){return l(e.value*this.value)?new c(e.value*this.value):S(Math.abs(e.value),d(Math.abs(this.value)),this.sign!==e.sign)},s.prototype._multiplyBySmall=function(e){return 0===e.value?o[0]:1===e.value?this:-1===e.value?this.negate():S(Math.abs(e.value),this.value,this.sign!==e.sign)},c.prototype.multiply=function(e){return z(e)._multiplyBySmall(this)},c.prototype.times=c.prototype.multiply,u.prototype.multiply=function(e){return new u(this.value*z(e).value)},u.prototype.times=u.prototype.multiply,s.prototype.square=function(){return new s(T(this.value),!1)},c.prototype.square=function(){var e=this.value*this.value;return l(e)?new c(e):new s(T(d(Math.abs(this.value))),!1)},u.prototype.square=function(e){return new u(this.value*this.value)},s.prototype.divmod=function(e){var t=I(this,e);return{quotient:t[0],remainder:t[1]}},u.prototype.divmod=c.prototype.divmod=s.prototype.divmod,s.prototype.divide=function(e){return I(this,e)[0]},u.prototype.over=u.prototype.divide=function(e){return new u(this.value/z(e).value)},c.prototype.over=c.prototype.divide=s.prototype.over=s.prototype.divide,s.prototype.mod=function(e){return I(this,e)[1]},u.prototype.mod=u.prototype.remainder=function(e){return new u(this.value%z(e).value)},c.prototype.remainder=c.prototype.mod=s.prototype.remainder=s.prototype.mod,s.prototype.pow=function(e){var t,n,r,i=z(e),a=this.value,s=i.value;if(0===s)return o[1];if(0===a)return o[0];if(1===a)return o[1];if(-1===a)return i.isEven()?o[1]:o[-1];if(i.sign)return o[0];if(!i.isSmall)throw new Error("The exponent "+i.toString()+" is too large.");if(this.isSmall&&l(t=Math.pow(a,s)))return new c(m(t));for(n=this,r=o[1];!0&s&&(r=r.times(n),--s),0!==s;)s/=2,n=n.square();return r},c.prototype.pow=s.prototype.pow,u.prototype.pow=function(e){var t=z(e),n=this.value,r=t.value,i=BigInt(0),a=BigInt(1),s=BigInt(2);if(r===i)return o[1];if(n===i)return o[0];if(n===a)return o[1];if(n===BigInt(-1))return t.isEven()?o[1]:o[-1];if(t.isNegative())return new u(i);for(var c=this,l=o[1];(r&a)===a&&(l=l.times(c),--r),r!==i;)r/=s,c=c.square();return l},s.prototype.modPow=function(e,t){if(e=z(e),(t=z(t)).isZero())throw new Error("Cannot take modPow with modulus 0");var n=o[1],r=this.mod(t);for(e.isNegative()&&(e=e.multiply(o[-1]),r=r.modInv(t));e.isPositive();){if(r.isZero())return o[0];e.isOdd()&&(n=n.multiply(r).mod(t)),e=e.divide(2),r=r.square().mod(t)}return n},u.prototype.modPow=c.prototype.modPow=s.prototype.modPow,s.prototype.compareAbs=function(e){var t=z(e),n=this.value,r=t.value;return t.isSmall?1:P(n,r)},c.prototype.compareAbs=function(e){var t=z(e),n=Math.abs(this.value),r=t.value;return t.isSmall?n===(r=Math.abs(r))?0:n>r?1:-1:-1},u.prototype.compareAbs=function(e){var t=this.value,n=z(e).value;return(t=t>=0?t:-t)===(n=n>=0?n:-n)?0:t>n?1:-1},s.prototype.compare=function(e){if(e===1/0)return-1;if(e===-1/0)return 1;var t=z(e),n=this.value,r=t.value;return this.sign!==t.sign?t.sign?1:-1:t.isSmall?this.sign?-1:1:P(n,r)*(this.sign?-1:1)},s.prototype.compareTo=s.prototype.compare,c.prototype.compare=function(e){if(e===1/0)return-1;if(e===-1/0)return 1;var t=z(e),n=this.value,r=t.value;return t.isSmall?n==r?0:n>r?1:-1:n<0!==t.sign?n<0?-1:1:n<0?1:-1},c.prototype.compareTo=c.prototype.compare,u.prototype.compare=function(e){if(e===1/0)return-1;if(e===-1/0)return 1;var t=this.value,n=z(e).value;return t===n?0:t>n?1:-1},u.prototype.compareTo=u.prototype.compare,s.prototype.equals=function(e){return 0===this.compare(e)},u.prototype.eq=u.prototype.equals=c.prototype.eq=c.prototype.equals=s.prototype.eq=s.prototype.equals,s.prototype.notEquals=function(e){return 0!==this.compare(e)},u.prototype.neq=u.prototype.notEquals=c.prototype.neq=c.prototype.notEquals=s.prototype.neq=s.prototype.notEquals,s.prototype.greater=function(e){return this.compare(e)>0},u.prototype.gt=u.prototype.greater=c.prototype.gt=c.prototype.greater=s.prototype.gt=s.prototype.greater,s.prototype.lesser=function(e){return this.compare(e)<0},u.prototype.lt=u.prototype.lesser=c.prototype.lt=c.prototype.lesser=s.prototype.lt=s.prototype.lesser,s.prototype.greaterOrEquals=function(e){return this.compare(e)>=0},u.prototype.geq=u.prototype.greaterOrEquals=c.prototype.geq=c.prototype.greaterOrEquals=s.prototype.geq=s.prototype.greaterOrEquals,s.prototype.lesserOrEquals=function(e){return this.compare(e)<=0},u.prototype.leq=u.prototype.lesserOrEquals=c.prototype.leq=c.prototype.lesserOrEquals=s.prototype.leq=s.prototype.lesserOrEquals,s.prototype.isEven=function(){return 0==(1&this.value[0])},c.prototype.isEven=function(){return 0==(1&this.value)},u.prototype.isEven=function(){return(this.value&BigInt(1))===BigInt(0)},s.prototype.isOdd=function(){return 1==(1&this.value[0])},c.prototype.isOdd=function(){return 1==(1&this.value)},u.prototype.isOdd=function(){return(this.value&BigInt(1))===BigInt(1)},s.prototype.isPositive=function(){return!this.sign},c.prototype.isPositive=function(){return this.value>0},u.prototype.isPositive=c.prototype.isPositive,s.prototype.isNegative=function(){return this.sign},c.prototype.isNegative=function(){return this.value<0},u.prototype.isNegative=c.prototype.isNegative,s.prototype.isUnit=function(){return!1},c.prototype.isUnit=function(){return 1===Math.abs(this.value)},u.prototype.isUnit=function(){return this.abs().value===BigInt(1)},s.prototype.isZero=function(){return!1},c.prototype.isZero=function(){return 0===this.value},u.prototype.isZero=function(){return this.value===BigInt(0)},s.prototype.isDivisibleBy=function(e){var t=z(e);return!t.isZero()&&(!!t.isUnit()||(0===t.compareAbs(2)?this.isEven():this.mod(t).isZero()))},u.prototype.isDivisibleBy=c.prototype.isDivisibleBy=s.prototype.isDivisibleBy,s.prototype.isPrime=function(e){var t=j(this);if(void 0!==t)return t;var n=this.abs(),r=n.bitLength();if(r<=64)return k(n,[2,3,5,7,11,13,17,19,23,29,31,37]);for(var a=Math.log(2)*r.toJSNumber(),o=Math.ceil(!0===e?2*Math.pow(a,2):a),s=[],c=0;c<o;c++)s.push(i(c+2));return k(n,s)},u.prototype.isPrime=c.prototype.isPrime=s.prototype.isPrime,s.prototype.isProbablePrime=function(e,t){var n=j(this);if(void 0!==n)return n;for(var r=this.abs(),a=void 0===e?5:e,o=[],s=0;s<a;s++)o.push(i.randBetween(2,r.minus(2),t));return k(r,o)},u.prototype.isProbablePrime=c.prototype.isProbablePrime=s.prototype.isProbablePrime,s.prototype.modInv=function(e){for(var t,n,r,a=i.zero,o=i.one,s=z(e),c=this.abs();!c.isZero();)t=s.divide(c),n=a,r=s,a=o,s=c,o=n.subtract(t.multiply(o)),c=r.subtract(t.multiply(c));if(!s.isUnit())throw new Error(this.toString()+" and "+e.toString()+" are not co-prime");return-1===a.compare(0)&&(a=a.add(e)),this.isNegative()?a.negate():a},u.prototype.modInv=c.prototype.modInv=s.prototype.modInv,s.prototype.next=function(){var e=this.value;return this.sign?y(e,1,this.sign):new s(_(e,1),this.sign)},c.prototype.next=function(){var e=this.value;return e+1<n?new c(e+1):new s(r,!1)},u.prototype.next=function(){return new u(this.value+BigInt(1))},s.prototype.prev=function(){var e=this.value;return this.sign?new s(_(e,1),!0):y(e,1,this.sign)},c.prototype.prev=function(){var e=this.value;return e-1>-n?new c(e-1):new s(r,!0)},u.prototype.prev=function(){return new u(this.value-BigInt(1))};for(var A=[1];2*A[A.length-1]<=t;)A.push(2*A[A.length-1]);var R=A.length,L=A[R-1];function N(e){return Math.abs(e)<=t}function M(e,t,n){t=z(t);for(var r=e.isNegative(),a=t.isNegative(),o=r?e.not():e,s=a?t.not():t,c=0,u=0,l=null,d=null,p=[];!o.isZero()||!s.isZero();)c=(l=I(o,L))[1].toJSNumber(),r&&(c=L-1-c),u=(d=I(s,L))[1].toJSNumber(),a&&(u=L-1-u),o=l[0],s=d[0],p.push(n(c,u));for(var h=0!==n(r?1:0,a?1:0)?i(-1):i(0),f=p.length-1;f>=0;f-=1)h=h.multiply(L).add(i(p[f]));return h}s.prototype.shiftLeft=function(e){var t=z(e).toJSNumber();if(!N(t))throw new Error(String(t)+" is too large for shifting.");if(t<0)return this.shiftRight(-t);var n=this;if(n.isZero())return n;for(;t>=R;)n=n.multiply(L),t-=R-1;return n.multiply(A[t])},u.prototype.shiftLeft=c.prototype.shiftLeft=s.prototype.shiftLeft,s.prototype.shiftRight=function(e){var t,n=z(e).toJSNumber();if(!N(n))throw new Error(String(n)+" is too large for shifting.");if(n<0)return this.shiftLeft(-n);for(var r=this;n>=R;){if(r.isZero()||r.isNegative()&&r.isUnit())return r;r=(t=I(r,L))[1].isNegative()?t[0].prev():t[0],n-=R-1}return(t=I(r,A[n]))[1].isNegative()?t[0].prev():t[0]},u.prototype.shiftRight=c.prototype.shiftRight=s.prototype.shiftRight,s.prototype.not=function(){return this.negate().prev()},u.prototype.not=c.prototype.not=s.prototype.not,s.prototype.and=function(e){return M(this,e,(function(e,t){return e&t}))},u.prototype.and=c.prototype.and=s.prototype.and,s.prototype.or=function(e){return M(this,e,(function(e,t){return e|t}))},u.prototype.or=c.prototype.or=s.prototype.or,s.prototype.xor=function(e){return M(this,e,(function(e,t){return e^t}))},u.prototype.xor=c.prototype.xor=s.prototype.xor;function D(e){var n=e.value,r="number"==typeof n?n|1<<30:"bigint"==typeof n?n|BigInt(1<<30):n[0]+n[1]*t|1073758208;return r&-r}function x(e,t){return e=z(e),t=z(t),e.greater(t)?e:t}function U(e,t){return e=z(e),t=z(t),e.lesser(t)?e:t}function B(e,t){if(e=z(e).abs(),t=z(t).abs(),e.equals(t))return e;if(e.isZero())return t;if(t.isZero())return e;for(var n,r,i=o[1];e.isEven()&&t.isEven();)n=U(D(e),D(t)),e=e.divide(n),t=t.divide(n),i=i.multiply(n);for(;e.isEven();)e=e.divide(D(e));do{for(;t.isEven();)t=t.divide(D(t));e.greater(t)&&(r=t,t=e,e=r),t=t.subtract(e)}while(!t.isZero());return i.isUnit()?e:e.multiply(i)}s.prototype.bitLength=function(){var e=this;return e.compareTo(i(0))<0&&(e=e.negate().subtract(i(1))),0===e.compareTo(i(0))?i(0):i(function e(t,n){if(n.compareTo(t)<=0){var r=e(t,n.square(n)),a=r.p,o=r.e,s=a.multiply(n);return s.compareTo(t)<=0?{p:s,e:2*o+1}:{p:a,e:2*o}}return{p:i(1),e:0}}(e,i(2)).e).add(i(1))},u.prototype.bitLength=c.prototype.bitLength=s.prototype.bitLength;var F=function(e,t,n,r){n=n||"0123456789abcdefghijklmnopqrstuvwxyz",e=String(e),r||(e=e.toLowerCase(),n=n.toLowerCase());var i,a=e.length,o=Math.abs(t),s={};for(i=0;i<n.length;i++)s[n[i]]=i;for(i=0;i<a;i++){if("-"!==(l=e[i])&&(l in s&&s[l]>=o)){if("1"===l&&1===o)continue;throw new Error(l+" is not a valid digit in base "+t+".")}}t=z(t);var c=[],u="-"===e[0];for(i=u?1:0;i<e.length;i++){var l;if((l=e[i])in s)c.push(z(s[l]));else{if("<"!==l)throw new Error(l+" is not a valid character");var d=i;do{i++}while(">"!==e[i]&&i<e.length);c.push(z(e.slice(d+1,i)))}}return H(c,t,u)};function H(e,t,n){var r,i=o[0],a=o[1];for(r=e.length-1;r>=0;r--)i=i.add(e[r].times(a)),a=a.times(t);return n?i.negate():i}function G(e,t){if((t=i(t)).isZero()){if(e.isZero())return{value:[0],isNegative:!1};throw new Error("Cannot convert nonzero numbers to base 0.")}if(t.equals(-1)){if(e.isZero())return{value:[0],isNegative:!1};if(e.isNegative())return{value:[].concat.apply([],Array.apply(null,Array(-e.toJSNumber())).map(Array.prototype.valueOf,[1,0])),isNegative:!1};var n=Array.apply(null,Array(e.toJSNumber()-1)).map(Array.prototype.valueOf,[0,1]);return n.unshift([1]),{value:[].concat.apply([],n),isNegative:!1}}var r=!1;if(e.isNegative()&&t.isPositive()&&(r=!0,e=e.abs()),t.isUnit())return e.isZero()?{value:[0],isNegative:!1}:{value:Array.apply(null,Array(e.toJSNumber())).map(Number.prototype.valueOf,1),isNegative:r};for(var a,o=[],s=e;s.isNegative()||s.compareAbs(t)>=0;){a=s.divmod(t),s=a.quotient;var c=a.remainder;c.isNegative()&&(c=t.minus(c).abs(),s=s.next()),o.push(c.toJSNumber())}return o.push(s.toJSNumber()),{value:o.reverse(),isNegative:r}}function V(e,t,n){var r=G(e,t);return(r.isNegative?"-":"")+r.value.map((function(e){return function(e,t){return e<(t=t||"0123456789abcdefghijklmnopqrstuvwxyz").length?t[e]:"<"+e+">"}(e,n)})).join("")}function q(e){if(l(+e)){var t=+e;if(t===m(t))return a?new u(BigInt(t)):new c(t);throw new Error("Invalid integer: "+e)}var n="-"===e[0];n&&(e=e.slice(1));var r=e.split(/e/i);if(r.length>2)throw new Error("Invalid integer: "+r.join("e"));if(2===r.length){var i=r[1];if("+"===i[0]&&(i=i.slice(1)),(i=+i)!==m(i)||!l(i))throw new Error("Invalid integer: "+i+" is not a valid exponent.");var o=r[0],d=o.indexOf(".");if(d>=0&&(i-=o.length-d-1,o=o.slice(0,d)+o.slice(d+1)),i<0)throw new Error("Cannot include negative exponent part for integers");e=o+=new Array(i+1).join("0")}if(!/^([0-9][0-9]*)$/.test(e))throw new Error("Invalid integer: "+e);if(a)return new u(BigInt(n?"-"+e:e));for(var p=[],f=e.length,g=f-7;f>0;)p.push(+e.slice(g,f)),(g-=7)<0&&(g=0),f-=7;return h(p),new s(p,n)}function z(e){return"number"==typeof e?function(e){if(a)return new u(BigInt(e));if(l(e)){if(e!==m(e))throw new Error(e+" is not an integer.");return new c(e)}return q(e.toString())}(e):"string"==typeof e?q(e):"bigint"==typeof e?new u(e):e}s.prototype.toArray=function(e){return G(this,e)},c.prototype.toArray=function(e){return G(this,e)},u.prototype.toArray=function(e){return G(this,e)},s.prototype.toString=function(e,t){if(void 0===e&&(e=10),10!==e)return V(this,e,t);for(var n,r=this.value,i=r.length,a=String(r[--i]);--i>=0;)n=String(r[i]),a+="0000000".slice(n.length)+n;return(this.sign?"-":"")+a},c.prototype.toString=function(e,t){return void 0===e&&(e=10),10!=e?V(this,e,t):String(this.value)},u.prototype.toString=c.prototype.toString,u.prototype.toJSON=s.prototype.toJSON=c.prototype.toJSON=function(){return this.toString()},s.prototype.valueOf=function(){return parseInt(this.toString(),10)},s.prototype.toJSNumber=s.prototype.valueOf,c.prototype.valueOf=function(){return this.value},c.prototype.toJSNumber=c.prototype.valueOf,u.prototype.valueOf=u.prototype.toJSNumber=function(){return parseInt(this.toString(),10)};for(var K=0;K<1e3;K++)o[K]=z(K),K>0&&(o[-K]=z(-K));return o.one=o[1],o.zero=o[0],o.minusOne=o[-1],o.max=x,o.min=U,o.gcd=B,o.lcm=function(e,t){return e=z(e).abs(),t=z(t).abs(),e.divide(B(e,t)).multiply(t)},o.isInstance=function(e){return e instanceof s||e instanceof c||e instanceof u},o.randBetween=function(e,n,r){e=z(e),n=z(n);var i=r||Math.random,a=U(e,n),s=x(e,n).subtract(a).add(1);if(s.isSmall)return a.add(Math.floor(i()*s));for(var c=G(s,t).value,u=[],l=!0,d=0;d<c.length;d++){var p=l?c[d]:t,h=m(i()*p);u.push(h),h<p&&(l=!1)}return a.add(o.fromArray(u,t,!1))},o.fromArray=function(e,t,n){return H(e.map(z),z(t||10),n)},o}();e.hasOwnProperty("exports")&&(e.exports=i),void 0===(r=function(){return i}.call(t,n,t,e))||(e.exports=r)}).call(this,n("YuTi")(e))},"dt/K":function(e,t,n){"use strict";n.r(t);var r,i=n("q1tI"),a=n("i8i4"),o=n("ZxpX"),s=n("clTp"),c=n("qihR"),u=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),l=function(){return(l=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},d=function(e){var t=e.position,n=e.align,r=e.text,i=e.rect,a=e.marginTop,o=e.marginLeft,s=e.maxWidth,c=e.appearance,u=e.className,l=i.left,d=i.top;switch(t){case"t":l+=.5*i.width;break;case"r":l+=i.width,d+=.5*i.height;break;case"b":l+=.5*i.width,d+=i.height;break;case"l":d+=.5*i.height}return{tooltip:{position:t,align:n,text:r,x:l=Math.round(l+(o||0)),y:d=Math.round(d+(a||0)),maxWidth:s,appearance:c,className:u}}},p=function(e){function t(t){var n=e.call(this,t)||this;return n.onMouseEnter=function(){if(n.state.el){var e=n.props,t=e.text,r=e.position,i=e.align,a=e.marginTop,o=e.marginLeft,c=e.maxWidth,u=e.appearance,l=e.className,d=Object(s.default)(n.state.el);n.update({text:t,position:r,align:i,rect:d,marginTop:a,marginLeft:o,maxWidth:c,appearance:u,className:l})}},n.onMouseLeave=function(){return n.update()},n.onTransitionEnd=function(e){"visibility"===e.propertyName&&n.state.tooltip&&n.setState({tooltip:void 0})},n.state={el:null},n}return u(t,e),t.prototype.componentDidMount=function(){var e=a.findDOMNode(this);this.setState({el:e}),null==e||e.addEventListener("mouseenter",this.onMouseEnter),null==e||e.addEventListener("mouseleave",this.onMouseLeave)},t.prototype.componentWillUnmount=function(){var e,t;null===(e=this.state.el)||void 0===e||e.removeEventListener("mouseenter",this.onMouseEnter),null===(t=this.state.el)||void 0===t||t.removeEventListener("mouseleave",this.onMouseLeave)},t.getDerivedStateFromProps=function(e,t){return t.tooltip&&(e.text!==t.tooltip.text||e.position!==t.tooltip.position||e.align!==t.tooltip.align||e.maxWidth!==t.tooltip.maxWidth||e.appearance!==t.tooltip.appearance)?d(l(l({},e),{rect:Object(s.default)(t.el)})):null},t.prototype.update=function(e){if(!e)return this.setState({tooltip:Object.assign({},this.state.tooltip,{removed:!0})});this.setState(d(e))},t.prototype.render=function(){var e=this.state.tooltip?Object(o.classNames)(this.state.tooltip.className,"Tooltip--noPointerEvents"):"",t=this.state.tooltip?l(l({},this.state.tooltip),{className:e}):null;return t&&"undefined"!=typeof window?i.createElement(i.Fragment,null,this.props.children,i.createElement(c.default,l({},t,{onTransitionEnd:this.onTransitionEnd}))):this.props.children},t.defaultProps={position:"b",align:"center",marginTop:0,marginLeft:0,appearance:"dark"},t}(i.Component);t.default=p},enZq:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));var r=n("q1tI"),i=(n("17x9"),n("ZxpX"));function a(e){var t={"List--border":!!e.border};return r.createElement("ul",{className:Object(i.classNames)("List",t,e.className),style:e.style},e.children)}a.defaultProps={border:!0}},f01n:function(e,t,n){"use strict";n.r(t),n.d(t,"constructEvent",(function(){return o})),n.d(t,"DELETE",(function(){return s})),n.d(t,"SET_FLAGS",(function(){return c})),n.d(t,"REPLACE_FLAGS",(function(){return u})),n.d(t,"RESET_FLAGS",(function(){return l})),n.d(t,"ADD_MESSAGE",(function(){return d})),n.d(t,"READ_INBOUND",(function(){return p})),n.d(t,"READ_OUTBOUND",(function(){return h})),n.d(t,"GOT_ONLINE",(function(){return f})),n.d(t,"GOT_OFFLINE",(function(){return m})),n.d(t,"CHAT_CHANGED",(function(){return g})),n.d(t,"CONVERSATION_UPDATED",(function(){return v})),n.d(t,"TYPING",(function(){return _})),n.d(t,"RECORDING_AUDIO",(function(){return b})),n.d(t,"VIDEO_CALL",(function(){return y})),n.d(t,"UNREAD_COUNT",(function(){return E})),n.d(t,"NOTIFY_SETTINGS_CHANGED",(function(){return O})),n.d(t,"KEYBOARD_CALLBACK_RECEIVED",(function(){return C})),n.d(t,"EMPTY",(function(){return S})),n.d(t,"RESET_DIRECTORIES",(function(){return T})),n.d(t,"REPLACE_DIRECTORIES",(function(){return w})),n.d(t,"SET_DIRECTORIES",(function(){return I})),n.d(t,"RESYNC",(function(){return P})),n.d(t,"REFRESH_LP_KEY",(function(){return j})),n.d(t,"TRANSITION",(function(){return k})),n.d(t,"RESET_PEER",(function(){return A})),n.d(t,"MUTEX",(function(){return R})),n.d(t,"CHANGE_PEER",(function(){return L})),n.d(t,"CHANGE_TAB",(function(){return N})),n.d(t,"FAILED_MESSAGE",(function(){return M})),n.d(t,"RESEND",(function(){return D})),n.d(t,"DELETE_DIALOG",(function(){return x})),n.d(t,"EDIT_MESSAGE",(function(){return U})),n.d(t,"REPLACE_MESSAGE",(function(){return B})),n.d(t,"INVALIDATE_MESSAGE",(function(){return F})),n.d(t,"AUDIO_START",(function(){return H})),n.d(t,"WAITING_FOR_RECONNECT",(function(){return G})),n.d(t,"RECONNECTING",(function(){return V})),n.d(t,"RECONNECTED",(function(){return q})),n.d(t,"INCOMING_CALL",(function(){return z})),n.d(t,"FLAG_UNREAD",(function(){return K})),n.d(t,"FLAG_OUTBOUND",(function(){return W})),n.d(t,"FLAG_IMPORTANT",(function(){return Y})),n.d(t,"FLAG_CHAT",(function(){return $})),n.d(t,"FLAG_FRIENDS",(function(){return J})),n.d(t,"FLAG_SPAM",(function(){return X})),n.d(t,"FLAG_DELETED",(function(){return Q})),n.d(t,"FLAG_MEDIA",(function(){return Z})),n.d(t,"FLAG_STEALTH",(function(){return ee})),n.d(t,"FLAG_HAS_REPLY",(function(){return te})),n.d(t,"FLAG_AUDIO_MESSAGE_LISTENED",(function(){return ne})),n.d(t,"FLAG_DELETE_BY_TTL",(function(){return re})),n.d(t,"FOLDER_IMPORTANT",(function(){return ie})),n.d(t,"FOLDER_UNRESPOND",(function(){return ae})),n.d(t,"FOLDER_HAS_BANNER",(function(){return oe})),n.d(t,"FOLDER_AD_TAG",(function(){return se})),n.d(t,"FOLDER_MARKED_UNREAD",(function(){return ce})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_TITLE_CHANGED",(function(){return ue})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_AVATAR_CHANGED",(function(){return le})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_ADMIN_GRANTED",(function(){return de})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_FLAGS_CHANGED",(function(){return pe})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_PINNED",(function(){return he})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_USER_JOINED",(function(){return fe})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_USER_LEFT",(function(){return me})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_USER_KICKED",(function(){return ge})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_ADMIN_KICKED",(function(){return ve})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_BANNER_CHANGED",(function(){return _e})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_KEYBOARD_CHANGED",(function(){return be})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED",(function(){return ye})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED",(function(){return Ee})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_BUSINESS_NOTIFY_DATA_CHANGED",(function(){return Oe})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CANCELED",(function(){return Ce})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_REJECTED",(function(){return Se})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_ACCEPTED",(function(){return Te})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_CONTACT_JOINED",(function(){return we})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_CALL_IN_PROGRESS_CHANGED",(function(){return Ie})),n.d(t,"MESSAGE_REQUEST_STATUS_NEW",(function(){return Pe})),n.d(t,"deleteEvent",(function(){return je})),n.d(t,"replaceFlagsEvent",(function(){return ke})),n.d(t,"setFlagsEvent",(function(){return Ae})),n.d(t,"resetFlagsEvent",(function(){return Re})),n.d(t,"addMessageEvent",(function(){return Le})),n.d(t,"editMessageEvent",(function(){return Ne})),n.d(t,"replaceMessageEvent",(function(){return Me})),n.d(t,"invalidateMessageEvent",(function(){return De})),n.d(t,"editMessageLocallyEvent",(function(){return xe})),n.d(t,"readInboundEvent",(function(){return Ue})),n.d(t,"readOutboundEvent",(function(){return Be})),n.d(t,"gotOnlineEvent",(function(){return Fe})),n.d(t,"gotOfflineEvent",(function(){return He})),n.d(t,"resetDirectoriesEvent",(function(){return Ge})),n.d(t,"replaceDirectoriesEvent",(function(){return Ve})),n.d(t,"setDirectoriesEvent",(function(){return qe})),n.d(t,"deleteDialogEvent",(function(){return ze})),n.d(t,"chatChangedEvent",(function(){return Ke})),n.d(t,"chatUpdatedEvent",(function(){return We})),n.d(t,"typingEvent",(function(){return Ye})),n.d(t,"recordingAudioEvent",(function(){return $e})),n.d(t,"videoCallEvent",(function(){return Je})),n.d(t,"unreadCountEvent",(function(){return Xe})),n.d(t,"notifySettingsChangedEvent",(function(){return Qe})),n.d(t,"incomingCallEvent",(function(){return Ze})),n.d(t,"refreshMessageEvent",(function(){return et})),n.d(t,"audioStartEvent",(function(){return tt})),n.d(t,"keyboardCallbackReceivedEvent",(function(){return nt})),n.d(t,"emptyEvent",(function(){return rt})),n.d(t,"transitionEvent",(function(){return it})),n.d(t,"resyncEvent",(function(){return at})),n.d(t,"refreshLpKeyEvent",(function(){return ot})),n.d(t,"waitingForReconnectEvent",(function(){return st})),n.d(t,"reconnectingEvent",(function(){return ct})),n.d(t,"reconnectedEvent",(function(){return ut})),n.d(t,"resetPeer",(function(){return lt})),n.d(t,"changePeer",(function(){return dt})),n.d(t,"changeTab",(function(){return pt})),n.d(t,"failedMessage",(function(){return ht})),n.d(t,"mutexEvent",(function(){return ft})),n.d(t,"resendEvent",(function(){return mt}));n("HEwt"),n("a1Th"),n("Btvt"),n("rGqo"),n("rE2o"),n("ioFf"),n("OEbY");var r=n("rudk");function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e){switch(e[0]){case 0:return je(e);case 1:return ke(e);case 2:return Ae(e);case 3:return Re(e);case 4:return Le(e);case 5:return Ne(e);case 6:return Ue(e);case 7:return Be(e);case 8:return Fe(e);case 9:return He(e);case 10:return Ge(e);case 11:return Ve(e);case 12:return qe(e);case 13:return ze(e);case 18:return Me(e);case 19:return De(e);case 51:return Ke(e);case 52:return We(e);case 63:return Ye(e);case 64:return $e(e);case 70:return Je(e);case 80:return Xe(e);case 114:return Qe(e);case 115:return Ze(e);case 116:return et(e);case 117:return tt(e);case 119:return nt(e);case-1:return at();case-2:return ot(e);case-3:return st(e);case-4:return ct();case-5:return ut();default:return rt(e)}}var s="event_delete",c="event_set_flags",u="event_replace_flags",l="event_reset_flags",d="event_add_message",p="event_read_inbound",h="event_read_outbound",f="event_got_online",m="event_got_offline",g="event_chat_changed",v="event_chat_updated",_="event_typing",b="event_recoding_audio",y="event_video_call",E="event_unread_count",O="event_notify_settings_changed",C="event_keyboard_callback_received",S="event_empty",T="event_reset_directories",w="event_replace_directories",I="event_set_directories",P="event_resync",j="event_refresh_lp_key",k="transition_event",A="reset_peer",R="mutex",L="change_peer",N="event_change_tab",M="event_failed_message",D="event_resend",x="event_delete_dialog",U="event_edit_message",B="event_replace_message",F="event_invalidate_event",H="event_audio_start",G="event_waiting_for_reconnect",V="event_reconnecting",q="event_reconnected",z="incoming_call",K=1,W=2,Y=8,$=16,J=32,X=64,Q=128,Z=512,ee=65536,te=1<<21,ne=4096,re=1<<22,ie=1,ae=2,oe=8,se=32768,ce=1<<20,ue=1,le=2,de=3,pe=4,he=5,fe=6,me=7,ge=8,ve=9,_e=10,be=11,ye=12,Ee=13,Oe=14,Ce=15,Se=16,Te=17,we=18,Ie=19,Pe=3;function je(e){var t=i(e,2)[1];return{type:s,localId:t}}function ke(e){var t=i(e,4),n=t[1],r=t[2],a=t[3];return{type:u,messageId:n,mask:r,peerId:a}}function Ae(e){var t=i(e,4),n=t[1],r=t[2],a=t[3];return{type:c,messageId:n,flags:r,peerId:a}}function Re(e){var t=i(e,4),n=t[1],r=t[2],a=t[3];return{type:l,messageId:n,flags:r,peerId:a}}function Le(e){var t=i(e,11),n=t[1],a=t[2],o=t[3],s=t[4],c=t[5],u=t[6],l=t[7],p=t[8],h=t[9],f=t[10],m=extend(u,l||void 0);return{type:d,messageId:intval(n),flags:intval(a),peerId:intval(o),date:intval(s),attaches:Object(r.convertKludgesToAttaches)(m,n),subject:u.title||"",text:c,kludges:m,randomId:intval(p),userId:Object(r.isChatPeer)(o)?intval(m.from):intval(o),update_time:f,chat_local_id:h}}function Ne(e){var t=Le(e);return t.type=U,t}function Me(e){var t=Le(e);return t.type=B,t}function De(e){var t=i(e,2)[1];return{type:F,messageId:t}}function xe(e){return extend({},e,{type:U})}function Ue(e){var t=i(e,4),n=t[1],r=t[2],a=t[3];return{type:p,peerId:n,upToId:r,unread:a}}function Be(e){var t=i(e,4),n=t[1],r=t[2],a=t[3];return{type:h,peerId:n,upToId:r,unread:a}}function Fe(e){var t=i(e,4),n=t[1],r=t[2],a=t[3];return{type:f,userId:-n,platform:r,lastSeenTs:a}}function He(e){var t=i(e,4),n=t[1],r=t[2],a=t[3];return{type:m,userId:-n,reason:r,lastSeenTs:a}}function Ge(e){var t=i(e,4),n=t[1],r=t[2],a=t[3];return{type:T,peerId:n,mask:r,local:void 0!==a&&a}}function Ve(e){var t=i(e,3),n=t[1],r=t[2];return{type:w,peerId:n,mask:r}}function qe(e){var t=i(e,4),n=t[1],r=t[2],a=t[3];return{type:I,peerId:n,mask:r,local:void 0!==a&&a}}function ze(e){var t=i(e,3),n=t[1],r=t[2];return{type:x,peerId:n,localId:r}}function Ke(e){var t=i(e,3),n=t[1],r=t[2];return{type:g,chatId:n,self:r}}function We(e){var t=i(e,4),n=t[1],r=t[2],a=t[3];return{type:v,peerId:r,updateType:n,updateArg:a}}function Ye(e){var t=i(e,5),n=t[1],r=t[2],a=t[3],o=t[4];return{type:_,peerId:n,userIds:r,totalCount:a,ts:o}}function $e(e){var t=i(e,5),n=t[1],r=t[2],a=t[3],o=t[4];return{type:b,peerId:n,userIds:r,totalCount:a,ts:o}}function Je(e){var t=i(e,3),n=t[1],r=t[2];return{type:y,userId:n,callId:r}}function Xe(e){var t=i(e,4),n=t[1],r=t[2],a=t[3];return{type:E,count:n,countNotMuted:r,showOnlyNotMuted:a}}function Qe(e){var t=i(e,2)[1],n=void 0===t?{}:t;return{type:O,peerId:n.peer_id,sound:n.sound,disabledUntil:n.disabled_until}}function Ze(e){var t=i(e,2)[1];return{type:z,payload:t}}function et(e){var t=i(e,2)[1],n=void 0===t?{}:t,r=Le([!1,n.id,n.flags,n.peer_id,n.date,n.message,extend(n.kludges,{title:n.title||""}),{},n.random_id,n.chat_local_id,n.update_time]);return r.type=U,r}function tt(e){var t=i(e,2)[1],n=void 0===t?{}:t;return{type:H,uuid:n.uuid,deviceName:n.device_name||""}}function nt(e){var t=i(e,2)[1],n=t.event_id,r=t.owner_id,a=t.peer_id,o=t.action;return{type:C,event_id:n,owner_id:r,peer_id:a,action:o}}function rt(e){return{type:S,params:e}}function it(e){return{type:k,state:e}}function at(){return{type:P}}function ot(e){var t=i(e,3),n=t[1],r=t[2];return{type:j,key:n,url:r}}function st(e){var t=i(e,2)[1];return{type:G,timeout:t}}function ct(){return{type:V}}function ut(){return{type:q}}function lt(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{type:A,cancelSearch:e,removeActivePeer:t}}function dt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return{type:L,peerId:e,msgid:t,forward:n,cancelSearch:r,entryPoint:i}}function pt(e){return{type:N,tab:e}}function ht(e,t,n){return{type:M,message:t,peer:e,error:n}}function ft(e){var t=i(e,6),n=(t[0],t[1]),r=t[2],a=t[3],o=t[4],s=t[5];return{type:R,free:!!intval(n)||intval(o)===vk.id,resource:r,peerId:intval(a),who:intval(o),name:s}}function mt(e,t){return{type:D,message:t,peerId:e}}},grKM:function(e,t,n){"use strict";n.r(t),n.d(t,"BlockSearchInput",(function(){return u}));var r=n("q1tI"),i=n.n(r),a=n("ZxpX"),o=n("dLHM"),s=function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},c=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},u=Object(r.forwardRef)((function(e,t){var n=e.className,r=c(e,["className"]);return i.a.createElement(o.default,s({},r,{className:Object(a.classNames)(n,"BlockSearchInput"),ref:t}))}))},"h++7":function(e,t,n){"use strict";n.r(t),n.d(t,"OUR_DOMAINS",(function(){return r})),n.d(t,"ENTITIES",(function(){return i})),n.d(t,"VK_DOMAIN",(function(){return a})),n.d(t,"MENTION",(function(){return o})),n.d(t,"MENTION_RAW",(function(){return s})),n.d(t,"ARROW_UP",(function(){return c})),n.d(t,"ARROW_DOWN",(function(){return u})),n.d(t,"PAGE_UP",(function(){return l})),n.d(t,"PAGE_DOWN",(function(){return d})),n.d(t,"END_KEY",(function(){return p})),n.d(t,"HOME",(function(){return h})),n.d(t,"ENTER",(function(){return f})),n.d(t,"ESC",(function(){return m})),n.d(t,"UNPRINTABLE_KEYS",(function(){return g})),n.d(t,"UP_DOWN_CONTROLS",(function(){return v})),n.d(t,"PRINTABLE",(function(){return _})),n.d(t,"FOLDER_UNREAD",(function(){return b})),n.d(t,"FOLDER_ALL",(function(){return y})),n.d(t,"FOLDER_UNRESPOND",(function(){return E})),n.d(t,"FOLDER_IMPORTANT",(function(){return O})),n.d(t,"FOLDER_MESSAGE_REQUEST",(function(){return C})),n.d(t,"FOLDER_MESSAGE_REQUEST_REJECTED",(function(){return S})),n.d(t,"FOLDER_AD_TAG",(function(){return T})),n.d(t,"FOLDER_MARKED_UNREAD",(function(){return w})),n.d(t,"FOLDERS",(function(){return I})),n.d(t,"FOLDER_MASKS",(function(){return P})),n.d(t,"TOP_DOMAINS",(function(){return j})),n.d(t,"MAX_DOMAIN_LENGTH",(function(){return k})),n.d(t,"EMAIL",(function(){return A})),n.d(t,"MESSAGE_REGEXP",(function(){return R})),n.d(t,"RE_HASHTAG_EXTRACTION_PATTERN",(function(){return N})),n.d(t,"MASS_MENTION_ALIASES",(function(){return M})),n.d(t,"RE_MASSMENTION",(function(){return D})),n.d(t,"LINE_FEED",(function(){return x}));n("Oyvg");var r=/^([a-zA-Z0-9\.\_\-]+\.)?(vkontakte\.ru|vk\.com|vkadre\.ru|vshtate\.ru|userapi\.com|vk\.me)$/,i=/([^a-zA-Z0-9#%;_\-.\/?&=\[\]])/g,a=/^(?:https?:\/\/)?(?:vk\.com|vkontakte\.ru)?\/([a-zA-Z0-9\._]+)\??$/,o=/\[(id|club)(\d+)(?:\:([a-z0-9_\-]+))?\|([^\$]+?)\]/g,s=/(^|[\s.,:\'\";>\)\(])(\*|@)([A-Za-z0-9_\.]{2,32})\s*\((.+?)\)/g,c=38,u=40,l=33,d=34,p=35,h=36,f=13,m=27,g=[c,u,l,d,f,m,p,h],v=[l,d,u,c,h,p],_="printable",b="unread",y="all",E="unrespond",O="important",C="mr",S="mr_rejected",T="ad_tag",w="marked_unread",I=[y,b,E,O,C,T],P={[E]:2,[O]:1,[C]:256,[S]:512,[T]:32768,[w]:1<<20},j=[].concat("aaa,aarp,abarth,abb,abbott,abbvie,abc,able,abogado,abudhabi,ac,academy,accenture,accountant,accountants,aco,active,actor,ad,adac,ads,adult,ae,aeg,aero,aetna,af,afamilycompany,afl,africa,ag,agakhan,agency,ai,aig,aigo,airbus,airforce,airtel,akdn,al,alfaromeo,alibaba,alipay,allfinanz,allstate,ally,alsace,alstom,am,americanexpress,americanfamily,amex,amfam,amica,amsterdam,an,analytics,android,anquan,anz,ao,aol,apartments,app,apple,aq,aquarelle,ar,aramco,archi,army,arpa,art,arte,as,asda,asia,associates,at,athleta,attorney,au,auction,audi,audible,audio,auspost,author,auto,autos,avianca,aw,aws,ax,axa,az,azure,ba,baby,baidu,banamex,bananarepublic,band,bank,bar,barcelona,barclaycard,barclays,barefoot,bargains,baseball,basketball,bauhaus,bayern,bb,bbc,bbt,bbva,bcg,bcn,bd,be,beats,beauty,beer,bentley,berlin,best,bestbuy,bet,bf,bg,bh,bharti,bi,bible,bid,bike,bing,bingo,bio,biz,bj,bl,black,blackfriday,blanco,blockbuster,blog,bloomberg,blue,bm,bms,bmw,bn,bnl,bnpparibas,bo,boats,boehringer,bofa,bom,bond,boo,book,booking,boots,bosch,bostik,boston,bot,boutique,box,bq,br,bradesco,bridgestone,broadway,broker,brother,brussels,bs,bt,budapest,bugatti,build,builders,business,buy,buzz,bv,bw,by,bz,bzh,ca,cab,cafe,cal,call,calvinklein,cam,camera,camp,cancerresearch,canon,capetown,capital,capitalone,car,caravan,cards,care,career,careers,cars,cartier,casa,case,caseih,cash,casino,cat,catering,catholic,cba,cbn,cbre,cbs,cc,cd,ceb,center,ceo,cern,cf,cfa,cfd,cg,ch,chanel,channel,chase,chat,cheap,chintai,chloe,christmas,chrome,chrysler,church,ci,cipriani,circle,cisco,citadel,citi,citic,city,cityeats,ck,cl,claims,cleaning,click,clinic,clinique,clothing,cloud,club,clubmed,cm,cn,co,coach,codes,coffee,college,cologne,com,comcast,commbank,community,company,compare,computer,comsec,condos,construction,consulting,contact,contractors,cooking,cookingchannel,cool,coop,corsica,country,coupon,coupons,courses,cr,credit,creditcard,creditunion,cricket,crown,crs,cruise,cruises,csc,cu,cuisinella,cv,cw,cx,cy,cymru,cyou,cz,dabur,dad,dance,data,date,dating,datsun,day,dclk,dds,de,deal,dealer,deals,degree,delivery,dell,deloitte,delta,democrat,dental,dentist,desi,design,dev,dhl,diamonds,diet,digital,direct,directory,discount,discover,dish,diy,dj,dk,dm,dnp,do,docs,doctor,dodge,dog,doha,domains,dot,download,drive,dtv,dubai,duck,dunlop,duns,dupont,durban,dvag,dvr,dz,earth,eat,ec,eco,edeka,edu,education,ee,eg,eh,email,emerck,energy,engineer,engineering,enterprises,epost,epson,equipment,er,ericsson,erni,es,esq,estate,esurance,et,eu,eurovision,eus,events,everbank,exchange,expert,exposed,express,extraspace,fage,fail,fairwinds,faith,family,fan,fans,farm,farmers,fashion,fast,fedex,feedback,ferrari,ferrero,fi,fiat,fidelity,fido,film,final,finance,financial,fire,firestone,firmdale,fish,fishing,fit,fitness,fj,fk,flickr,flights,flir,florist,flowers,fly,fm,fo,foo,food,foodnetwork,football,ford,forex,forsale,forum,foundation,fox,fr,free,fresenius,frl,frogans,frontdoor,frontier,ftr,fujitsu,fujixerox,fun,fund,furniture,futbol,fyi,ga,gal,gallery,gallo,gallup,game,games,gap,garden,gb,gbiz,gd,gdn,ge,gea,gent,genting,george,gf,gg,ggee,gh,gi,gift,gifts,gives,giving,gl,glade,glass,gle,global,globo,gm,gmail,gmbh,gmo,gmx,gn,godaddy,gold,goldpoint,golf,goo,goodhands,goodyear,goog,google,gop,got,gov,gp,gq,gr,grainger,graphics,gratis,green,gripe,group,gs,gt,gu,guardian,gucci,guge,guide,guitars,guru,gw,gy,hair,hamburg,hangout,haus,hbo,hdfc,hdfcbank,health,healthcare,help,helsinki,here,hermes,hgtv,hiphop,hisamitsu,hitachi,hiv,hk,hkt,hm,hn,hockey,holdings,holiday,homedepot,homegoods,homes,homesense,honda,honeywell,horse,hospital,host,hosting,hot,hoteles,hotmail,house,how,hr,hsbc,ht,htc,hu,hughes,hyatt,hyundai,ibm,icbc,ice,icu,id,ie,ieee,ifm,ikano,il,im,imamat,imdb,immo,immobilien,in,industries,infiniti,info,ing,ink,institute,insurance,insure,int,intel,international,intuit,investments,io,ipiranga,iq,ir,irish,is,iselect,ismaili,ist,istanbul,it,itau,itv,iveco,iwc,jaguar,java,jcb,jcp,je,jeep,jetzt,jewelry,jio,jlc,jll,jm,jmp,jnj,jo,jobs,joburg,jot,joy,jp,jpmorgan,jprs,juegos,juniper,kaufen,kddi,ke,kerryhotels,kerrylogistics,kerryproperties,kfh,kg,kh,ki,kia,kim,kinder,kindle,kitchen,kiwi,km,kn,koeln,komatsu,kosher,kp,kpmg,kpn,kr,krd,kred,kuokgroup,kw,ky,kyoto,kz,la,lacaixa,ladbrokes,lamborghini,lamer,lancaster,lancia,lancome,land,landrover,lanxess,lasalle,lat,latino,latrobe,law,lawyer,lb,lc,lds,lease,leclerc,lefrak,legal,lego,lexus,lgbt,li,liaison,lidl,life,lifeinsurance,lifestyle,lighting,like,lilly,limited,limo,lincoln,linde,link,lipsy,live,living,lixil,lk,loan,loans,local,locker,locus,loft,lol,london,lotte,lotto,love,lpl,lplfinancial,lr,ls,lt,ltd,ltda,lu,lundbeck,lupin,luxe,luxury,lv,ly,ma,macys,madrid,maif,maison,makeup,man,management,mango,market,marketing,markets,marriott,marshalls,maserati,mattel,mba,mc,mcd,mcdonalds,mckinsey,md,me,med,media,meet,melbourne,meme,memorial,men,menu,meo,metlife,mf,mg,mh,miami,microsoft,mil,mini,mint,mit,mitsubishi,mk,ml,mlb,mls,mm,mma,mn,mo,mobi,mobile,mobily,moda,moe,moi,mom,monash,money,monster,montblanc,mopar,mormon,mortgage,moscow,moto,motorcycles,mov,movie,movistar,mp,mq,mr,ms,msd,mt,mtn,mtpc,mtr,mu,museum,mutual,mv,mw,mx,my,mz,na,nab,nadex,nagoya,name,nationwide,natura,navy,nba,nc,ne,nec,net,netbank,netflix,network,neustar,new,newholland,news,next,nextdirect,nexus,nf,nfl,ng,ngo,nhk,ni,nico,nike,nikon,ninja,nissan,nissay,nl,no,nokia,northwesternmutual,norton,now,nowruz,nowtv,np,nr,nra,nrw,ntt,nu,nyc,nz,obi,observer,off,office,okinawa,olayan,olayangroup,oldnavy,ollo,om,omega,one,ong,onl,online,onyourside,ooo,open,oracle,orange,org,organic,orientexpress,origins,osaka,otsuka,ott,ovh,pa,page,pamperedchef,panasonic,panerai,paris,pars,partners,parts,party,passagens,pay,pccw,pe,pet,pf,pfizer,pg,ph,pharmacy,philips,phone,photo,photography,photos,physio,piaget,pics,pictet,pictures,pid,pin,ping,pink,pioneer,pizza,pk,pl,place,play,playstation,plumbing,plus,pm,pn,pnc,pohl,poker,politie,porn,post,pr,pramerica,praxi,press,prime,pro,prod,productions,prof,progressive,promo,properties,property,protection,pru,prudential,ps,pt,pub,pw,pwc,py,qa,qpon,quebec,quest,qvc,racing,radio,raid,re,read,realestate,realtor,realty,recipes,red,redstone,redumbrella,rehab,reise,reisen,reit,reliance,ren,rent,rentals,repair,report,republican,rest,restaurant,review,reviews,rexroth,rich,richardli,ricoh,rightathome,ril,rio,rip,rmit,ro,rocher,rocks,rodeo,rogers,room,rs,rsvp,ru,ruhr,run,rw,rwe,ryukyu,sa,saarland,safe,safety,sakura,sale,salon,samsclub,samsung,sandvik,sandvikcoromant,sanofi,sap,sapo,sarl,sas,save,saxo,sb,sbi,sbs,sc,sca,scb,schaeffler,schmidt,scholarships,school,schule,schwarz,science,scjohnson,scor,scot,sd,se,seat,secure,security,seek,select,sener,services,ses,seven,sew,sex,sexy,sfr,sg,sh,shangrila,sharp,shaw,shell,shia,shiksha,shoes,shop,shopping,shouji,show,showtime,shriram,si,silk,sina,singles,site,sj,sk,ski,skin,sky,skype,sl,sling,sm,smart,smile,sn,sncf,so,soccer,social,softbank,software,sohu,solar,solutions,song,sony,soy,space,spiegel,spot,spreadbetting,sr,srl,srt,ss,st,stada,staples,star,starhub,statebank,statefarm,statoil,stc,stcgroup,stockholm,storage,store,stream,studio,study,style,su,sucks,supplies,supply,support,surf,surgery,suzuki,sv,swatch,swiftcover,swiss,sx,sy,sydney,symantec,systems,sz,tab,taipei,talk,taobao,target,tatamotors,tatar,tattoo,tax,taxi,tc,tci,td,tdk,team,tech,technology,tel,telecity,telefonica,temasek,tennis,teva,tf,tg,th,thd,theater,theatre,tiaa,tickets,tienda,tiffany,tips,tires,tirol,tj,tjmaxx,tjx,tk,tkmaxx,tl,tm,tmall,tn,to,today,tokyo,tools,top,toray,toshiba,total,tours,town,toyota,toys,tp,tr,trade,trading,training,travel,travelchannel,travelers,travelersinsurance,trust,trv,tt,tube,tui,tunes,tushu,tv,tvs,tw,tz,ua,ubank,ubs,uconnect,ug,uk,um,unicom,university,uno,uol,ups,us,uy,uz,va,vacations,vana,vanguard,vc,ve,vegas,ventures,verisign,vermögensberater,vermögensberatung,versicherung,vet,vg,vi,viajes,video,vig,viking,villas,vin,vip,virgin,visa,vision,vista,vistaprint,viva,vivo,vlaanderen,vn,vodka,volkswagen,volvo,vote,voting,voto,voyage,vu,vuelos,wales,walmart,walter,wang,wanggou,warman,watch,watches,weather,weatherchannel,webcam,weber,website,wed,wedding,weibo,weir,wf,whoswho,wien,wiki,williamhill,win,windows,wine,winners,wme,wolterskluwer,woodside,work,works,world,wow,ws,wtc,wtf,xbox,xerox,xfinity,xihuan,xin,xperia,xxx,xyz,yachts,yahoo,yamaxun,yandex,ye,yodobashi,yoga,yokohama,you,youtube,yt,yu,yun,za,zappos,zara,zero,zip,zippo,zm,zone,zuerich,zw".split(","),"бг,бел,дети,ею,католик,ком,мкд,мон,москва,онлайн,орг,рус,рф,сайт,срб,укр".split(","),"qxam,90ae,90ais,d1acj3b,e1a4c,80aqecdr1a,j1aef,d1alf,l1acc,80adxhks,80asehdb,c1avg,p1acf,p1ai,80aswg,90a3ac,j1amh,80ao21a,y9a3aq,9dbq2a,mgbca7dzdo,mgba3a3ejt,mgbayh7gpa,lgbbat1ad8j,mgberp4a5d4ar,mgba7c0bbn0a,mgbc0a9azcg,mgb2ddes,mgbaam7a8h,mgba3a4f16a,mgbbh1a,mgbab2bd,ngbe9e0a,mgbbh1a71e,pgbs0dh,mgbpl2fh,ogbpf8fl,ngbc5azd,mgbtx2b,mgb9awbf,ygbi2ammx,wgbl6a,mgbi4ecexp,fhbei,wgbh1c,mgbx4cd0ab,mgbb9fbpob,4gbrim,mgbt3dhd,mgbai9azgqp6j,mgbgu82a,11b4c3d,c2br7g,h2brj9c,h2breg3eve,h2brj9c8c,i1b6b1a6a2e,54b7fta0cc,45brj9c,45br5cyl,s9brj9c,gecrj9c,3hcrj9c,xkc2dl3a5ee0h,xkc2al3hye2a,clchc0ea0b2g2a9gcd,fpcrj9c3d,2scrj9c,rvc1e0am3e,fzc2c9e2c,42c2d9a,o3cw4h,node,q9jyb4c,gckr3f0f,qcka1pmc,tckwe,cck2b3b,1ck2e1b,bck1b9a5dre4c,eckvdtc9d,rhqv96g,fiq64b,fiqs8s,fiqz9s,fiq228c5hs,vhquv,1qqw23a,vuq861b,nyqy26a,45q11c,55qx5d,55qw42g,kprw13d,kpry57d,czru2d,czrs0t,czr694b,w4rs40l,w4r85el8fhu5dnra,3ds443g,3oq18vl8pn36a,pssy2u,tiq49xqyj,fjq720a,fct429k,estv75g,xhq521b,9krt00a,30rr7y,6qq986b3xl,kput3i,kpu716f,zfr164b,mxtq1m,yfro4i67o,efvy88h,9et52u,rovu88b,nqv7f,b4w605ferd,unup4y,mix891f,mix082f,3pxu8k,pbt977c,6frz82g,nqv7fs00ema,ses554g,hxt814e,5tzm5g,io0a7i,8y0a063a,jlq61u9w7b,flw351e,g2xx48c,gk3at1e,3bst00m,fzys8d69uvgm,kcrx77d1x4a,jvr189m,imr513n,5su34j936bgsg,j6w193g,t60b56a,mk1bu44c,cg4bki,3e0b707e".split(",").map(e=>"xn--"+e)),k=j.reduce((e,t)=>Math.max(e,t.length),0),A=new RegExp("([a-zA-Zа-яА-Я\\-_\\.0-9\\+]+@(((?:[\\w\\$А-Яа-яёЁєЄҐґЇїІіЈј\\—\\-\\_]+\\.){1,5})([A-Za-zа-яА-Я\\-\\d]{2,22})))","ig"),R=new RegExp("(https?:\\/\\/)?(((?:[\\w\\$А-Яа-яёЁєЄҐґЇїІіЈј\\—\\-\\_]+\\.){1,5})([A-Za-zа-яА-Я\\-\\d]{2,22})(?:\\:(\\d{2,5}))?)(([\\/?#])(?:\\&amp;|\\&#\\d{2,6};|,[_%]|!|,*[\\wА-Яа-я\\xa8\\xb8\\xc0-\\xffєЄҐґЇїІіЈј\\—\\-\\_@#%?+\\/\\$.~=;:'ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠ-ࢴࢶ-ࢽऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛱ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢄᢇ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲈᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿕ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞮꞰ-ꞷꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭥꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ　-〿＀-￯*]+|(?:\\(|\\[)[\\w\\$А-Яа-яёЁєЄҐґЇїІіЈј\\d&#%;,]+(?:\\)|\\])){0,200})?","ig"),L="(?:[a-zA-Zа-яА-ЯёіјєїґўЁІЈЄЇҐЎ’_\\d]|(?:&#(?:19[2-9]|(?:[2-9]|1[0-3])[0-9][0-9]);?))",N=`(^|[s.,:'";>)(]?)(${`(#${L}{0,100}(?:[a-zA-Zа-яА-ЯёіјєїґўЁІЈЄЇҐЎ’]|(?:&#(?:19[2-9]|(?:[2-9]|1[0-3])[0-9][0-9]);?))${L}{0,100})`})(@((?:[a-z0-9_]*[a-z0-9])?(?:(?:.[a-z](?:[a-z0-9_]+[a-z0-9])?)*.[a-z][a-z0-9_]{2,40}[a-z0-9])?))?(?=$|[s.,:'"&;?<)(]?)`,M={all:["all","everyone","все"],online:["online","here","здесь","тут"]},D=new RegExp(['(?!,|;|:|\\.|\\s|"|\\(|\\)|\\[|\\]|!|\\?)',"(",[].concat(M.all).concat(M.online).map(e=>`@${e}|\\*${e}`).join("|"),")",'(?=$|,|;|:|\\.(?![a-z0-9_-])|\\s|"|\\(|\\)|\\[|\\]|!|\\?)'].join(""),"gi"),x=10},k76L:function(e,t,n){var r=n("leix"),i=n("8Lyy");t.write=i,t.parse=r.parse,t.parseFmtpConfig=r.parseFmtpConfig,t.parseParams=r.parseParams,t.parsePayloads=r.parsePayloads,t.parseRemoteCandidates=r.parseRemoteCandidates,t.parseImageAttributes=r.parseImageAttributes,t.parseSimulcastStreamList=r.parseSimulcastStreamList},lJdi:function(e,t,n){"use strict";n.r(t),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE",(function(){return c})),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN",(function(){return u})),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE",(function(){return l})),n.d(t,"MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS",(function(){return d})),n.d(t,"MAIL_CHAT_FLAG_ADMINS_CAN_INVITE_LINK",(function(){return p})),n.d(t,"MAIL_CHAT_FLAG_SERVICE_CHAT",(function(){return h})),n.d(t,"MAIL_CHAT_FLAG_IS_CHANNEL",(function(){return f})),n.d(t,"MAIL_CHAT_FLAG_IS_SUPERGROUP",(function(){return m})),n.d(t,"MAIL_CHAT_FLAG_IS_FAKE_CHANNEL",(function(){return g})),n.d(t,"MAIL_CHAT_FLAG_IS_PROMO_CHAT",(function(){return v})),n.d(t,"MAIL_CHAT_FLAG_IS_BUSINESS_NOTIFY",(function(){return _})),n.d(t,"MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE",(function(){return b})),n.d(t,"MAIL_CHAT_FLAG_IS_CASPER",(function(){return y})),n.d(t,"MAIL_CHAT_FLAG_IS_COPIED",(function(){return E})),n.d(t,"MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT",(function(){return O})),n.d(t,"MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT_DELETED",(function(){return C})),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_MASS_MENTION",(function(){return S})),n.d(t,"MAIL_CHAT_FLAG_ONLY_OWNER_CAN_MASS_MENTION",(function(){return T})),n.d(t,"MAIL_CHAT_FLAG_ONLY_OWNER_CAN_INVITE",(function(){return w})),n.d(t,"MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_TITLE",(function(){return I})),n.d(t,"MAIL_CHAT_FLAG_ONLY_OWNER_CAN_PIN",(function(){return P})),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_SEE_INVITE_LINK",(function(){return j})),n.d(t,"MAIL_CHAT_FLAG_ONLY_OWNER_CAN_SEE_INVITE_LINK",(function(){return k})),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CALL",(function(){return A})),n.d(t,"MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CALL",(function(){return R})),n.d(t,"MAIL_CHATS_ACTION_SEE_INVITE_LINK",(function(){return L})),n.d(t,"MAIL_CHATS_ACTION_CHANGE_INVITE_LINK",(function(){return N})),n.d(t,"MAIL_CHATS_ACTION_INVITE_USER",(function(){return M})),n.d(t,"MAIL_CHATS_ACTION_PIN_OR_UNPIN",(function(){return D})),n.d(t,"MAIL_CHATS_ACTION_CHANGE_TITLE",(function(){return x})),n.d(t,"MAIL_CHATS_ACTION_ADD_ADMIN",(function(){return U})),n.d(t,"MAIL_CHATS_ACTION_MASS_MENTION",(function(){return B})),n.d(t,"MAIL_CHATS_ACTION_START_GROUP_CALL",(function(){return F})),n.d(t,"canSeeInviteLink",(function(){return G})),n.d(t,"canMassMention",(function(){return V})),n.d(t,"canChangeInviteLink",(function(){return q})),n.d(t,"canAddAdmin",(function(){return z})),n.d(t,"canInviteUser",(function(){return K})),n.d(t,"canKickUser",(function(){return W})),n.d(t,"canPinOrUnpin",(function(){return Y})),n.d(t,"canStartGroupCall",(function(){return $})),n.d(t,"canChangeTitle",(function(){return J})),n.d(t,"canChangeAvatar",(function(){return X})),n.d(t,"canSeeAllMessages",(function(){return Q})),n.d(t,"canSeeSettingsItem",(function(){return Z})),n.d(t,"canCloseChat",(function(){return ee})),n.d(t,"checkChatRights",(function(){return te})),n.d(t,"doesChatTabHaveFlag",(function(){return ne})),n.d(t,"isUserAdminInChat",(function(){return re})),n.d(t,"isUserOwnerInChat",(function(){return ie})),n.d(t,"isUserInvitedByMe",(function(){return ae}));n("HEwt"),n("a1Th"),n("Btvt"),n("rGqo"),n("rE2o"),n("ioFf"),n("OEbY");var r=n("rHUl"),i=n("aong"),a=n("P13b");function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var c=1,u=4,l=8,d=16,p=32,h=64,f=256,m=512,g=1024,v=2048,_=4096,b=16384,y=32768,E=65536,O=1<<17,C=1<<18,S=1<<19,T=1<<20,w=1<<21,I=1<<22,P=1<<23,j=1<<24,k=1<<25,A=1<<26,R=1<<27,L="see_invite_link",N="change_invite_link",M="invite_user",D="pin_unpin",x="change_title",U="add_admin",B="mass_mention",F="call",H={[N]:[p,p],[U]:[d,d],[L]:[j,k],[M]:[c,w],[D]:[u,P],[x]:[l,I],[B]:[S,T],[F]:[A,R]};function G(e,t,n){return te(e,L,t,n)}function V(e,t,n){return te(e,B,t,n)}function q(e,t,n){return te(e,N,t,n)}function z(e,t,n,a){var o=Object(i.unpackStore)(e);return!ie(Object(r.getTab)(o,n||o.peer),t)&&te(e,U,n,a)}function K(e,t,n){return te(e,M,t,n)}function W(e,t,n,o){var s=Object(i.unpackStore)(e);if(function(e,t){var n=Object(i.unpackStore)(e);return void 0!==n.service&&(n.service&t)>0}(e,1))return!0;var c=Object(r.getTab)(s,n||s.peer);return!(c.data.kicked&&!c.data.closed)&&(!Object(a.isFvkcomgroup)(e,n)&&(!ie(c,t)&&(!!ie(c,o=void 0===o?window.vk.id:o)||(re(c,o)||ae(c,t))&&!re(c,t))))}function Y(e,t,n){return te(e,D,t,n)}function $(e,t,n){return te(e,F,t,n)}function J(e,t,n){return te(e,x,t,n)}function X(e,t,n){return J(e,t,n)&&!Object(a.isFvkcomgroup)(e,t)}function Q(e,t,n){return!Object(r.isCommunityPeer)(n)||!!Object(r.getTab)(e,t).caccess[n]}function Z(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.vk.id,o=Object(i.unpackStore)(e),s=Object(a.isFvkcomgroup)(o,t),c=o.tabs[o.peer];if(Object(r.isCommunityChat)(o,t)){var u=c&&c.data&&Object(r.isChatActive)(c),l=ie(c,-o.gid)&&u,d=l||re(c,n)&&u,p=c.allowedUpdateFlags?c.allowedUpdateFlags.filter(e=>e!==b):[];return!(!d||!p.length)}return ie(c,n)&&!s}function ee(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.vk.id,a=Object(i.unpackStore)(e),o=Object(r.isCommunityChat)(a,t),s=Object(r.isCommunityChatDeleted)(a,t),c=a.tabs[a.peer],u=c&&c.data&&Object(r.isChatActive)(c),l=ie(c,-a.gid)&&u,d=l||re(c,n)&&u;return o&&!s&&d&&c.allowedUpdateFlags&&c.allowedUpdateFlags.includes(b)}function te(e,t,n,s){var c=Object(i.unpackStore)(e),u=c.gid?-c.gid:window.vk.id;s=void 0===s?u:s,n=void 0===n?c.peer:n;var l=Object(r.getTab)(c,n),d=l&&l.data&&Object(r.isChatActive)(l),p=o(H[t],2),h=p[0],f=p[1],m=f|h,g=Object(a.isFvkcomgroup)(e,n),v=ie(l,s)&&d,_=v||re(l,s)&&d;if(g)switch(t){case U:case M:return!1;case L:return d;default:return c.gid>0}else if(Object(r.isCommunityChat)(e,n)){if(Object(r.isClosedChat)(e,n))return!1;switch(t){case L:return Object(r.isServiceChatTab)(l)?d:ne(l,m)?ne(l,f)?d:_:v;case N:return v||_;case U:return ne(l,m)?_:v;case B:case F:case M:return Object(r.isServiceChatTab)(l)?d:!v&&(ne(l,m)?_:d);case D:case x:return Object(r.isServiceChatTab)(l)?d:_;default:return!1}}switch(t){case N:return ne(l,h)?_:v;case U:return ne(l,m)?_:v;case L:return ne(l,m)?ne(l,f)?d:_:v;case M:case D:case B:case F:case x:return ne(l,m)?ne(l,h)?_:v:d}return!1}function ne(e,t){return((e&&e.data&&e.data.flags||0)&t)>0}function re(e,t){return(e&&e.adminIds||[]).indexOf(+t)>-1}function ie(e,t){return e.ownerId===t}function ae(e,t){return-1!==e.invitedByMe.indexOf(t)}},leix:function(e,t,n){var r=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,n){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var a=e.push?{}:i?t[e.name]:t;!function(e,t,n,i){if(i&&!n)t[i]=r(e[1]);else for(var a=0;a<n.length;a+=1)null!=e[a+1]&&(t[n[a]]=r(e[a+1]))}(n.match(e.reg),a,e.names,e.name),e.push&&t[e.push].push(a)},a=n("O6qx"),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},n=[],r=t;return e.split(/(\r\n|\r|\n)/).filter(o).forEach((function(e){var t=e[0],o=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),r=n[n.length-1]);for(var s=0;s<(a[t]||[]).length;s+=1){var c=a[t][s];if(c.reg.test(o))return i(c,r,o)}})),t.media=n,t};var s=function(e,t){var n=t.split(/=(.+)/,2);return 2===n.length&&(e[n[0]]=r(n[1])),e};t.parseParams=function(e){return e.split(/\;\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(r),i=0;i<n.length;i+=3)t.push({component:n[i],ip:n[i+1],port:n[i+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,n=!1;return"~"!==e[0]?t=r(e):(t=r(e.substring(1,e.length)),n=!0),{scid:t,paused:n}}))}))}},ofcU:function(e,t,n){"use strict";n.r(t),n.d(t,"createMutations",(function(){return u})),n.d(t,"createModule",(function(){return p})),n.d(t,"destroyModule",(function(){return h}));n("HEwt"),n("a1Th"),n("rE2o"),n("ioFf"),n("rGqo"),n("Btvt"),n("KKXr");function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var a=new window.Map;function o(e){var t=a.get(e.currentTarget);if(t){var n=t[e.type];if(n)for(var i,o=0;o<n.length;o++){var s=r(n[o],2),c=s[0],u=s[1],l=void 0;if(hasClass(e.target,c)?l=u(e,e.target):(i=gpeByClass(c,e.target,e.currentTarget))&&(l=u(e,i)),!1===l)break}}}var s=n("Egk5"),c=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)r[i]=a[o];return r};function u(e){return{callMutations:function(){if("function"==typeof e)throw console.trace(),new Error("Mutations are not initialized");return e},bindMutations:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if("function"!=typeof e)throw console.trace(),new Error("Mutations are already initialized");return e=e.apply(void 0,t)}}}function l(e,t,n,r){Object(s.addEvent)(t,n,r),e._registeredHandlers.push({handlerType:"bind",elem:t,types:n,handler:r})}function d(e,t,n,r,i){!function(e,t,n,r){var i=a.get(e);i||(a.set(e,{}),i=a.get(e));for(var s=t.split(" "),c=0;c<s.length;c++){var u=s[c];i[u]||(i[u]=[],addEvent(e,u,o)),i[u].push([n,r])}}(t,n,r,i),e._registeredHandlers.push({handlerType:"delegate",elem:t,types:n,selector:r,handler:i})}function p(e){var t={_registeredHandlers:[]};return e.handlers((function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return l.apply(void 0,c([t],e))}),(function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return d.apply(void 0,c([t],e))})),t}function h(e){e._registeredHandlers.forEach((function(e){var t,n,r,i,c;"delegate"===e.handlerType?(t=e.elem,n=e.types,r=e.selector,i=e.handler,(c=a.get(t))&&(n.split(" ").forEach(e=>{c[e]&&(c[e]=c[e].filter(e=>e[0]!==r||e[1]!==i),0===c[e].length&&removeEvent(t,e,o))}),0===Object.keys(c).map(e=>c[e].length).reduce((e,t)=>e+t)&&a.delete(t))):Object(s.removeEvent)(e.elem,e.types,e.handler)})),e._registeredHandlers=[]}},qihR:function(e,t,n){"use strict";n.r(t);var r=n("q1tI"),i=n.n(r),a=n("i8i4"),o=n("ZxpX"),s=function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},c=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};t.default=function(e){var t,n=e.x,u=e.y,l=e.text,d=e.position,p=void 0===d?"b":d,h=e.align,f=void 0===h?"center":h,m=e.removed,g=e.maxWidth,v=e.appearance,_=void 0===v?"dark":v,b=e.className,y=e.tooltipRef,E=c(e,["x","y","text","position","align","removed","maxWidth","appearance","className","tooltipRef"]),O=Object(r.useRef)(null);O.current||(O.current=document.createElement("div"),document.body.appendChild(O.current));var C=Object(o.classNames)("Tooltip","Tooltip--"+p,"Tooltip--"+_,((t={"Tooltip--removed":!!m})["Tooltip--align-"+f]="t"===p||"b"===p,t),b);return Object(a.createPortal)(i.a.createElement("div",s({},E,{className:C,ref:y,style:{top:u,left:n}}),"string"==typeof l&&i.a.createElement("div",{className:"Tooltip__in",style:{maxWidth:g},dangerouslySetInnerHTML:{__html:l}}),"string"!=typeof l&&i.a.createElement("div",{className:"Tooltip__in",style:{maxWidth:g}},l)),O.current)}},r7nW:function(e,t,n){"use strict";n.r(t);var r=n("q1tI"),i=n("i8i4"),a=(n("17x9"),n("ZxpX"));class o extends r.Component{constructor(){super(...arguments),this.getScrollbarWidth=()=>{var e=document.createElement("div");e.classList.add("BaseModal__scrollbarMeasure"),document.body.appendChild(e);var t=e.getBoundingClientRect().width-e.clientWidth;return document.body.removeChild(e),t},this.hideScrollBar=()=>{var e=document.body.getBoundingClientRect(),t=e.left+e.right<window.innerWidth,n=this.getScrollbarWidth();this.calculatedPadding=window.getComputedStyle(document.body)["padding-right"],t&&(document.body.style.paddingRight=parseFloat(this.calculatedPadding)+n+"px"),document.body.classList.add("BaseModal__bodyHiddenOverflow")},this.showScrollBar=()=>{document.body.style.paddingRight=this.calculatedPadding,document.body.classList.remove("BaseModal__bodyHiddenOverflow")},this.onDocumentKeyDown=e=>{var t=this.props.onClose;"Escape"===e.key&&t()},this.onBackdropClick=()=>{var e=this.props,t=e.onClose,n=e.onBackdropClick;e.disableBackdropClick||(n?n():t())}}componentDidMount(){var e=this.props,t=e.disableEscapeClose,n=e.disableBodyScroll;t||document.body.addEventListener("keydown",this.onDocumentKeyDown),n&&this.hideScrollBar()}componentWillUnmount(){var e=this.props,t=e.disableEscapeClose,n=e.disableBodyScroll;t||document.body.removeEventListener("keydown",this.onDocumentKeyDown),n&&this.showScrollBar()}renderModal(){var e=this.props.className,t=Object(a.classNames)("BaseModal",e);return r.createElement("div",{className:t,"aria-modal":"true"},r.createElement("div",{className:"BaseModal__backdrop",onClick:this.onBackdropClick}),r.createElement("div",{className:"BaseModal__content"},this.props.children))}render(){return i.createPortal(this.renderModal(),document.body)}}o.defaultProps={className:"",children:null,disableBackdropClick:!1,disableEscapeClose:!1,disableBodyScroll:!1},t.default=o},rHUl:function(e,t,n){"use strict";n.r(t),n.d(t,"getFirstUnread",(function(){return d})),n.d(t,"isSearchShown",(function(){return p})),n.d(t,"getPeer",(function(){return h})),n.d(t,"getCurrentKeyboard",(function(){return f})),n.d(t,"getKeyboard",(function(){return m})),n.d(t,"getTab",(function(){return g})),n.d(t,"getCurrentTab",(function(){return v})),n.d(t,"getSelectedMessages",(function(){return _})),n.d(t,"getMessageRangeFromSelection",(function(){return b})),n.d(t,"countUnread",(function(){return y})),n.d(t,"getMessageByRid",(function(){return E})),n.d(t,"isRidExist",(function(){return O})),n.d(t,"getLocalId",(function(){return C})),n.d(t,"getLastMessage",(function(){return S})),n.d(t,"parserMessage",(function(){return T})),n.d(t,"getAuthorFullName",(function(){return w})),n.d(t,"getMessage",(function(){return I})),n.d(t,"getPreviousMessage",(function(){return P})),n.d(t,"isClassicInterface",(function(){return j})),n.d(t,"isLocksAvailable",(function(){return k})),n.d(t,"isFoldersAvailable",(function(){return A})),n.d(t,"isCommunityInterface",(function(){return R})),n.d(t,"isChannelPeer",(function(){return L})),n.d(t,"getBareTab",(function(){return N})),n.d(t,"isReversedDialogs",(function(){return M})),n.d(t,"isFullyLoadedTab",(function(){return D})),n.d(t,"makeTabNotFullyLoaded",(function(){return x})),n.d(t,"isGoToEndVisible",(function(){return U})),n.d(t,"isGoToMentionVisible",(function(){return B})),n.d(t,"getUnreadScrollBottom",(function(){return F})),n.d(t,"isSendingAvailable",(function(){return H})),n.d(t,"isCommunityPeer",(function(){return G})),n.d(t,"isCommunityBlocked",(function(){return V})),n.d(t,"checkVoiceMessageAvailable",(function(){return q})),n.d(t,"isSearching",(function(){return z})),n.d(t,"getSearchText",(function(){return K})),n.d(t,"isSearchingValue",(function(){return W})),n.d(t,"isRecentSearchesActive",(function(){return Y})),n.d(t,"getPinnedMessage",(function(){return $})),n.d(t,"doPopularSuggExist",(function(){return J})),n.d(t,"isAnyMessageBeingEdited",(function(){return X})),n.d(t,"getGroupId",(function(){return Q})),n.d(t,"getTabDraft",(function(){return Z})),n.d(t,"getTemplates",(function(){return ee})),n.d(t,"tabIsMessageRequest",(function(){return te})),n.d(t,"tabIsMessageRequestToChat",(function(){return ne})),n.d(t,"removeMessageRequestFolderFlags",(function(){return re})),n.d(t,"isMessageRequestFolder",(function(){return ie})),n.d(t,"tabIsOutgoingMessageRequest",(function(){return ae})),n.d(t,"existsIncomingMessageRequest",(function(){return oe})),n.d(t,"isMessageRequestChangedEvent",(function(){return se})),n.d(t,"isCommunityChat",(function(){return ce})),n.d(t,"isCommunityChatDeleted",(function(){return ue})),n.d(t,"isClosedChat",(function(){return le})),n.d(t,"isCasperChat",(function(){return de})),n.d(t,"isServiceChatTab",(function(){return pe})),n.d(t,"isCasperChatTab",(function(){return he})),n.d(t,"isChatActive",(function(){return fe})),n.d(t,"isTabMarkedUnread",(function(){return me}));n("Vd3H"),n("rGqo"),n("Btvt");var r=n("MhhX"),i=n("f01n"),a=n("h++7"),o=n("86+7"),s=n("rjmT"),c=n("aong"),u=n("lJdi"),l=n("rudk");function d(e,t){var n=Object(c.unpackStore)(e),i=n.tabs[n.peer];return Object.keys(i.msgs).filter(n=>{var a=I(e,t,n);return!Object(r.isOut)(a)&&intval(n)>i.in_up_to})[0]}function p(e){return Object(c.unpackStore)(e).searchShown}function h(e){return Object(c.unpackStore)(e).peer}function f(e){return m(e,h(e))}function m(e,t){var n=(g(e,t)||{}).keyboard;if(!n||!n.buttons||n.buttons.length)return n}function g(e,t){var n=Object(c.unpackStore)(e);return n.tabs&&n.tabs[t]}function v(e){var t=Object(c.unpackStore)(e);return t.peer?t.tabs[t.peer]:null}function _(e){return Object(c.unpackStore)(e).selectedMessages}function b(e,t,n){var i=g(e,t),a=_(e)[0];if(void 0===a)return[n];var o=Math.min(n,a),s=Math.max(n,a);return Object.keys(i.msgs).filter(e=>e>=o&&e<=s).filter(t=>{var n=I(e,e.get().peer,t);return!Object(r.isServiceMsg)(n)&&!Object(r.isCallMessage)(n)}).map(intval)}function y(e,t){var n=g(Object(c.unpackStore)(t),e),i=0;for(var a in n.msgs)if(n.msgs.hasOwnProperty(a)){var o=I(t,e,a);Object(r.isOut)(o)||(i+=Object(r.isUnread)(n,o)?1:0)}return i}function E(e,t,n){var r=g(e,t);return Object.keys(r.msgs).filter(r=>intval(I(e,t,r).randomId)===n).length>0}function O(e,t,n){return!!E(e,t,n)}function C(e,t){var n=Object(c.unpackStore)(e),r=n.msg_local_ids_sort&&n.msg_local_ids_sort[t];return void 0!==r?2e9+r:t}function S(e,t,n){var r=g(e,t),a=I(e,t,n),o=Object.keys(r.msgs).filter(n=>{var r=I(e,t,n),o=r.local&&r.type!==i.EDIT_MESSAGE;return!(!a.local&&o)&&(!(!a.local||o)||C(e,a.messageId)>C(e,r.messageId))}).pop();return o?I(e,t,o):null}function T(e){return e&&e.length>0?i.addMessageEvent([0].concat(e)):e}function w(e,t,n){var i=g(e,t),a=I(e,t,n),s=Object(c.unpackStore)(e);return Object(r.isOut)(a)?Object(o.oCacheGet)(e,s.id).name:a.userId!==a.peerId?!!Object(o.oCacheExists)(e,a.userId)&&Object(o.oCacheGet)(e,a.userId).name:i.tab}function I(e,t,n){var r=g(e,t),i=r&&r.msgs&&r.msgs[n];return i?T(i):null}function P(e,t,n){var r=g(e,t),i=r&&r.msgs&&Object.keys(r.msgs).sort((e,t)=>+e-t);if(!i)return null;var a=i&&i.indexOf(""+n),o=a>-1?i[a-1]:null;return r.msgs[o]}function j(e){var t=Object(c.unpackStore)(e);return t.gid||t.isClassic}function k(e){return Object(c.unpackStore)(e).gid}function A(e){return Object(c.unpackStore)(e).gid}function R(e){return!!Object(c.unpackStore)(e).gid}function L(e){return!!(e.peerId>2e9&&Object(u.doesChatTabHaveFlag)(e,1024))}function N(e,t){var n=Object(c.unpackStore)(t);return n.tabs[e]||n.mapped_index[e]}function M(e){var t=Object(c.unpackStore)(e);return!!R(e)&&((19542789===t.gid||103416369==t.gid)&&(t.active_tab===a.FOLDER_UNRESPOND||t.active_tab===a.FOLDER_UNREAD))}function D(e,t){var n=(e=Object(c.unpackStore)(e)).tabs;return!(!n||!n[t]||void 0===n[t].history||!n[t].msgs)}function x(e,t){var n=g(e,t);n&&(n.msgs=void 0,n.msgid=void 0,n.scrollTop=void 0,n.scrollBottom=void 0,n.contHeight=void 0,n.offset=void 0,n.skipped=void 0)}function U(e){var t=e.get().go_to_end_visible;return!!t&&t[0]}function B(e){var t=e.get().go_to_mentions_visible;return!!t&&t[0]}function F(e){var t=e.get().go_to_end_visible;return t?t[1]:0}function H(e){return!Object(c.unpackStore)(e).lockedSending}function G(e){return e>-2e9&&e<0}function V(e,t){return!!G(t)&&!!g(e,t).blocked_community}function q(e){return Object(c.unpackStore)(e).voice_message_available}function z(e){var t=Object(c.unpackStore)(e);return!(!K(t)&&!t.recentSearch)}function K(e){return Object(c.unpackStore)(e).searchText}function W(e,t){var n=Object(c.unpackStore)(e);return!!(t&&t!==K(e)||n.recentSearch)}function Y(e){return Object(c.unpackStore)(e).recentSearch}function $(e){var t=v(e);return t&&t.pinned&&T(t.pinned)}function J(e){var t=e.get().popular_sugg;return t&&t.length>0}function X(e){return 1==Object(c.unpackStore)(e).isEditing}function Q(e){return Object(c.unpackStore)(e).gid}function Z(e){return e.draft||(e.draft=Object(s.loadDraftForPeer)(cur.imDb,e.peerId)),e.draft}function ee(e){return(Object(c.unpackStore)(e).templates||[]).filter(e=>!e.deleted)}function te(e){return!!e&&Boolean(e.is_message_request||e.folders&a.FOLDER_MASKS[a.FOLDER_MESSAGE_REQUEST]||e.folders&a.FOLDER_MASKS[a.FOLDER_MESSAGE_REQUEST_REJECTED])}function ne(e){return Object(l.isChatPeer)(e.peerId)&&te(e)}function re(e){return e&~a.FOLDER_MASKS[a.FOLDER_MESSAGE_REQUEST]&~a.FOLDER_MASKS[a.FOLDER_MESSAGE_REQUEST_REJECTED]}function ie(e){return Object(c.unpackStore)(e).active_tab===a.FOLDER_MESSAGE_REQUEST}function ae(e){return e.peerId>19e8&&e.peerId<2e9}function oe(e){return!!Object(c.unpackStore)(e).dialog_tab_cts[a.FOLDER_MESSAGE_REQUEST]}function se(e){var t=e.type,n=e.updateType;return t===i.CONVERSATION_UPDATED&&(n===i.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED||n===i.MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED)}function ce(e,t){return Object(u.doesChatTabHaveFlag)(g(e,t),u.MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT)}function ue(e,t){return Object(u.doesChatTabHaveFlag)(g(e,t),u.MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT_DELETED)}function le(e,t){return Object(u.doesChatTabHaveFlag)(g(e,t),u.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE)}function de(e,t){return Object(u.doesChatTabHaveFlag)(g(e,t),u.MAIL_CHAT_FLAG_IS_CASPER)}function pe(e){return Object(u.doesChatTabHaveFlag)(e,u.MAIL_CHAT_FLAG_SERVICE_CHAT)}function he(e){return Object(u.doesChatTabHaveFlag)(e,u.MAIL_CHAT_FLAG_IS_CASPER)}function fe(e){return!e.data.closed&&!e.data.kicked}function me(e){return!!(e.folders&a.FOLDER_MASKS[a.FOLDER_MARKED_UNREAD])}},rjmT:function(e,t,n){"use strict";n.r(t),n.d(t,"ImDraft",(function(){return c})),n.d(t,"loadDraftForPeer",(function(){return l}));n("HEwt"),n("a1Th"),n("rGqo"),n("rE2o"),n("ioFf"),n("KKXr"),n("VRzm"),n("Btvt"),n("OEbY"),n("pIFo");var r=n("BxOC"),i=n("f01n"),a=n("vT4u");function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t){this._db=e,this._key=t,this.dData={txt:"",attaches:[],urlBinds:[],cancelled:[]},this.load()}function u(e){switch(e.type){case"mail":case"reply":return e.id<0&&1==e.object.fwd_count;default:return!e.object}}function l(e,t){return new c(e,"draft_"+t)}c.prototype.dump=function(){var e;this._key&&this._db.updateByKey(this._key,{txt:(e=this.dData).txt,attaches:e.attaches.length?e.attaches:void 0,urlBinds:e.urlBinds.length?e.urlBinds:void 0,cancelled:e.cancelled.length?e.cancelled:void 0})},c.prototype.load=function(){if(this._key){var e=this._db.selectByKey(this._key);e&&(this.dData=function(e){return{txt:e.txt,attaches:e.attaches||[],urlBinds:e.urlBinds||[],cancelled:e.cancelled||[]}}(e))}},c.prototype.clear=function(){this.dData={txt:"",attaches:[],urlBinds:[],cancelled:[]},this.dump()},c.prototype.setText=function(e){this.dData.txt=trim(e),this.dump()},c.prototype.addAttach=function(e,t,n){if(("share"===e&&this.removeAttachByType(e),"mail"!==e&&"reply"!==e||(this.removeAttachByType("mail"),this.removeAttachByType("reply")),"audio_playlist"===e||"artist"===e)&&this.dData.attaches.find(t=>t.type===e))return!1;if(!e||!t&&"poll"!==e)return!1;var r=this.dData.attaches.findIndex(n=>n.type===e&&n.id===t);-1===r?(this.dData.attaches.push({type:e,id:t,object:n}),this.dump()):"video"!==e&&"poll"!==e||(this.dData.attaches[r]={type:e,id:t,object:n},this.dump())},c.prototype.syncWithSelector=function(e){var t=this.getFwdRaw();this.dData.attaches=(t?[t]:[]).concat(e.getMedias().map(e=>{var t=o(e,2),n=t[0],r=t[1];return this.dData.attaches.find(e=>e.type==n&&e.id==r)||{type:n,id:r}})),this.dump()},c.prototype.removeAttachByType=function(e){for(var t=this.dData.attaches.length;t--;)this.dData.attaches[t].type===e&&this.dData.attaches.splice(t,1);this.dump()},c.prototype.removeAllAttaches=function(){this.dData.attaches=[],this.dData.cancelled=[],this.dump()},c.prototype.addBindUrl=function(e,t,n){this.getBoundAttach(e)||(this.dData.urlBinds.push({url:e,type:t,id:n}),this.dump())},c.prototype.getBoundAttach=function(e){var t=this.dData.urlBinds.find(t=>t.url===e);return t&&this.dData.attaches.find(e=>e.type===t.type&&e.id===t.id)||null},c.prototype.getShareUrl=function(){var e=this.dData.attaches.find(e=>"share"===e.type);if(e&&e.object)return e.object.url.replace(/&amp;/g,"&")},c.prototype.hasOnlyReplies=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e?e.flags&i.FLAG_HAS_REPLY&&!this.dData.attaches.find(e=>"mail"!==e.type):this.hasAttaches()&&!this.dData.attaches.find(e=>"reply"!==e.type)},c.prototype.getCancelledShares=function(){return this.dData.cancelled.length?this.dData.cancelled:void 0},c.prototype.hasAttaches=function(){return this.dData.attaches.length>0},c.prototype.destroy=function(){this.dData={},this._key=this._db=null},c.prototype.prepareObjects=function(e,t){return this.dData.attaches.find(u)?Object(r.post)(a.CONTROLLER,{act:"draft_medias",gid:e,messageId:t||0,media:t?void 0:this.dData.attaches.map(e=>[e.type,e.id]).join("*")}).then(e=>{var t=o(e,1)[0];this.dData.attaches=t.map(e=>({type:e[0],id:e[1],object:e[2]}))}):Promise.resolve()},c.prototype.getFwdRaw=function(){return this.dData.attaches.find(e=>"mail"===e.type||"reply"===e.type)},c.prototype.getFwdCount=function(){var e=this.getFwdRaw();return e?e.id<0?e.object.fwd_count:e.id.split(";").length:0}},rudk:function(e,t,n){"use strict";n.r(t),n.d(t,"parseFwd",(function(){return o})),n.d(t,"convertKludgesToAttaches",(function(){return s})),n.d(t,"isReservedPeer",(function(){return c})),n.d(t,"isUserPeer",(function(){return u})),n.d(t,"isChatPeer",(function(){return l})),n.d(t,"convertAttachesToPhpMedia",(function(){return d}));var r=n("jE6c");function i(e,t){void 0===t&&(t=[]);var n=e.split("_");return[n[0],n[1],t]}var a={};function o(e){if(a[e])return a[e];for(var t=e?e.length:0,n=[],r=[],o="",s=0;s<t;s++){var c=e[s],u=c.charCodeAt(0);u>=48&&u<=57||"_"===c||"-"===c?o+=c:"("!==c&&")"!==c&&":"!==c&&","!==c||(""!==o&&(r.push(o),n.push("id"),o=""),r.push(c),n.push(c))}o.length>0&&(r.push(o),n.push("id"));var l=function e(t,n,r,a){if(void 0===r&&(r=0),void 0===a&&(a=0),a>50)return[[],t.length];for(var o=[],s="";r<t.length;){var c=t[r];if("id"===c)s=n[r];else if(","===c&&s)o.push(i(s)),s="";else if("("===c){var u=e(t,n,r+1,a+1),l=u[0];r=u[1],o.push(i(s,l)),s=""}else if(")"===c)return""!==s&&o.push(i(s)),[o,r];r++}return s&&o.push(i(s)),[o,r]}(n,r)[0];return Object.keys(a).length>300&&(a={}),a[e]=l,l}function s(e,t){var n=[];e.fwd_count?n.push({type:"mail",id:-t,object:{fwd_count:e.fwd_count}}):e.fwd&&n.push({type:"mail",id:-t,object:{fwd_count:o(e.fwd).length}});for(var i=1;e["attach"+i+"_type"];++i)"call"===e["attach"+i+"_type"]?n.push({type:e["attach"+i+"_type"],id:e["attach"+i],initiatorId:Object(r.intval)(e["attach"+i+"_call_initiator_id"]),state:e["attach"+i+"_call_state"],duration:Object(r.intval)(e["attach"+i+"_call_duration"]),receiverId:Object(r.intval)(e["attach"+i+"_call_receiver_id"])}):n.push({type:e["attach"+i+"_type"],id:e["attach"+i],kind:e["attach"+i+"_kind"],productId:e["attach"+i+"_product_id"]});return e.geo&&n.push({type:"geo",id:e.geo}),n}function c(e){return 0==e}function u(e){return e>0&&e<2e9}function l(e){return e>2e9}function d(e){return e.map((function(e){var t="audiomsg"===e[2]?"audio_message":e[2];return e[0]+":"+e[1]+":"+t})).join(",")}},uytb:function(e,t,n){"use strict";n.r(t),n.d(t,"RECENT_SEARCH_OP",(function(){return o})),n.d(t,"PIN_HIDDEN_ID_OP",(function(){return s})),n.d(t,"deleteOldStoredFormat",(function(){return d})),n.d(t,"mount",(function(){return h}));n("HEwt"),n("a1Th"),n("Btvt"),n("rGqo"),n("rE2o"),n("ioFf");var r=n("BJj/");function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var o="recent_search",s="pin_hide";function c(e){return"im_store_"+e}function u(e){return ls.get(c(e))||{}}function l(e,t,n){if(ls.checkVersion()){var r=JSON.stringify(t);rand(0,1e5)<=1&&statlogsValueEvent("im_local_store_size",r.length),n(c(e),r)}}function d(e,t){for(var n=["fwd","draft","bind_attach"],r=u(e),i=!1,a=n.length;a--;)n[a]in r&&(delete r[n[a]],i=!0);i&&l(e,r,t)}function p(e,t,n){n.key===c(e)&&(t.db=JSON.parse(n.newValue),t.checkTime=Date.now())}function h(e){var t=Object(r.debounce)((e,t)=>{localStorage.setItem(e,t)},300);ls.checkVersion()&&d(e,t);var n={db:u(e),checkTime:Date.now()},a=p.bind(null,e,n);return window.addEventListener("storage",a,!1),{select:(t,r)=>(Date.now()-n.checkTime>1e3&&(n.db=u(e)),function(e,t,n){return t===o?e[t]||[]:t===s?e[t]&&e[t][n]:e[t]?extend(!0,{},e[t][n]):null}(n.db,t,r)),selectByKey:t=>(Date.now()-n.checkTime>1e3&&(n.db=u(e)),n.db[t]),update(r,a){var c=function(e,t,n){switch(e[t]||(e[t]={}),t){case o:var r=n;r&&r.length>0?e[t]=r:delete e[t];break;case s:var a=i(n,2),c=a[0],u=a[1];u?e[t][c]=+u:delete e[t][c]}return e}(n.db,r,a);return n.db=c,n.checkTime=Date.now(),l(e,c,t)},updateByKey:(r,i)=>(n.db[r]=i,n.checkTime=Date.now(),l(e,n.db,t)),unmount(){window.removeEventListener("storage",a,!1)}}}},vRp6:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return u}));n("HEwt"),n("a1Th"),n("Btvt"),n("rGqo"),n("rE2o"),n("ioFf");var r=n("q1tI"),i=(n("17x9"),n("UlUB")),a=n("PjZB"),o=n("ZxpX");function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}class u extends r.Component{constructor(e){super(e),this.checkLoad=Object(i.throttle)(e=>{var t=s(e,3),n=t[0],r=t[1],i=t[2];if(!this.loading)return this.props.virtualized||this.props.hasMore?void(r-n-i<=this.props.threshold&&(this.loading=!0,this.props.loadMore().then(()=>{this.loading=!1}))):this.detachListeners()},34),this.onScroll=e=>{var t=this.getScrollData();this.props.virtualized&&this.processChildren(this.props.children,t),this.props.hasMore&&this.checkLoad(t)},this.getRef=e=>{this.container=e,this.props.virtualized&&this.setState(this.getChildrenData(this.props.children,this.getScrollData()))},this.useWindowScroll=e.useWindowScroll,e.virtualized&&(this.state={before:0,after:e.children.length,start:0,end:0})}getScrollData(){var e=this.useWindowScroll?document.documentElement:this.container;return[this.getScrollTop(),e?e.scrollHeight:0,e?e.clientHeight:0]}getScrollTop(){var e=document.documentElement||document.body.parentNode||document.body;return this.useWindowScroll?void 0!==window.pageYOffset?window.pageYOffset:e.scrollTop:this.container?this.container.scrollTop:0}attachListeners(){var e=this.useWindowScroll?window:this.container;this.container&&(e.addEventListener("scroll",this.onScroll,this.props.useCapture),e.addEventListener("resize",this.onScroll,this.props.useCapture))}detachListeners(){var e=this.useWindowScroll?window:this.container;this.container&&(e.removeEventListener("scroll",this.onScroll,this.props.useCapture),e.removeEventListener("resize",this.onScroll,this.props.useCapture))}processChildren(e,t){var n=this.state,r=this.getChildrenData(e,t||this.getScrollData()),i=r.start,a=r.end,o=r.before,s=r.after;i===n.start&&a===n.end&&o===n.before&&s===n.after||this.setState(r)}getChildrenData(e,t){var n=s(t,3),r=n[0],i=n[1],a=n[2],o=this.useWindowScroll?window:this.container,c=o&&o.offsetHeight;if(!o||0===i||0===a)return{start:0,end:0,before:0,after:e.length};a=Math.max(a,c);var u=e.length,l=Math.max(Math.floor(r/this.props.itemHeight)-1,0),d=Math.min(Math.floor((r+2*a)/this.props.itemHeight+1),u);return{start:l,end:d,before:l,after:u-d}}componentWillReceiveProps(e){this.props.virtualized&&this.processChildren(e.children)}componentDidMount(){this.attachListeners()}componentWillUnmount(){this.detachListeners()}render(){return r.createElement("div",{className:Object(o.classNames)("InfiniteScroll",this.props.className),ref:this.getRef,style:this.props.style},this.props.virtualized&&this.state.before>0&&r.createElement("div",{style:{height:this.state.before*this.props.itemHeight},key:"before"}),this.props.virtualized?[].concat(this.props.children).slice(this.state.start,this.state.end):this.props.children,this.props.virtualized&&this.state.after>0&&r.createElement("div",{style:{height:this.state.after*this.props.itemHeight},key:"after"}),this.props.hasMore&&(this.props.loader||r.createElement("div",{className:"InfiniteScroll__loader",key:"loader"},r.createElement(a.default,null))))}}u.defaultProps={useWindowScroll:!1,virtualized:!1,hasMore:!0,useCapture:!1,threshold:100,itemHeight:55}},vT4u:function(e,t,n){"use strict";n.r(t),n.d(t,"CONTROLLER",(function(){return T})),n.d(t,"ACTIVITY_PERIOD",(function(){return w})),n.d(t,"ACTIVITY_TYPE_TYPING",(function(){return I})),n.d(t,"ACTIVITY_TYPE_RECORDING_AUDIO",(function(){return P})),n.d(t,"CHAT_ACTION_SETTINGS",(function(){return L})),n.d(t,"CHAT_ACTION_BLOCK",(function(){return N})),n.d(t,"CHAT_ACTION_INVITE",(function(){return M})),n.d(t,"CHAT_ACTION_MEDIA",(function(){return D})),n.d(t,"CHAT_ACTION_SEARCH",(function(){return x})),n.d(t,"CHAT_ACTION_PIN_HIDE",(function(){return U})),n.d(t,"CHAT_ACTION_PIN_UNHIDE",(function(){return B})),n.d(t,"CHAT_ACTION_UNPIN",(function(){return F})),n.d(t,"CHAT_ACTION_MUTE",(function(){return H})),n.d(t,"CHAT_ACTION_UNMUTE",(function(){return G})),n.d(t,"CHAT_ACTION_CLEAR",(function(){return V})),n.d(t,"CHAT_ACTION_LEAVE",(function(){return q})),n.d(t,"CHAT_ACTION_RETURN",(function(){return z})),n.d(t,"CHAT_ACTION_BLOCK_COMMUNITY",(function(){return K})),n.d(t,"CHAT_ACTION_ALLOW_COMMUNITY",(function(){return W})),n.d(t,"CHAT_ACTION_BLOCK_NOTIFY",(function(){return Y})),n.d(t,"CHAT_ACTION_CALL_AUDIO",(function(){return $})),n.d(t,"CHAT_ACTION_CALL_VIDEO",(function(){return J})),n.d(t,"CHAT_ACTION_UNREAD",(function(){return X})),n.d(t,"ACTION_PRIORITIES",(function(){return Q})),n.d(t,"loadHashes",(function(){return Z})),n.d(t,"loadWriteHash",(function(){return ne})),n.d(t,"strHistory",(function(){return ie})),n.d(t,"updateBlockStates",(function(){return ae})),n.d(t,"setCallAvailability",(function(){return oe})),n.d(t,"loadPeer",(function(){return se})),n.d(t,"restoreHistoryQueue",(function(){return ce})),n.d(t,"removeFailed",(function(){return ue})),n.d(t,"removeExpiredFailed",(function(){return le})),n.d(t,"selectPeer",(function(){return pe})),n.d(t,"selectPeerOnMessage",(function(){return fe})),n.d(t,"changePeer",(function(){return me})),n.d(t,"updateMentions",(function(){return ge})),n.d(t,"setActions",(function(){return ve})),n.d(t,"loadMoreHistory",(function(){return _e})),n.d(t,"loadLessHistory",(function(){return be})),n.d(t,"readLastMessages",(function(){return Ee})),n.d(t,"readTillSpecificMessage",(function(){return Oe})),n.d(t,"markAudioMessageAsListened",(function(){return Ce})),n.d(t,"loadLongPollKey",(function(){return Se})),n.d(t,"loadLongPollTs",(function(){return Te})),n.d(t,"setMessageErrored",(function(){return we})),n.d(t,"resendMessage",(function(){return Ie})),n.d(t,"loadAdmins",(function(){return je})),n.d(t,"updateVideoThumb",(function(){return Re})),n.d(t,"editMessage",(function(){return Le})),n.d(t,"addMessage",(function(){return Ne})),n.d(t,"markInboundMessagesAsRead",(function(){return Ue})),n.d(t,"markOutboundMessagesAsRead",(function(){return Be})),n.d(t,"initTextStore",(function(){return Fe})),n.d(t,"processFwd",(function(){return He})),n.d(t,"mergeTabs",(function(){return Ge})),n.d(t,"updateOnline",(function(){return Ve})),n.d(t,"setActivity",(function(){return qe})),n.d(t,"updateActivity",(function(){return ze})),n.d(t,"waitActivity",(function(){return Ke})),n.d(t,"sendMessage",(function(){return Ye})),n.d(t,"deliverMessage",(function(){return $e})),n.d(t,"deliverEditedMessage",(function(){return Je})),n.d(t,"addSelection",(function(){return Xe})),n.d(t,"cleanSelected",(function(){return Qe})),n.d(t,"dropSelection",(function(){return Ze})),n.d(t,"replaceMessage",(function(){return et})),n.d(t,"saveMedia",(function(){return tt})),n.d(t,"loadMedia",(function(){return nt})),n.d(t,"addAttachmentsToStoreData",(function(){return rt})),n.d(t,"replaceMediaAttachesStore",(function(){return it})),n.d(t,"setCurrentSearchDate",(function(){return at})),n.d(t,"setInplaceSearch",(function(){return ot})),n.d(t,"setCurrentSearch",(function(){return st})),n.d(t,"searchHints",(function(){return ct})),n.d(t,"searchHintsIndex",(function(){return ut})),n.d(t,"localIndexToDialog",(function(){return lt})),n.d(t,"searchTopConv",(function(){return pt})),n.d(t,"searchImTopConv",(function(){return ht})),n.d(t,"searchLocalHints",(function(){return ft})),n.d(t,"preloadSearchIndex",(function(){return mt})),n.d(t,"loadDialogs",(function(){return gt})),n.d(t,"searchMessages",(function(){return vt})),n.d(t,"isSearchAllLoaded",(function(){return _t})),n.d(t,"isSearchingInplace",(function(){return bt})),n.d(t,"cancelSearch",(function(){return yt})),n.d(t,"clearDate",(function(){return Et})),n.d(t,"searchInplaceStart",(function(){return Ot})),n.d(t,"searchMessagesInplace",(function(){return Ct})),n.d(t,"loadImportant",(function(){return St})),n.d(t,"loadActualLastMessage",(function(){return Tt})),n.d(t,"removeUnreadDeletedMsgsFromTab",(function(){return wt})),n.d(t,"removeMessagesMarkDeleted",(function(){return It})),n.d(t,"removeMessages",(function(){return Pt})),n.d(t,"removeMessageSend",(function(){return jt})),n.d(t,"removeMessagesWithRestore",(function(){return kt})),n.d(t,"restoreMessage",(function(){return At})),n.d(t,"restoreMessageSend",(function(){return Rt})),n.d(t,"acceptMessageRequest",(function(){return Nt})),n.d(t,"rejectMessageRequest",(function(){return Mt})),n.d(t,"cancelMessageRequest",(function(){return Dt})),n.d(t,"sendTyping",(function(){return xt})),n.d(t,"sendRecordingAudio",(function(){return Ut})),n.d(t,"forwardMessages",(function(){return Bt})),n.d(t,"prepareForward",(function(){return Ft})),n.d(t,"deletedDialog",(function(){return Ht})),n.d(t,"flushHistory",(function(){return Gt})),n.d(t,"updateChatTopic",(function(){return Vt})),n.d(t,"loadChatInfo",(function(){return qt})),n.d(t,"addNewMemberOptimisticly",(function(){return zt})),n.d(t,"addNewMember",(function(){return Kt})),n.d(t,"loadChatMember",(function(){return Wt})),n.d(t,"checkNewPeople",(function(){return Yt})),n.d(t,"loadNewPeople",(function(){return $t})),n.d(t,"updateChatPhoto",(function(){return Jt})),n.d(t,"updateActions",(function(){return Xt})),n.d(t,"leaveChat",(function(){return Qt})),n.d(t,"returnToChat",(function(){return Zt})),n.d(t,"toggleMutePeer",(function(){return en})),n.d(t,"toggleMuteMentionsPeer",(function(){return tn})),n.d(t,"setMutedPeer",(function(){return nn})),n.d(t,"setExecStack",(function(){return rn})),n.d(t,"favMessage",(function(){return an})),n.d(t,"updateFavMessage",(function(){return on})),n.d(t,"updateImportant",(function(){return sn})),n.d(t,"loadSpam",(function(){return cn})),n.d(t,"flushSpam",(function(){return un})),n.d(t,"setCreationType",(function(){return ln})),n.d(t,"getOwnerPhoto",(function(){return dn})),n.d(t,"getContactsList",(function(){return pn})),n.d(t,"presetAvatar",(function(){return hn})),n.d(t,"setChatPhoto",(function(){return fn})),n.d(t,"createChat",(function(){return mn})),n.d(t,"createCommunityChat",(function(){return gn})),n.d(t,"resync",(function(){return vn})),n.d(t,"toggleSendingAbility",(function(){return _n})),n.d(t,"setDelayedMessage",(function(){return bn})),n.d(t,"isAnythingLoading",(function(){return yn})),n.d(t,"updateUnreadCount",(function(){return En})),n.d(t,"changeSubmitSettings",(function(){return On})),n.d(t,"updateFavAndTitle",(function(){return Cn})),n.d(t,"saveHistoryScroll",(function(){return Sn})),n.d(t,"filterFromTab",(function(){return Tn})),n.d(t,"changeDialogsTab",(function(){return wn})),n.d(t,"updateFolderState",(function(){return Pn})),n.d(t,"toggleDialogImportant",(function(){return jn})),n.d(t,"markDialogAnswered",(function(){return kn})),n.d(t,"markDialogUnread",(function(){return An})),n.d(t,"markDialogRead",(function(){return Rn})),n.d(t,"getMutexQueue",(function(){return Ln})),n.d(t,"releaseBlock",(function(){return Nn})),n.d(t,"toggleCommunityMute",(function(){return Mn})),n.d(t,"deleteDialog",(function(){return Dn})),n.d(t,"restoreDialog",(function(){return xn})),n.d(t,"spamDialog",(function(){return Un})),n.d(t,"updateTabbedPeers",(function(){return Bn})),n.d(t,"isEverythingLoaded",(function(){return Fn})),n.d(t,"cleanTab",(function(){return Hn})),n.d(t,"stringifyTab",(function(){return Gn})),n.d(t,"updateGoToEndVisibility",(function(){return Vn})),n.d(t,"updateGoToMentionVisibility",(function(){return qn})),n.d(t,"toggleCommunityMessages",(function(){return zn})),n.d(t,"updateHistory",(function(){return Kn})),n.d(t,"syncHistory",(function(){return Wn})),n.d(t,"startRecording",(function(){return Yn})),n.d(t,"cancelRecording",(function(){return $n})),n.d(t,"setVoiceMessageAvail",(function(){return Jn})),n.d(t,"toggleConversation",(function(){return Xn})),n.d(t,"updateSearchQuery",(function(){return Qn})),n.d(t,"initializeChatResize",(function(){return Zn})),n.d(t,"joinChat",(function(){return er})),n.d(t,"getInviteLink",(function(){return tr})),n.d(t,"resetInviteLink",(function(){return nr})),n.d(t,"leaveInvitation",(function(){return rr})),n.d(t,"saveRecentSearchPeer",(function(){return ir})),n.d(t,"resetRecentSearch",(function(){return ar})),n.d(t,"removeFromRecentSearch",(function(){return or})),n.d(t,"pinMessageOptimistic",(function(){return sr})),n.d(t,"unpinMessageOptimistic",(function(){return cr})),n.d(t,"pinMessage",(function(){return ur})),n.d(t,"unpinMessage",(function(){return lr})),n.d(t,"getPinnedMessage",(function(){return dr})),n.d(t,"getMessageLocalId",(function(){return pr})),n.d(t,"getChatMembers",(function(){return hr})),n.d(t,"getChatDetails",(function(){return fr})),n.d(t,"updateFlags",(function(){return mr})),n.d(t,"removeChatPhoto",(function(){return gr})),n.d(t,"kickUserOptimisticly",(function(){return vr})),n.d(t,"kickUser",(function(){return _r})),n.d(t,"toggleAdminOptimisticly",(function(){return br})),n.d(t,"toggleAdmin",(function(){return yr})),n.d(t,"checkChatMember",(function(){return Er})),n.d(t,"hidePromoTooltip",(function(){return Or})),n.d(t,"videoAutoPlayHandler",(function(){return Cr})),n.d(t,"hideTopBannerAction",(function(){return Sr})),n.d(t,"callbackTopBannerAction",(function(){return Tr})),n.d(t,"loadBanner",(function(){return wr})),n.d(t,"setKeyboard",(function(){return Ir})),n.d(t,"deleteKeyboard",(function(){return Pr})),n.d(t,"toggleKeyboard",(function(){return jr})),n.d(t,"loadKeyboard",(function(){return kr})),n.d(t,"changeCommunityAccess",(function(){return Ar})),n.d(t,"deleteTemplate",(function(){return Rr})),n.d(t,"createTemplate",(function(){return Lr})),n.d(t,"updateTemplate",(function(){return Nr})),n.d(t,"resetTabAll",(function(){return Mr})),n.d(t,"updateMessageRequestsCounter",(function(){return Dr})),n.d(t,"updateCasperMessageExpiringStatus",(function(){return xr})),n.d(t,"prepareCasperMessagesFromMessages",(function(){return Ur})),n.d(t,"peerProfileToggleTag",(function(){return Br})),n.d(t,"peerProfileManageTags",(function(){return Fr})),n.d(t,"peerProfileSaveNote",(function(){return Hr})),n.d(t,"reloadMessage",(function(){return Gr})),n.d(t,"getPeerActiveCallData",(function(){return Vr})),n.d(t,"removePeerActiveCallData",(function(){return qr}));n("HEwt"),n("rE2o"),n("ioFf"),n("hhXQ"),n("a1Th"),n("OG14"),n("OEbY"),n("Vd3H"),n("91GP"),n("SRfc"),n("rGqo"),n("VRzm"),n("Btvt");var r=n("BxOC"),i=n("bIHZ"),a=n("f01n"),o=n("DM26"),s=n("rudk"),c=n("aong"),u=n("uytb"),l=n("P13b"),d=n("h++7"),p=n("rHUl"),h=n("MhhX"),f=n("86+7"),m=n("ERyv"),g=n("Wu9C"),v=n("lJdi"),_=n("O8ze"),b=n("zxIV"),y=n("XzvV"),E=n("ambf");function O(){return(O=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var T="al_im.php",w=5,I="typing",P="audiomessage",j=Object(i.updateLazyLocation)(),k=j.scheduleNav,A=j.commitNav,R=j.scheduleNavWithTimeOut;var L="settings",N="block",M="invite",D="media",x="search",U="pin_hide",B="pin_unhide",F="unpin",H="mute",G="unmute",V="clear",q="leave",z="return",K="block_community",W="allow_community",Y="block_notify",$="call_audio",J="call_video",X="unread",Q={[L]:0,[N]:1,[M]:2,[D]:3,[x]:6,[X]:6,[U]:7,[B]:7,[F]:8,[H]:10,[G]:10,[V]:11,[q]:12,[z]:12,[K]:12,[W]:12,[Y]:12};function Z(e,t,n){return Object(r.post)(T,{act:"a_renew_hash",peers:e.join(","),gid:t.hidegid?void 0:n.gid})}function ee(e,t,n){return function(e){return e.resync_in_process?e.resync_in_process:Promise.resolve(!1)}(e).then(r=>r?t(...n):function(e){if(!e.renew_hashes){var t=e.last_hashes_update||0;if(Date.now()-t<1e4)return Promise.resolve();var n=Object.keys(e.tabs).filter(t=>Object(l.isFullyLoadedTab)(e,t));e.renew_hashes=Z(n,{},e).then(t=>{var r=C(t,3),i=r[0],a=r[1],o=r[2];return n.forEach(t=>{e.tabs[t].hash=i[t]}),e.writeHash=a,e.manageTagsHash=o,delete e.renew_hashes,e.last_hashes_update=Date.now(),e})}return e.renew_hashes}(e).then(e=>t(...n)))}function te(e){return function(){var t=arguments,n=t[t.length-1];return e(...t).catch(r=>{if(r&&r.match&&r.match(/1001;/))return ee(n,e,t);throw r})}}function ne(e){return Object(r.post)(T,O({act:"a_get_write_hash"},e))}function re(e){return"string"==typeof e?Object(b.se)(`<div>${e}</div>`):e}function ie(e){return"string"==typeof e?e:e.innerHTML}function ae(e,t){return t.block_states=extend(t.block_states,e),Promise.resolve(t)}function oe(e,t){return t.tabs[e].can_start_call=Object(v.canStartGroupCall)(t,e),Promise.resolve(t)}function se(e,t,n,i,a){return a.tabHistoryNotChanged=!1,Object(o.retryFn)(r.post,3,e=>e-1)(T,{act:"a_start",peer:e,msgid:n,history:t,prevpeer:a.prevPeer,gid:a.gid,block:i}).then(t=>{var r=C(t,6),i=r[0],o=r[1],s=r[2],c=r[3],u=r[4],p=r[5];if(o.forEach(e=>Object(f.oCacheAdd)(a,e)),a.tabs||(a.tabs={}),a.dialog_tab_cts=Object.assign({},u,{[d.FOLDER_MESSAGE_REQUEST]:a.dialog_tab_cts[d.FOLDER_MESSAGE_REQUEST]}),a.tabs[e]||(a.tabs[e]=Object(l.normalizeTab)(a,i)),ae(c,a),n){if(a.tabs[e]){var h=a.tabs[e].lastmsg,m=a.tabs[e].lastmsg_meta;extend(a.tabs[e],i),a.tabs[e].lastmsg=h,a.tabs[e].lastmsg_meta=m}}else extend(a.tabs[e],i);return a.admins=extend(a.admins,s),a.imQueue(e,!1),Cr(),p&&(a.tabs[e].peer_profile_info=p),ce(e,a)}).catch(e=>Object(m.imWeirdCatch)("loadPeer",e))}function ce(e,t){var n=t.imQueue(e,!1),r=t.tabs[e],i=n.filter(n=>!Object(p.isRidExist)(t,e,n.rid));return r.msgs=i.reduce((e,t)=>(e["rid"+t.rid]=t.mess,e),r.msgs),t.imQueueSet(e,i),t.tabs[e].history=Object(l.restoreQueue)(i,t,re(t.tabs[e].history)),Promise.resolve(t)}function ue(e,t,n,r){var i=r.imQueue(t),a=[],o=[];return i.forEach(e=>{e.failed&&n&&e.mess.messageId!==n&&o.push(e),!e.failed||n&&e.mess.messageId!==n||a.push("rid"+e.rid)}),r.imQueueSet(t,o),r.tabs[t].history=Object(l.removeMessages)(a,re(r.tabs[t].history)),Object(l.removeMessages)(a,e),Promise.resolve(r)}function le(e,t,n){var r=n.imQueue(t),i=[],a=[],o=Date.now();return r.forEach(e=>{e.failed&&o-e.ts<864e5&&a.push(e),e.failed&&o-e.ts>=864e5&&i.push("rid"+e.rid)}),n.imQueueSet(t,a),n.tabs[t].history=Object(l.removeMessages)(i,re(n.tabs[t].history)),Object(l.removeMessages)(i,e),Promise.resolve(n)}function de(e,t){return!1===(t.block_states[e]||{}).free?Promise.resolve(t):Object(r.post)(T,{act:"a_block",peer:e,prevPeer:t.prevPeer,gid:t.gid}).then(e=>ae(C(e,1)[0],t))}function pe(e,t){var n=t.peer;return Promise.resolve(t).then(t=>(t.tabHistoryNotChanged=!1,Object(l.isFullyLoadedTab)(t,n)&&!t.tabs[n].msgid?(t.gid&&de(n,t),Promise.resolve(t).then(ve)):(Object(l.isFullyLoadedTab)(t,n)&&(t.tabs[n].msgid=!1),se(n,e,!1,!0,t)))).then(ve).then(he.bind(null,n))}function he(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(l.isTabLoaded)(t,e)&&(t.tabs[e].last_touched=Date.now()),Object(l.isTabLoaded)(t,e)&&n&&(t.tabs[e].last_visited=Date.now()),t}function fe(e,t,n){var r=n.msgid,i=n.peer;return!e&&Object(l.isFullyLoadedTab)(n,i)&&n.tabs[i].msgs[r]?(t===n.peer?n.tabHistoryNotChanged=!0:n.tabHistoryNotChanged=!1,n.gid&&de(i,n),Promise.resolve(n).then(ve).then(he.bind(null,i))):se(i,!0,r,!0,n).then(ve).then(()=>(Object(p.getTab)(n,i).msgid=r,n)).then(he.bind(null,i))}function me(e,t,n,r){if(yn(r))throw Object(l.showWaitUntilUploadedBox)(),new Error("Cant change peer while loading something");var i=r.gid?"gim"+r.gid:"im";if(r.prevPeer=r.peer,r.peer=e,r.msgid=t||"",r.currentEntryPoint=n,cur.peer=e,k({sel:e?Object(l.convertPeerToUrl)(e):null,msgid:r.msgid,email:"",0:i}),0!=r.prevPeer&&he(r.prevPeer,r,!0),0!==e){Object(l.isTabLoaded)(r,e)&&he(e,r,!0),Bn(r.tabbedPeers.map(e=>e.peer).indexOf(e)<0?[{peer:e,type:"perm"}].concat(r.tabbedPeers):r.tabbedPeers.map(t=>(t.peer==e&&"perm"!==t.type&&(t.type="perm"),t)),!1,r)}else Bn(r.tabbedPeers,!1,r);return A(),yt(r.prevPeer,r)}function ge(e){var t=e.isMassMentionsMessageAllowed;cur.wallMentions=()=>new Promise((n,r)=>{if(cur.wallMentions=[],!Object(l.isChatPeer)(e.peer)||!Object(l.isFullyLoadedTab)(e,e.peer)||Object(l.isFvkcomgroup)(e,e.peer))return r();var i=e.tabs[e.peer];function a(){var r=[];Object.keys(i.msgs||{}).reverse().forEach(e=>{var t=Object(p.parserMessage)(i.msgs[e]),n=t&&t.userId;n&&n!=vk.id&&-1===r.indexOf(n)&&Object(l.isUserAliveInChat)(i,n)&&r.push(n)}),(i.memberIds||[]).forEach(e=>{-1===r.indexOf(e)&&r.push(e)});var a=[];r.forEach(t=>{if(Object(f.oCacheExists)(e,t)){var n=Object(f.oCacheGet)(e,t),r=n.link.substring(1);a.push([n.id,n.name,"@"+r,n.photo,void 0,void 0,void 0,r,n.first_name,""])}});var o=getLang("mail_im_mention_all"),s=getLang("mail_im_mention_online");t&&Object(v.canMassMention)(e)&&a&&a.length>1&&(d.MASS_MENTION_ALIASES.online.forEach(e=>a.push(["online",s,"@"+e,"/images/mention_online.svg",void 0,void 0,void 0,e,e,""])),d.MASS_MENTION_ALIASES.all.forEach(e=>a.push(["all",o,"@"+e,"/images/mention_all.svg",void 0,void 0,void 0,e,e,""]))),n(a)}i.membersLoaded?a():hr(e.peer,e).then(a)})}function ve(e){var t=e.peer;if(0===t)return Promise.resolve(e);var n=e.tabs[t],r=Object(l.isChatPeer)(t),i=Object(p.isChannelPeer)(n),a=Object(p.isCommunityChat)(e,t),o=r&&!Object(p.isChatActive)(n),s=!!n.offset,c=[];s&&c.push(D),s&&c.push(x),0===n.unread&&c.push(X),!Object(l.isEmailPeer)(t)&&!s||i||c.push(V),!Object(l.isCommunityInterface)(e)||i||a||c.push(N),i&&!o&&c.push(L),Object(l.isCommunityPeer)(t)&&(n.can_send_notify?c.push(Y):c.push(n.blocked_community?W:K)),!Object(l.isCommunityInterface)(e)&&(r||Object(l.isUserPeer)(t)||Object(l.isCommunityPeer)(t))&&(!r||!o)&&c.push(inArray(t,e.mutedPeers)?G:H);var u=!Object(l.isCommunityInterface)(e)&&Object(l.isUserPeer)(t)&&n.is_friend&&!n.block_error,d=r&&!o&&Object(v.canInviteUser)(e);(u||d)&&c.push(M),!r||o||Object(l.isCommunityInterface)(e)||c.push(q),r&&n.data.closed&&!n.data.kicked&&c.push(z),r&&n.pinned&&(c.push(Object(g.isPinnedMessageVisibleInTab)(e,t)?U:B),Object(v.canPinOrUnpin)(e)&&c.push(F));var h=Object(l.chatActions)(e,i);return e.curActions=c.sort((e,t)=>Q[e]-Q[t]).reduce((e,t)=>(e[t]=h[t],e),{}),Promise.resolve(e)}function _e(e,t,n){var i=n.tabs[n.peer];return Object(r.post)(T,{peer:n.peer,whole:e,act:"a_history",offset:i.offset+(i.skipped||0),toend:t,gid:n.gid}).then(e=>{var t=C(e,4),r=t[0],a=t[1],o=t[2],s=t[3];return i.allShown=o,n.admins=extend(n.admins,s),i.history=r+ie(i.history),i.historyToAppend=r,i.offset+=Object.keys(a).length,i.msgs=extend(i.msgs,a),n})}function be(e){var t=e.tabs[e.peer];return Object(r.post)(T,{peer:e.peer,act:"a_history",rev:1,offset:t.skipped,gid:e.gid}).then(n=>{var r=C(n,5),i=r[0],a=r[1],o=r[2];r[3],r[4];t.allShown=t.allShown||o,t.history=ie(t.history)+i,t.historyToAppend=i;var s=Object.keys(a).length;return t.skipped-=s,t.offset+=s,t.msgs=extend(t.msgs,a),e})}function ye(e,t,n,r){var i=e.tabs[t];return r===a.FLAG_OUTBOUND&&i.out_up_to>n||(r===a.FLAG_OUTBOUND?i.out_up_to=n:i.in_up_to=n),e}var Ee=te((function(e,t){if(Object(l.tabIsMessageRequest)(t.tabs[e]))return Promise.resolve(t);var n=t.tabs[e],i=n.msgs||{},o=Object.keys(i).map(n=>Object(p.getMessage)(t,e,n)).filter(e=>!Object(h.isOut)(e)).map(e=>e.messageId).sort((e,t)=>t-e);return n.skipped>0&&(o=o.filter(e=>intval(e)<=n.lastmsg-n.skipped)),(o=intval(o.shift()))<=n.in_up_to?Promise.resolve(t):(t.longpoll.push([a.readInboundEvent([6,e,o,null])]),Object(r.post)(T,{peer:e,ids:[o],hash:n.hash,act:"a_mark_read",gid:t.gid}).then(()=>ye(t,e,o,a.FLAG_OUTBOUND)).catch(()=>t))})),Oe=te((function(e,t,n){if(Object(l.tabIsMessageRequest)(n.tabs[t]))return Promise.resolve(n);var i=n.tabs[t];return e<=i.in_up_to?Promise.resolve(n):(n.longpoll.push([a.readInboundEvent([6,t,e,null])]),Object(r.post)(T,{peer:t,ids:[e],hash:i.hash,act:"a_mark_read",gid:n.gid}).then(()=>ye(n,t,e,a.FLAG_OUTBOUND)))})),Ce=te((function(e,t,n){var i=n.tabs[e];return Object(r.post)(T,{peer:e,id:t,hash:i.hash,act:"a_mark_listened",gid:n.gid})}));function Se(e){return Object(r.post)(T,{act:"a_get_key",uid:e.id,gid:e.gid}).then(t=>{var n=C(t,3),r=n[0],i=n[1],a=n[2];return extend({},e,{imKey:r,imUrl:i,imPart:a})})}function Te(e){return Object(r.post)(T,{act:"a_get_ts",gid:e.gid}).then(t=>{var n=C(t,1)[0];return extend({},e,{imTs:n})})}function we(e,t,n){var r=n.tabs[e];return r.msgs[t.messageId]&&(r.msgs[t.messageId].errored=1,r.history=Object(l.setMessageError)(e,t,re(r.history))),Promise.resolve(n)}function Ie(e,t,n,r){var i=r.tabs[e];return i.msgs[t]&&(i.msgs[t].errored=0,i.lastmsg_meta=n,i.lastmsg=t,i.history=Object(l.startResendMessage)(e,t,re(i.history))),Promise.resolve(r)}function Pe(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];t.deletedDialog||(e.dialog_tabs=Object.keys(e.dialog_tabs).reduce((e,a)=>(!n&&!Tn(a)(t)||i&&!i(a,e[a],t)||(e[a]=Object(c.arrayUnique)(r(e[a],a))),e),e.dialog_tabs))}function je(e,t){return 0===e.length?Promise.resolve(t):Object(r.post)(T,{act:"a_get_admin",admins:e.join(","),gid:t.gid}).then(e=>{var n=C(e,1)[0];return t.admins=extend(t.admins,n),t})}function ke(e,t){if(!inArray(e,t.tabbedPeers.map(e=>e.peer))&&(0!==t.peer||t.searchText)&&!inArray(e,t.mutedPeers)){var n={peer:e,type:"temp"};Bn(t.tabbedPeers.concat([n]),!1,t)}}function Ae(e,t,n){return Object(l.isReversedDialogs)(n)?t.concat([e]):[e].concat(t)}function Re(e,t){var n=e.get().peer,r=Object(p.getTab)(e,n);if(Object(l.isFullyLoadedTab)(e,n)){var i=re(r.history);r.history=Object(l.updateMessageInCache)(e,i,t)}}function Le(e,t){var n=Object(p.getTab)(t,e.peerId);if(Object(l.isFullyLoadedTab)(t,e.peerId)){var r=re(n.history);n.msgs[e.messageId]=extend(!0,{},e),n.history=Object(l.editAndReplaceMessage)(t,e,r)}n&&n.lastmsg===e.messageId&&(n.lastmsg_meta=e);var i=n&&n.pinned&&Object(p.parserMessage)(n.pinned);if(i&&i.messageId===e.messageId&&(n.pinned=e),Object(l.isTabLoaded)(t,e.peerId)&&!Object(h.isOut)(e)&&Object(h.isUnread)(n,e)){var a=Object(h.hasUserMentions)(e,t.id),o=n.mentions&&n.mentions.includes(e.messageId);a&&!o?(n.mentions||(n.mentions=[]),n.mentions.push(e.messageId)):!a&&o&&xe(e.peerId,t=>t!==e.messageId,t)}return Promise.resolve(t)}function Ne(e,t){var n=e.flags&a.FLAG_OUTBOUND,r=e.peerId;if(Object(l.isTabLoaded)(t,r)){var i=t.tabs[r];if(i.deletedDialog=!1,!t.msg_local_ids_sort&&e.local?t.msg_local_ids_sort={[e.messageId]:0}:e.local&&(t.msg_local_ids_sort[e.messageId]=Object.keys(t.msg_local_ids_sort).length),n||Object(l.tabIsMessageRequest)(i)?i.unread=0:(i.lastmsg===e.messageId&&i.unread?Me(t,1,e.peerId):(!i.unread&&Me(t,1,e.peerId),i.unread++),E.casperMessagesStore.has(e.messageId)&&!Object(p.isCasperChatTab)(i)&&(i.expiring_messages||(i.expiring_messages=[]),i.expiring_messages.push(e.messageId)),Object(h.hasUserMentions)(e,t.id)&&(i.mentions||(i.mentions=[]),i.mentions.push(e.messageId)),ke(e.peerId,t)),Object(l.isFullyLoadedTab)(t,r)){var o=Object(h.isMessageToBlockedCommunity)(i,e),s=o||0===i.offset;o&&(i.blocked_community=0),i.skipped>0&&i.skipped++,i.offset++,i.msgs[e.messageId]=extend(!0,{},e);var c=re(i.history);i.history=Object(l.appendToHistory)(t,e,c,!0,!0,!0),s&&ve(t)}if(i.typing){var u=i.typing.userIds.indexOf(e.userId);u>=0&&i.typing.userIds.splice(u,1)}return i.lastmsg=e.messageId,i.lastmsg_meta=e,Number.isInteger(e.messageId)&&e.messageId>(i.minor_sort_id||0)&&(i.minor_sort_id=e.messageId),he(e.peerId,t),Pe(t,i,!1,Ae.bind(null,r),In.bind(null,t)),Promise.resolve(t)}return se(r,0,0,0,t).then(t=>(Pe(t,t.tabs[r],!1,Ae.bind(null,r),In.bind(null,t)),he(e.peerId,t),n||ke(e.peerId,t),t))}function Me(e,t,n){e.cur_unread_cnt||(e.cur_unread_cnt={}),-1===t&&delete e.cur_unread_cnt[n],e.unread_cnt+=t}function De(e,t,n){var r=n.tabs[e];return r.expiring_messages&&(r.expiring_messages=r.expiring_messages.filter(t),r.expiring_messages.length||delete r.expiring_messages),n}function xe(e,t,n){var r=n.tabs[e];return r.mentions&&(r.mentions=r.mentions.filter(t),r.mentions.length||delete r.mentions),n}function Ue(e,t){var n=Object(p.getTab)(t,e.peerId);if(Object(l.isFullyLoadedTab)(t,e.peerId)){var r=n.unread;if(t=ye(t,e.peerId,e.upToId,0),null!==e.unread?n.unread=e.unread:n.unread=e.upToId>=n.lastmsg?0:Object(p.countUnread)(e.peerId,t)+(n.unread>0?+n.skipped:0),r>0&&!n.unread&&Me(t,-1,e.peerId),!n.skipped){var i=re(n.history);n.history=Object(l.removewNewUnreadBarAndMerge)(t,i,e.peerId)}}else Object(l.isTabLoaded)(t,e.peerId)&&(t.tabs[e.peerId].unread>0&&Me(t,-1,e.peerId),t.tabs[e.peerId].unread=0,t.tabs[e.peerId].in_up_to=e.upToId);return Object(l.isTabLoaded)(t,e.peerId)&&e.upToId>=n.lastmsg&&(t.dialog_tabs[d.FOLDER_UNREAD]=t.dialog_tabs[d.FOLDER_UNREAD].filter(t=>intval(t)!==e.peerId)),Object(l.isTabLoaded)(t,e.peerId)&&(De(e.peerId,t=>t>e.upToId,t),xe(e.peerId,t=>t>e.upToId,t)),0!==t.unread_cnt||t.active_tab!==d.FOLDER_UNREAD||t.gid?Promise.resolve(t):wn(d.FOLDER_ALL,t)}function Be(e,t){var n=t.tabs[e.peerId];if(Object(l.isTabLoaded)(t,e.peerId)&&ye(t,e.peerId,e.upToId,a.FLAG_OUTBOUND),Object(l.isFullyLoadedTab)(t,e.peerId)){var r=re(n.history);n.history=Object(l.markMessagesAsRead)(t,e.peerId,r)}return Promise.resolve(t)}function Fe(e,t,n,r,i){return i.text={},i.imQueue=e,i.imQueueResend=t,i.imQueueSet=n,i.imQueueComplete=r,Promise.resolve(i)}function He(e,t,n){function r(e,t){return{id:e.messageId,text:e.text,date:e.date,kludges:e.kludges,authorName:t}}if(1===e.length){var i=e[0],a=Object(p.getMessage)(n,t,i),o=Object(p.getAuthorFullName)(n,t,i);return!1===o?n.set(Wt.bind(null,{[t]:[a.userId]})).then(n=>{var o=Object(p.getAuthorFullName)(n,t,i);return{msgIds:e,object:r(a,o)}}):Promise.resolve({msgIds:e,object:r(a,o)})}return Promise.resolve({msgIds:e})}function Ge(e,t){Object(l.normalizeTabsGotFromServer)(t,e);var n=t.tabs[t.peer];return t.tabs=Object.keys(e).reduce((n,r)=>{var i=t.tabs[r]?t.tabs[r].msgs:{},a=extend({},i||{},e[r].msgs||{});return n[r]=extend(t.tabs[r]||{},e[r]),a&&(n[r].msgs=a),e[r].lastmsg||(n[r].lastmsg=!1),n},t.tabs),n&&(t.tabs[t.peer]=n),Promise.resolve(t)}function Ve(e,t,n,r){var i=Object(p.getTab)(r,e);if(i&&i.last_seen&&i.last_seen.can_see){var a=!1!==t?mobPlatforms[t]?1:0:i.last_seen.mobile;i.online=t,i.last_seen={platform:t,time:n||i.last_seen.time,mobile:a,can_see:i.last_seen.can_see}}return Promise.resolve(r)}function qe(e,t,n){var r=Object(p.getTab)(n,e.peerId);return r&&(e.ts=Date.now()/1e3,r.activity||(r.activity={}),r.activity[t]=e,r.typing===I&&(r.typing=e)),Promise.resolve(n)}function ze(e,t){var n=Object(p.getTab)(t,e.peerId),r=Object(h.isAudioMsg)(e)?"audiomessage":"typing";return n&&n.activity&&n.activity[r]&&(n.activity[r].userIds=n.activity[r].userIds.filter(t=>t!==e.userId)),Promise.resolve(t)}function Ke(e,t,n){var r=e.peerId;return Object(o.pause)(w+2).then(()=>{if(Object(l.isTabLoaded)(n,r)){var e=n.tabs[r];if((e.activity||{})[t])Date.now()-1e3*e.activity[t].ts>=1e3*w&&(delete e.activity[t],0===Object.keys(e.activity)&&delete e.activity);if(e.typing)Date.now()-1e3*e.typing.ts>=1e3*w&&(e.typing=void 0)}return n})}function We(e){var t={},n=e.find(e=>"poll"===e[0]);if(n){var r=C(n,3)[2];Object.assign(t,r)}return t}var Ye=function(e,t,n,i){var a=Date.now()+rand(0,100).toFixed(0),o=i.ref_id,c=i.ref_source;i.ref_source=void 0,i.ref_id=void 0,(c||o)&&(k({ref_source:null,ref:null}),A()),Object(_.statlogsSendingQueueLength)(i);var u=t.attaches.length>0,l=Object(_.statlogsSendingTime)(i,"send","server",u),d=Object.assign({act:"a_send",to:e,hash:n.hash,ref_source:c,ref:o,msg:t.message,payload:t.payload,media:Object(s.convertAttachesToPhpMedia)(t.attaches),guid:a,share_url:t.share_url,cancelled_shares:t.cancelled_shares,random_id:t.rid,gid:n.hidegid?void 0:i.gid,entrypoint:i.currentEntryPoint||"",sticker_referrer:t.sticker_referrer},n.external,We(t.attaches));return Object(r.post)(T,d,2e4).then(e=>{var t=C(e,1)[0];return l(),i.version!==t.version&&nav.reload({force:!0}),i.currentEntryPoint="",i}).catch(e=>{throw Object(_.statlogsSendingError)(i,e,"send","server_send"),e})},$e=te((function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,i=r.tabs[e];return Ye(e,t,O({hash:i.hash},n),r)})),Je=te((function(e,t,n){var i=t.attaches.length>0,a=Object(_.statlogsSendingTime)(n,"edit","server",i);return Object(r.post)(T,Object.assign({act:"a_edit_message",hash:e.hash,id:t.messageId,peerId:e.peerId,gid:n.gid,msg:t.origText,media:Object(s.convertAttachesToPhpMedia)(t.attaches),share_url:t.share_url,cancelled_shares:t.cancelled_shares},We(t.attaches)),2e4).then(e=>{C(e,1)[0];return a(),n}).catch(e=>{throw Object(_.statlogsSendingError)(n,e,"edit","server_send"),e})}));function Xe(e,t){if(t.selectedMessages||(t.selectedMessages=[]),1===e.length&&inArray(e[0],t.selectedMessages))t.selectedMessages=t.selectedMessages.filter(t=>t!==e[0]);else{var n=t.selectedMessages.concat(e);t.selectedMessages=Object(c.arrayUnique)(n).sort((e,t)=>e-t)}return Promise.resolve(t)}function Qe(e){return e.selectedMessages=[],Promise.resolve(e)}function Ze(e){return e.selectedMessages=[],Promise.resolve(e)}function et(e,t){if(Object(l.isFullyLoadedTab)(t,e.peerId)){var n=t.tabs[e.peerId],r=t.imQueue(e.peerId).filter(t=>t.failed&&t.rid!==e.randomId);t.imQueueSet(e.peerId,r),t.imQueueComplete(e.peerId,e.randomId),n.lastmsg_meta=e,n.lastmsg=e.messageId,Number.isInteger(e.messageId)&&e.messageId>n.minor_sort_id&&(n.minor_sort_id=e.messageId),n.msgs["rid"+e.randomId]&&(n.msgs[e.messageId]=e,delete n.msgs["rid"+e.randomId]),n.history=Object(l.replaceMessageAttrs)(t,re(n.history),e)}return Promise.resolve(t)}function tt(e,t){return Promise.resolve()}function nt(e,t){var n=Object(_.statlogsSendingTime)(t,"unknown","attach"),i={act:"a_get_media",id:e.messageId,gid:t.gid};return Object(o.retryFn)(r.post,3,e=>e*e)(T,i).then(r=>(n(),rt(e,r,t))).catch(n=>(Object(_.statlogsSendingError)(t,n,"unknown","server_load_attach"),rt(e,null,t)))}function rt(e,t,n){var r=n.tabs[e.peerId],i=t&&t[2];return r.mediacontent||(r.mediacontent={}),r.mediacontent[e.messageId]=t||[getTemplate("im_retry_link")],i&&(i.no_forward&&(r.msgs[e.messageId].kludges.no_forward=!0),i.no_pin&&(r.msgs[e.messageId].kludges.no_pin=!0)),it(e,n)}function it(e,t){var n=t.tabs[e.peerId];return n.history=Object(l.replaceAttaches)(re(n.history),e,t),Promise.resolve(t)}function at(e,t,n){var r=Object(l.dayFromVal)(t),i=n.tabs[e];return i.searchDay=r,i.searchOffset=0,i.searchAllLoaded=!1,i.searchMsgs=[],Promise.resolve(n)}function ot(e,t,n){return n.tabs[t].searchText=e,Ot(t,n),n}function st(e,t,n){if(t){var r=n.tabs[t];r.searchText=e,r.searchOffset=0,r.searchAllLoaded=!1}else n.searchText=e,n.searchOffset=0,n.searchAllLoaded=!1;return Promise.resolve(n)}function ct(e,t,n,i,a){return Object(r.post)(T,{act:"a_hints",str:e,gid:i.hidegid?0:a.gid,query:n,peerIds:t.join(",")}).then(t=>{var n=C(t,3),r=n[0],i=n[1];if(ae(n[2],a),i.forEach(e=>Object(f.oCacheAdd)(a,e)),Ge(r,a),e){var o=r&&Object.keys(r).length;Object(y.saveSearchAttemptStats)(y.serviceMessages,0,o,e)}return Object.keys(r).sort((e,t)=>r[e].order-r[t].order).map(e=>r[e])})}function ut(e,t,n,r){return ct(e,t,n,{},r).then(e=>e.map(e=>({peerId:e.peerId,name:e.tab,photo:e.photo,online:e.online,is_friend:"friends"===n})))}function lt(e){var t={peerId:e[0],name:e[1],tab:e[1],photo:e[2],href:e[3],online:e[4],is_friend:e[5],local_index:!0};return e[6]&&(t.data={flags:e[6]}),t}function dt(e){return(t,n)=>e(n).then(e=>{var r=(t?e.search(t):e.list).map(lt);return n.mapped_index||(n.mapped_index={}),r.forEach(e=>{n.mapped_index[e.peerId]=e}),r})}var pt=dt(e=>e.topConvTree),ht=dt(e=>e.imTopConvTree),ft=dt(e=>e.hintsTree);function mt(e,t){var n,i,a;t.topConvTree=new Promise(e=>{n=e}),t.hintsTree=new Promise(e=>{i=e}),t.imTopConvTree=new Promise(e=>{a=e});var s=e.select(u.RECENT_SEARCH_OP);return Object(o.retryFn)(r.post,1,()=>4)(T,{act:"a_dialogs_preload",rs:s.join(","),gid:t.gid}).catch(e=>[[],[],[]]).then(e=>{var r=C(e,4),o=r[0],s=r[1],c=r[2],u=r[3];return t.popular_sugg=c,new vkIndexer(o,e=>e[1],n),new vkIndexer(s,e=>e[1],i),u&&u.length>0?new vkIndexer(u,e=>e[1],a):a(),t})}function gt(e){var t,n,i=e.active_tab,a=e.dialog_tabs[i];return a.length>0?a.forEach(r=>{var i=e.tabs[r],a=i.minor_sort_id,o=i.major_sort_id;void 0===t||t>o?(t=o,n=a):t===o&&n>a&&(n=a)}):(t=0,n=0),Object(r.post)(T,{act:"a_get_dialogs",start_message_id:n,major_sort_id:t,tab:i,gid:e.gid}).then(t=>{var n=C(t,4),r=n[0],o=n[1],s=n[2],c=n[3];return s.forEach(t=>Object(f.oCacheAdd)(e,t)),ae(c,e),Ge(o,e),e.dialog_tabs[i]=a.filter(e=>!o[e]).concat(Object.keys(o).map(intval)),e.dialog_tabs_all[i]=!r.has_more,Promise.resolve(e)})}var vt=te((function(e,t){return Object(r.post)(T,{act:"a_search",q:e,from:"all",gid:t.gid,hash:t.writeHash,offset:t.searchOffset||0}).then(n=>{var r=C(n,5),i=r[0],a=r[1],o=r[2],s=r[3],c=r[4];return a.forEach(e=>Object(f.oCacheAdd)(t,e)),Object(l.normalizeTabsGotFromServer)(t,i),e===t.searchText&&(t.searchOffset=s,t.searchAllLoaded=c),Object.keys(i).filter(e=>!t.tabs[e]).forEach(e=>{t.tabs[e]=i[e]}),[i,o]})}));function _t(e,t){return t.tabs[e].searchAllLoaded}function bt(e,t){return!(t.peer!==e||!Object(l.isFullyLoadedTab)(t,e))&&t.tabs[e].inplaceSearch}function yt(e,t){if(Object(l.isFullyLoadedTab)(t,e)){var n=t.tabs[e];delete n.inplaceSearch,delete n.searchOffset,delete n.searchAllLoaded,delete n.searchText,delete n.searchDay,delete n.searchMsgs,k({st:""}),A()}return Promise.resolve(t)}function Et(e,t){if(Object(l.isFullyLoadedTab)(t,e)){var n=t.tabs[e];delete n.searchDay,n.searchOffset=0,n.searchAllLoaded=!1,n.searchMsgs=[]}return Promise.resolve(t)}function Ot(e,t){return t.tabs[e].inplaceSearch=!0,Promise.resolve(t)}var Ct=te((function(e,t){var n=t.tabs[e],i="";if(Ot(e,t),n.searchDay&&(i="day:"+n.searchDay),!i&&!n.searchText)return Promise.reject();var a=`in:${e} ${i} ${n.searchText||""}`;return k({st:n.searchText}),A(),Object(r.post)(T,{act:"a_search",q:a,from:"in",gid:t.gid,hash:t.writeHash,offset:n.searchOffset||0}).then(e=>{var t=C(e,4),r=t[0],i=t[1],a=t[2],o=t[3];return n.searchOffset=i,n.searchAllLoaded=a,n.searchMsgs=(n.searchMsgs||[]).concat(o),r})}));function St(e){return Object(r.post)(T,{act:"a_important",offset:e,part:e>0})}function Tt(e,t){var n=Object(p.getTab)(e,t);return Object(r.post)(T,{act:"a_load_lastmsg",peerId:t,gid:e.get().gid}).then(r=>{var i=C(r,4),a=i[0],o=i[1],s=i[2],c=i[3],u=intval(a[0]);n.lastmsg=u||!1,n.lastmsg_meta=a,(!Object(p.isCasperChat)(e,t)||u>n.minor_sort_id)&&(n.minor_sort_id=u);var l=C(o,3);n.unread=l[0],n.in_up_to=l[1],n.out_up_to=l[2],s?n.mentions=s:n.mentions&&delete n.mentions,c?n.expiring_messages=c:n.expiring_messages&&delete n.expiring_messages,n.unread||(e.get().dialog_tabs[d.FOLDER_UNREAD]=e.get().dialog_tabs[d.FOLDER_UNREAD].filter(e=>e!=t)),Pe(e.get(),n,!1,Ae.bind(null,t),In.bind(null,e.get()))})}function wt(e,t,n){n.tabs[e].unread-=t.length;var r=t.reduce((e,t)=>(e[t]=!0,e),{});return De(e,e=>!r[e],n),xe(e,e=>!r[e],n),Promise.resolve(n)}function It(e,t,n){if(Object(l.isFullyLoadedTab)(n,t)){var r=n.tabs[t];r.deleted=r.deleted?r.deleted.concat(e):e}return Promise.resolve(n)}function Pt(e,t,n){if(Object(l.isFullyLoadedTab)(n,t)){var r=n.tabs[t];if(r.history=Object(l.removeMessages)(e,re(r.history)),r.offset-=e.filter(e=>r.msgs[e]).length,e.forEach(e=>delete r.msgs[e]),e.forEach(e=>{var t=(n.selectedMessages||[]).indexOf(e);-1!=t&&n.selectedMessages.splice(t,1)}),r.inplaceSearch){var i=e.reduce((e,t)=>(e[t]=!0,e),{});r.searchMsgs=r.searchMsgs.filter(e=>!i[e]),r.searchOffset=r.searchMsgs.length}}return Promise.resolve(n)}var jt=te((function(e,t,n,i,a){return Object(r.post)(T,{act:"a_mark",peer:t,hash:n||a.tabs[t].hash,gid:a.gid,msgs_ids:e.join(","),mark:i})}));function kt(e,t,n,r){if(Object(l.isFullyLoadedTab)(r,t)){var i=r.tabs[t];i.deleted=i.deleted?i.deleted.concat(e):e,i.history=Object(l.removeMessagesWithRestore)(e,t,n,re(i.history)),i.offset-=e.filter(e=>i.msgs[e]).length}return Promise.resolve(r)}function At(e,t,n){if(Object(l.isFullyLoadedTab)(n,t)){var r=n.tabs[t];r.deleted&&(r.deleted=r.deleted.filter(t=>t!==e)),r.history=Object(l.restoreMessage)(e,t,re(r.history)),r.offset++}return Promise.resolve(n)}function Rt(e,t,n,i){return Object(r.post)(T,{act:"a_restore",id:e,peer:t,hash:n,gid:i})}var Lt=te((function(e,t,n){return Object(l.tabIsMessageRequest)(n.tabs[e])?Promise.resolve(n):(n.tabs[e].lastTyping=Date.now(),Object(r.post)(T,{act:"a_activity",type:t,peer:e,gid:n.gid,hash:n.tabs[e].hash}).then(()=>n,()=>n))})),Nt=te((e,t)=>Object(r.post)(T,{act:"a_accept_message_request",peer_id:e,hash:t.tabs[e].hash}).then(()=>{var n=t.tabs[e];return n.is_message_request=!1,n.folders=Object(p.removeMessageRequestFolderFlags)(n.folders),t})),Mt=te((e,t)=>Object(r.post)(T,{act:"a_reject_message_request",peer_id:e,hash:t.tabs[e].hash}).then(()=>(Pe(t,t.tabs[e],!0,t=>t.filter(t=>t!==Number(e))),Bn(t.tabbedPeers.filter(t=>t.peer!==e),!0,t),t))),Dt=te((e,t,n)=>Object(r.post)(T,{act:"a_cancel_message_request",peer_id:e,contact_id:t,hash:n.tabs[e].hash}).then(()=>{var r=n.tabs[e];return r&&r.invitedByMessageRequest&&(r.invitedByMessageRequest=r.invitedByMessageRequest.filter(e=>e.id!==t)),n})),xt=te((function(e,t){return Lt(e,I,t)})),Ut=te((function(e,t){return Lt(e,P,t)}));function Bt(e,t,n,r){return t&&(r.pendingForward=null,e||(e={msgIds:[]}),t.addAttach(n?"reply":"mail",e.msgIds.join(";"),e.object||null)),Promise.resolve(r)}function Ft(e,t){return t.pendingForward=e,Promise.resolve(t)}function Ht(e,t,n){if(!Object(l.isTabLoaded)(n,e))return n;n.blockedFlagUpdates||(n.blockedFlagUpdates={}),n.blockedFlagUpdates[e]=!0;var r=n.tabs[e];return Pe(n,r,!0,t=>t.filter(t=>t!==e)),r.unread>0&&!Object(l.tabIsMessageRequest)(r)&&Me(n,-1,e),r.deletedDialog=!0,Bn(n.tabbedPeers.filter(t=>t.peer!==e),!0,n),t.then(t=>{var i=C(t,2);i[0],i[1];return delete n.blockedFlagUpdates[e],r.msgs=null,r.history=null,r.unread=0,r.lastmsg=!1,r.lastmsg_meta=null,r.minor_sort_id=0,n})}var Gt=te((function(e,t){return Ht(e,Object(r.post)("al_im.php",{act:"a_flush_history",id:e,from:"im",gid:t.gid,hash:t.tabs[e].hash}),t)})),Vt=te((function(e,t,n){return Object(r.post)(T,{act:"a_set_chat_title",peer:e,new_title:t,gid:n.gid,hash:n.tabs[e].hash}).then(()=>(n.onUpdate&&n.onUpdate(),n))})),qt=te((function(e,t){return Object(r.post)(T,{act:"a_load_chat_info",peer:e,gid:t.gid,hash:t.tabs[e].hash}).then(n=>{var r=C(n,1)[0];return t.tabs[e]=extend(t.tabs[e],r),t})}));function zt(e,t,n){var r=n.tabs[e];return r.memberIds=[].concat(r.memberIds,t).filter((e,t,n)=>n.indexOf(e)===t),r.membersCount=r.memberIds.length,Promise.resolve(n)}var Kt=te((function(e,t,n,i){return Object(r.post)(T,{act:"a_add_chat_members",peer:e,new_peer:t.join(","),gid:i.gid,hash:i.tabs[e].hash,show_history:n?1:0}).then(e=>i)}));function Wt(e,t){if(isEmpty(e))return Promise.resolve(t);var n=Object.keys(e).map(t=>`${t}:${e[t].join(",")}`).join(";");return Object(r.post)(T,{act:"a_load_member",need:n,gid:t.gid}).then(e=>(C(e,1)[0].forEach(e=>Object(f.oCacheAdd)(t,e)),t))}function Yt(e,t,n){var r={},i=n.get();function o(e,t){Object(l.isChatPeer)(e)&&t&&!Object(f.oCacheExists)(i,t)&&(r[e]?-1===r[e].indexOf(t)&&r[e].push(t):r[e]=[t])}var s=t.filter(e=>!Object(l.isTabLoaded)(i,e.peerId)).map(e=>e.peerId);t.forEach(e=>{o(e.peerId,e.userId)}),e.forEach(e=>{o(e.peerId,+e.kludges.source_mid||+e.kludges.from)});var c=t.filter(e=>e.flags&a.FLAG_OUTBOUND&&!e.local).map(e=>e.kludges.from_admin).filter(e=>e&&!i.admins[e]);return 0===Object.keys(r).length&&0===c.length&&0===s.length?Promise.resolve(i):{shouldLoad:Object.keys(r).length>0||c.length>0||s.length>0,needMembers:r,needAdminIds:c,needPeers:s}}function $t(e,t,n){var r=e.needMembers,i=e.needAdminIds,a=e.needPeers;return t.pause(),Promise.all([Wt(r,n),je(i,n),Promise.all(a.map(e=>se(e,0,0,0,n)))]).catch(()=>n).then(()=>t.resume()).then(()=>n)}var Jt=te((function(e,t){return e.kludges.source_act===l.CHAT_PHOTO_REMOVE?(delete t.tabs[e.peerId].photo,delete t.tabs[e.peerId].photoLarge,Promise.resolve(t)):(t.onUpdate&&t.onUpdate(),Object(r.post)(T,{act:"a_get_chat_photo",msg_id:e.messageId}).then(n=>{var r=C(n,2),i=r[0],a=r[1];t.chat_photo_msg=a;var o=t.tabs[e.peerId];if(t.tabs[e.peerId].photo=i[0],t.tabs[e.peerId].photoLarge=i[1],Object(l.isFullyLoadedTab)(t,e.peerId)){var s=e.kludges.source_act;o.history=Object(l.addChatPhotoToUpdate)(e,s,t,re(o.history))}return t}))}));function Xt(e,t,n,r){return t!==vk.id||Object(l.isTabLoaded)(r,n)&&r.peer==n&&(r=ve(r)),Promise.resolve(r)}var Qt=te((function(e,t){return Object(r.post)(T,{act:"a_leave_chat",chat:e-2e9,gid:t.gid,hash:t.tabs[e].hash}).then(Xt.bind(null,l.CHAT_KICK_USER,vk.id,e,t))})),Zt=te((function(e,t){return Object(r.post)(T,{act:"a_return_to_chat",chat:e-2e9,gid:t.gid,hash:t.tabs[e].hash}).then(Xt.bind(null,l.CHAT_INVITE_USER,vk.id,e,t))})),en=te((function(e,t,n,i){return Object(r.post)(T,{act:"a_mute",peer:e,hash:i.tabs[e].hash,gid:i.gid,value:Number(t),until:n}).then(()=>{var n=t?"mute":"unmute";return window.Notifier&&Notifier.lcSend("im",{act:n,peer:e}),i}).then(nn.bind(null,e,t))})),tn=te((function(e,t,n){return Object(r.post)(T,{act:"a_mute_mentions",peer:e,hash:n.tabs[e].hash,gid:n.gid,value:Number(t)}).then(()=>n)}));function nn(e,t,n){var r=n.mutedPeers.filter(t=>t!==e);return t&&r.push(e),n.mutedPeers=r,cur.mutedPeers=n.mutedPeers,ve(n)}function rn(e,t){return t.stack=e,Promise.resolve(t)}var an=te((function(e,t,n,i){return on(e,n,t,i),Object(r.post)(T,{act:"a_mark_important",ids:e,val:t?1:0,from:"im",gid:i.gid,peer:n,hash:i.tabs[n].hash}).then(()=>i)}));function on(e,t,n,r){if(Object(l.isFullyLoadedTab)(r,t)){var i=r.tabs[t];e.filter(e=>i.msgs[e]).forEach(e=>{var o=Object(p.getMessage)(r,t,e),s=n?o.flags|a.FLAG_IMPORTANT:o.flags&~a.FLAG_IMPORTANT;o.flags=s,i.msgs[e]=o,i.history=Object(l.updateStar)(e,n,re(i.history))})}return Promise.resolve(r)}function sn(e,t,n){return n.importants||(n.importants={}),(n.importants[t]||0)!==e&&(n.important_cnt+=e,n.importants[t]=e),Promise.resolve(n)}function cn(e,t){return Object(r.post)(T,{act:"a_spam",offset:e,gid:t,part:e>0})}function un(e,t){return Object(r.post)(T,{act:"a_flush_spam",gid:t,hash:e})}function ln(e,t,n){return n.creationType=e,n.creationFilter=t,Promise.resolve(n)}function dn(e,t){return Object(r.post)(T,{act:"a_owner_photo",photo:JSON.parse(e).data[0],peer:t})}function pn(e){return Object(r.post)(T,{act:"a_get_contacts"}).then(t=>{var n=C(t,1)[0];return e.contactsList=n,e})}function hn(e,t){return t.next_chat_avatar=e,Promise.resolve(t)}function fn(e,t,n){return Object(r.post)("al_page.php",{act:"owner_photo_save",peer:e,_query:t,gid:n.gid}).then(e=>n)}var mn=te((function(e,t,n,i,a){return a.creating=!0,a.longpoll.pause(),Object(r.post)(T,{act:"a_multi_start",hash:a.writeHash,peers:t.join(","),title:n,flags:i}).then(e=>{var t=C(e,1)[0];return a.next_peer=t.peerId,a.tabs[t.peerId]=t,Pe(a,t,!1,e=>[t.peerId].concat(e)),a.longpoll.resume(),a}).then(t=>e?fn(t.next_peer,e,t):t).then(e=>(e.creating=!1,e)).catch(e=>{throw a.creating=!1,a.longpoll.resume(),e})})),gn=te((function(e,t,n){return n.creating=!0,Object(r.post)(T,{act:"a_multi_start",hash:n.writeHash,peers:[],title:t,gid:n.gid,is_community_chat:1}).then(t=>{var r=C(t,1)[0].peer_id;if(!r)throw new Error("No peer_id");return e?fn(r,e,n):n}).then(e=>(e.creating=!1,e)).catch(e=>{throw n.creating=!1,e})}));function vn(e){var t;e.resync_in_process=new Promise(e=>{t=e});var n=Object.keys(e.tabs).length,i=e.active_tab;return Object(r.post)(T,{act:"a_resync",sel:e.peer,gid:e.gid,loaded:n,tab:i,add_peers:e.tabbedPeers.map(e=>e.peer).join(",")}).then(n=>{var r=C(n,5),a=r[0],o=r[1],s=r[2],u=r[3],p=r[4];o.forEach(t=>Object(f.oCacheAdd)(e,t)),Object(l.normalizeTabsGotFromServer)(e,a),s.user_unread&&handlePageCount("msg",s.user_unread),Object(c.lplog)("Resync success","success");var h,m=e.peer;if(Object(l.isReservedPeer)(m))h=Promise.resolve(!1);else{var g={tabs:{[m]:e.tabs[m]},oCache:{}};h=Ge({[m]:a[m]},g)}return h.then(n=>{e.tabs=a,e.admins=extend(e.admins,u),n&&(e.tabs[m]=n.tabs[m],e.tabs[m].history=Object(l.restoreQueue)(m,e,re(e.tabs[m].history))),e.loadingDialogs=!1,e.mutedPeers=s.mutedPeers,e.lastDialogsOptions={has_more:s.has_more},e.dialog_tab_cts=Object.assign({},s.folder_cts,{[d.FOLDER_MESSAGE_REQUEST]:e.dialog_tab_cts[d.FOLDER_MESSAGE_REQUEST]}),e.dialog_tabs[i]=p.map(intval);var r=e.dialog_tabs[i].map(t=>e.tabs[t]);return Object.keys(e.dialog_tabs).filter(e=>e!=i).forEach(t=>{i==d.FOLDER_ALL?e.dialog_tabs[t]=r.filter(Tn(t)).map(e=>e.peerId):e.dialog_tabs[t]=[]}),delete e.resync_in_process,setTimeout(t.bind(null,!0),0),En(intval(s.unread),e)})}).catch(t=>(Object(c.lplog)("Resync error: "+t.message+" "+t.stack,"error"),Object(o.pause)(2).then(vn.bind(null,e))))}function _n(e,t){return t.lockedSending=e,Promise.resolve(t)}function bn(e,t,n){return e&&!n.delayed_message?(n.delayed_message=e,n.delayed_ts=t):e||(n.delayed_message=e,n.delayed_ts=t),Promise.resolve(n)}function yn(e){return!!e.textMediaSelector.urlAttachmentLoading||!!(window.Upload&&Upload.options&&Upload.isSomethingUploading)&&Object.keys(Upload.options).filter(e=>Upload.isSomethingUploading(e)).length>0}function En(e,t){return t.unread_cnt=e,t.dialog_tab_cts[d.FOLDER_UNREAD]=e,Promise.resolve(t)}function On(e,t){return t.ctrl_submit=!!e,Object(r.post)(T,{act:"a_save_ctrl_submit",to:t.peer,hash:t.tabs[t.peer].hash,value:e?1:0}).then(e=>t)}function Cn(e,t,n){n.cur_unread_cnt||(n.cur_unread_cnt={}),t&&!inArray(e,n.mutedPeers)&&(n.cur_unread_cnt[e]=!0);var r=document.title,i=window.devicePixelRatio>=2?"_2x":"";if(t&&!n.update_title_to){var a=function(e,t,n){return function(){n.update_old_title=e;var r=Object.keys(n.cur_unread_cnt).length;if(0===r)return Object(b.setDocumentTitle)(e||document.title),setFavIcon("/images/icons/favicons/fav_im"+t+".ico"),clearInterval(n.update_title_to),void(n.update_title_to=!1);e?(Object(b.setDocumentTitle)(e),setFavIcon("/images/icons/favicons/fav_im"+t+".ico"),e=!1):(e=document.title,setFavIcon("/images/icons/favicons/fav_im"+(r>9?10:r)+t+".ico"),Object(b.setDocumentTitle)(winToUtf(getLang("mail_im_new_messages",r))))}}(r,i,n);n.update_title_to=setInterval(a,1e3),a()}else!t&&n.update_old_title&&(Object(b.setDocumentTitle)(n.update_old_title),n.cur_unread_cnt={},r=!1,n.update_old_title=!1,setFavIcon("/images/icons/favicons/fav_im"+i+".ico"),clearInterval(n.update_title_to),n.update_title_to=!1);return Promise.resolve(n)}function Sn(e,t,n,r,i){return Object(l.isFullyLoadedTab)(i,e)&&(i.tabs[e].scrollTop=intval(t),i.tabs[e].scrollBottom=intval(n),i.tabs[e].contHeight=intval(r)),Promise.resolve(i)}function Tn(e){return e===d.FOLDER_ALL?e=>!Object(l.tabIsMessageRequest)(e):e===d.FOLDER_UNREAD?e=>!Object(l.tabIsMessageRequest)(e)&&(e.unread>0||Object(p.isTabMarkedUnread)(e)):e===d.FOLDER_MESSAGE_REQUEST?e=>Object(l.tabIsMessageRequest)(e):t=>t.folders&d.FOLDER_MASKS[e]}function wn(e,t){t.active_tab=e,Object(i.updateLocation)({tab:e===d.FOLDER_ALL?null:e});var n=[];if(e!==d.FOLDER_ALL&&!Object(l.isReversedDialogs)(t)){var r=t.dialog_tabs[e];n=t.dialog_tabs[d.FOLDER_ALL].map(e=>t.tabs[e]).filter(Tn(e)).map(e=>e.peerId),t.dialog_tabs[e]=r.length>=n.length?r:n}return Promise.resolve(t)}function In(e,t,n,r){var i=e.dialog_tabs_all;return!(!i[d.FOLDER_ALL]&&!i[t])||(!!n.includes(r.peerId)||("r"===r.lastmsg[0]||n.map(t=>e.tabs[t.toString()]).filter(t=>Object(l.isReversedDialogs)(e)?t.minor_sort_id>r.minor_sort_id:t.minor_sort_id<r.minor_sort_id).length>0))}function Pn(e,t,n,r,i,o){if(Object(l.isTabLoaded)(o,e)&&!i){var s=o.tabs[e];return n===a.REPLACE_DIRECTORIES&&(t^=s.folders),function(e,t,n){return!(e===a.SET_DIRECTORIES&&n.folders&t)&&(!!(e!==a.RESET_DIRECTORIES||n.folders&t)&&!Object(l.tabIsMessageRequest)(n))}(n,t,s)&&Object.keys(d.FOLDER_MASKS).filter(e=>d.FOLDER_MASKS[e]&t).forEach(e=>{o.dialog_tab_cts[e]+=function(e,t,n){return t!==a.RESET_DIRECTORIES||e.folders&d.FOLDER_MASKS[n]?t===a.REPLACE_DIRECTORIES?e.folders&d.FOLDER_MASKS[n]?-1:1:t===a.SET_DIRECTORIES?1:-1:0}(s,n,e)}),n===a.SET_DIRECTORIES?o.tabs[e].folders|=t:n===a.RESET_DIRECTORIES?o.tabs[e].folders&=~t:o.tabs[e].folders=t^=s.folders,Pe(o,o.tabs[e],!0,(t,n)=>t.concat([e]).map(e=>o.tabs[e]).filter(Tn(n)).map(e=>e.peerId),In.bind(null,o)),Promise.resolve(o)}return se(e,0,0,0,o).then(Pn.bind(null,e,t,n,null,!1,o))}var jn=te((function(e,t){var n=d.FOLDER_MASKS[d.FOLDER_IMPORTANT],i=t.tabs[e].folders&n,o=i?a.resetDirectoriesEvent:a.setDirectoriesEvent;return t.longpoll.push([o([0,e,n,!0])]),Object(r.post)(T,{act:"a_dialog_star",val:i?0:1,peer:e,hash:t.tabs[e].hash,gid:t.gid}).then(()=>t)})),kn=te((function(e,t,n){var i=d.FOLDER_MASKS[d.FOLDER_UNRESPOND];return n.longpoll.push([a.resetDirectoriesEvent([0,e,i,!0]),a.readInboundEvent([6,e,t,null])]),Object(r.post)(T,{act:"a_mark_answered",peer:e,lastmsg:t,hash:n.tabs[e].hash,gid:n.gid}).then(()=>n)})),An=te((e,t)=>(t.longpoll.push([a.resetPeer(),a.setDirectoriesEvent([0,e,d.FOLDER_MASKS[d.FOLDER_MARKED_UNREAD],!0])]),Object(r.post)(T,{act:"a_mark_conversation_as_unread",peer_id:e,hash:t.tabs[e].hash,gid:t.gid}))),Rn=te((e,t)=>{t.longpoll.push([a.resetDirectoriesEvent([0,e,d.FOLDER_MASKS[d.FOLDER_MARKED_UNREAD],!0])]);var n=t.tabs[e];return Object(r.post)(T,{peer:e,ids:n.lastmsg?[n.lastmsg]:[],mark_conversation_as_read:!0,hash:n.hash,act:"a_mark_read",gid:t.gid}).then(()=>t)});function Ln(e){return Object(r.post)(T,{act:"a_get_mutex_key",gid:e})}function Nn(e,t){return ae({[e]:{free:!0}},t),Object(r.post)(T,{act:"a_block_release",peer:e,gid:t.gid}).then(()=>t)}function Mn(e,t){var n=ls.get("comm_mute_"+t.gid)?1:0;return e&&(n^=1),ls.set("comm_mute_"+t.gid,n),t.mute=n,Promise.resolve(t)}var Dn=te((function(e,t){return Pe(t,t.tabs[e],!0,t=>t.filter(t=>t!==e)),t.tabs[e].deletedDialog=!0,Object(r.post)(T,{act:"a_delete_dialog",peer:e,gid:t.gid,hash:t.tabs[e].hash}).then(n=>(n[0]?(Bn(t.tabbedPeers.filter(t=>t.peer!==e),!0,t),t.tabs[e].unread=0,t.tabs[e].lastmsg=!1,t.tabs[e].lastmsg_meta=null):(t.tabs[e].deletedDialog=!1,Pe(t,t.tabs[e],!1,Ae.bind(null,e),In.bind(null,t))),n))}));function xn(e,t,n,i){return Object(r.post)(T,{act:"a_restore_dialog",hash:t,gid:i.gid,spam:n?1:0,peer:e}).then(t=>(i.tabs[e].deletedDialog=!1,Pe(i,i.tabs[e],!1,t=>[e].concat(t)),i.tabs[e].unread=t,i))}function Un(e,t,n){return Object(r.post)(T,{act:"a_spam_dialog",peer:e,gid:n.gid,hash:t})}function Bn(e,t,n){return n.tabbedPeers=e,Object(l.isClassicInterface)(n)&&(k({peers:n.tabbedPeers.filter(e=>{var t=e.peer,r=e.type;return t!==n.peer&&"perm"===r}).map(e=>Object(l.getBareTab)(e.peer,n)).filter(e=>!e.deletedDialog).map(e=>e.peerId).map(l.convertPeerToUrl).join("_"),to:""}),t&&A()),Promise.resolve(n)}function Fn(e){return!e.peer||(bt(e.peer,e)?_t(e.peer,e):!!Object(l.isFullyLoadedTab)(e,e.peer)&&e.tabs[e.peer].allShown)}function Hn(e,t){var n=t.tabs[e];return Object(l.isFullyLoadedTab)(t,e)&&(n.skipped=null,n.msgs=null,n.offset=null,n.allShown=null,n.history=null),Promise.resolve(t)}function Gn(e,t){var n=t.tabs[e];return Object(l.isFullyLoadedTab)(t,e)&&(n.history=ie(n.history)),Promise.resolve(t)}function Vn(e,t){return t.go_to_end_visible=e,Promise.resolve(t)}function qn(e,t){return t.go_to_mentions_visible=e,Promise.resolve(t)}function zn(e,t,n){if(!Object(l.isCommunityPeer)(t))return Promise.resolve(n);var i=Object(p.getTab)(n,t);return i.blocked_community=!e,!1===e&&(i.can_send_notify=!1),Object(r.post)(T,{act:"a_toggle_community",peer_id:t,hash:i.hash,state:e?1:0}).then(()=>ve(n))}function Kn(e,t){if(0!==t.peer&&Object(l.isFullyLoadedTab)(t,t.peer)){var n=Object(p.getTab)(t,t.peer);n.history=re(n.history),e(n.history)}return Promise.resolve(t)}function Wn(e){if(0!==e.peer&&Object(l.isFullyLoadedTab)(e,e.peer)){var t=Object(p.getTab)(e,e.peer),n=geByClass1("_im_peer_history");n&&(t.history=re(n.innerHTML))}return Promise.resolve(e)}function Yn(e){return e.audio_msg.isRecording?Promise.reject():(e.audio_msg.isRecording=!0,Promise.resolve(e))}function $n(e){return e.audio_msg.isRecording=!1,Promise.resolve(e)}function Jn(e,t){return t.voice_message_available=e,Promise.resolve(t)}function Xn(e){k({act:e?"create":null}),A()}function Qn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;k({q:e}),A()}function Zn(e){return void 0===e.chatResizeInitialized&&(e.chatResizeInitialized=!0,Object(l.getClassicChatHeight)()>window.clientHeight()&&Object(l.setClassicChatHeight)(0)),Promise.resolve(e)}var er=te((function(e,t,n){return Object(r.post)(T,{act:"a_join_chat",chat_id:e,hash:t,write_hash:n.writeHash}).then(e=>{var t=C(e,4),r=t[0],i=t[1],a=t[2],o=t[3];return a.forEach(e=>Object(f.oCacheAdd)(n,e)),n.tabs[r]=i,Pe(n,i,!1,Ae.bind(null,r),In.bind(null,n)),n.admins=extend(n.admins,o),[r]})}));function tr(e,t){return Object(r.post)(T,{act:"a_get_link",gid:t.gid,chat_id:e})}var nr=te((function(e,t){var n=t.tabs[e];return Object(r.post)(T,{act:"a_reset_link",chat_id:e-2e9,write_hash:t.writeHash,gid:t.gid}).then(e=>(n.inviteLink=e[0],e))}));function rr(e){return R({invite_chat_id:null,invite_hash:null,mr:null}),e.invitation=void 0,Promise.resolve(e)}function ir(e,t){var n=Object(c.arrayUnique)([e].concat(t.select(u.RECENT_SEARCH_OP))).slice(0,500);t.update(u.RECENT_SEARCH_OP,n)}function ar(e){e.update(u.RECENT_SEARCH_OP,[])}function or(e,t){var n=t.select(u.RECENT_SEARCH_OP).filter(t=>t!==e);return t.update(u.RECENT_SEARCH_OP,n),n}function sr(e,t,n){var r=n.tabs[t],i=Object(p.getMessage)(n,t,e);return Object(p.isChatActive)(r)&&!i.kludges.source_act&&(r.pinned=i),Promise.resolve(n)}function cr(e,t){return t.tabs[e].pinned=null,Promise.resolve(t)}var ur=te((function(e,t,n){var i=n.tabs[t];return Object(p.isChatActive)(i)?Object(r.post)(T,{act:"a_pin_message",msgid:e,chat:t,gid:n.gid,hash:n.tabs[t].hash}).then(e=>{var r=C(e,1)[0];return n.tabs[t]=Object.assign({},i,r),n}):Promise.resolve(n)})),lr=te((function(e,t){var n=t.tabs[e];return Object(p.isChatActive)(n)?Object(r.post)(T,{act:"a_unpin_message",chat:e,gid:t.gid,hash:t.tabs[e].hash}).then(r=>{var i=C(r,1)[0];return t.tabs[e]=Object.assign({},n,i),t}):Promise.resolve(t)})),dr=te((function(e,t){var n=t.tabs[e];return Object(r.post)(T,{act:"a_get_pinned_message",chat:e,gid:t.gid,hash:t.tabs[e].hash}).then(e=>{var r=C(e,1)[0];return n.pinned=r||null,t})})),pr=te((function(e,t,n){var i=n.tabs[e];return Object(r.post)(T,{act:"a_get_message_local_id",chat:e,chat_local_id:t,hash:i.hash})})),hr=te((function(e,t){var n=t.tabs[e];return n.membersLoaded?Promise.resolve(t):Object(r.post)(T,{act:"a_get_chat_members",chat:e,gid:t.gid,hash:n.hash}).then(e=>{var r=C(e,1),i=C(r[0],3),a=i[0],o=i[1],s=i[2];return n.memberIds=a,n.adminIds=o,s.forEach(e=>Object(f.oCacheAdd)(t,e)),n.membersLoaded=!0,t})})),fr=te((function(e,t){return Promise.all([hr(e,t),function(e,t){var n=t.tabs[e];return Object(r.post)(T,{act:"a_get_chat_details",chat:e,gid:t.gid,hash:n.hash}).then(e=>{var r=C(e,1)[0];return n.photoGrid=r.grid,n.photoLarge=r.photo,n.membersLastSeen=r.lastSeen||null,n.inviters=r.inviters,n.caccess=r.caccess,n.invitedByMe=r.invitedByMe||[],n.inviteLink=r.link||null,n.invitedByMessageRequest=r.invitedByMessageRequest,n.serverSettings=r.serverSettings||null,n.isDefaultPhotoOwner=r.isDefaultPhotoOwner||null,n.owner=r.owner||null,n.allowedUpdateFlags=r.allowedUpdateFlags,n.canInvite=r.canInvite||null,n.notifications=r.notifications,t})}(e,t)]).then(()=>t)})),mr=te((function(e,t,n){var i=n.tabs[e];return Object(r.post)(T,{act:"a_update_flags",chat:e,gid:n.gid,hash:i.hash,flags:t}).then(e=>(n.onUpdate&&n.onUpdate(),e))})),gr=te((function(e,t){var n=t.tabs[e];return Object(r.post)("al_page.php",{act:"owner_photo_remove",oid:e,gid:t.gid,hash:n.photoHash}).then(()=>(n.photo=null,n.photoLarge=null,t.onUpdate&&t.onUpdate(),t))}));function vr(e,t,n){var r=n.tabs[e];return r.memberIds=r.memberIds.filter(e=>e!==t),r.adminIds=r.adminIds.filter(e=>e!==t),r.membersCount=r.memberIds.length,Promise.resolve(n)}var _r=te((function(e,t,n){var i=n.tabs[e];return Object(r.post)(T,{act:"a_kick_user",chat:e,hash:i.hash,mid:t,gid:n.gid}).then(()=>(i.memberIds=i.memberIds.filter(e=>e!==t),i.adminIds=i.adminIds.filter(e=>e!==t),i.membersCount=i.memberIds.length,n))}));function br(e,t,n,r){var i=r.tabs[e];return i.adminIds=n?[].concat(i.adminIds,t).filter((e,t,n)=>n.indexOf(e)===t):i.adminIds.filter(e=>e!==t),Promise.resolve(r)}var yr=te((function(e,t,n,i){var a=i.tabs[e];return Object(r.post)(T,{act:"a_toggle_admin",chat:e,hash:a.hash,mid:t,is_admin:+n,gid:i.gid}).then(()=>br(e,t,n,i))}));function Er(e,t,n,r){var i=Object(p.getMessage)(e,n,t).userId;return Object(f.oCacheGet)(r,i)?Promise.resolve(r):Wt({[n]:[i]},r)}function Or(){ajax.post("al_im.php",{act:"a_hide_promo_tooltip"})}function Cr(){cur.videoAutoplayScrollHandler&&cur.videoAutoplayScrollHandler()}var Sr=te((function(e,t){return t.tabs[e].top_banner=void 0,Object(r.post)(T,{act:"a_hide_banner",peer_id:e,gid:t.gid,hash:t.tabs[e].hash}).then(()=>t)})),Tr=te((function(e,t,n){n.tabs[e].top_banner=void 0;var i=n.tabs[e];return Object(r.post)(T,{act:"a_callback_banner",peer_id:e,callback_data:t,hash:i.hash}).then(()=>n)}));function wr(e,t){return Object(r.post)(T,{act:"a_load_banner",peer_id:e,gid:t.gid}).then(n=>{var r=C(n,1)[0];return t.tabs[e].top_banner=r,t})}function Ir(e,t,n){return n.tabs[e].keyboard=t&&t.buttons?t:null,jr(e,!1,!0,n)}function Pr(e,t){return Ir(e,null,t)}function jr(e,t,n,r){return((r.tabs||{})[e]||{}).keyboard&&(r.tabs[e].keyboard.hide=t,n&&ls.set("is_keyboards_hide",Object.assign(ls.get("is_keyboards_hide")||{},{[e]:t}))),Promise.resolve(r)}var kr=te((function(e,t){var n=t.tabs[e];return Object(r.post)(T,{act:"a_get_keyboard",peer_id:e,hash:n.hash}).then(n=>{var r=C(n,1)[0];return Ir(e,r,t)})}));function Ar(e,t,n,i){var a=i.tabs[e];return a.caccess[t]=n,Object(r.post)(T,{act:"a_change_caccess",peer_id:e,member_id:t,hash:a.hash,access:n?1:0,gid:i.gid}).then(()=>i).catch(e=>{throw a.caccess[t]=!n,e})}var Rr=te((function(e,t){var n=t.tabs[t.peer];return Object(r.post)(T,{act:"a_delete_template",template_id:e,hash:n.hash,gid:t.gid,peer_id:t.peer}).then(()=>{var n=t.templates.find(t=>t.id===e);return n&&(n.deleted=!0),t})}));function Lr(e,t,n){var i=n.tabs[n.peer];return Object(r.post)(T,{act:"a_create_template",hash:i.hash,gid:n.gid,peer_id:n.peer,name:e,text:t}).then(e=>(n.templates.unshift(e[0]),n))}function Nr(e,t,n,i){var a=i.tabs[i.peer];return Object(r.post)(T,{act:"a_update_template",template_id:e,hash:a.hash,gid:i.gid,peer_id:i.peer,group_id:i.gid,name:t,text:n}).then(t=>{var n=i.templates.find(t=>t.id===e);return n&&Object.assign(n,t[0]),i})}function Mr(e,t){if(Object(l.isFullyLoadedTab)(t,e)){var n=Object(p.getTab)(t,e);n.allShown=!1,n.lastReset=Date.now()}return t}function Dr(e,t){var n=e.updateType,r=e.updateArg,i=0;return n===a.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED&&(i=r===a.MESSAGE_REQUEST_STATUS_NEW?1:-1),n===a.MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED&&(i=-1),t.dialog_tab_cts[d.FOLDER_MESSAGE_REQUEST]+=i,Promise.resolve(t)}function xr(e,t,n){if(Object(l.isFullyLoadedTab)(n,e.peerId)){var r=Object(p.getTab)(n,e.peerId);r.history=Object(l.setCasperMessageExpiringStatusDOM)(r.history,t,e.messageId)}return Promise.resolve(n)}function Ur(e,t){return Promise.resolve().then(()=>{if(Object(l.isFullyLoadedTab)(t,e)){var n=Object(p.getTab)(t,e);Object.values(n.msgs).forEach(e=>{var t=Object(p.parserMessage)(e);Object(h.isCasperMessage)(t)&&!E.casperMessagesStore.has(t.messageId)&&E.casperMessagesStore.add(t)})}return Promise.resolve(t)})}var Br=te((function(e,t,n,i,a,o){return Object(r.post)(T,{act:"a_peer_profile_toggle_tag",hash:o.manage_tags_hash,group_id:o.gid,peer_id:i,tag_id:e,action:n}).then(()=>{o.tabs[i].peer_tags=a;var n=o.peer_profile_tags.findIndex(t=>t.id===e);return t?o.peer_profile_tags[n].uses++:!t&&o.peer_profile_tags[n].uses>0&&o.peer_profile_tags[n].uses--,o})})),Fr=te((function(e,t){return Object(r.post)(T,{act:"a_peer_profile_manage_tags",hash:t.manage_tags_hash,group_id:t.gid,tags:JSON.stringify(e)}).then(e=>(t.peer_profile_tags=e[0].tags,t.peerProfileTagsChanged=!0,t))})),Hr=te((function(e,t,n){return Object(r.post)(T,{act:"a_peer_profile_save_note",hash:n.manage_tags_hash,group_id:n.gid,peer_id:e,note:t}).then(()=>(n.tabs[e].peer_profile_info.note=t,n))})),Gr=te((e,t)=>Object(r.post)(T,{act:"a_reload_message",msg_id:e,hash:t.writeHash}).then(e=>C(e,1)[0])),Vr=te((e,t)=>{var n=t.tabs[e];return Object(r.post)(T,{act:"a_get_active_call_data",peer_id:n.peerId,hash:n.hash}).then(e=>{var r=C(e,1)[0];return r?n.callInProgress=r:n.callInProgress&&delete n.callInProgress,t})}),qr=(e,t)=>{var n=t.tabs[e];return n.callInProgress&&delete n.callInProgress,Promise.resolve(t)}},"wSs/":function(e,t,n){"use strict";n.r(t),n.d(t,"canMessageBeEdited",(function(){return c})),n.d(t,"convertEmojiHtmlToRegularText",(function(){return u})),n.d(t,"findLastMessageToEdit",(function(){return l})),n.d(t,"wasMessageReallyModified",(function(){return d})),n.d(t,"replaceMsgAfterEdit",(function(){return p}));n("Vd3H"),n("rGqo"),n("Btvt"),n("pIFo");var r=n("rHUl"),i=n("MhhX"),a=n("P13b"),o=n("rudk"),s=n("aong");function c(e,t){t=Object(r.parserMessage)(t);var n=Object(s.unpackStore)(e),o=vk.id==t.peerId&&!n.gid,c=n.pinMessageEditSettings,u=c.messageEditAllowedTime,l=c.pinEditDelayTime,d=c.isPinEditEnabled,p=Date.now()/1e3,h=Object(r.getPinnedMessage)(n),f=h&&h.messageId===t.messageId,m=t.kludges&&t.kludges.pinned_at,g=p-t.date>u,v=m&&p-m<l;if(333==t.peerId)return!1;if(!o&&!Object(i.isOut)(t))return!1;if(Object(i.isServiceMsg)(t))return!1;if(f&&g&&d){if(v)return!1}else if(g)return!1;return!(Object(i.isGift)(t)||Object(i.isSticker)(t)||Object(i.isAudioMsg)(t)||Object(i.isGraffiti)(t)||Object(i.isMoney)(t)||Object(i.isVKPay)(t)||Object(i.isCallMessage)(t))&&!Object(a.isAlreadyDeleted)(e,t.peerId,t.messageId)}function u(e){var t=document.createElement("div");return e=e.replace(/\[((id|club)\d+)\|(.+?)]/g,(function(){var e=arguments.length<=1?void 0:arguments[1],t=arguments.length<=3?void 0:arguments[3];return/^\@/.test(t)?t:`@${e} (${t})`})),t.innerHTML=e,Emoji.val(t)}function l(e,t){return+(t&&t.msgs?Object.keys(t.msgs):[]).filter(e=>e>0).sort((e,t)=>t-e).find(n=>c(e,t.msgs[n]))||null}function d(e,t,n){var r=Object(o.convertKludgesToAttaches)(t.kludges,t.messageId),i=n.dData.attaches;if(u(t.text)!==n.dData.txt||r.length!==i.length)return!0;for(var a=r.length;a--;){var s=r[a],c=i[a];if(s.id!=c.id||s.type!=c.type||"poll"==s.type&&c.object&&c.object.poll_is_edited)return!0}return!1}function p(e,t,n,r,i,o){t.origText=n,t.text=Object(a.replaceSpecialSymbols)(clean(n)).replace(/\n/gi,"<br>"),t.attaches=r,t.kludges.emoji=1,t.local=1,t.share_url=i,t.cancelled_shares=o,t.update_time=Math.floor(Date.now()/1e3),e.get().tabs[t.peerId].msgs[t.messageId]=t}},xGYt:function(e,t,n){"use strict";n.r(t);var r=n("q1tI"),i=n.n(r),a=n("ZxpX"),o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},s=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};t.default=function(e){var t=e.icon,n=void 0===t?null:t,r=e.aside,c=void 0===r?null:r,u=e.chevron,l=void 0!==u&&u,d=e.selectable,p=void 0===d||d,h=e.border,f=void 0===h||h,m=e.className,g=e.children,v=e.active,_=e.canBeHovered,b=void 0===_||_,y=s(e,["icon","aside","chevron","selectable","border","className","children","active","canBeHovered"]),E={"ListItem--chevron":l,"ListItem--selectable":p,"ListItem--border":f,"ListItem--active":v,"ListItem--can-be-hovered":b};return i.a.createElement("li",o({},y,{className:Object(a.classNames)("ListItem",E,m)}),n&&i.a.createElement("div",{className:"ListItem__icon"},n),i.a.createElement("div",{className:"ListItem__main"},g),i.a.createElement("div",{className:"ListItem__aside"},c))}},z10o:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"shimGetUserMedia",(function(){return Hn})),n.d(r,"shimGetDisplayMedia",(function(){return Gn})),n.d(r,"shimMediaStream",(function(){return Vn})),n.d(r,"shimOnTrack",(function(){return qn})),n.d(r,"shimGetSendersWithDtmf",(function(){return zn})),n.d(r,"shimGetStats",(function(){return Kn})),n.d(r,"shimSenderReceiverGetStats",(function(){return Wn})),n.d(r,"shimAddTrackRemoveTrackWithNative",(function(){return Yn})),n.d(r,"shimAddTrackRemoveTrack",(function(){return $n})),n.d(r,"shimPeerConnection",(function(){return Jn})),n.d(r,"fixNegotiationNeeded",(function(){return Xn}));var i={};n.r(i),n.d(i,"shimGetUserMedia",(function(){return er})),n.d(i,"shimGetDisplayMedia",(function(){return tr})),n.d(i,"shimPeerConnection",(function(){return nr})),n.d(i,"shimReplaceTrack",(function(){return rr}));var a={};n.r(a),n.d(a,"shimGetUserMedia",(function(){return ir})),n.d(a,"shimGetDisplayMedia",(function(){return ar})),n.d(a,"shimOnTrack",(function(){return or})),n.d(a,"shimPeerConnection",(function(){return sr})),n.d(a,"shimSenderGetStats",(function(){return cr})),n.d(a,"shimReceiverGetStats",(function(){return ur})),n.d(a,"shimRemoveStream",(function(){return lr})),n.d(a,"shimRTCDataChannel",(function(){return dr})),n.d(a,"shimAddTransceiver",(function(){return pr})),n.d(a,"shimGetParameters",(function(){return hr})),n.d(a,"shimCreateOffer",(function(){return fr})),n.d(a,"shimCreateAnswer",(function(){return mr}));var o={};n.r(o),n.d(o,"shimLocalStreamsAPI",(function(){return gr})),n.d(o,"shimRemoteStreamsAPI",(function(){return vr})),n.d(o,"shimCallbacksAPI",(function(){return _r})),n.d(o,"shimGetUserMedia",(function(){return br})),n.d(o,"shimConstraints",(function(){return yr})),n.d(o,"shimRTCIceServerUrls",(function(){return Er})),n.d(o,"shimTrackEventTransceiver",(function(){return Or})),n.d(o,"shimCreateOfferLegacy",(function(){return Cr})),n.d(o,"shimAudioContext",(function(){return Sr}));var s={};n.r(s),n.d(s,"shimRTCIceCandidate",(function(){return Ir})),n.d(s,"shimMaxMessageSize",(function(){return Pr})),n.d(s,"shimSendThrowTypeError",(function(){return jr})),n.d(s,"shimConnectionState",(function(){return kr})),n.d(s,"removeAllowExtmapMixed",(function(){return Ar}));var c={};n.r(c),n.d(c,"Api",(function(){return Ia})),n.d(c,"BaseApi",(function(){return Ui})),n.d(c,"BaseLogger",(function(){return Bi})),n.d(c,"BaseSignaling",(function(){return Hi})),n.d(c,"CallType",(function(){return Vi})),n.d(c,"ExternalIdType",(function(){return Ki})),n.d(c,"HangupReason",(function(){return Xi})),n.d(c,"HangupType",(function(){return zi})),n.d(c,"Signaling",(function(){return Aa})),n.d(c,"SignalingCommandType",(function(){return ka})),n.d(c,"SignalingConnectionType",(function(){return Yi})),n.d(c,"acceptCall",(function(){return Va})),n.d(c,"addParticipant",(function(){return $a})),n.d(c,"addParticipantInternal",(function(){return Ja})),n.d(c,"authorize",(function(){return Ga})),n.d(c,"browser",(function(){return La})),n.d(c,"call",(function(){return Ua})),n.d(c,"callInternal",(function(){return Ba})),n.d(c,"captureScreen",(function(){return eo})),n.d(c,"changeDevice",(function(){return Za})),n.d(c,"changeParticipantState",(function(){return ao})),n.d(c,"changePriorities",(function(){return io})),n.d(c,"chatHistory",(function(){return po})),n.d(c,"chatMessage",(function(){return uo})),n.d(c,"chatMessageInternal",(function(){return lo})),n.d(c,"createJoinLink",(function(){return go})),n.d(c,"customData",(function(){return ho})),n.d(c,"customDataInternal",(function(){return fo})),n.d(c,"debug",(function(){return Oo})),n.d(c,"declineCall",(function(){return qa})),n.d(c,"getAnonymTokenByLink",(function(){return _o})),n.d(c,"getStreamInfo",(function(){return Eo})),n.d(c,"hangup",(function(){return Ya})),n.d(c,"init",(function(){return xa})),n.d(c,"joinCall",(function(){return za})),n.d(c,"joinCallByLink",(function(){return Wa})),n.d(c,"joinCallInternal",(function(){return Ka})),n.d(c,"muteParticipant",(function(){return so})),n.d(c,"muteParticipantInternal",(function(){return co})),n.d(c,"processPush",(function(){return Fa})),n.d(c,"processPushInternal",(function(){return Ha})),n.d(c,"removeJoinLink",(function(){return vo})),n.d(c,"removeParticipant",(function(){return Xa})),n.d(c,"removeParticipantInternal",(function(){return Qa})),n.d(c,"setApi",(function(){return Na})),n.d(c,"setLogger",(function(){return Da})),n.d(c,"setSignalingFactory",(function(){return Ma})),n.d(c,"setVideoStream",(function(){return to})),n.d(c,"startConversation",(function(){return mo})),n.d(c,"startStream",(function(){return bo})),n.d(c,"stopStream",(function(){return yo})),n.d(c,"toggleLocalAudio",(function(){return ro})),n.d(c,"toggleLocalVideo",(function(){return no})),n.d(c,"updateDisplayLayout",(function(){return oo}));n("91GP"),n("VRzm"),n("Btvt");var u,l,d=n("q1tI"),p=n.n(d),h=n("i8i4"),f=n.n(h);n("HEwt"),n("a1Th"),n("rGqo"),n("rE2o"),n("ioFf");!function(e){e[e.HEADER=0]="HEADER",e[e.SELECT_ALL=1]="SELECT_ALL",e[e.MEMBERS_MORE=2]="MEMBERS_MORE",e[e.FRIENDS_MORE=3]="FRIENDS_MORE"}(u||(u={})),function(e){e[e.READY=0]="READY",e[e.CALL=1]="CALL",e[e.INCOMING=2]="INCOMING",e[e.JOIN=3]="JOIN",e[e.ERROR=4]="ERROR"}(l||(l={}));var m,g,v,_,b,y="change_mode";!function(e){e.AUDIO="audio",e.VIDEO="video"}(m||(m={})),function(e){e.DEFAULT="default",e.COLLAPSED="collapsed",e.FULLSCREEN="fullscreen"}(g||(g={})),function(e){e.WAITING="WAITING",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e.RECONNECT="RECONNECT",e.ERROR="ERROR",e.HANGUP="HANGUP",e.PERMISSIONS="PERMISSIONS"}(v||(v={})),function(e){e.SPEAKING_ON_MUTE="SPEAKING_ON_MUTE",e.RAISED_HAND="RAISED_HAND",e.SCREEN_SHARING_STARTED="SCREEN_SHARING_STARTED",e.NO_SIMULTANEOUS_SHARING="NO_SIMULTANEOUS_SHARING",e.BAD_NETWORK_CONNECTION="BAD_NETWORK_CONNECTION",e.BAD_NETWORK_CONNECTION_DISABLE_CAMERA="BAD_NETWORK_CONNECTION_DISABLE_CAMERA"}(_||(_={})),function(e){e.LOWERED="0",e.RAISED="1"}(b||(b={}));var E,O,C,S,T="CANCELED",w="HUNGUP",I="MISSED",P="REMOVED";!function(e){e.AUDIO="audio",e.AUDIO_TO_VIDEO="video",e.VIDEO="started_as_video",e.GROUP_AUDIO="group_audio",e.GROUP_AUDIO_TO_VIDEO="group_video",e.GROUP_VIDEO="group_started_as_video"}(E||(E={})),function(e){e.SUCCESS="success",e.FAIL="fail"}(O||(O={})),function(e){e.REMOTE_NO_CONNECT="push_not_delivered",e.REMOTE_FAILED_ACCEPT="сant_connect",e.REMOTE_DECLINE="declined_remote",e.LOCAL_DECLINE="declined_local",e.REMOTE_TIMEOUT="declined_timeout",e.REMOTE_BUSY="busy",e.CONNECTION_LOST="lost_connection"}(C||(C={})),function(e){e.CONVO_HEADER="im_header",e.CONVO_SNIPPET="im_message"}(S||(S={}));var j=function(){return(j=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},k=function(e,t,n){var r,i=n.participantLimit,a=void 0===i?8:i,o=n.isJoinAvailable,s=void 0===o||o,c=n.isUpdateEnabled,u=void 0!==c&&c,d=n.useDirectAudio,p=void 0!==d&&d,h=window.vk.id||e.peerId;return{me:h,mode:l.READY,peer:0,participants:(r={},r[h]=j(j({},e),{mediaSettings:{isAudioEnabled:!0,isVideoEnabled:!1,isScreenSharingEnabled:!1},statusData:{hand:!1}}),r),callData:{type:null},imHash:t,participantLimit:a,popup:null,uiMode:g.DEFAULT,orator:null,pinnedParticipant:null,screenSharer:null,isJoinAvailable:s,isShownParticipantsAside:!0,isOratorMode:!1,isUpdateEnabled:u,useDirectAudio:p,chatMembers:[],preselectedIds:null,friends:[],speakers:{}}};function A(){return(A=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function R(e,t){switch(t.type){case"load_peer":var n=t.conversation||e.callData.conversation,r=t.members;return A({},e,{participants:A({},e.participants,{},r.reduce((t,n)=>(n&&n.peerId&&(t[n.peerId]=A({},e.participants[n.peerId]||{},{},n)),t),{})),callData:A({},e.callData,{conversation:n}),peer:"peerId"in t?t.peerId:e.peer});case y:var i=t.mode!==l.READY&&t.data&&t.data.type?t.data.type:null;return t.mode===l.READY?k(e.participants[e.me],e.imHash,{participantLimit:e.participantLimit,isJoinAvailable:e.isJoinAvailable,isUpdateEnabled:e.isUpdateEnabled,useDirectAudio:e.useDirectAudio}):A({},e,{mode:t.mode,peer:"peerId"in t?t.peerId:e.peer,callData:A({},e.callData,{type:i,ts:t.ts||e.callData.ts||null}),hangupType:e.hangupType});case"hangup":return A({},e,{hangupType:t.data});case"time_start":return A({},e,{callData:A({},e.callData,{ts:t.data})});case"media_settings":return L(e,t.participantId,{mediaSettings:t.data});case"stream":return L(e,t.participantId,{stream:t.data});case"update_user_status":var a=e.participants[t.participantId]||{};return L(e,t.participantId,{status:t.status,statusData:A({},a.statusData,{},t.data),wasConnected:a&&a.wasConnected||t.status===v.CONNECTED});case"remove_user":var o=L(e,t.participantId,{status:void 0,statusData:void 0,wasConnected:void 0});return e.screenSharer===t.participantId&&(o.screenSharer=null),e.orator===t.participantId&&(o.orator=null),e.pinnedParticipant===t.participantId&&(o.pinnedParticipant=null),o;case"set_chat_info":return A({},e,{chatMembers:t.data,chatData:t.conversation});case"group_call_setup":return A({},e,{groupCallSetup:t.open,peer:t.peerId||e.peer||0,preselectedIds:t.preselectedIds});case"toggle_popup":return A({},e,{popup:t.data||null});case"update_hash":return A({},e,{imHash:t.hash});case"change_ui_mode":return A({},e,{uiMode:t.mode||g.DEFAULT});case"toggle_orator_mode":return A({},e,{isOratorMode:t.isOratorMode});case"toggle_participants_aside":return A({},e,{isShownParticipantsAside:t.isShownParticipantsAside});case"set_orator":return A({},e,{orator:t.orator||null});case"set_pinned_participant":return A({},e,{pinnedParticipant:t.pinnedParticipant});case"management":return A({},e,{isManagementOpen:t.isOpen});case"call_state":return A({},e,{callData:A({},e.callData,{},t.callData)});case"call_notification":return A({},e,{notification:t.notification});case"join":return A({},e,{mode:l.JOIN,join:t.data});case"error":return A({},e,{mode:l.ERROR,error:{title:t.title,text:t.text}});case"change_participant_state":var s=e.participants[t.participantId].statusData;return L(e,t.participantId,{statusData:A({},s,{},t.data)});case"set_screen_sharer":return A({},e,{screenSharer:t.participantId});case"set_friends":return A({},e,{friends:t.data});case"set_speakers":return A({},e,{speakers:t.data})}return e}function L(e,t,n){return A({},e,{participants:A({},e.participants,{[t]:A({},e.participants[t],{},n)})})}var N,M=n("Nlxk"),D=n("ZxpX"),x=function(){return(x=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},U=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};!function(e){e.POSITIVE="positive",e.NEGATIVE="negative",e.REGULAR="regular",e.ON="on",e.OFF="off",e.CLEAR="clear"}(N||(N={}));var B=function(e){var t=e.icon,n=e.text,r=e.type,i=e.className,a=U(e,["icon","text","type","className"]),o=Object(D.classNames)("CallButton","CallButton--"+r,i,{"CallButton--withText":!!n}),s=x(x({},a),{onMouseDown:function(e){e.preventDefault(),a.onMouseDown&&a.onMouseDown(e)}});return p.a.createElement("button",x({className:o},s),p.a.createElement("figure",{className:"CallButton__icon"},t),n)},F=function(){return(F=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},H=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},G=function(e){var t=H(e,[]);return p.a.createElement("svg",F({height:"14",width:"21",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),p.a.createElement("path",{d:"M11.154 0c1.337 0 1.822.14 2.311.4.49.262.873.646 1.134 1.135.262.489.401.974.401 2.31v6.31c0 1.336-.14 1.821-.4 2.31a2.726 2.726 0 01-1.135 1.134c-.489.262-.974.401-2.31.401h-7.31c-1.336 0-1.821-.14-2.31-.4A2.726 2.726 0 01.4 12.464C.139 11.976 0 11.491 0 10.155v-6.31c0-1.336.14-1.821.4-2.31A2.726 2.726 0 011.536.4C2.024.139 2.509 0 3.845 0zM20.8 2.897a1 1 0 01.2.6v7.006a1 1 0 01-1.6.8L17.2 9.65a.5.5 0 01-.2-.4v-4.5a.5.5 0 01.2-.4l2.2-1.652a1 1 0 011.4.199z"}))},V=function(){return(V=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},q=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},z=function(e){var t=q(e,[]);return p.a.createElement("svg",V({height:"18",width:"18",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),p.a.createElement("path",{d:"M11.112 12.259c1.354-1.354 3.486-1.48 4.903-.287l1.025.863c1.168.983 1.287 2.757.263 3.96a3.318 3.318 0 01-2.195 1.133c-3.273.44-6.707-1.137-10.303-4.733C1.21 9.6-.369 6.165.072 2.892a3.25 3.25 0 01.159-.752c.19-.56.527-1.058.974-1.443C2.41-.327 4.181-.21 5.165.96l.862 1.024c1.194 1.416 1.07 3.55-.284 4.903l-.736.735a.712.712 0 00-.164.748c.267.732.95 1.645 2.046 2.74 1.096 1.097 2.01 1.78 2.74 2.048.26.095.553.03.749-.166z"}))},K=function(){return(K=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},W=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Y=function(e){var t=W(e,[]);return p.a.createElement("svg",K({height:"14",width:"14",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),p.a.createElement("path",{d:"M13.3.7a.99.99 0 00-1.4 0L7 5.6 2.1.7A.99.99 0 00.7 2.1L5.6 7 .7 11.9a.99.99 0 001.4 1.4L7 8.4l4.9 4.9a.99.99 0 001.4-1.4L8.4 7l4.9-4.9a.99.99 0 000-1.4z"}))};n("17x9");function $(e){var t=e.id,n=e.disablePhoto,r=e.photo,i=e.className,a=e.children,o=t%6+1,s=Object(D.classNames)("BlurredBackground",i,"BlurredBackground--"+o,{"BlurredBackground--noPhoto":!n&&!r});return d.createElement("div",{className:s},d.createElement("div",{className:"BlurredBackground__in"},!n&&r&&d.createElement("div",{className:"BlurredBackground__inner",style:{backgroundImage:`url(${r})`}})),d.createElement("div",{className:"BlurredBackground__content"},a))}$.defaultProps={photo:"",children:"",disablePhoto:!1};var J=n("756/"),X=function(e){var t=e.id,n=e.waves,r=void 0!==n&&n,i=e.size,a=void 0===i?"m":i,o=e.photo,s=void 0===o?"":o,c=e.alt,u=Object(D.classNames)("CallPhoto","CallPhoto--"+a,{"CallPhoto--waves":!!r});return s?p.a.createElement("img",{src:s,className:u,alt:c}):p.a.createElement(J.ConversationNoPhoto,{id:t,text:c.slice(0,1),size:a,className:u})},Q=n("2zsc");function Z(e){var t=e.title,n=e.description,r=e.className;return d.createElement("header",{className:Object(D.classNames)("CallHeader",r)},d.createElement("h1",{className:"CallHeader__title"},d.createElement(Q.default,null,t)),d.createElement("div",{className:"CallHeader__description"},n))}var ee=function(){return(ee=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},te=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},ne=Object(d.forwardRef)((function(e,t){var n=e.component,r=e.type,i=e.isActive,a=e.icon,o=e.className,s=te(e,["component","type","isActive","icon","className"]),c=n||"button",u=Object(D.classNames)("CallIconButton","CallIconButton--"+r,o,{"CallIconButton--active":i}),l=ee(ee({},s),{onMouseDown:function(e){e.preventDefault(),s.onMouseDown&&s.onMouseDown(e)}});return p.a.createElement(c,ee({className:u},l,{ref:t}),a)})),re=n("dt/K"),ie=n("6krn");function ae(e){var t=e.id,n=e.photo,r=e.title,i=e.description,a=e.onCollapseCall,o=e.children;return d.createElement("section",{className:"IncomingCall"},d.createElement($,{id:t,photo:n}),d.createElement(re.default,{position:"b",text:Object(ie.getLang)("calls_collapse"),marginTop:-6},d.createElement(ne,{type:"collapse",className:"IncomingCall__collapse",onClick:a})),d.createElement(Z,{title:r,description:i}),d.createElement(X,{id:t,waves:!0,photo:n,alt:r||""}),d.createElement("footer",{className:"IncomingCall__footer"},o))}var oe=n("r7nW"),se=n("RdBX"),ce=function(e,t,n){var r=Object(d.useRef)(null);r.current=r.current?r.current:new se.vkIndexer(e,t);var i=r.current,a=Object(d.useCallback)((function(e){return e.reduce((function(e,t){return e[n(t)]=!0,e}),{})}),[]),o=Object(d.useState)(e),s=o[0],c=o[1],u=Object(d.useState)(a(e)),l=u[0],p=u[1];return Object(d.useEffect)((function(){var t=a(e),r=e.filter((function(e){return!l[n(e)]})),o=s.filter((function(e){return!t[n(e)]}));(r.length||o.length)&&(r.forEach((function(e){i.add(e)})),o.forEach((function(e){i.remove(e)})),c(e),p(t))}),[e]),i};var ue=function(e){var t=e.onClose,n=e.onBackdropClick,r=e.isIncoming,i=void 0!==r&&r,a=e.isCautionBoxShown,o=void 0!==a&&a,s=e.children;Object(d.useEffect)((function(){return window.bodyNode.classList.add("layers_shown"),function(){window.bodyNode.classList.remove("layers_shown")}}),[]);var c=o?function(){var e=Object(M.showCautionBox)((function(){t(),e.hide()}),i||!1);return e}:t;return p.a.createElement(oe.default,{className:"CallModal",disableBodyScroll:!0,onClose:c,onBackdropClick:n},s)},le=n("rudk"),de=function(e){return 0===e||Object(le.isChatPeer)(e)};function pe(e,t){var n=e.browser.hasMicrophonePermission(),r=e.browser.hasCameraPermission();return!n||t&&!r?function(e,t){return e.browser.getUserMedia(t).then(e=>(e.getTracks().forEach(e=>e.stop()),Promise.resolve()))}(e,t):Promise.resolve()}function he(e){var t=e.SDK,n=e.state,r=e.dispatch,i=n.peer,a=de(i)?n.callData.conversation:n.participants[i],o=n.callData.type===m.VIDEO,s=o?Object(ie.getLang)("calls_incoming_videocall"):Object(ie.getLang)("calls_incoming_audiocall"),c=o?Object(ie.getLang)("calls_reply_with_audio"):Object(ie.getLang)("calls_reply"),u=o?Object(ie.getLang)("calls_reject_call"):Object(ie.getLang)("calls_reject"),p=e=>pe(t,e).then(()=>t.acceptCall(e)).then(e=>{var t=e.acceptTime;return r({type:y,mode:l.CALL,ts:t})}).catch(()=>{Object(M.showPermissionsError)(e,!0,(function(){r({type:y,mode:l.READY}),t.declineCall()}))});return d.createElement(ue,{onClose:t.declineCall,isIncoming:!0,isCautionBoxShown:!0},d.createElement(ae,{id:i,title:a.tab,description:s,photo:a.photo||"",onCollapseCall:()=>{r({type:"change_ui_mode",mode:g.COLLAPSED})}},o&&d.createElement(B,{text:Object(ie.getLang)("calls_reply_with_video"),type:N.POSITIVE,icon:d.createElement(G,null),onClick:()=>p(!0)}),d.createElement(B,{text:c,type:o?N.REGULAR:N.POSITIVE,icon:d.createElement(z,null),onClick:()=>p(!1)}),d.createElement(B,{text:u,type:N.NEGATIVE,icon:d.createElement(Y,null),onClick:t.declineCall})))}n("hhXQ"),n("pIFo"),n("SRfc"),n("KKXr");var fe=n("DM26"),me=n("vT4u"),ge=n("4+be"),ve=n("gdug"),_e=n("1BRX"),be=n("nAFc");function ye(){return(ye=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Ee(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Oe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Oe(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ce(e){var t=e.shortName;if(!t){var n=Ee(e.name.split(" "),2),r=n[0],i=n[1];t=`${r} ${i?i.length>2?i.substring(0,1)+".":i:""}`}return ye({},e,{peerId:+e.id,tab:e.name,shortName:t})}function Se(e){var t=Ee(e,2),n=t[0],r=t[1];return["peerId"in n?n:Ce(n),r?r.map(Ce):[]]}function Te(e){var t=Ee(e,2),n=t[0],r=t[1];return[ye({},n,{tab:n.name}),r]}function we(e){var t=e.caller_info,n=e.chat_info;return n?2e9+n.chat_id:t.user_id}function Ie(e){return!!e.payload.chat_info}function Pe(e){return Object.values(e.participants).filter(t=>t.peerId===e.me||t.status)}function je(e){return!!Object.values(e.participants).find(t=>(t.peerId===e.me||t.wasConnected)&&t.mediaSettings&&t.mediaSettings.isVideoEnabled)}function ke(e){var t=Date.now(),n=Math.max(0,Math.floor((t-e)/1e3));return n<=599?"0"+Object(_e.formatTime)(n):Object(_e.formatTime)(n)}function Ae(e,t,n){return JSON.stringify({is_video:t,chat_id:Object(le.isChatPeer)(e)?e-2e9:void 0,with_join_link:de(e),join_by_link:de(e)&&n})}function Re(e){ve.browser.safari&&+ve.browser.version.split(".")[0]<13&&setTimeout(()=>{e&&e.current&&(e.current.volume=1e-4)},10)}var Le=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(){return n.reduce((e,t)=>t(e),e)(...arguments)}},Ne=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{attempts:10,timeout:0};return function(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return n.attempts>0?Object(fe.pause)(n.timeout).then(()=>t(...i)).catch(()=>(!n.timeout&&(n.timeout=1),n.attempts--,n.timeout=Math.min(2*n.timeout,300),e(t,n)(...i))):Promise.reject()}},Me=(e,t,n)=>function(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];var o=window.Calls.id<0&&{anonymId:window.Calls.id};return n(e(),...i).catch(e=>e&&e.match&&e.match(/1001;/)?Object(me.loadWriteHash)(o).then(e=>{var n=Ee(e,1)[0];return t(n)}).then(e=>n(e,...i)):Promise.reject(e))};function De(e,t){if(e.length>t.length){var n=e.length-t.length,r=e.slice(0,3).map(xe).join(", ");return langNumeric(n,Object(ge.getLang)("calls_members_list_label",!0)).replace("{name}",r)}if(t.length>1){var i=t.length>2?e.slice(0,2).map(xe).join(", "):xe(e[0]),a=xe(e[t.length-1]);return Object(ge.getLang)("global_and").replace("{before}",i).replace("{after}",a)}return 1===t.length?xe(e[0]):""}function xe(e){return Object(be.decodeHTMLEntities)(e.firstName)}function Ue(){return(Ue=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Be(e){var t=e.hasVideo,n=e.stream,r=e.isMe,i=e.isVideoVisible,a=e.isScreenShareStream,o=e.setVideoVisibility,s=e.className,c=e.allowContain,u=d.useRef(null),l=t&&n,p={autoPlay:!0,controls:!1,crossOrigin:"anonymous",playsInline:"playsinline",preload:"metadata",onLoadedData:()=>l&&!i&&o&&o(!0)},h=c&&function(e,t){if(t&&t.active){var n=t.getVideoTracks();if(!n||0===n.length)return!1;var r=n[0].getSettings(),i=void 0!==r.width?r.width:e?e.videoWidth:0;return(void 0!==r.height?r.height:e?e.videoHeight:0)>=i}return!1}(u.current,n)||a,f=Object(D.classNames)("Video",s,{"Video--contain":l&&n&&h,"Video--visible":l&&i,"Video--mirrored":r&&l&&!a});return d.useEffect(()=>{l&&u.current&&(u.current.srcObject=n,u.current.volume=0,Re(u)),!l&&i&&o&&o(!1)},[e.hasVideo,e.stream,i]),l?d.createElement("video",Ue({className:f,ref:u},p)):null}Be.defaultProps={hasVideo:!1,isMe:!1,isVideoVisible:!1,allowContain:!0,isScreenShareStream:!1};var Fe=n("FEsp");function He(e){var t=e.isInverted,n=Object(D.classNames)("CallingStatus",{"CallingStatus--inverted":!!t});return p.a.createElement("div",{className:n},p.a.createElement("span",{className:"CallingStatus__part"}),p.a.createElement("span",{className:"CallingStatus__part"}),p.a.createElement("span",{className:"CallingStatus__part"}))}var Ge=function(e){var t=e.id,n=e.photo,r=e.photoSize,i=e.status,a=e.wasConnected,o=e.alt;return p.a.createElement(Fe.default,{className:"ParticipantCardNew"},p.a.createElement("span",{className:"ParticipantCardNew__in"},p.a.createElement(X,{id:t,photo:n,size:r,alt:o||""}),i===v.WAITING&&!a&&p.a.createElement("div",{className:"ParticipantCardNew__status"},p.a.createElement(He,{isInverted:!0}))))},Ve=function(){return(Ve=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},qe=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},ze=function(e){var t=qe(e,[]);return p.a.createElement("svg",Ve({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 21 24"},t),p.a.createElement("path",{d:"M21.442 10.058c.513.77.588 1.831.192 2.663l-2.679 5.625C17.435 21.538 13.54 24 9.998 24H9c-4.422 0-8-3.58-8-8.009V8.128a2.746 2.746 0 013.5-2.642v-.732a2.75 2.75 0 013.571-2.629A2.749 2.749 0 0110.75 0c1.47 0 2.67 1.15 2.746 2.604A2.748 2.748 0 0117 5.254v4.264c1.299-1.278 3.357-1.087 4.442.54zM3.75 7.383a.746.746 0 00-.75.745v7.863A5.998 5.998 0 009 22h.998c2.773 0 5.964-2.02 7.152-4.514l2.678-5.625a.787.787 0 00-.05-.694c-.428-.642-1.123-.65-1.55-.01l-2.177 3.267c-.576.864-1.051.726-1.051-.323V5.255a.748.748 0 00-.75-.755.746.746 0 00-.75.747v5.757c0 .55-.448.996-1 .996-.556 0-1-.446-1-.995V2.752a.75.75 0 10-1.5 0v8.253c0 .54-.448.995-1 .995-.556 0-1-.446-1-.997v-6.25A.756.756 0 007.25 4a.75.75 0 00-.75.754v6.738c0 .551-.448 1.008-1 1.008-.556 0-1-.447-1-.999V8.138a.751.751 0 00-.75-.755z"}))},Ke=function(){return(Ke=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},We=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Ye=function(e){var t=We(e,[]);return p.a.createElement("svg",Ke({width:"12",height:"20",xmlns:"http://www.w3.org/2000/svg"},t),p.a.createElement("path",{d:"M4 3a2 2 0 104 0 2 2 0 00-4 0zm0 7a2 2 0 104 0 2 2 0 00-4 0zm2 9a2 2 0 110-4 2 2 0 010 4z",fill:"currentColor"}))},$e=function(){return($e=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Je=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Xe=Object(d.forwardRef)((function(e,t){var n=e.children,r=Je(e,["children"]),i=Object(d.useRef)(null);return i.current||(i.current=document.createElement("div"),document.body.appendChild(i.current)),Object(d.useEffect)((function(){return function(){i.current&&i.current.remove()}}),[]),f.a.createPortal(p.a.createElement("div",$e({},r,{ref:t}),n),i.current)}));var Qe=n("clTp"),Ze=function(){return(Ze=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},et=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},tt=p.a.forwardRef((function(e,t){var n=e.position,r=void 0===n?"auto":n,i=e.mode,a=void 0===i?"side":i,o=e.align,s=void 0===o?"auto":o,c=e.content,u=e.children,l=et(e,["position","mode","align","content","children"]),h=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=p.a.useRef();return p.a.useEffect((function(){e.forEach((function(e){e&&(e.current=n.current)}))}),[e]),n}(t,Object(d.useRef)(null)),f=Object(d.useState)(null),m=f[0],g=f[1],v=Object(d.useState)(null),_=v[0],b=v[1],y=Object(d.useState)(null),E=y[0],O=y[1],C=Ze(Ze({},u.props),{ref:h});return Object(d.useEffect)((function(){if(h&&h.current){var e=function(e,t,n,r){if(!e)return[{top:0,left:0,width:0,height:0},"auto"===r?"left":r,"auto"===n?"b":n];var i=Object(Qe.default)(e),a="auto"===n||"auto"===r,o=a?window.innerWidth:0,s=a?window.innerHeight:0,c=a?window.pageYOffset||document.documentElement.scrollTop:0,u=a?window.pageXOffset||document.documentElement.scrollLeft:0;if("auto"===n){var l=i.top-c,d=c+s-i.top-i.height;n=d>l?"b":"t"}if("auto"===r){var p=i.left+.5*i.width,h=u+2*o/3;r=p>=u+o/3&&p<=h?"center":p>h?"right":"left"}var f=i.left,m=i.top;if("side"===t)return[{top:"b"===n?m+i.height:m,left:"r"===n?f+i.width:f,width:"t"===n||"b"===n?i.width:0,height:"l"===n||"r"===n?i.height:0},r,n];switch(n){case"t":f+=.5*i.width;break;case"r":f+=i.width,m+=.5*i.height;break;case"b":f+=.5*i.width,m+=i.height;break;case"l":m+=.5*i.height}return[{top:m,left:f,width:0,height:0},r,n]}(h.current,a,r,s),t=e[0],n=e[1],i=e[2];g(t),b(n),O(i)}}),[a,r,s]),p.a.createElement(p.a.Fragment,null,p.a.cloneElement(u,C),m&&p.a.createElement(Xe,Ze({},l,{className:Object(D.classNames)("Popper",_&&"Popper--"+_,E&&"Popper--"+E),"data-align":_,"data-position":E,style:m}),c))}));var nt=function(){return(nt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},rt=function(e){var t=e.children,n=e.items,r=Object(d.useState)(!1),i=r[0],a=r[1],o=Object(d.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),a(!i)}),[i]),s=function(e){e.target&&e.target.closest(".CallsDropdown")||a(!1)};return Object(d.useEffect)((function(){return document.documentElement.addEventListener("click",s),function(){return document.documentElement.removeEventListener("click",s)}}),[]),i?p.a.createElement(tt,{content:p.a.createElement("ul",{className:"CallsDropdown"},n.map((function(e,t){return p.a.createElement("li",{className:"CallsDropdown__item",key:e.key||t},"href"in e&&p.a.createElement("a",{href:e.href,target:"_blank",onClick:function(){return a(!1)},className:"CallsDropdown__button"},e.text),"onClick"in e&&p.a.createElement("button",{onClick:function(){e.onClick(),a(!1)},className:"CallsDropdown__button"},e.text))}))),mode:"point"},p.a.cloneElement(t,nt(nt({},t.props),{onClick:o,"data-active":i}))):p.a.cloneElement(t,nt(nt({},t.props),{onClick:o}))},it=function(e){var t=e.id,n=e.isInfoShown,r=e.isPinned,i=e.isHandRaised,a=e.photo,o=e.hasVideo,s=e.hasAudio,c=e.isSharingScreen,u=e.useDirectAudio,l=e.isSpeaking,h=void 0!==l&&l,f=e.stream,m=e.isMe,g=void 0!==m&&m,v=e.photoSize,_=e.name,b=e.status,y=e.wasConnected,E=e.onClickParticipant,O=e.allowContain,C=void 0!==O&&O,S=e.actions,T=!!E,w=Object(D.classNames)("ParticipantNew",{"ParticipantNew--isInteractive":T,"ParticipantNew--isPinned":r,"ParticipantNew--isSpeaking":h}),I=p.a.useState(!1),P=I[0],j=I[1];p.a.useEffect((function(){o&&f||j(!1)}),[o,f,P]);var k=!(o&&f)||!P,A=Object(d.useCallback)((function(e){E&&E(e,t)}),[E]);return p.a.createElement("article",{className:w,onClick:A},S&&S.length>0&&p.a.createElement(rt,{items:S},p.a.createElement("button",{className:"ParticipantNew__more","aria-label":Object(ie.getLang)("global_actions")},p.a.createElement(Ye,null))),T&&p.a.createElement("header",{className:"ParticipantNew__header"},r&&p.a.createElement("div",{className:"ParticipantNew__pin"})),k&&p.a.createElement($,{id:t,photo:a,className:"ParticipantNew__main"},p.a.createElement(Ge,{id:t,photo:a,photoSize:v,status:b,wasConnected:y,alt:_||""})),i&&p.a.createElement("div",{className:"ParticipantNew__handIndicator"},p.a.createElement(ze,{className:"ParticipantNew__handIcon"})),(!u||o)&&p.a.createElement(Be,{className:"ParticipantNew__main",hasVideo:o,stream:f,isMe:g,isVideoVisible:P,isScreenShareStream:c,setVideoVisibility:j,allowContain:C}),n&&p.a.createElement("footer",{className:"ParticipantNew__footer"},p.a.createElement(Q.default,{className:"ParticipantNew__name"},_),(y||g)&&!s&&p.a.createElement("span",{className:"ParticipantNew__statusIcon ParticipantNew__statusIcon--mic"})))},at=function(e){var t=e.id,n=e.name,r=e.hasAudio,i=e.hasVideo,a=e.isSharingScreen,o=e.stream,s=e.wasConnected,c=e.opponentId,u=e.opponentHasAudio,l=e.opponentHasVideo,d=e.opponentIsSharingScreen,h=e.opponentStream,f=e.opponentPhoto,m=e.opponentName,g=e.opponentWasConnected,v=Object(D.classNames)("OneToOne",{"OneToOne--hasVideo":i,"OneToOne--opponentHasVideo":l});return p.a.createElement("div",{className:v},p.a.createElement("aside",{className:"OneToOne__local"},p.a.createElement(it,{id:t,hasVideo:i,hasAudio:r,isSharingScreen:a,stream:o,isMe:!0,name:n,photoSize:"m",wasConnected:s})),p.a.createElement("main",{className:"OneToOne__remote"},p.a.createElement(it,{id:c,hasVideo:l,hasAudio:u,isSharingScreen:d,stream:h,photo:f,name:m,photoSize:"l",wasConnected:g})))},ot=function(e){var t=e.children,n=e.className;return p.a.createElement("div",{className:Object(D.classNames)("CallInfo",n)},t)},st=function(){return(st=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},ct=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},ut=function(e){var t=e.children,n=e.className,r=e.alignX,i=e.alignY,a=e.size,o=void 0===a?"m":a,s=ct(e,["children","className","alignX","alignY","size"]),c=Object(D.classNames)("CallIconButtonGroup","CallIconButtonGroup--"+r,"CallIconButtonGroup--"+i,"CallIconButtonGroup--size-"+o,n);return p.a.createElement("div",st({className:c},s),t)},lt=function(){return(lt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},dt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},pt=function(e){var t=dt(e,[]);return p.a.createElement("svg",lt({width:"24",height:"24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),p.a.createElement("path",{d:"M4.3 4.3a1 1 0 011.4 0l6.3 6.29 6.3-6.3a1 1 0 111.4 1.42L13.42 12l6.3 6.3a1 1 0 01-1.42 1.4L12 13.42l-6.3 6.3a1 1 0 01-1.4-1.42L10.58 12l-6.3-6.3a1 1 0 010-1.4z"}))},ht=function(){return(ht=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},ft=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},mt=function(e){var t=e.unreadCount,n=void 0===t?0:t,r=ft(e,["unreadCount"]),i="",a="";switch(!0){case!n:i="none";break;case n<=9:i="single",a=n.toString();break;case n<=99:i="double",a=n.toString();break;case n>99:i="max",a="99+"}var o=Object(D.classNames)("ChatIconButton","ChatIconButton--"+i);return p.a.createElement("button",ht({className:o},r),a&&p.a.createElement("div",{className:"ChatIconButton__count "},a))},gt=function(){return(gt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},vt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},_t=function(e){var t=vt(e,[]);return p.a.createElement("svg",gt({height:"9",width:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),p.a.createElement("path",{d:"M12 0c5.358 0 9.09 1.325 11.2 3.976.668.84.85 1.587.79 2.376-.133 1.59-1.353 2.638-3.145 2.638-3.445 0-4.773-1.787-4.842-3.664L16 4.122c0-.28-.169-.535-.434-.653-.693-.33-1.933-.469-3.567-.469s-2.821.14-3.565.469a.718.718 0 00-.435.653V5.17c0 1.933-1.304 3.82-4.844 3.82C1.363 8.99.142 7.94.009 6.352-.05 5.563.132 4.816.8 3.976 2.91 1.325 6.642 0 12 0z"}))},bt=function(){return(bt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},yt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Et=function(e){var t=yt(e,[]);return p.a.createElement("svg",bt({height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),p.a.createElement("path",{d:"M1.721 2.307L4 4.586v-.002l7.029 7.029 4.693 4.695a1 1 0 01-1.414 1.414l-1.938-1.937A8.482 8.482 0 019 16.941V19a1 1 0 01-1.993.117L7.001 19v-2.06c-3.234-.384-5.995-2.611-6.955-5.646a.995.995 0 01.681-1.25 1.035 1.035 0 011.287.662C2.808 13.216 5.257 15 7.999 15c1.03 0 2.016-.25 2.89-.695l-1.538-1.539A4 4 0 014 9V7.414L.307 3.721a1 1 0 011.414-1.414zm13.55 7.737c.544.162.85.72.684 1.249a7.825 7.825 0 01-.75 1.666l-1.51-1.51c.113-.239.21-.487.29-.742a1.035 1.035 0 011.287-.663zM8 0a4 4 0 014 4v5c0 .237-.02.468-.06.694L4.433 2.188A4 4 0 018 0z"}))},Ot=function(){return(Ot=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Ct=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},St=function(e){var t=Ct(e,[]);return p.a.createElement("svg",Ot({height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),p.a.createElement("path",{d:"M8 0a4 4 0 00-4 4v5a4 4 0 008 0V4a4 4 0 00-4-4z"}),p.a.createElement("path",{d:"M1.1 10c-.551 0-.982.486-.843 1.02A8.007 8.007 0 007.1 16.95v2.15a.9.9 0 101.8 0v-2.15a8.007 8.007 0 006.843-5.93c.139-.534-.292-1.02-.843-1.02-.45 0-.826.329-.953.76a6.203 6.203 0 01-11.894 0C1.926 10.33 1.55 10 1.1 10z"}))},Tt=function(){return(Tt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},wt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},It=function(e){var t=wt(e,[]);return p.a.createElement("svg",Tt({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),p.a.createElement("path",{d:"M17 12.5c2.294 0 6.5.857 6.5 4.286 0 1.5-.382 1.714-1.147 1.714h-6.09c.158-.488.237-1.062.237-1.714 0-1.723-.631-3.067-1.672-4.062.783-.16 1.548-.224 2.172-.224zm-9 0c2.294 0 6.5.857 6.5 4.286 0 1.5-.382 1.714-1.147 1.714H2.647c-.765 0-1.147-.214-1.147-1.714C1.5 13.357 5.706 12.5 8 12.5zM8 5a3 3 0 110 6 3 3 0 110-6zm9 0a3 3 0 110 6 3 3 0 110-6z"}))},Pt=n("UlUB"),jt=function(){return(jt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},kt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},At=function(e){var t=kt(e,[]);return p.a.createElement("svg",jt({width:"24",height:"24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),p.a.createElement("path",{d:"M3.86 14c-.24 0-.47.02-.7.06a1 1 0 11-.33-1.98 6.14 6.14 0 017.08 7.08 1 1 0 01-1.97-.33A4.14 4.14 0 003.85 14z"}),p.a.createElement("path",{d:"M4 20a2 2 0 100-4 2 2 0 000 4zM10.96 4h2.08c1.37 0 2.45 0 3.33.07.9.07 1.65.23 2.35.58a6 6 0 012.63 2.63c.35.7.5 1.46.58 2.35.07.88.07 1.33.07 1.33v2.08s0 .45-.07 1.33c-.07.9-.23 1.65-.58 2.35a6 6 0 01-2.63 2.63c-.7.35-1.46.5-2.35.58-.88.07-1.96.07-3.33.07H13a1 1 0 110-2c1.42 0 2.42 0 3.2-.06a4.23 4.23 0 001.62-.38 4 4 0 001.74-1.74c.2-.37.31-.85.38-1.62.06-.78.06-1.2.06-1.2v-2s0-.42-.06-1.2a4.23 4.23 0 00-.38-1.62 4 4 0 00-1.74-1.74c-.37-.2-.85-.31-1.62-.38C15.42 6 14.42 6 13 6h-2c-1.42 0-2.42 0-3.2.06-1.78.15-3.35 1.23-3.66 3.1a1 1 0 11-1.97-.32 5.8 5.8 0 013.1-4.19c.7-.35 1.47-.5 2.36-.58C8.51 4 9.6 4 10.96 4z"}))},Rt=function(){return(Rt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Lt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Nt=function(e){var t=Lt(e,[]);return p.a.createElement("svg",Rt({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),p.a.createElement("path",{d:"M6 5.18c.65 0 1 .54 1 1.2v5.48c0 .22.26.4.47.4.23 0 .52-.18.52-.4V4c0-.66.33-1.2.99-1.2.65 0 1.02.54 1.02 1.2v7.08c0 .22.29.4.5.4.22 0 .5-.18.5-.4V3.19c0-.66.31-1.2.97-1.2.66 0 1.04.54 1.04 1.2v7.88c0 .22.24.4.46.4.22 0 .52-.18.52-.4V4.79c0-.67.32-1.18.98-1.18.66 0 1.02.51 1.02 1.17v10.73l2.29-2.67c.33-.45 1-.68 1.65-.26.34.2.86.81.2 1.68 0 0-2.45 3.09-3.81 4.74-1.3 1.65-3.81 2.5-5.51 2.5C5.25 21.5 5 17.71 5 16.43V6.37c0-.65.33-1.19 1-1.19z"}))},Mt=function(){return(Mt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Dt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},xt=function(e){var t=Dt(e,[]);return p.a.createElement("svg",Mt({height:"16",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),p.a.createElement("path",{d:"M6.1 9a.9.9 0 01.9.9v4.2a.9.9 0 11-1.8 0v-2.027l-3.664 3.663a.9.9 0 11-1.272-1.272L3.927 10.8H1.9a.9.9 0 110-1.8zM15.736.264a.9.9 0 010 1.272L12.073 5.2h2.025a.9.9 0 010 1.8H9.9a.9.9 0 01-.9-.9V1.9a.9.9 0 111.8 0v2.027L14.464.264a.9.9 0 011.272 0z"}))},Ut=function(){return(Ut=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Bt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Ft=function(e){var t=Bt(e,[]);return p.a.createElement("svg",Ut({height:"16",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),p.a.createElement("path",{d:"M6.5 15a1 1 0 01-1 1H1a1 1 0 01-1-1v-4.5a1 1 0 012 0v2.071l3.363-3.364a1 1 0 011.414 0l.016.016a1 1 0 010 1.414L3.428 14H5.5a1 1 0 011 1zM14 3.428l-3.363 3.365a1 1 0 01-1.414 0l-.016-.016a1 1 0 010-1.414L12.571 2H10.5a1 1 0 010-2H15a1 1 0 011 1v4.5a1 1 0 01-2 0z"}))},Ht=function(){return(Ht=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Gt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Vt=function(e){var t=Gt(e,[]);return p.a.createElement("svg",Ht({height:"16",width:"22",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),p.a.createElement("path",{d:"M1.514.242A.9.9 0 00.286 1.558l1.092 1.02C1.13 3.053 1 3.548 1 4.846v6.308c0 1.338.14 1.822.4 2.311.262.49.646.873 1.135 1.134.489.262.974.401 2.31.401h7.31c1.207 0 1.72-.114 2.168-.328l1.163 1.086a.9.9 0 001.228-1.316L1.514.242zM15.999 11.346L4.924 1h7.23c1.338 0 1.822.14 2.311.4.49.262.873.646 1.134 1.135.262.489.401.974.401 2.31 0 2.167.023 4.335-.001 6.501zM22 4.497v7.006c0 .815-.964 1.277-1.6.8l-2.2-1.653a.5.5 0 01-.2-.4v-4.5a.5.5 0 01.2-.4l2.2-1.652c.651-.49 1.6.003 1.6.8z"}))};function qt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return zt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return zt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Kt(e){var t=e.id,n=e.photo,r=e.disablePhoto,i=e.title,a=e.description,o=e.info,s=e.chatUnreadCount,c=void 0===s?0:s,u=e.callMenuActions,l=e.isVideoEnabled,p=e.isAudioEnabled,h=e.isScreenSharingEnabled,f=e.isOratorMode,m=e.isFullScreen,g=e.onToggleVideo,v=e.onToggleAudio,_=e.onLeaveCall,b=e.canAddParticipants,y=e.onAddParticipants,E=e.onOpenSettings,O=e.onCollapseCall,C=e.onToggleOratorMode,S=e.onChat,T=e.onHandClick,w=e.onToggleScreenShare,I=e.onFullScreenToggle,P=e.isParticipantControlShown,j=e.isParticipantControlActive,k=e.isLayoutSwitchShown,A=e.isScreenShareControlShown,R=e.isHandRaised,L=e.isHandControlShown,M=e.isChatControlShown,x=e.isUpdateEnabled,U=e.onParticipantsClick,F=e.notification,H=e.children,V=Object(D.classNames)("Call",{"Call--fullscreen":m}),q=qt(d.useState(!0),2),z=q[0],K=q[1];d.useEffect(()=>{var e=null,t=!1;function n(){t||(e&&clearTimeout(e),K(!0),e=setTimeout(()=>{K(!1),e=null},5e3))}n();var r=Object(Pt.throttle)(n,1e3);return window.addEventListener("mousemove",r),()=>{t=!0,e&&clearTimeout(e),window.removeEventListener("mousemove",r)}},[]);var W=Object(D.classNames)("Call__controlPanel",{"Call__controlPanel--hideBottom":!z}),Y=Object(D.classNames)("Call__controlPanel",{"Call__controlPanel--hideBottom":!z},"Call__curtain"),J=Object(D.classNames)("Call__footer",{"Call_footer--updated":x}),X=Object(D.classNames)("Call__buttons","Call__controlPanel",{"Call__controlPanel--hideBottom":!z,"Call_footer--updated":x}),Q=Object(D.classNames)("Call__controlPanel",{"Call__controlPanel--hideTop":!z}),ee=Object(D.classNames)("Call__info","Call__controlPanel",{"Call__controlPanel--hideTop":!z});return d.createElement("section",{className:V},d.createElement($,{id:t,photo:n,disablePhoto:r},H),!x&&d.createElement(Z,{title:i,description:a,className:Q}),x&&d.createElement("div",{className:Y}),b&&!x&&d.createElement(ut,{alignX:"r",alignY:"t",className:Q},d.createElement(re.default,{position:"b",text:Object(ie.getLang)("calls_add_participants"),marginTop:-6},d.createElement(ne,{type:"add",onClick:y}))),d.createElement(ut,{alignX:"r",alignY:"b",style:m?{right:"70px"}:void 0,className:Object(D.classNames)(W,{"CallIconButtonGroup--updated":x})},k&&d.createElement(re.default,{position:"t",text:Object(ie.getLang)(f?"calls_show_grid":"calls_show_orator"),marginTop:6},d.createElement(ne,{type:f?"changeToGrid":"changeToOrator",onClick:C})),x&&d.createElement(d.Fragment,null,d.createElement(rt,{items:u},d.createElement(ne,{type:"settings"})),d.createElement(re.default,{position:"t",text:Object(ie.getLang)("calls_collapse"),marginTop:6},d.createElement(ne,{type:"collapse",onClick:O})),d.createElement(re.default,{position:"t",text:m?Object(ie.getLang)("calls_tooltip_fullscreen_off"):Object(ie.getLang)("calls_tooltip_fullscreen_on"),marginTop:6},d.createElement(ne,{onClick:I,icon:m?d.createElement(xt,null):d.createElement(Ft,null)}))),!x&&d.createElement(d.Fragment,null,d.createElement(re.default,{position:"t",text:Object(ie.getLang)("calls_collapse"),marginTop:6},d.createElement(ne,{type:"collapse",onClick:O})))),d.createElement(ut,{alignX:"l",alignY:"b",className:Object(D.classNames)(W,{"CallIconButtonGroup--updated":x})},x&&d.createElement(d.Fragment,null,M&&d.createElement(re.default,{position:"t",text:Object(ie.getLang)("calls_chat"),marginTop:6},d.createElement(mt,{unreadCount:c,onClick:S})),L&&d.createElement(re.default,{position:"t",text:R?Object(ie.getLang)("calls_tooltip_lower_hand"):Object(ie.getLang)("calls_tooltip_raise_hand"),marginTop:6},d.createElement(ne,{icon:d.createElement(Nt,null),type:"hand",isActive:R,onClick:T}))),A&&d.createElement(re.default,{position:"t",text:h?Object(ie.getLang)("calls_stop_screen_share"):Object(ie.getLang)("calls_start_screen_share"),marginTop:6},d.createElement(ne,{icon:d.createElement(At,null),isActive:h,onClick:w})),!x&&d.createElement(re.default,{position:"t",text:Object(ie.getLang)("calls_settings"),marginTop:6},d.createElement(ne,{type:"settings",onClick:E}))),x&&d.createElement(ot,{className:ee},o),d.createElement("footer",{className:J},F&&d.createElement("div",{className:"Call__notification"},F),d.createElement("div",{className:X},P&&d.createElement(B,{type:j?N.OFF:N.ON,icon:d.createElement(It,null),onClick:U,className:"Call__footerButton"}),d.createElement(B,{type:l?N.ON:N.OFF,icon:l?d.createElement(G,null):d.createElement(Vt,null),onClick:g,className:"Call__footerButton"}),d.createElement(B,{type:p?N.ON:N.OFF,icon:p?d.createElement(St,null):d.createElement(Et,null),onClick:v,className:"Call__footerButton"}),d.createElement(B,{type:N.NEGATIVE,icon:x?d.createElement(pt,null):d.createElement(_t,null),onClick:_,className:"Call__footerButton"}))))}var Wt=function(e){var t=e.limit,n=e.children,r=d.Children.toArray(n),i=Math.min(r.length,t),a=Object(D.classNames)("CallGridNew","CallGridNew--c"+i);return p.a.createElement("section",{className:a},p.a.createElement("div",{className:"CallGridNew__in"},r.map((function(e,t){return p.a.createElement("article",{className:"CallGridNew__item",key:e.key||t},e)}))))};function Yt(e){var t=e.children,n=e.orator,r=e.onToggleParticipantsAside,i=e.isShownParticipantsAside,a=p.a.Children.toArray(t),o=Object(D.classNames)({CallOrator:!0,"CallOrator--withoutOthers":!i}),s=Object(D.classNames)({CallOrator__others:!0,"CallOrator__others--hide":!i}),c=Object(D.classNames)({CallOrator__toggleArrow:!0,"CallOrator__toggleArrow--toLeft":i,"CallOrator__toggleArrow--toRight":!i});return p.a.createElement("article",{className:o},p.a.createElement("main",{className:"CallOrator__orator"},n),p.a.createElement("button",{className:"CallOrator__toggleOthers",onClick:r},p.a.createElement("div",{className:"CallOrator__toggleIcon"},p.a.createElement("div",{className:c}))),p.a.createElement("aside",{className:s},p.a.createElement("ul",{className:"CallOrator__list"},a.map((function(e){return p.a.createElement("li",{className:"CallOrator__participant",key:e.key},e)})))))}function $t(){return($t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Jt(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var Xt=e=>{var t=e.children,n=e.className,r=Jt(e,["children","className"]),i=Object(D.classNames)("ActivityIndicator",n);return d.createElement("span",$t({},r,{className:i}),t)},Qt=function(e){var t=e.participant,n=t.status,r=t.wasConnected;switch(n){case v.WAITING:return r?p.a.createElement(Xt,null,Object(ie.getLang)("calls_status_waiting")):p.a.createElement(He,{isInverted:!0});case v.CONNECTING:case v.RECONNECT:return p.a.createElement(Xt,null,Object(ie.getLang)("calls_status_connecting"));case v.ERROR:return Object(ie.getLang)("global_error");case v.HANGUP:return p.a.createElement(Xt,null,Object(ie.getLang)("calls_status_hangup"));case v.PERMISSIONS:return Object(ie.getLang)("calls_status_no_permissions");case v.CONNECTED:default:return null}},Zt=function(e){var t=e.duration;return p.a.createElement("div",{className:"CallTimer","aria-label":t,"data-duration":t})},en=function(e){var t=e.state,n=t.peer,r=de(n)?t.callData.conversation:t.participants[n],i=p.a.useState(null),a=i[0],o=i[1],s=p.a.useState(""),c=s[0],u=s[1];return r.status!==a&&(u(tn(t,t.peer)),o(r.status)),p.a.useEffect((function(){var e=setInterval((function(){return u(tn(t,t.peer))}),1e3);return function(){return clearInterval(e)}}),[t]),p.a.createElement(p.a.Fragment,null,c)};function tn(e,t){return de(t)?rn(e)||nn():function(e){if(e.hangupType)switch(e.hangupType){case"BUSY":return Object(ie.getLang)("calls_busy");case"CALLEE_IS_OFFLINE":return Object(ie.getLang)("calls_callee_is_offline");case"REJECTED":return Object(ie.getLang)("calls_rejected_status");case T:case I:case w:case P:return null;case"CALLER_IS_BLOCKED":case"EXTERNAL_API_ERROR":case"FAILED":case"NOT_FRIENDS":case"OLD_VERSION":case"SERVICE_DISABLED":case"UNKNOWN_ERROR":case"UNSUPPORTED":return Object(ie.getLang)("global_error")}return null}(e)||function(e,t){var n=e.participants[t];return n&&n.status!==v.CONNECTED?p.a.createElement(Qt,{participant:n}):null}(e,t)||rn(e)||nn()}function nn(){return p.a.createElement(Xt,null,Object(ie.getLang)("calls_status_waiting"))}function rn(e){var t=e.callData.ts;return t?p.a.createElement(Zt,{duration:ke(t)}):null}var an=function(e){var t=e.children,n=e.className,r=Object(D.classNames)("CallNotification",n);return p.a.createElement("div",{className:r},t)},on=function(){return(on=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},sn=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},cn=function(e){var t=sn(e,[]);return p.a.createElement("svg",on({width:"14",height:"12",fill:"currentColor"},t,{xmlns:"http://www.w3.org/2000/svg"}),p.a.createElement("path",{d:"M9.574 11.13a.751.751 0 001.061-1.06L1.48.92A.75.75 0 10.42 1.98l.82.82c-.153.282-.24.606-.24.95v4.5a2 2 0 002 2h5a2 2 0 00.601-.092l.973.972zM13.897 3.664A.454.454 0 0114 3.95v4.075c0 .415-.392.602-.825.382-.475-.24-1.572-.789-1.572-.789a.233.233 0 01-.103-.19v-2.88c0-.075.038-.146.103-.19 0 0 1.378-.694 1.572-.79.193-.094.55-.115.722.096zM10 7.425V3.75a2 2 0 00-2-2H4.32L10 7.425z"}))},un=function(e){var t=e.state,n=e.dispatch,r=Object(d.useMemo)((function(){return function(e){if(!e.notification)return null;switch(e.notification.type){case _.SPEAKING_ON_MUTE:return p.a.createElement(Q.default,null,Object(ie.getLang)("calls_notification_mic_is_mute"));case _.NO_SIMULTANEOUS_SHARING:if(!(n=e.screenSharer?e.participants[e.screenSharer]:null)||!n.name)return p.a.createElement(Q.default,null,Object(ie.getLang)("calls_notification_screen_already_shared"));var t=Object(ge.langSex)(n.sex,Object(ie.getLang)("calls_notification_screen_already_shared_by_user",!0));return p.a.createElement(Q.default,null,t.replace("{user}",n.name));case _.SCREEN_SHARING_STARTED:if(!(n=e.screenSharer?e.participants[e.screenSharer]:null)||!n.name)return p.a.createElement(Q.default,null,Object(ie.getLang)("calls_notification_screen_sharing_started"));t=Object(ge.langSex)(n.sex,Object(ie.getLang)("calls_notification_user_started_screen_sharing",!0));return p.a.createElement(Q.default,null,t.replace("{user}",n.name));case _.RAISED_HAND:var n=e.participants[e.notification.data];t=Object(ge.langSex)(n.sex,Object(ie.getLang)("calls_notification_raised_hand",!0));return p.a.createElement(Q.default,null,t.replace("{user}",n.name));case _.BAD_NETWORK_CONNECTION:return p.a.createElement(Q.default,null,Object(ie.getLang)("calls_notification_bad_network_connection"));case _.BAD_NETWORK_CONNECTION_DISABLE_CAMERA:return[p.a.createElement(cn,{key:"icon"}),p.a.createElement(Q.default,{key:"text"},Object(ie.getLang)("calls_notification_bad_network_connection_disable_camera"))];default:return null}}(t)}),[t.notification]),i=Object(d.useRef)(0);return Object(d.useEffect)((function(){return i.current&&window.clearTimeout(i.current),t.notification&&0!==t.notification.timer&&(i.current=window.setTimeout((function(){n({type:"call_notification",notification:null}),i.current=0}),t.notification.timer||5e3)),function(){i.current&&window.clearTimeout(i.current)}}),[t.notification]),t.notification?p.a.createElement(an,null,r):null};function ln(e,t){return[function(){return dn(e).imHash},function(e){return t({type:"update_hash",hash:e}),e}]}function dn(e){return"current"in e?e.current:e}var pn=n("BxOC"),hn=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Object(pn.post)(me.CONTROLLER,{act:"a_load_call_peers",peerId:+t,memberIds:n,hash:e,anonymId:r})},fn=(e,t)=>Object(pn.post)(me.CONTROLLER,{act:"a_get_chat_members",chat:t,hash:e}),mn=e=>Object(pn.post)(me.CONTROLLER,{act:"a_get_calls_token",hash:e}),gn=(e,t)=>Object(pn.post)(me.CONTROLLER,{act:"a_get_call_link",hash:e,callId:t}),vn=e=>Object(pn.post)(me.CONTROLLER,{act:"a_get_friends",hash:e}),_n=(e,t)=>Object(pn.post)(me.CONTROLLER,{act:"a_force_call_finish",hash:e,callId:t}),bn=(e,t,n)=>Object(pn.post)(me.CONTROLLER,{act:"a_get_active_call_data",peer_id:t,hash:e,userId:n}),yn=(e,t,n,r,i)=>Object(pn.post)(me.CONTROLLER,{act:"a_load_call_participants",callId:t,peerIds:n,userId:r,hash:e,withConversation:i.withConversation,withChatMembers:i.withChatMembers,withCallParticipants:i.withCallParticipants}),En=function(e){var t=e.id;return{peerId:t,id:t,name:e.name,link:e.link,photo:e.photo,sex:e.sex,firstName:e.first_name,lastName:e.last_name}},On=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)r[i]=a[o];return r};function Cn(e,t){var n=ln(e,t),r=n[0],i=n[1];return dn(e).friends.length>0?Promise.resolve():(window.curFastChat&&window.curFastChat.friends?Promise.resolve([window.curFastChat.friends]):Le(vn,Me.bind(null,r,i))()).then((function(e){var n=e[0],r=Object.entries(n).map((function(e){var t=e[0],n=e[1],r=n[0],i=n[1],a=n[2],o=n[4],s=n[5];return{id:parseInt(t),peerId:parseInt(t),name:r,photo:i,firstName:a,link:s,sex:o}}));t({type:"set_friends",data:r})}))}function Sn(e,t,n,r){var i=ln(e,t),a=i[0],o=i[1];return Le(fn,Me.bind(null,a,o))(n).then((function(n){var i=n[0][2];t({type:"set_chat_info",data:i.map(En).sort((function(t,n){var r=dn(e).me;return t.peerId===r?-1:n.peerId===r?1:0})),conversation:r})}))}function Tn(e,t,n,r){var i=ln(e,t),a=i[0],o=i[1];return Le(hn,(function(e){return Me(a,o,e)}))(n,r).then(M.preloadImagesFromResponse).then((function(e){var r=Te(e),i=r[0],a=r[1];t({type:"load_peer",conversation:i,members:a,peerId:n})}))}function wn(e,t,n){if(!n)return Promise.resolve();var r=ln(e,t),i=r[0],a=r[1],o=dn(e).me,s=o<0?o:void 0;return Le(bn,(function(e){return Me(i,a,e)}))(n,s).then((function(e){var n=e[0];n&&t({type:"call_state",callData:{canFinishCall:n.can_finish_call,hasUrlLink:n.has_link}})}))}function In(e,t,n,r,i){var a=ln(e,t),o=a[0],s=a[1],c=dn(e).me,u=c<0?c:void 0;return Le(yn,(function(e){return Me(o,s,e)}))(n,r,u,i).then((function(e){var t=e[0],n=t.conversation,r=t.anonyms,a=t.profiles,o=On(Object.values(r),Object.values(a)),s=Object(M.preloadImagesFromResponse)([n||{},o]);return i.awaitImages?s.then((function(){return[n,o]})):[n,o]})).then((function(e){var n=e[0],r=e[1];t({type:"load_peer",conversation:n,members:r})})).catch((function(e){return console.error(e)}))}let Pn=!0,jn=!0;function kn(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function An(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);const a=e=>{const t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,a),i.apply(this,[e,a])};const a=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(n))return a.apply(this,arguments);const r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,a.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function Rn(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Pn=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Ln(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(jn=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Nn(){if("object"==typeof window){if(Pn)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Mn(e,t){jn&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Dn(e){const{navigator:t}=e,n={browser:null,version:null};if(void 0===e||!e.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=kn(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)n.browser="chrome",n.version=kn(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=kn(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=kn(t.userAgent,/AppleWebKit\/(\d+)\./,1),n.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return n}function xn(e){return"[object Object]"===Object.prototype.toString.call(e)}function Un(e){return xn(e)?Object.keys(e).reduce((function(t,n){const r=xn(e[n]),i=r?Un(e[n]):e[n],a=r&&!Object.keys(i).length;return void 0===i||a?t:Object.assign(t,{[n]:i})}),{}):e}function Bn(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;const a=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)}),a.forEach(t=>{e.forEach(n=>{n.type===r&&n.trackId===t.id&&function e(t,n,r){n&&!r.has(n.id)&&(r.set(n.id,n),Object.keys(n).forEach(i=>{i.endsWith("Id")?e(t,t.get(n[i]),r):i.endsWith("Ids")&&n[i].forEach(n=>{e(t,t.get(n),r)})}))}(e,n,i)})}),i}const Fn=Nn;function Hn(e){const t=e&&e.navigator;if(!t.mediaDevices)return;const n=Dn(e),r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach(n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[i("min",n)]=r.ideal,t.optional.push(e),e={},e[i("max",n)]=r.ideal,t.optional.push(e)):(e[i("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(n.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let a=e.video.facingMode;a=a&&("object"==typeof a?a:{ideal:a});const o=n.version<66;if(a&&("user"===a.exact||"environment"===a.exact||"user"===a.ideal||"environment"===a.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||o)){let n;if(delete e.video.facingMode,"environment"===a.exact||"environment"===a.ideal?n=["back","rear"]:"user"!==a.exact&&"user"!==a.ideal||(n=["front"]),n)return t.mediaDevices.enumerateDevices().then(t=>{let o=(t=t.filter(e=>"videoinput"===e.kind)).find(e=>n.some(t=>e.label.toLowerCase().includes(t)));return!o&&t.length&&n.includes("back")&&(o=t[t.length-1]),o&&(e.video.deviceId=a.exact?{exact:o.deviceId}:{ideal:o.deviceId}),e.video=r(e.video),Fn("chrome: "+JSON.stringify(e)),i(e)})}e.video=r(e.video)}return Fn("chrome: "+JSON.stringify(e)),i(e)},a=function(e){return n.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=function(e,n,r){i(e,e=>{t.webkitGetUserMedia(e,n,e=>{r&&r(a(e))})})}.bind(t),t.mediaDevices.getUserMedia){const e=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(t){return i(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Promise.reject(a(e))))}}}function Gn(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(t=>{const r=n.video&&n.video.width,i=n.video&&n.video.height,a=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:a||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function Vn(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function qn(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.track.id):{track:n.track};const i=new Event("track");i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}),t.stream.getTracks().forEach(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.id):{track:n};const i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else An(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function zn(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach(e=>{const t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Kn(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,r]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const i=function(e){const t={};return e.result().forEach(e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(t=>{n[t]=e.stat(t)}),t[n.id]=n}),t},a=function(e){return new Map(Object.keys(e).map(t=>[t,e[t]]))};if(arguments.length>=2){const r=function(e){n(a(i(e)))};return t.apply(this,[r,e])}return new Promise((e,n)=>{t.apply(this,[function(t){e(a(i(t)))},n])}).then(n,r)}}function Wn(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>Bn(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),An(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>Bn(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach(n=>{n.track===e&&(t?r=!0:t=n)}),this.getReceivers().forEach(t=>(t.track===e&&(n?r=!0:n=t),t.track===e)),r||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Yn(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),i.apply(this,arguments)}}function $n(e){if(!e.RTCPeerConnection)return;const t=Dn(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Yn(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};const i=e.RTCPeerConnection.prototype.removeStream;function a(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const i=this.getSenders().find(e=>e.track===t);if(i)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const a=this._streams[n.id];if(a)a.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=a(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then(e=>a(this,e))}};e.RTCPeerConnection.prototype[t]=r[t]}));const s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=o(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=c.get.apply(this);return""===e.type?e:a(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach(n=>{this._streams[n].getTracks().find(t=>e.track===t)&&(t=this._streams[n])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Jn(e){const t=Dn(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),!e.RTCPeerConnection)return;const n=0===e.RTCPeerConnection.prototype.addIceCandidate.length;t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}));const r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return n||arguments[0]?t.version<78&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}function Xn(e){const t=Dn(e);An(e,"negotiationneeded",e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e})}var Qn=n("8D0k"),Zn=n.n(Qn);function er(e){const t=e&&e.navigator,n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch(e=>Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString(){return this.name}}}(e)))}}function tr(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}function nr(e){const t=Dn(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){const t=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set(e){t.set.call(this,e);const n=new Event("enabled");n.enabled=e,this.dispatchEvent(n)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);const n=Zn()(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=function(e,t){let n=!1;return(e=JSON.parse(JSON.stringify(e))).filter(e=>{if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&Mn("RTCIceServer.url","RTCIceServer.urls");const r="string"==typeof t;return r&&(t=[t]),t=t.filter(e=>{if(0===e.indexOf("stun:"))return!1;const t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!n?(n=!0,!0):t&&!n}),delete e.url,e.urls=r?t[0]:t,!!t.length}})}(e.iceServers,t.version),Nn("ICE servers after filtering:",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype}function rr(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}function ir(e){const t=Dn(e),n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){Mn("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function ar(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}function or(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function sr(e){const t=Dn(e);if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;if(!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]})),t.version<68){const t=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?arguments[0]&&""===arguments[0].candidate?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,a]=arguments;return r.apply(this,[e||null]).then(e=>{if(t.version<53&&!i)try{e.forEach(e=>{e.type=n[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(i,a)}}function cr(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function ur(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),An(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function lr(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){Mn("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function dr(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function pr(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const e=arguments[1],n=e&&"sendEncodings"in e;n&&e.sendEncodings.forEach(e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=t.apply(this,arguments);if(n){const{sender:t}=r,n=t.getParameters();"encodings"in n||(n.encodings=e.sendEncodings,t.sendEncodings=e.sendEncodings,this.setParametersPromises.push(t.setParameters(n).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return r})}function hr(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"sendEncodings"in this?Object.assign({},{encodings:this.sendEncodings},e):e})}function fr(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function mr(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function gr(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(n=>t.call(this,n,e)),e.getVideoTracks().forEach(n=>t.call(this,n,e))},e.RTCPeerConnection.prototype.addTrack=function(e,...n){return n&&n.forEach(e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach(e=>{n.includes(e.track)&&this.removeTrack(e)})})}}function vr(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)})}),t.apply(e,arguments)}}}function _r(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};let s=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){const r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=s}function br(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(yr(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function yr(e){return e&&void 0!==e.video?Object.assign({},e,{video:Un(e.video)}):e}function Er(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(Mn("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Or(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Cr(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return t.apply(this,arguments)}}function Sr(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Tr=n("KCt4"),wr=n.n(Tr);function Ir(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),r=wr.a.parseCandidate(e.candidate),i=Object.assign(n,r);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,An(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function Pr(e){if(!e.RTCPeerConnection)return;const t=Dn(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){if(!e||!e.sdp)return!1;const t=wr.a.splitSections(e.sdp);return t.shift(),t.some(e=>{const t=wr.a.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},r=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n},i=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},a=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const i=wr.a.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const e=r(arguments[0]),t=i(e),n=a(arguments[0],e);let o;o=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);const s={};Object.defineProperty(s,"maxMessageSize",{get:()=>o}),this._sctp=s}return o.apply(this,arguments)}}function jr(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},An(e,"datachannel",e=>(t(e.channel,e.target),e))}function kr(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function Ar(e){if(!e.RTCPeerConnection)return;const t=Dn(e);if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==e.trim()).join("\n")),n.apply(this,arguments)}}!function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const n=Nn,c=Dn(e),u={browserDetails:c,commonShim:s,extractVersion:kn,disableLog:Rn,disableWarnings:Ln};switch(c.browser){case"chrome":if(!r||!Jn||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),u;if(null===c.version)return n("Chrome shim can not determine version, not shimming."),u;n("adapter.js shimming chrome."),u.browserShim=r,Hn(e),Vn(e),Jn(e),qn(e),$n(e),zn(e),Kn(e),Wn(e),Xn(e),Ir(e),kr(e),Pr(e),jr(e),Ar(e);break;case"firefox":if(!a||!sr||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),u;n("adapter.js shimming firefox."),u.browserShim=a,ir(e),sr(e),or(e),lr(e),cr(e),ur(e),dr(e),pr(e),hr(e),fr(e),mr(e),Ir(e),kr(e),Pr(e),jr(e);break;case"edge":if(!i||!nr||!t.shimEdge)return n("MS edge shim is not included in this adapter release."),u;n("adapter.js shimming edge."),u.browserShim=i,er(e),tr(e),nr(e),rr(e),Pr(e),jr(e);break;case"safari":if(!o||!t.shimSafari)return n("Safari shim is not included in this adapter release."),u;n("adapter.js shimming safari."),u.browserShim=o,Er(e),Cr(e),_r(e),gr(e),vr(e),Or(e),br(e),Sr(e),Ir(e),Pr(e),jr(e),Ar(e);break;default:n("Unsupported browser!")}}({window});var Rr=n("dAlA"),Lr=n.n(Rr),Nr=n("9XzT"),Mr=function(e,t){return(Mr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function Dr(e,t){function n(){this.constructor=e}Mr(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var xr,Ur,Br=function(){return(Br=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function Fr(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))}function Hr(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function Gr(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)r[i]=a[o];return r}(Ur=xr||(xr={})).CAMERA_PERMISSION="camera",Ur.MIC_PERMISSION="mic",Ur.CAMERA_ACCESS="cameralock",Ur.MIC_ACCESS="miclock",Ur.MIC_NOT_FOUND="nomic",Ur.SCREEN_PERMISSION="screenpermission",Ur.SCREEN_ACCESS="screenlock",Ur.CONNECTION="connection",Ur.NETWORK="network",Ur.UNKNOWN="unknown",Ur.UNSUPPORTED="unsupported",Ur.SIGNALING_FAILED="signalingfailed",Ur.API="api",Ur.AUTH="auth";var Vr,qr=xr,zr=function(){function e(){}return Object.defineProperty(e,"sessionKey",{get:function(){return e._sessionKey},set:function(t){e._sessionKey=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"sessionSecretKey",{get:function(){return e._sessionSecretKey},set:function(t){e._sessionSecretKey=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"accessToken",{get:function(){return e._accessToken},set:function(t){e._accessToken=t},enumerable:!1,configurable:!0}),e.isEmpty=function(){return!e._sessionKey||!e._sessionSecretKey},e}(),Kr=function(){function e(){}return e.set=function(t){t.hasOwnProperty("voiceParams")&&(Object.assign(e._params.voiceParams,t.voiceParams),delete t.voiceParams),t.hasOwnProperty("specListenerParams")&&(Object.assign(e._params.specListenerParams,t.specListenerParams),delete t.specListenerParams),t.hasOwnProperty("unifiedPlanBrowsers")&&(Object.assign(e._params.unifiedPlanBrowsers,t.unifiedPlanBrowsers),delete t.unifiedPlanBrowsers),t.hasOwnProperty("apiAuth")&&(zr.accessToken=t.apiAuth.accessToken,zr.sessionKey=t.apiAuth.sessionKey,zr.sessionSecretKey=t.apiAuth.sessionSecretKey),Object.assign(e._params,t)},e.get=function(t){return e._params[t]},Object.defineProperty(e,"appName",{get:function(){return e._params.appName},enumerable:!1,configurable:!0}),Object.defineProperty(e,"appVersion",{get:function(){return e._params.appVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e,"protocolVersion",{get:function(){return e._params.protocolVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e,"platform",{get:function(){return e._params.platform},enumerable:!1,configurable:!0}),Object.defineProperty(e,"clientType",{get:function(){return e._params.clientType},set:function(t){e._params.clientType=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"device",{get:function(){return e._params.device},enumerable:!1,configurable:!0}),Object.defineProperty(e,"apiAppId",{get:function(){return e._params.apiAppId},enumerable:!1,configurable:!0}),Object.defineProperty(e,"apiKey",{get:function(){return e._params.apiKey},enumerable:!1,configurable:!0}),Object.defineProperty(e,"apiEnv",{get:function(){switch(e._params.apiEnv){case"TEST":return{api:"https://apitest.ok.ru/api/",connect:"https://test.ok.ru/"};case"VIDEOTEST":return{api:"https://videotestapi.ok.ru/api/",connect:"https://test.ok.ru/"};default:return{api:"https://api.ok.ru/",connect:"https://connect.ok.ru/"}}},enumerable:!1,configurable:!0}),Object.defineProperty(e,"authToken",{get:function(){return e._params.authToken},set:function(t){e._params.authToken=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"anonymToken",{get:function(){return e._params.anonymToken},set:function(t){e._params.anonymToken=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"iceServers",{get:function(){return e._params.iceServers},set:function(t){e._params.iceServers=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"wssBase",{get:function(){return e._params.wssBase},set:function(t){e._params.wssBase=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"wssToken",{get:function(){return e._params.wssToken},set:function(t){e._params.wssToken=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"signalingReconnectDelay",{get:function(){return e._params.signalingReconnectDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e,"signalingReconnectMaxDelay",{get:function(){return e._params.signalingReconnectMaxDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e,"signalingReconnectMaxCount",{get:function(){return e._params.signalingReconnectMaxCount},enumerable:!1,configurable:!0}),Object.defineProperty(e,"waitConnectionDelay",{get:function(){return e._params.waitConnectionDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e,"waitResponseDelay",{get:function(){return e._params.waitResponseDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e,"waitMessageDelay",{get:function(){return e._params.waitMessageDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoMinWidth",{get:function(){return e._params.videoMinWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoMaxWidth",{get:function(){return e._params.videoMaxWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoMinHeight",{get:function(){return e._params.videoMinHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoMaxHeight",{get:function(){return e._params.videoMaxHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoAspectRatio",{get:function(){return e._params.videoAspectRatio},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoFrameRate",{get:function(){return e._params.videoFrameRate},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoFacingMode",{get:function(){return e._params.videoFacingMode},enumerable:!1,configurable:!0}),Object.defineProperty(e,"screenFrameRate",{get:function(){return e._params.screenFrameRate},enumerable:!1,configurable:!0}),Object.defineProperty(e,"voiceParams",{get:function(){return e._params.voiceParams},enumerable:!1,configurable:!0}),Object.defineProperty(e,"specListenerParams",{get:function(){return e._params.specListenerParams},enumerable:!1,configurable:!0}),Object.defineProperty(e,"iceRestartWaitTime",{get:function(){return e._params.iceRestartWaitTime},enumerable:!1,configurable:!0}),Object.defineProperty(e,"transportConnectionWaitTime",{get:function(){return e._params.transportConnectionWaitTime},enumerable:!1,configurable:!0}),Object.defineProperty(e,"debugInfoInterval",{get:function(){return e._params.debugInfoInterval},enumerable:!1,configurable:!0}),Object.defineProperty(e,"perfStatReportEnabled",{get:function(){return e._params.perfStatReportEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(e,"allowMissingMic",{get:function(){return e._params.allowMissingMic},enumerable:!1,configurable:!0}),Object.defineProperty(e,"directAudioOutput",{get:function(){return e._params.directAudioOutput},enumerable:!1,configurable:!0}),Object.defineProperty(e,"badConnectionAudioBitrate",{get:function(){return e._params.badConnectionAudioBitrate},enumerable:!1,configurable:!0}),Object.defineProperty(e,"badConnectionSilenceBitrate",{get:function(){return e._params.badConnectionSilenceBitrate},enumerable:!1,configurable:!0}),Object.defineProperty(e,"badConnectionVideoBitrate",{get:function(){return e._params.badConnectionVideoBitrate},enumerable:!1,configurable:!0}),e.isUnifiedPlan=function(t,n){var r=e._params.unifiedPlanBrowsers;return!!r.hasOwnProperty(t)&&n>=r[t]},e._params={appName:"ok.calls.sdk.js",appVersion:1.1,protocolVersion:3,platform:"WEB",clientType:"PORTAL",device:"browser",apiAppId:42,apiKey:"",authToken:"",anonymToken:"",apiEnv:"PROD",iceServers:[],wssBase:"",wssToken:"",signalingReconnectDelay:1e3,signalingReconnectMaxDelay:5e3,signalingReconnectMaxCount:20,waitConnectionDelay:1e4,waitResponseDelay:1e4,waitMessageDelay:15e3,videoMinWidth:428,videoMinHeight:240,videoMaxWidth:1280,videoMaxHeight:720,videoAspectRatio:16/9,videoFrameRate:25,screenFrameRate:15,iceRestartWaitTime:2e4,transportConnectionWaitTime:5e3,debugInfoInterval:5e3,perfStatReportEnabled:!0,voiceParams:{smoothing:.8,minFreq:200,maxFreq:5e3,interval:500,threshold:.35,speakerLevelMultiplier:1.8},specListenerParams:{connectionTimeout:1e4,volumeTimeout:1e4},unifiedPlanBrowsers:{Firefox:10,Chrome:76,Safari:12},allowMissingMic:!1,directAudioOutput:!1,badConnectionAudioBitrate:2e3,badConnectionSilenceBitrate:800,badConnectionVideoBitrate:3e4},e}();function Wr(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=Kr.get(e);r&&r.apply(null,t)}function Yr(e){return Object.assign({},e)}!function(e){e.onLocalStream=function(e,t){Wr("onLocalStream",e,Yr(t))},e.onLocalStreamUpdate=function(e,t){Wr("onLocalStreamUpdate",Yr(e),t)},e.onRemoteStream=function(e,t){Wr("onRemoteStream",e,t)},e.onConversation=function(e){Wr("onConversation",e)},e.onRemoteMediaSettings=function(e,t){Wr("onRemoteMediaSettings",e,Yr(t))},e.onRemoteParticipantState=function(e,t){Wr("onRemoteParticipantState",e,Yr(t))},e.onParticipantStatus=function(e,t,n){void 0===n&&(n=null),Wr("onParticipantStatus",e,t,n)},e.onUserPermissions=function(e){Wr("onUserPermissions",e.slice())},e.onPermissionsRequested=function(){Wr("onPermissionsRequested")},e.onPermissionsError=function(e){Wr("onPermissionsError",e)},e.onRemoteRemoved=function(e){Wr("onRemoteRemoved",e)},e.onCallState=function(e,t,n){Wr("onCallState",e,t,Yr(n))},e.onCallAccepted=function(){Wr("onCallAccepted")},e.onRateNeeded=function(){Wr("onRateNeeded")},e.onSpeakerChanged=function(e){Wr("onSpeakerChanged",e)},e.onVolumesDetected=function(e){Wr("onVolumesDetected",e)},e.onLocalVolume=function(e,t){Wr("onLocalVolume",e,t)},e.onJoinStatus=function(e,t){Wr("onJoinStatus",e,t)},e.onHangup=function(e,t){Wr("onHangup",e,t)},e.onMultipartyChatCreated=function(e){Wr("onMultipartyChatCreated",Yr(e))},e.onDeviceChange=function(){Wr("onDeviceChange")},e.onFingerprintChange=function(e){Wr("onFingerprintChange",e)},e.onTokenExpired=function(){Wr("onTokenExpired")},e.onChatMessage=function(e,t,n){void 0===n&&(n=!1),Wr("onChatMessage",e,t,n)},e.onCustomData=function(e,t,n){void 0===n&&(n=!1),Wr("onCustomData",e,t,n)},e.onRecordStarted=function(e,t,n,r){Wr("onRecordStarted",e,t,n,r)},e.onRecordStopped=function(){Wr("onRecordStopped")},e.onNetworkStatus=function(e){Wr("onNetworkStatus",e)},e.onDebugMessage=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];Wr.apply(void 0,Gr(["onDebugMessage",e],t))}}(Vr||(Vr={}));var $r,Jr,Xr=Vr;!function(e){e.DEBUG="DEBUG",e.LOG="LOG",e.WARN="WARN",e.ERROR="ERROR"}($r||($r={})),function(e){var t=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];Xr.onDebugMessage.apply(Xr,Gr([e],t))},n=console.debug.bind(console,"📞"),r=console.log.bind(console,"📞"),i=console.warn.bind(console,"📞"),a=console.error.bind(console,"📞"),o=t.bind(null,$r.DEBUG),s=t.bind(null,$r.LOG),c=t.bind(null,$r.WARN),u=t.bind(null,$r.ERROR);e.debug=o,e.log=s,e.warn=c,e.error=u,e.toggle=function(t){t?(e.debug=n,e.log=r,e.warn=i,e.error=a):(e.debug=o,e.log=s,e.warn=c,e.error=u)}}(Jr||(Jr={}));var Qr,Zr=Jr,ei=function(){try{var e,t=Date.now().toString(),n=window.localStorage;return n.setItem(t,t),e=n.getItem(t)===t,n.removeItem(t),e?n:null}catch(e){return null}}();!function(e){e.get=function(e){return function(e){var t=ei?ei.getItem("_okcls_"+e):null;if(null===t)return null;try{return JSON.parse(t)}catch(e){return null}}(e)||null},e.set=function(e,t){!function(e,t){try{ei&&ei.setItem("_okcls_"+e,JSON.stringify(t))}catch(e){}}(e,t)},e.remove=function(e){!function(e){ei&&ei.removeItem("_okcls_"+e)}(e)}}(Qr||(Qr={}));var ti,ni=Qr;!function(e){e.patchSDP=function(e,t,n){if(!t&&!n)return e;var r=new RegExp("[\r\n]+");function i(e,t,n){var r,i=e.split(" "),a=i.slice(0,3);for(r=3;r<i.length;r++)n.includes(i[r])&&a.push(i[r]);for(r=3;r<i.length;r++)n.includes(i[r])||t.includes(i[r])||a.push(i[r]);return a.join(" ")}function a(e,t,n,r){var a,o="m="+t;for(a=0;a<e.length;++a)if(e[a].startsWith(o)){e[a]=i(e[a],n,r);break}}var o=[],s=e.split(r);if((n||t)&&(o=function(e,t){var n,r=new RegExp("a=rtpmap:(\\d+) ([a-zA-Z0-9-]+)\\/\\d+"),i=[];for(n=0;n<e.length;++n){var a=e[n].match(r);a&&3===a.length&&"H264"===a[2]&&i.push(a[1])}return i}(s)),n){var c=o.slice(0),u=new RegExp("a=fmtp:(\\d+) apt=(\\d+)"),l=void 0;for(l=0;l<s.length;++l)(p=s[l].match(u))&&3===p.length&&c.includes(p[2])&&c.push(p[1]);var d=new RegExp("a=(rtpmap|rtcp-fb|fmtp):(\\d+) .*");for(l=s.length;l--;){var p;(p=s[l].match(d))&&3===p.length&&c.includes(p[2])&&s.splice(l,1)}a(s,"video",c,[])}else t&&a(s,"video",[],o);return s.join("\r\n")},e.getPeerIdString=function(e){return e?e.type+"_"+e.id:"_"},e.getPeerConnectionHostInfo=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){return e&&e.getStats?[2,e.getStats(null).then((function(e){var t=null,n=null;if(e.forEach((function(t){"transport"===t.type&&t.selectedCandidatePairId?n=e.get(t.selectedCandidatePairId):"candidate-pair"!==t.type||"succeeded"!==t.state||n||t.hasOwnProperty("selected")&&!t.selected||(n=t)})),n&&n.localCandidateId){var r=e.get(n.localCandidateId);r&&(t={type:r.candidateType,ip:r.ip||r.ipAddress,port:r.port||r.portNumber})}return t})).catch((function(){return null}))]:[2,Promise.resolve(null)]}))}))};var t=/^[0-9]+$/,n=/^([gu])([0-9]+)$/;function r(e,r){var i=String(e);return n.test(i)?(Zr.warn("Already composite id ["+e+"] type supplied ["+r+"]"),i):"GROUP"===r?"g"+i:"USER"===r?"u"+i:(Zr.warn("Unknown type ["+r+"] for id ["+e+"]"),i.match(t)?"u"+i:i)}function i(e){return r(e.id,e.idType)}e.composeId=r,e.composeParticipantId=i,e.composeMessageId=function(e){return e.participant?i(e.participant):r(e.participantId,e.participantType)},e.decomposeId=function(e){var r=String(e),i=r.match(n);return i?{id:String(i[2]),type:"g"===i[1]?"GROUP":"USER"}:(Zr.warn("Unsupported compositeId ["+e+"]"),{id:t.test(r)?r:e,type:"USER"})},e.uuid=function(){var e,t,n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=new Array(36),i=0;for(t=0;t<36;t++)8===t||13===t||18===t||23===t?r[t]="-":14===t?r[t]="4":(i<=2&&(i=33554432+16777216*Math.random()|0),e=15&i,i>>=4,r[t]=n[19===t?3&e|8:e]);return r.join("")},e.throttle=function(e,t){var n;return function(){var r=this,i=arguments;n&&window.clearTimeout(n),n=window.setTimeout((function(){e.apply(r,i)}),t)}},e.sdpFingerprint=function(e){for(var t="",n=0,r=e.split("\n");n<r.length;n++){var i=r[n];if(i.startsWith("a=fingerprint")){var a=i.split(" ");if(2===a.length){t=a[1];break}}}if(!t)return Lr.a.minusOne;for(var o=t.split(":"),s=Lr.a.zero,c=Math.min(7,o.length-1);c>=0;c--){var u=Lr()(o[c],16);s=s.shiftLeft(8).or(u)}return function(e,t){var n=t.value;if("bigint"==typeof n)return Lr()(BigInt.asIntN(64,n));var r=Lr.a.one.shiftLeft(64),i=t.and(r.subtract(1));return i.greaterOrEquals(r.subtract(i))?i.subtract(r):i}(0,s)},e.delay=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){return[2,new Promise((function(t){return window.setTimeout(t,e)}))]}))}))},e.comparePlainObjects=function(e,t){var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(var i=0,a=n;i<a.length;i++){var o=a[i];if(!t.hasOwnProperty(o))return!1;if(t[o]!==e[o])return!1}return!0}}(ti||(ti={}));var ri,ii,ai,oi,si=ti,ci=null,ui=null,li=[],di=[],pi=[],hi=null,fi=null,mi=null,gi=!1,vi=!1,_i=!1,bi=!1,yi=null,Ei="",Oi=[],Ci=null,Si=navigator.appVersion,Ti=navigator.appName,wi=navigator.userAgent;!function(e){e.USER="user",e.ENVIRONMENT="environment",e.LEFT="left",e.RIGHT="right"}(oi||(oi={}));var Ii,Pi=function(){function e(e,t){void 0===t&&(t=!1);var n=!1;e&&(n={noiseSuppression:!0,echoCancellation:!0,autoGainControl:!0},fi&&(n.deviceId={exact:fi.deviceId}));var r=!1;t&&(r={width:{min:Kr.videoMinWidth,max:Kr.videoMaxWidth,ideal:Kr.videoMaxWidth},height:{min:Kr.videoMinHeight,max:Kr.videoMaxHeight,ideal:Kr.videoMaxHeight},aspectRatio:{ideal:Kr.videoAspectRatio},frameRate:{ideal:Kr.videoFrameRate}},hi&&(r.deviceId={exact:hi.deviceId}),Kr.videoFacingMode&&(r.facingMode={exact:Kr.videoFacingMode})),this.audio=n,this.video=r}return e.prototype.getNative=function(){return Object.assign({},{audio:this.audio,video:this.video})},e.prototype.simplify=function(){return"object"==typeof this.video&&(this.video.width||this.video.height?(delete this.video.width,delete this.video.height):this.video.aspectRatio?delete this.video.aspectRatio:this.video.frameRate?delete this.video.frameRate:(this.video.deviceId||this.video.facingMode)&&(delete this.video.deviceId,delete this.video.facingMode)),"object"==typeof this.audio&&(this.audio.echoCancellation||this.audio.autoGainControl||this.audio.noiseSuppression?(delete this.audio.echoCancellation,delete this.audio.autoGainControl,delete this.audio.noiseSuppression):this.audio.deviceId&&delete this.audio.deviceId),!0===this.video&&!0===this.audio?this.video=!1:!1===this.video&&!0===this.audio&&Kr.allowMissingMic?(this.audio=!1,this.video=!0):!0===this.video&&!1===this.audio&&(this.video=!1),this.video&&!Object.keys(this.video).length&&(this.video=!0),this.audio&&!Object.keys(this.audio).length&&(this.audio=!0),this},e.prototype.canSimplify=function(){var e="object"==typeof this.video&&(this.video.width||this.video.height||this.video.aspectRatio||this.video.frameRate||this.video.facingMode||this.video.deviceId)||this.video;return!!("object"==typeof this.audio&&(this.audio.deviceId||this.audio.noiseSuppression||this.audio.echoCancellation||this.audio.autoGainControl)||Kr.allowMissingMic&&this.audio||e)},e.prototype.isVideo=function(){return!!this.video},e.prototype.isAudio=function(){return!!this.audio},e}(),ji=function(e){function t(t,n){var r=e.call(this,!1,!0)||this;return"object"==typeof r.video?(delete r.video.deviceId,delete r.video.aspectRatio,delete r.video.frameRate,delete r.video.facingMode):r.video={},r.video.cursor="motion",r.video.width=t,r.video.height=n,r.video.frameRate=Kr.screenFrameRate,r}return Dr(t,e),t}(Pi);function ki(){ci=null,Ai().then((function(){return Xr.onDeviceChange()}))}function Ai(){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(e){return ci?[2,ci]:navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?(!ui&&navigator.mediaDevices.addEventListener&&(ui=si.throttle(ki,1e3),navigator.mediaDevices.addEventListener("devicechange",ui)),[2,ci=navigator.mediaDevices.enumerateDevices().then((function(e){li=e.filter((function(e){return"videoinput"===e.kind&&(e.label&&(gi=!0),!0)})),di=e.filter((function(e){return"audioinput"===e.kind&&(e.label?vi=!0:Ii.isMobile()&&"Firefox"===Ii.browserName()&&(vi=gi),!0)})),pi=e.filter((function(e){return"audiooutput"===e.kind}));var t=ni.get("videoinput"),n=ni.get("audioinput"),r=ni.get("audiooutput");return hi=li.find((function(e){return e.deviceId===t}))||null,fi=di.find((function(e){return e.deviceId===n}))||null,mi=pi.find((function(e){return e.deviceId===r}))||null,ci=Promise.resolve(e),e})).catch((function(){return ci=null,[]}))]):[2,Promise.resolve([])]}))}))}function Ri(){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(e){return Ii.isBrowserSupported()?[2,new Promise((function(e){var t={};Ii.baseChromeVersion()&&(t.sdpSemantics="plan-b"),new window.RTCPeerConnection(t).createOffer({offerToReceiveVideo:!0}).then((function(t){/^a=rtpmap:\d+ VP8\/\d+$/m.test(t.sdp)&&(_i=!0),/^a=mid:0$/m.test(t.sdp)&&(bi=!0),e()})).catch(e)}))]:[2,Promise.resolve()]}))}))}function Li(e,t){return Fr(this,void 0,void 0,(function(){var n,r,i=this;return Hr(this,(function(a){return Zr.debug("Try to get media",e.getNative()),(n=Ii.hasPermissions(e.isVideo()))||t||Xr.onPermissionsRequested(),r=function(e){return n||ki(),t&&Xr.onPermissionsError(t),e},!Kr.allowMissingMic||e.isAudio()||e.isVideo()?[2,navigator.mediaDevices.getUserMedia(e.getNative()).then((function(e){return r(e)})).catch((function(n){return Fr(i,void 0,void 0,(function(){return Hr(this,(function(r){switch(n.name){case"PermissionDeniedError":case"PermissionDismissedError":case"NotAllowedError":case"SecurityError":case"DOMException":t=e.isVideo()?qr.CAMERA_PERMISSION:qr.MIC_PERMISSION;break;case"OverconstrainedError":case"TypeError":case"NotFoundError":break;case"AbortError":case"NotReadableError":t=e.isVideo()?qr.CAMERA_ACCESS:qr.MIC_ACCESS}if(e.canSimplify())return[2,Li(e.simplify(),t)];throw t||qr.UNKNOWN}))}))}))]:[2,r(new MediaStream)]}))}))}function Ni(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){return Zr.debug("Try to get screen",e.getNative()),[2,navigator.mediaDevices.getDisplayMedia(e.getNative()).catch((function(e){switch(e.name){case"PermissionDeniedError":case"NotAllowedError":case"SecurityError":throw qr.SCREEN_PERMISSION;default:throw qr.SCREEN_ACCESS}}))]}))}))}function Mi(){return Oi.length?Oi:Oi=function(){var e,t=!1,n=0,r=wi.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(r[1]))return["IE",(e=/\brv[ :]+(\d+)/g.exec(wi))&&e[1]||"Unknown",t,n];if("Safari"===r[1]&&(e=wi.match(/\bEdge\/(\d+)/)))return["Edge",e[1]||"Unknown",t,n];if("Chrome"===r[1]){if(t=!0,n=Number(r[2]),e=wi.match(/\bOPR\/(\d+)/))return["Opera",e[1]||"Unknown",t,n];if(e=wi.match(/\bYaBrowser\/(\d+)/))return["Yandex",e[1]||"Unknown",t,n];if(e=wi.match(/\bEdge?\/(\d+)/))return["Edge",e[1]||"Unknown",t,n];if(void 0!==window.opr&&/^(.+\.)?ok.ru$/.test(window.location.host))return["Opera","Hidden",t,n]}return e=wi.match(/version\/(\d+)/i),[r[2]?r[1]:Ti,e&&e[1]||r[2]||Si,t,n]}()}!function(e){function t(){return li.length>0}function n(){return gi}function r(){return vi}function i(){if(!ai||"ended"===ai.readyState){var e=c(),t=e.createMediaStreamDestination(),n=e.createGain();n.gain.value=1e-5,n.connect(t),n.connect(e.destination);var r=e.createOscillator();r.type="sine",r.frequency.value=0,r.connect(n),r.start(),ai=t.stream.getAudioTracks()[0]}return Object.assign(ai.clone(),{enabled:!1})}function a(e,t){if(void 0===e&&(e=Kr.videoMinWidth),void 0===t&&(t=Kr.videoMinHeight),ii||(ii=document.createElement("canvas")).getContext("2d"),ii.width=e,ii.height=t,!ri||"ended"===ri.readyState){var n=ii.captureStream(25);ri=n.getVideoTracks()[0]}return Object.assign(ri.clone(),{enabled:!1})}function o(){return Mi()[0]}function s(){return Mi()[1]}function c(){return Ci||(Ci=new(window.AudioContext||window.webkitAudioContext)),Ci}e.init=function(){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(e){switch(e.label){case 0:return[4,Ri()];case 1:return e.sent(),[2,Ai()]}}))}))},e.getCameras=function(){return li},e.getMicrophones=function(){return di},e.getOutput=function(){return pi},e.hasCamera=t,e.hasMicrophone=function(){return di.length>0},e.getSavedCamera=function(){return hi},e.getSavedMicrophone=function(){return fi},e.getSavedOutput=function(){return mi},e.hasCameraPermission=n,e.hasMicrophonePermission=r,e.hasPermissions=function(e){return void 0===e&&(e=!1),!!r()&&(!t()||!e||n())},e.getUserMedia=function(e,n){return void 0===e&&(e=!1),void 0===n&&(n=!0),Fr(this,void 0,void 0,(function(){var r,o;return Hr(this,(function(s){return r=n,o=t()&&e,[2,Li(new Pi(r,o)).then((function(e){return e.getVideoTracks().length||e.addTrack(a()),e.getAudioTracks().length||e.addTrack(i()),e}))]}))}))},e.getScreenMedia=function(){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(e){return[2,Ni(new ji(window.screen.width,window.screen.height))]}))}))},e.getUserVideo=function(){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(e){return[2,Li(new Pi(!1,!0)).then((function(e){return e.getVideoTracks().length||e.addTrack(a()),e}))]}))}))},e.getUserAudio=function(){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(e){return[2,Li(new Pi(!0,!1)).then((function(e){return e.getAudioTracks().length||e.addTrack(i()),e}))]}))}))},e.saveDeviceId=function(e,t){return Fr(this,void 0,void 0,(function(){var n,r;return Hr(this,(function(i){switch(i.label){case 0:return[4,Ai()];case 1:return n=i.sent(),(r=n.find((function(n){return n.kind===e&&n.deviceId===t})))?("videoinput"===e?hi=r:"audioinput"===e?fi=r:"audiooutput"===e&&(mi=r),ni.set(e,t),[2,r]):[2,null]}}))}))},e.getSilentMediaTrack=i,e.getBlackMediaTrack=a,e.isBrowserSupported=function(){if("Edge"===o()&&s()<70)return!1;try{var e=window;return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&e.RTCPeerConnection&&e.RTCIceCandidate&&e.RTCSessionDescription&&e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype.captureStream&&e.RTCRtpSender&&e.RTCRtpSender.prototype.replaceTrack&&navigator.sendBeacon&&!0}catch(e){return!1}},e.isScreenCapturingSupported=function(){return!!navigator.mediaDevices.getDisplayMedia},e.canVP8=function(){return _i},e.isUnifiedPlan=function(){return bi},e.isBrokenH264=function(){return"Opera"===e.browserName()},e.canPreferH264=function(){return!(e.baseChromeVersion()&&e.isMobile())},e.os=function(){return Ei||(Ei=function(){var e={Windows:/Win/,Android:/Android/,OpenBSD:/OpenBSD/,SunOS:/SunOS/,Linux:/(Linux|X11)/,iPad:/(iPad)/,iPhone:/(iPhone)/,iPod:/(iPod)/,MacOS:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh|Mac OS X)/,QNX:/QNX/,UNIX:/UNIX/,BeOS:/BeOS/,OS2:/OS\/2/,Bot:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/};for(var t in e)if(e.hasOwnProperty(t)&&e[t].test(wi))return t;return"Unknown"}()),Ei},e.isMobile=function(){return null===yi&&(yi=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(Si)),yi},e.browserName=o,e.browserVersion=s,e.baseChromeVersion=function(){return Mi()[3]},e.getAudioContext=c}(Ii||(Ii={}));var Di,xi=Ii,Ui=function(){function e(){}return e.prototype.createJoinLink=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(e){return[2,{join_link:"nop"}]}))}))},e.prototype.removeJoinLink=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(e){return[2,{success:!0}]}))}))},e.prototype.getAnonymTokenByLink=function(e,t){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(e){return[2,""]}))}))},e.prototype.log=function(e){},e.prototype.prepareUserIds=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(e){return[2]}))}))},e.prototype.hangupConversation=function(e){},e}(),Bi=function(){function e(){}return e.prototype.log=function(e,t,n){},e.prototype.destroy=function(){},e}(),Fi=function(){function e(){this._handlers={},this._listeners=[],this.EVENT_LOG="EVENT_LOG"}return e.prototype._triggerEvent=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];this._handlers.hasOwnProperty(e)&&this._handlers[e].slice().forEach((function(e){e.apply(t,n)}))},e.prototype.addEventListener=function(e,t){if("function"!=typeof t)throw new Error("Listener should be a function");return this._handlers.hasOwnProperty(e)||(this._handlers[e]=[]),this._handlers[e].push(t),{dispose:this.removeEventListener.bind(this,e,t)}},e.prototype.removeEventListener=function(e,t){if(this._handlers.hasOwnProperty(e)){t||delete this._handlers[e];var n=this._handlers[e].indexOf(t);n>=0&&this._handlers[e].splice(n,1)}},e.prototype.subscribe=function(e,t,n){var r=e.addEventListener(t,n);this._listeners.push(r)},e.prototype.unsubscribe=function(){this._listeners.forEach((function(e){e.dispose()}))},e.prototype.log=function(e,t,n){void 0===n&&(n=!1),this._triggerEvent(this.EVENT_LOG,e,t,n)},e.prototype.onLog=function(e,t){this.subscribe(e,this.EVENT_LOG,t)},e}(),Hi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Dr(t,e),t.prototype.requestRealloc=function(e){},t.prototype.setEndpoint=function(e){},t.prototype.setConversationId=function(e){},t.prototype.readyToSend=function(){},t}(Fi);!function(e){e.USER="USER",e.GROUP="GROUP",e.CHAT="CHAT"}(Di||(Di={}));var Gi,Vi=Di;!function(e){e.CANCELED="CANCELED",e.REJECTED="REJECTED",e.REMOVED="REMOVED",e.HUNGUP="HUNGUP",e.MISSED="MISSED",e.BUSY="BUSY",e.FAILED="FAILED",e.CALLER_IS_BLOCKED="CALLER_IS_BLOCKED",e.NOT_FRIENDS="NOT_FRIENDS",e.CALLEE_IS_OFFLINE="CALLEE_IS_OFFLINE",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.UNSUPPORTED="UNSUPPORTED",e.OLD_VERSION="OLD_VERSION",e.SERVICE_DISABLED="SERVICE_DISABLED",e.EXTERNAL_API_ERROR="EXTERNAL_API_ERROR",e.SOCKET_CLOSED="SOCKET_CLOSED"}(Gi||(Gi={}));var qi,zi=Gi;!function(e){e.START="start",e.ACCEPT="accept",e.JOIN="join",e.RETRY="retry"}(qi||(qi={}));var Ki,Wi,Yi=qi;!function(e){e.USER="USER",e.ANONYM="ANONYM",e.GROUP="GROUP"}(Ki||(Ki={})),function(e){function t(e,t){return void 0===t&&(t=Ki.USER),{id:e,type:t}}function n(e){return'{"id":"'+e.id+'","type":"'+e.type+'"}'}e.fromIds=function(e){return e.length?"object"==typeof e[0]?e:e.map((function(e){return t(e)})):[]},e.fromId=t,e.toString=n,e.fromIdToString=function(e,r){return void 0===r&&(r=Ki.USER),n(t(e,r))},e.fromString=function(e){try{return JSON.parse(e)}catch(t){throw new Error("Failed to parse ExternalId from string '"+e+"'")}},e.compare=function(e,t){return e.id===t.id&&e.type===t.type}}(Wi||(Wi={}));var $i,Ji=function(e){function t(){var t=e.call(this)||this;t._interval=null,t._lastMemoryPercent=0,t._lastStat={bandwidth:0,kind:"video",good:!0};var n=function(){t._calcMemory(),t._interval=window.setTimeout(n,Kr.debugInfoInterval)};return t._interval=window.setTimeout(n,Kr.debugInfoInterval),t}return Dr(t,e),t.prototype.onLocalDataStats=function(e,t){t&&this._checkBadNetwork(e.outbound.rtps,t)},t.prototype.destroy=function(){this.unsubscribe(),this._interval&&(window.clearTimeout(this._interval),this._interval=null)},t.prototype._calcMemory=function(){var e=window.performance&&window.performance.memory;if(e&&e.usedJSHeapSize&&e.jsHeapSizeLimit){var t=Number((100*e.usedJSHeapSize/e.jsHeapSizeLimit).toFixed(2)),n=Number((e.usedJSHeapSize/1024/1024).toFixed(1));t>90?Zr.warn("High memory usage: "+t+"% ("+n+" MiB)"):(!this._lastMemoryPercent||Math.abs(t-this._lastMemoryPercent)>=3)&&(Zr.debug("Memory usage: "+t+"% ("+n+" MiB)"),this._lastMemoryPercent=t)}},t.prototype._checkBadNetwork=function(e,t){var n,r,i,a=!1,o=!0;if(t.isVideoEnabled?(n=e.find((function(e){return"video"===e.kind})),r=1.05*Kr.badConnectionVideoBitrate,i=.95*Kr.badConnectionVideoBitrate):t.isAudioEnabled?(n=e.find((function(e){return"audio"===e.kind})),r=1.05*Kr.badConnectionAudioBitrate,i=.95*Kr.badConnectionAudioBitrate):(n=e.find((function(e){return"audio"===e.kind})),r=1.05*Kr.badConnectionSilenceBitrate,i=.95*Kr.badConnectionSilenceBitrate),n){var s=n.bandwidth,c=this._lastStat.bandwidth,u=this._lastStat.kind;this._lastStat.bandwidth=s,this._lastStat.kind=n.kind,u===n.kind&&c&&(s<i&&c<i&&(a=!0),s<=r&&c<=r&&(o=!1),a&&this._lastStat.good?(this._lastStat.good=!1,Xr.onNetworkStatus(!1),this.log("callPoorConnection",n.kind)):o&&!this._lastStat.good&&(this._lastStat.good=!0,Xr.onNetworkStatus(!0)))}},t}(Fi),Xi=function(e){function t(n,r){var i=e.call(this,r?r.message:"")||this;return i.name="HangupReason",r&&(i.code=r.code||0,i.remote=r.remote||!1),Object.values(zi).indexOf(n)>-1?i.hangup=n:i.error=n,Error.captureStackTrace&&Error.captureStackTrace(i,t),i}return Dr(t,e),t}(Error),Qi=function(){function e(e){this._analyser=null,this._gainNode=null,this._fftBins=null,this._mediaStreamSource=null,this._lastSmoothedLevel=0,this._stream=e;try{var t=xi.getAudioContext();this._gainNode=t.createGain(),this._gainNode.gain.value=1e-5,this._gainNode.connect(t.destination),this._analyser=t.createAnalyser(),this._analyser.fftSize=1024,this._analyser.smoothingTimeConstant=0,this._analyser.connect(this._gainNode),this._fftBins=new Uint8Array(this._analyser.frequencyBinCount),this._mediaStreamSource=t.createMediaStreamSource(e),this._mediaStreamSource.connect(this._analyser)}catch(e){}}return Object.defineProperty(e.prototype,"stream",{get:function(){return this._stream},enumerable:!1,configurable:!0}),e.prototype._getBins=function(){if(!this._fftBins||!this._analyser)return new Uint8Array;this._analyser.getByteFrequencyData(this._fftBins);var e=44100/this._fftBins.length,t=Math.ceil(Kr.voiceParams.minFreq/e),n=Math.floor(Kr.voiceParams.maxFreq/e);return this._fftBins.subarray(t,n)},e.prototype.getLevel=function(){var e=this._getBins(),t=e.reduce((function(e,t){return e+t}),0)/e.length/255,n=this._lastSmoothedLevel*Kr.voiceParams.smoothing+t*(1-Kr.voiceParams.smoothing);return this._lastSmoothedLevel=n,{real:t,smoothed:n}},e.prototype.destroy=function(){this._mediaStreamSource&&(this._mediaStreamSource.disconnect(),this._mediaStreamSource=null),this._gainNode&&(this._gainNode.disconnect(),this._gainNode=null),this._analyser&&(this._analyser.disconnect(),this._analyser=null,this._fftBins=null,this._lastSmoothedLevel=0)},e}(),Zi=function(e){function t(t){var n=e.call(this)||this;n._detector=null,n._track=null,n._interval=null;var r=function(){n._detector&&Xr.onLocalVolume(n._detector.getLevel().real,t.getMediaSettings().isAudioEnabled),n._interval=window.setTimeout(r,Kr.voiceParams.interval)};n._interval=window.setTimeout(r,Kr.voiceParams.interval);var i=function(){var e=t.getStream();e&&n.init(e)};return n.subscribe(t,"SOURCE_CHANGED",(function(e){"audio"===e.kind&&e.mediaSettings.isAudioEnabled&&i()})),i(),n}return Dr(t,e),t.prototype.init=function(e){this._stopDetector();var t=e.getAudioTracks();t.length&&(this._track=t[0].clone(),this._detector=new Qi(new MediaStream([this._track])))},t.prototype._stopDetector=function(){this._detector&&(this._detector.destroy(),this._detector=null),this._track&&(this._track.stop(),this._track=null)},t.prototype.destroy=function(){this.unsubscribe(),this._interval&&(window.clearTimeout(this._interval),this._interval=null),this._stopDetector()},t}(Fi),ea=function(e){function t(t,n){var r=e.call(this)||this;return r._batchInterval=3e3,r._batch=[],r._batchTimeout=null,r._api=t,r._externalLogger=n,r}return Dr(t,e),t.prototype._send=function(e){this._api.log(e)},t.prototype._sendBatch=function(){this._stopTimeout(),this._batch.length>0&&(this._send(this._batch),this._batch=[],this._startTimeout())},t.prototype._startTimeout=function(){var e=this;this._batchTimeout=window.setTimeout((function(){return e._sendBatch()}),this._batchInterval)},t.prototype._stopTimeout=function(){this._batchTimeout&&(clearTimeout(this._batchTimeout),this._batchTimeout=null)},t.prototype._onUnload=function(){this._sendBatch(),this._stopTimeout()},t.prototype.log=function(e,t,n){void 0===n&&(n=!1);var r={type:1,time:0,operation:e,timestamp:Date.now(),custom:{},uid:this._api.getUserId()};void 0!==t&&(r.custom.param=t),this._batch.push(r),!n&&this._batchTimeout||this._sendBatch(),this._externalLogger&&this._externalLogger.log(e,t,n)},t.prototype.destroy=function(){this._sendBatch(),this._stopTimeout(),this._externalLogger&&this._externalLogger.destroy()},t}(Bi),ta=function(e){function t(){var t=e.call(this)||this;return t._stream=null,t._mediaSettings={isAudioEnabled:!0,isVideoEnabled:!0,isDataEnabled:!1,isScreenSharingEnabled:!1,audioBitrateBps:0,videoBitrateBps:0},t._videoStatusOnScreenCapturingEnabled=!1,t._initDeviceChangeListener(),t}return Dr(t,e),t.prototype.request=function(e){return void 0===e&&(e=!1),Fr(this,void 0,void 0,(function(){var t,n;return Hr(this,(function(r){switch(r.label){case 0:if(this._stream)return[2,Promise.resolve(this._stream)];if(!xi.isBrowserSupported())throw new Xi(qr.UNSUPPORTED);if(!xi.hasMicrophone()&&!Kr.allowMissingMic)throw new Xi(qr.MIC_NOT_FOUND);r.label=1;case 1:return r.trys.push([1,3,,4]),[4,xi.getUserMedia(e)];case 2:return t=r.sent(),e&&0===t.getVideoTracks().length&&Zr.warn("Unable to obtain requested local video track"),this._stream=t,this._mediaSettings.isVideoEnabled=e&&t.getVideoTracks().filter((function(e){return e.enabled})).length>0||!1,this._mediaSettings.isAudioEnabled=t.getAudioTracks().filter((function(e){return e.enabled})).length>0||!1,[2,t];case 3:throw n=r.sent(),new Xi(n);case 4:return[2]}}))}))},t.prototype.getStream=function(){return this._stream},t.prototype.getMediaSettings=function(){return this._mediaSettings},t.prototype.changeDevice=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){switch(e){case"videoinput":return[2,this._changeVideoInput()];case"audioinput":return[2,this._changeAudioInput()];case"screen":return[2,this._changeScreen()];default:return[2,Promise.reject()]}}))}))},t.prototype.setVideoStream=function(e,t){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(n){return[2,t?this._changeScreen(e):this._changeVideoInput(e)]}))}))},t.prototype._initDeviceChangeListener=function(){var e=this;if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.addEventListener){var t=!1,n=!1,r=si.throttle((function(){n&&e._changeVideoInput().catch((function(){})),t&&e._changeAudioInput().catch((function(){})),t=!1,n=!1}),1e3);navigator.mediaDevices.addEventListener("devicechange",(function(){return Fr(e,void 0,void 0,(function(){var e,i,a,o,s,c,u;return Hr(this,(function(l){switch(l.label){case 0:return this._stream?(e=this._stream.getAudioTracks()[0],i=e&&e.enabled&&e.getSettings(),a=i&&i.groupId,o=this._stream.getVideoTracks()[0],s=o&&o.enabled&&o.getSettings(),c=s&&s.groupId,a||c?[4,navigator.mediaDevices.enumerateDevices()]:[2]):[2];case 1:return u=l.sent(),!t&&a&&(t=!u.find((function(e){return e.groupId===a}))),!n&&c&&(n=!u.find((function(e){return e.groupId===c}))),r(),[2]}}))}))}))}},t.prototype._changeVideoInput=function(e){return Fr(this,void 0,void 0,(function(){var t,n,r,i=this;return Hr(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),(t=e)?[3,2]:[4,xi.getUserVideo()];case 1:t=a.sent(),a.label=2;case 2:return e=t,this._stream?(this._stopLocalTrack("video"),this.log("callDeviceChanged","video"),Zr.log("Camera changed"),n=e.getVideoTracks()[0],this._stream.getVideoTracks().forEach((function(e){i._replaceLocalTrack(e,n)})),this._mediaSettings.isVideoEnabled=!0,this._mediaSettings.isScreenSharingEnabled=!1,this._triggerEvent("SOURCE_CHANGED",{kind:"video",mediaSettings:this._mediaSettings})):e.getTracks().forEach((function(e){e.stop()})),[3,4];case 3:throw r=a.sent(),this.log("callError","change_video"),Zr.warn("Camera change failed",r),r;case 4:return[2]}}))}))},t.prototype._changeAudioInput=function(){return Fr(this,void 0,void 0,(function(){var e,t,n,r=this;return Hr(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,xi.getUserAudio()];case 1:return e=i.sent(),this._stream?(this._stopLocalTrack("audio"),this.log("callDeviceChanged","audio"),Zr.debug("Microphone changed"),t=e.getAudioTracks()[0],this._stream.getAudioTracks().forEach((function(e){r._replaceLocalTrack(e,t)})),this._mediaSettings.isAudioEnabled=!0,this._triggerEvent("SOURCE_CHANGED",{kind:"audio",mediaSettings:this._mediaSettings})):e.getTracks().forEach((function(e){e.stop()})),[3,3];case 2:throw n=i.sent(),this.log("callError","change_audio"),Zr.error("Microphone change failed",n),n;case 3:return[2]}}))}))},t.prototype._changeScreen=function(e){return Fr(this,void 0,void 0,(function(){var t,n,r,i=this;return Hr(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),(t=e)?[3,2]:[4,xi.getScreenMedia()];case 1:t=a.sent(),a.label=2;case 2:return(e=t).addEventListener("inactive",(function(){i._mediaSettings.isScreenSharingEnabled&&i.toggleScreenCapturing(!1)}),!1),this._stream?(this._stopLocalTrack("video"),this.log("callDeviceChanged","screen"),Zr.log("Screen capturing started"),n=e.getVideoTracks()[0],this._stream.getVideoTracks().forEach((function(e){i._replaceLocalTrack(e,n)})),this._videoStatusOnScreenCapturingEnabled=this._mediaSettings.isVideoEnabled,this._mediaSettings.isVideoEnabled=!0,this._mediaSettings.isScreenSharingEnabled=!0,this._triggerEvent("SOURCE_CHANGED",{kind:"screen",mediaSettings:this._mediaSettings})):e.getTracks().forEach((function(e){e.stop()})),[3,4];case 3:throw r=a.sent(),this.log("callError","screen"),Zr.warn("Screen capturing failed",r),r;case 4:return[2]}}))}))},t.prototype._replaceLocalTrack=function(e,t){this._stream&&(this._stream.removeTrack(e),this._stream.addTrack(t),this._triggerEvent("TRACK_REPLACED",e,t))},t.prototype._stopLocalTrack=function(e){this._stream&&this._stream.getTracks().forEach((function(t){t.kind===e&&t.stop()}))},t.prototype.destroy=function(){this._stream&&(this._stream.getTracks().forEach((function(e){e.stop()})),this._stream=null)},t.prototype.toggleScreenCapturing=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){return e?[2,this.changeDevice("screen")]:this._videoStatusOnScreenCapturingEnabled?[2,this.changeDevice("videoinput")]:[2,this.toggleVideo(!1)]}))}))},t.prototype.toggleVideo=function(e){return Fr(this,void 0,void 0,(function(){var t,n,r,i=this;return Hr(this,(function(a){switch(a.label){case 0:return this.log("callMediaStatus",e?"video_1":"video_0"),t=xi.hasCameraPermission()||this._mediaSettings.isScreenSharingEnabled,this._stream&&t?e?[4,xi.getUserVideo()]:[3,2]:[2];case 1:return r=a.sent(),n=r.getVideoTracks()[0],[3,3];case 2:n=xi.getBlackMediaTrack(Kr.videoMinWidth,Kr.videoMinHeight),a.label=3;case 3:return this._stopLocalTrack("video"),this._stream.getVideoTracks().forEach((function(e){i._replaceLocalTrack(e,n)})),this._mediaSettings.isVideoEnabled=e,e||(this._mediaSettings.isScreenSharingEnabled=!1),this._triggerEvent("SOURCE_CHANGED",{kind:"video",mediaSettings:this._mediaSettings}),[2]}}))}))},t.prototype.toggleAudio=function(e){return Fr(this,void 0,void 0,(function(){var t,n,r=this;return Hr(this,(function(i){switch(i.label){case 0:return this.log("callMediaStatus",e?"audio_1":"audio_0"),this._stream&&xi.hasMicrophonePermission()?e?[4,xi.getUserAudio()]:[3,2]:[2];case 1:return n=i.sent(),t=n.getAudioTracks()[0],[3,3];case 2:t=xi.getSilentMediaTrack(),i.label=3;case 3:return this._stopLocalTrack("audio"),this._stream.getAudioTracks().forEach((function(e){r._replaceLocalTrack(e,t)})),this._mediaSettings.isAudioEnabled=e,this._triggerEvent("SOURCE_CHANGED",{kind:"audio",mediaSettings:this._mediaSettings}),[2]}}))}))},t}(Fi),na=function(e){function t(t){var n=e.call(this)||this;return n._speakerId=null,n.subscribe(t,"VOLUMES_DETECTED",n._onVolumesDetected.bind(n)),n}return Dr(t,e),t.prototype.destroy=function(){this.unsubscribe()},t.prototype._onVolumesDetected=function(e){var t=0,n=null;if(Object.keys(e).forEach((function(r){var i=e[r].smoothed;i>t&&i>Kr.voiceParams.threshold&&(t=i,n=r)})),n&&n!==this._speakerId){var r=this._speakerId&&e.hasOwnProperty(this._speakerId)?e[this._speakerId].smoothed:0;t>r*Kr.voiceParams.speakerLevelMultiplier&&(this._speakerId=n,this._triggerEvent("SPEAKER_CHANGED",n))}},t}(Fi),ra=function(e){function t(t,n,r){var i=e.call(this)||this;return i._states={},i._volumes={},i._participants={},i._connectionTimeout=0,i._volumeTimeout=0,i._transport=t,i._participants=r,i.subscribe(t,"STATE_CHANGED",i._onTransportStateChanged.bind(i)),i.subscribe(n,"VOLUMES_DETECTED",i._onVolumesDetected.bind(i)),i}return Dr(t,e),t.prototype.destroy=function(){this.unsubscribe(),this._connectionTimeout&&window.clearTimeout(this._connectionTimeout),this._volumeTimeout&&window.clearTimeout(this._volumeTimeout)},t.prototype.onChangeRemoteMediaSettings=function(e,t){t.isAudioEnabled||(this._volumes[e]=1),t.isAudioEnabled&&(this._volumes[e]=0)},t.prototype._onTransportStateChanged=function(e,t){this._states[e]=t,"OPENED"===t&&(this._connectionTimeout||(this._connectionTimeout=window.setTimeout(this._onConnectionTimeout.bind(this),Kr.specListenerParams.connectionTimeout)),this._volumeTimeout||(this._volumeTimeout=window.setTimeout(this._onVolumeTimeout.bind(this),Kr.specListenerParams.volumeTimeout))),"FAILED"===t&&this._connectionTimeout&&(Zr.warn("Transport failed, send callSpecError"),this.log("callSpecError",this._transport.getTopology()+"_CONNECTION_TIMEOUT"))},t.prototype._onVolumesDetected=function(e){var t=this;Object.keys(e).forEach((function(n){t._volumes[n]=Math.max(e[n].real,t._volumes[n]||0)}))},t.prototype._onConnectionTimeout=function(){Object.values(this._states).filter((function(e){return"CONNECTED"!==e})).length>0&&(Zr.warn("There is not connected transport, send callSpecError"),this.log("callSpecError",this._transport.getTopology()+"_CONNECTION_TIMEOUT")),this._connectionTimeout=0},t.prototype._onVolumeTimeout=function(){var e=this,t=[];Object.keys(this._volumes).forEach((function(n){if(!(e._volumes[n]>0)){var r="UNKNOWN",i=e._participants[n];i&&i.platform&&(r=i.platform),t.indexOf(r)<0&&(t.push(r),e.log("callSpecError",e._transport.getTopology()+"_VOLUME_TIMEOUT_"+r))}})),t.length&&Zr.warn("There is silent participant, send callSpecError"),this._volumeTimeout=0},t}(Fi);function ia(e){var t=[];return function e(t,n){t.forEach((function(t){Array.isArray(t)?e(t,n):n.push(t)}))}(e,t),t}function aa(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){for(var n=0,r=e;n<r.length;n++)if((0,r[n])(t))return!0;return!1}}function oa(e,t){return function(n){return n[e]===t}}function sa(e,t){return t.reduce((function(t,n){return t[n[e]]=n,t}),{})}function ca(e,t){return Object.values(sa(e,t))}function ua(e){return Object.keys(e).filter((function(t){return void 0!==e[t]})).map((function(t){return[t,e[t]]})).reduce((function(e,t){return e[t[0]]=function(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}(t[1])?ua(t[1]):t[1],e}),{})}function la(e){var t=[];return e.forEach((function(e){t.push(e)})),t}function da(e){return Fr(this,void 0,void 0,(function(){var t,n=this;return Hr(this,(function(r){return t=[],RTCRtpReceiver.prototype.getStats?(t.push(e.getReceivers().map((function(e){return Fr(n,void 0,void 0,(function(){return Hr(this,(function(t){return[2,e.getStats()]}))}))}))),t.push(e.getSenders().map((function(e){return Fr(n,void 0,void 0,(function(){return Hr(this,(function(t){return[2,e.getStats()]}))}))})))):t.push(e.getStats()),[2,Promise.all(ia(t)).then((i=la,function(e){return e.map(i)})).then(ia).then(ca.bind(null,"id"))];var i}))}))}function pa(e){var t,n=e.filter(oa("type","candidate-pair")).sort((t="priority",function(e,n){return e[t]-n[t]})).find(aa(oa("nominated",!0),oa("selected",!0)));if(!n)return{};var r={totalRoundTripTime:n.totalRoundTripTime,currentRoundTripTime:n.currentRoundTripTime,bytesSent:n.bytesSent,bytesReceived:n.bytesReceived},i=e.find(oa("id",n.remoteCandidateId));i&&(r=Object.assign({},r,{remote:{type:i.candidateType,address:i.ip||i.address,port:i.port,protocol:i.protocol}}));var a=e.find(oa("id",n.localCandidateId));return a&&(r=Object.assign({},r,{local:{type:a.candidateType,address:a.ip||a.address,port:a.port,protocol:a.protocol,relayProtocol:a.relayProtocol,networkType:a.networkType}})),ua(r)}function ha(e,t){t=t||{};var n=sa("id",e),r=e.filter(aa(oa("type","inbound-rtp"),oa("type","outbound-rtp")));"Firefox"===xi.browserName()&&(r=Object.values(r.reduce((function(e,t){if(e[t.ssrc]){var n=Object.assign({},e[t.ssrc],t),r=e[t.ssrc].isRemote?t:e[t.ssrc];n.id=r.id,n.type=r.type,delete n.isRemote,delete n.remoteId,e[n.ssrc]=n}else e[t.ssrc]=t;return e}),{})));var i={};return"Safari"===xi.browserName()&&(i=sa("trackIdentifier",e.filter(oa("type","track")))),r.map((function(e){var r=e.ssrc,a=e.mediaType||e.kind,o=e.trackId,s=e.type,c=e.codecId;if("Safari"===xi.browserName()){var u=/^.+_([\d]+)$/.exec(e.id);if(u&&(r=parseInt(u[1],10)),a=e.id.indexOf("Audio")>0?"audio":"video",t[r]){var l=a+"-"+t[r];i[l]&&(o=i[l].id)}}if(!s||!r||!a)return null;var d={ssrc:r,type:s,kind:a,bytesReceived:e.bytesReceived,bytesSent:e.bytesSent,jitter:e.jitter,packetsLost:e.packetsLost,packetsReceived:e.packetsReceived,packetsSent:e.packetsSent,fractionLost:e.fractionLost,pliCount:e.pliCount,firCount:e.firCount,nackCount:e.nackCount};if(c&&n[c]){var p=n[c];d.clockRate=p.clockRate,d.mimeType=p.mimeType}if(o&&n[o]){var h=n[o];d.frameHeight=h.frameHeight,d.frameWidth=h.frameWidth,d.framesDecoded=h.framesDecoded,d.framesReceived=h.framesReceived,d.framesDropped=h.framesDropped}return ua(d)})).filter((function(e){return!!e}))}!function(e){e.collect=function(e,t,n){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(r){return[2,da(e).then((function(e){return{timestamp:Date.now(),transport:pa(e),rtps:ha(e,n)}})).then((function(e){return function(e,t){if(!t)return e;if(!t.rtps||!e.rtps)return e;var n=sa("ssrc",e.rtps),r=sa("ssrc",t.rtps),i=(e.timestamp-t.timestamp)/1e3;return n&&r?(Object.keys(n).forEach((function(e){var t=n[e],a=r[e];t&&a&&(t.bytesReceived&&t.bytesReceived>a.bytesReceived&&(t.bandwidth=Math.round((t.bytesReceived-a.bytesReceived)/i)),t.bytesSent&&t.bytesSent>a.bytesSent&&(t.bandwidth=Math.round((t.bytesSent-a.bytesSent)/i)),t.packetsReceived>a.packetsReceived&&(t.packetLoss=parseFloat((100*(t.packetsLost-a.packetsLost)/(t.packetsReceived-a.packetsReceived)/i).toFixed(2))),t.framesDropped>a.framesDropped&&(t.framesDroppedDelta=parseFloat(((t.framesDropped-a.framesDropped)/i).toFixed(0))))})),e):e}(e,t)}))]}))}))}}($i||($i={}));var fa=$i,ma=function(e){function t(t,n,r,i){var a=e.call(this)||this;if(a._remoteSDP={},a._remoteCandidates={},a._state="IDLE",a._isOpen=!1,a._remotePeerId=null,a._statInterval=null,a._failedOnCreate=null,a._remoteStream=null,a._iceRestartTimeout=null,a._reconnectionTimeout=null,a._reconnectionPrevented=!1,a._fingerprint=null,a._neverConnected=!0,a._signaling=r,a._mediaSource=i,a._participantId=t,a._isMaster=n,a.subscribe(a._signaling,"NOTIFICATION",a._onSignalingNotification.bind(a)),a.subscribe(a._mediaSource,"TRACK_REPLACED",a._onReplacedTrack.bind(a)),a._pc=new RTCPeerConnection({iceServers:Kr.iceServers},{optional:[{googSuspendBelowMinBitrate:!1}]}),a._pc.onicecandidate=a._handleIceCandidate.bind(a),a._pc.ontrack=a._onAddTrack.bind(a),a._pc.onconnectionstatechange=a._onConnectionStateChange.bind(a),a._pc.onsignalingstatechange=a._onSignalingStateChange.bind(a),a._isMaster){try{var o=a._mediaSource.getStream();if(!o)throw new Error("No local stream found");a._addTracks(o)}catch(e){return a.log("callError","addTrack-direct"),Zr.error("Unable to add media source tracks",e,{participantId:a._participantId}),a._failedOnCreate=e,a}a._createOffer(!1).catch((function(e){"IDLE"===a._state?a._failedOnCreate=e:a.close(e)}))}return a._startStatInterval(),a}return Dr(t,e),t.prototype.getState=function(){return this._state},t.prototype.open=function(e){var t=this;if(void 0===e&&(e=null),this._isOpen)Zr.warn("Transport is already opened",{participantId:this._participantId});else{if(this._failedOnCreate&&this.close(this._failedOnCreate),Zr.debug("Open transport",{participantId:this._participantId}),this._isOpen=!0,this._remotePeerId=e,!this._isMaster)try{var n=this._mediaSource.getStream();if(!n)throw new Error("No local stream found");this._addTracks(n)}catch(e){this.log("callError","addTrack-direct"),Zr.error("Unable to add media source tracks",e,{participantId:this._participantId}),this.close(e)}var r=e,i=e;if(!e){var a=Object.keys(this._remoteSDP),o=Object.keys(this._remoteCandidates);r=a[a.length-1],i=o[o.length-1]}r&&this._remoteSDP[r]&&this._setRemoteDescription(r,this._remoteSDP[r]).catch(this.close.bind(this)),i&&this._remoteCandidates[i]&&this._remoteCandidates[i].forEach((function(e){i&&t._addIceCandidate(i,e).catch(t.close.bind(t))})),this._remoteSDP={},this._remoteCandidates={},this._setState("OPENED")}},t.prototype.preventRestart=function(){this._reconnectionPrevented=!0},t.prototype.allowRestart=function(){this._reconnectionPrevented=!1},t.prototype.close=function(e){this._isOpen=!1,this._stopReconnection(),this._remoteStream&&(this._remoteStream.getTracks().forEach((function(e){e.stop()})),this._remoteStream=null),this._stopStatInterval(),this._pc&&(this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.onsignalingstatechange=null,this._pc.close()),this.unsubscribe(),e?(Zr.error("Closed",e,{participantId:this._participantId}),this._setState("FAILED")):(Zr.debug("Closed",{participantId:this._participantId}),this._setState("CLOSED"))},t.prototype._addTracks=function(e){var t=this;e.getTracks().forEach((function(n){t._pc&&t._pc.addTrack(n,e)}))},t.prototype._setState=function(e){this._state!==e&&(Zr.debug("State changed to "+e,{participantId:this._participantId}),this._state=e,this._triggerEvent("STATE_CHANGED",e))},t.prototype._onSignalingNotification=function(e){"transmitted-data"===e.notification&&this._handleTransmittedData(e)},t.prototype._handleTransmittedData=function(e){var t=e.data,n=si.getPeerIdString(e.peerId);si.composeMessageId(e)===this._participantId&&(t.candidate?this._addIceCandidate(n,t.candidate).catch(this.close.bind(this)):t.sdp&&this._setRemoteDescription(n,t.sdp).catch(this.close.bind(this)))},t.prototype._addIceCandidate=function(e,t){return Fr(this,void 0,void 0,(function(){var n=this;return Hr(this,(function(r){return Zr.debug("Remote ice candidate",{participantId:this._participantId,candidate:t}),!this._isOpen||this._remotePeerId&&this._remotePeerId!==e||!this._pc?(this._remoteCandidates[e]=this._remoteCandidates[e]||[],this._remoteCandidates[e].push(t),[2,Promise.resolve()]):[2,this._pc.addIceCandidate(new RTCIceCandidate(t)).catch((function(e){throw n.log("callError","addIceCandidate-direct"),Zr.error("Unable to add remote ice candidate",e,{participantId:n._participantId,candidate:t}),e}))]}))}))},t.prototype._setRemoteDescription=function(e,t){return Fr(this,void 0,void 0,(function(){var n=this;return Hr(this,(function(r){return Zr.debug("Remote description",{participantId:this._participantId,sdp:t}),!this._isOpen||this._remotePeerId&&this._remotePeerId!==e||!this._pc?(this._remoteSDP[e]=t,[2,Promise.resolve()]):(this._calcFingerprint(t.sdp),[2,this._pc.setRemoteDescription(new RTCSessionDescription(t)).catch((function(e){throw n.log("callError","setRemoteDescription-direct"),Zr.error("Unable to set remote description",e,{participantId:n._participantId,sdp:t}),e}))])}))}))},t.prototype._onAddTrack=function(e){var t=this;if(Zr.debug("Added remote track",{participantId:this._participantId}),!this._remoteStream){var n=e.streams[0];n.onremovetrack=function(e){t._triggerEvent("REMOTE_TRACK_REMOVED",n,e.track)},this._remoteStream=n}this._triggerEvent("REMOTE_TRACK_ADDED",this._remoteStream,e.track)},t.prototype._handleIceCandidate=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){switch(t.label){case 0:return e.candidate?(Zr.debug("Local ice candidate",{participantId:this._participantId,candidate:e.candidate}),[4,this._signaling.sendCandidate(this._participantId,e.candidate)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype._onSignalingStateChange=function(){var e=this;switch(Zr.debug("Signaling state changed to "+this._pc.signalingState,{participantId:this._participantId}),this._pc.signalingState){case"have-local-offer":var t=this._pc.localDescription;t?this._signaling.sendSdp(this._participantId,t).catch(this.close.bind(this)):this.close(new Error);break;case"have-remote-offer":this._createAnswer().catch(this.close.bind(this)).then((function(t){return Fr(e,void 0,void 0,(function(){return Hr(this,(function(e){return[2,this._signaling.sendSdp(this._participantId,t)]}))}))})).catch(this.close.bind(this))}},t.prototype._onConnectionStateChange=function(){var e=this;switch(Zr.debug("Connection state changed to "+this._pc.connectionState,{participantId:this._participantId}),this.log("callIceConnectionState",this._pc.connectionState),this._pc.connectionState){case"connecting":var t=this.getState();"IDLE"===t||"OPENED"===t?this._setState("CONNECTING"):this._setState("RECONNECTING");break;case"connected":this._neverConnected=!1,this._setState("CONNECTED"),this._stopReconnection(),si.getPeerConnectionHostInfo(this._pc).then((function(t){t&&e.log("callIceConnectionType",t.type)}));break;case"failed":case"disconnected":this._reconnectionPrevented?this.close(new Error("Ice connection "+this._pc.connectionState)):(this._setState("RECONNECTING"),this._startReconnection());break;case"closed":this.close(new Error("Ice connection closed"))}},t.prototype._startReconnection=function(){var e=this;this._reconnectionTimeout||this._iceRestartTimeout||(Zr.log("Waiting for reconnection...",{participantId:this._participantId}),this._reconnectionTimeout=window.setTimeout((function(){e._reconnectionTimeout=null,e._neverConnected?e._requestTopologySwitch():e._startIceRestart()}),Kr.transportConnectionWaitTime))},t.prototype._requestTopologySwitch=function(){this._isMaster&&(Zr.log("Switch topology DIRECT to SERVER",{participantId:this._participantId}),this._signaling.switchTopology("SERVER"))},t.prototype._stopReconnection=function(){this._reconnectionTimeout&&(clearTimeout(this._reconnectionTimeout),this._reconnectionTimeout=null),this._iceRestartTimeout&&(clearTimeout(this._iceRestartTimeout),this._iceRestartTimeout=null)},t.prototype._startIceRestart=function(){var e=this;this._isMaster?(this.log("callIceRestart"),Zr.log("Ice restart",{participantId:this._participantId}),this._createOffer(!0).catch(this.close.bind(this))):Zr.debug("Waiting for ice restart...",{participantId:this._participantId}),this._iceRestartTimeout=window.setTimeout((function(){e._iceRestartTimeout=null,Zr.error("Ice restart failed",{participantId:e._participantId}),e.log("callError","iceRestart-direct"),e._requestTopologySwitch()}),Kr.iceRestartWaitTime)},t.prototype._createOffer=function(e){return Fr(this,void 0,void 0,(function(){var n,r=this;return Hr(this,(function(i){return n={iceRestart:e,offerToReceiveAudio:!0,offerToReceiveVideo:!0},Zr.debug("Create offer",{participantId:this._participantId,options:n}),[2,this._pc.createOffer(n).catch((function(e){throw Zr.error("Unable to create offer",e,{participantId:r._participantId}),r.log("callError","createOffer-direct"),e})).then((function(e){return Fr(r,void 0,void 0,(function(){var n=this;return Hr(this,(function(r){return Zr.debug("Created offer",{participantId:this._participantId,offer:e}),e=t._patchDescription(e),Zr.debug("Set local description",{participantId:this._participantId,offer:e}),this._calcFingerprint(e.sdp),[2,this._pc.setLocalDescription(e).then((function(){return n._pc.localDescription}))]}))}))})).catch((function(e){throw Zr.error("Unable to set local description",e,{participantId:r._participantId}),r.log("callError","setLocalDescription-direct"),e}))]}))}))},t.prototype._createAnswer=function(){return Fr(this,void 0,void 0,(function(){var e=this;return Hr(this,(function(n){return Zr.debug("Create answer",{participantId:this._participantId}),[2,this._pc.createAnswer().catch((function(t){throw Zr.error("Unable to create answer",t,{participantId:e._participantId}),e.log("callError","createAnswer-direct"),t})).then((function(n){return Fr(e,void 0,void 0,(function(){return Hr(this,(function(e){return Zr.debug("Created answer",{participantId:this._participantId,answer:n}),n=t._patchDescription(n),Zr.debug("Set local description",{participantId:this._participantId,answer:n}),this._calcFingerprint(n.sdp),[2,this._pc.setLocalDescription(n)]}))}))})).then((function(){return e._pc.localDescription})).catch((function(t){throw Zr.error("Unable to set local description",t,{participantId:e._participantId}),e.log("callError","setLocalDescription-direct"),t}))]}))}))},t._patchDescription=function(e){return e.sdp=si.patchSDP(e.sdp,xi.canPreferH264(),xi.isBrokenH264()),e},t.prototype._onReplacedTrack=function(e,t){var n=this;this._pc&&this._pc.getSenders().forEach((function(e){e.track&&e.track.kind===t.kind&&(e.track.enabled=t.enabled,e.replaceTrack(t).catch((function(e){Zr.error("Unable to replace track",e,{participantId:n._participantId}),n.log("callError","replaceTrack-direct")})))}))},t.prototype._startStatInterval=function(){var e=this;if(!this._statInterval){var t=function(){e._pc?fa.collect(e._pc,e._lastStat,{}).then((function(n){e._lastStat=n;var r={inbound:{topology:"DIRECT",transport:n.transport,rtps:n.rtps.filter((function(e){return"inbound-rtp"===e.type}))},outbound:{topology:"DIRECT",transport:n.transport,rtps:n.rtps.filter((function(e){return"outbound-rtp"===e.type}))}};e._triggerEvent("REMOTE_DATA_STATS",r),e._triggerEvent("LOCAL_DATA_STATS",{outbound:r.outbound}),e._statInterval=window.setTimeout(t,3e3)})):e._stopStatInterval()};this._statInterval=window.setTimeout(t,3e3)}},t.prototype._stopStatInterval=function(){this._statInterval&&(window.clearTimeout(this._statInterval),this._statInterval=null)},t.prototype._calcFingerprint=function(e){var t=si.sdpFingerprint(e);null===this._fingerprint?this._fingerprint=t:(Xr.onFingerprintChange(this._fingerprint.xor(t).toString()),this._fingerprint=null)},t}(Fi),ga=function(e){function t(t,n){var r=e.call(this)||this;return r._previousTimestamp=0,r._renderDropRate=0,r._signaling=n,r.subscribe(t,"REMOTE_DATA_STATS",r._handleStats.bind(r)),r}return Dr(t,e),t.prototype.destroy=function(){this.unsubscribe()},t.getEstimatedPerformanceIndex=function(){try{var e=parseInt(localStorage.getItem("videochat-epi")||"",10);return isNaN(e)?0:e}catch(e){return 0}},t.prototype._handleStats=function(e){return Fr(this,void 0,void 0,(function(){var t,n,r;return Hr(this,(function(i){switch(i.label){case 0:if(!Kr.perfStatReportEnabled)return[2];if(!e.inbound||!e.inbound.rtps)return[2];if(t=e.inbound.rtps.filter((function(e){return"video"===e.kind})).map((function(e){return{framesDecoded:e.framesDecoded||0,framesReceived:e.framesReceived||0}})).reduce((function(e,t){return e.framesDecoded+=t.framesDecoded,e.framesReceived+=t.framesReceived,e}),{framesDecoded:0,framesReceived:0}),n=Date.now(),this._renderDropRate&&(t.renderDropRate=this._renderDropRate),this._previousTimestamp+5e3>n)return[2];if(!t.framesDecoded&&!t._renderDropRate)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._signaling.reportPerfStat(t)];case 2:return r=i.sent(),localStorage.setItem("videochat-epi",r.estimatedPerformanceIndex),[3,4];case 3:return i.sent(),[3,4];case 4:return this._previousTimestamp=n,[2]}}))}))},t.prototype._onUIPerformanceStatistics=function(e){if(e.decoded){var t=e.dropped/(e.decoded+e.dropped);this._renderDropRate=.2*t+.8*this._renderDropRate}},t}(Fi),va={},_a=function(e){function t(t,n){var r=e.call(this)||this;return r._consumer=null,r._producer=null,r._isOpen=!1,r._reconnectionPrevented=!1,r._state={},r._statInterval=null,r._statBytes={},r._ssrcMap={},r._producerOfferIsProcessing=!1,r._producerNextOffer=null,va.CONNECTED=1,va.CONNECTING=2,va.RECONNECTING=3,va.CLOSED=4,va.FAILED=5,va.OPENED=6,va.IDLE=7,r._signaling=t,r._mediaSource=n,r._state.consumer="IDLE",r._state.producer="IDLE",r._signaling&&r._mediaSource&&(r.subscribe(r._signaling,"NOTIFICATION",r._onSignalingNotification.bind(r)),r.subscribe(r._mediaSource,"TRACK_REPLACED",r._onReplacedTrack.bind(r))),r._interop=new Nr.Interop,r._perfStatReporter=new ga(r,t),Zr.debug("Created"),r}return Dr(t,e),t.prototype.getState=function(){var e=this._getState("consumer"),t=this._getState("producer");return va[e]>va[t]?e:t},t.prototype.open=function(){this._isOpen?Zr.log("Already opened connections"):(this._isOpen=!0,this._openConnection("producer"),this._openConnection("consumer"))},t.prototype.close=function(e){this._isOpen=!1,this._closeConnection("producer"),this._closeConnection("consumer"),this.unsubscribe(),e?(Zr.error("Closed",e),this._setState("FAILED","consumer"),this._setState("FAILED","producer")):(Zr.debug("Closed"),this._setState("CLOSED","consumer"),this._setState("CLOSED","producer"))},t.prototype.preventRestart=function(){this._reconnectionPrevented=!0},t.prototype.allowRestart=function(){this._reconnectionPrevented=!1},t.prototype._closeConnection=function(e){this._stopStatInterval(),"producer"===e&&this._producer&&(this._producer.ontrack=null,this._producer.onconnectionstatechange=null,this._producer.onsignalingstatechange=null,this._producer.close(),this._producer=null,this._producerOfferIsProcessing=!1,this._producerNextOffer=null),"consumer"===e&&this._consumer&&(this._consumer.ontrack=null,this._consumer.onconnectionstatechange=null,this._consumer.onsignalingstatechange=null,this._consumer.close(),this._consumer=null)},t.prototype._openConnection=function(e){var n=this;Zr.debug("Open connection for "+e);var r={};if(xi.baseChromeVersion()&&(r.sdpSemantics=t._isUnifiedPlanEnabled()?"unified-plan":"plan-b"),"producer"===e&&(this._producer=new RTCPeerConnection(r,{optional:[{googSuspendBelowMinBitrate:!1}]}),this._producer.ontrack=this._onAddTrack.bind(this,this._producer,"producer"),this._producer.onconnectionstatechange=si.throttle((function(e){n._producer&&n._onConnectionStateChange(n._producer,"producer",e)}),500),this._producer.onsignalingstatechange=t._onSignalingStateChange.bind(this,this._producer,"producer"),this._setState("OPENED","producer")),"consumer"===e){this._consumer=new RTCPeerConnection(r,{optional:[{googSuspendBelowMinBitrate:!1}]}),this._consumer.ontrack=this._onAddTrack.bind(this,this._consumer,"consumer"),this._consumer.onconnectionstatechange=this._onConnectionStateChange.bind(this,this._consumer,"consumer"),this._consumer.onsignalingstatechange=t._onSignalingStateChange.bind(this,this._consumer,"consumer");try{var i=this._mediaSource.getStream();if(!i)throw new Error("No local stream found");i.getTracks().forEach((function(e){n._consumer&&n._consumer.addTrack(e,i)}))}catch(e){return Zr.error("Unable to add media source tracks",e),this.log("callError","addTrack-consumer"),void this.close(e)}this._allocateConsumer(),this._setState("OPENED","consumer")}this._startStatInterval()},t.prototype._reconnect=function(e){this._setState("RECONNECTING",e),this._closeConnection(e),this._openConnection(e)},t.prototype._updateSSRCMap=function(e){var t=this._ssrcMap;e&&e.sdp.split("\n").forEach((function(e){var n=/a=ssrc:([0-9]+) label:(audio|video)-([ug]?[\d]+)/.exec(e);n&&(t[n[1]]=n[3])}))},t.prototype._setState=function(e,t){this._state[t]!==e&&(this._state[t]=e,this._triggerEvent("STATE_CHANGED",this.getState()))},t.prototype._getState=function(e){return this._state[e]||"IDLE"},t.prototype._startStatInterval=function(){var e=this;if(!this._statInterval){var t=function(){e._producer?(e._collectStat().then((function(t){e._reportStats(t),e._detectStaleTracks(t)})).catch((function(){})),e._statInterval=window.setTimeout(t,3e3)):e._stopStatInterval()};this._statInterval=window.setTimeout(t,3e3)}},t.prototype._stopStatInterval=function(){this._statInterval&&(window.clearTimeout(this._statInterval),this._statInterval=null),this._statBytes={}},t.prototype._collectStat=function(){return Fr(this,void 0,void 0,(function(){var e,t,n=this;return Hr(this,(function(r){return this._producer&&this._consumer?(e=fa.collect(this._producer,this._producerLastStat,this._ssrcMap),t=fa.collect(this._consumer,this._consumerLastStat,this._ssrcMap),[2,Promise.all([e,t]).then((function(e){return{producer:n._producerLastStat=e[0],consumer:n._consumerLastStat=e[1]}}))]):[2,Promise.reject()]}))}))},t.prototype._reportStats=function(e){var t=e.producer,n=e.consumer;this._triggerEvent("REMOTE_DATA_STATS",{inbound:{topology:"SERVER",transport:t.transport,rtps:t.rtps},outbound:{topology:"SERVER",transport:n.transport,rtps:n.rtps}}),this._triggerEvent("LOCAL_DATA_STATS",{outbound:{topology:"SERVER",transport:n.transport,rtps:n.rtps}})},t.prototype._detectStaleTracks=function(e){var t=this,n=e.producer.rtps,r={};this._producer&&this._producer.getReceivers().forEach((function(e){var t=e.track.id.match(/audio-([ug]?[\d]+)/);t&&"ended"!==e.track.readyState&&(r[t[1]]=e.track)})),n.forEach((function(e){if("audio"===e.kind){var n=t._ssrcMap[e.ssrc],i=r[n],a=t._statBytes[n],o=!1;if(a){var s=e.bytesReceived-a.bytesReceived;s>=0&&s<=5&&(o=!0),a.stalled!==o&&i&&t._triggerEvent("REMOTE_STREAM_STALL",i,o)}t._statBytes[n]={bytesReceived:e.bytesReceived,stalled:o}}}))},t.prototype._allocateConsumer=function(){var e=this,t={estimatedPerformanceIndex:ga.getEstimatedPerformanceIndex()},n="consumer";Zr.debug("["+n+"] create offer"),this._consumer&&this._consumer.createOffer({iceRestart:!1,offerToReceiveAudio:!1,offerToReceiveVideo:!1}).catch((function(t){throw Zr.error("["+n+"] unable to create offer",t),e.log("callError","createOffer-"+n),t})).then((function(e){return e.sdp=si.patchSDP(e.sdp,!1,xi.isBrokenH264()),e})).then((function(t){return Fr(e,void 0,void 0,(function(){var e=this;return Hr(this,(function(r){if(Zr.debug("["+n+"] created offer",{offer:t}),!this._consumer)throw new Error("Interrupt allocation");return[2,this._consumer.setLocalDescription(t).then((function(){if(!e._consumer)throw new Error("Interrupt allocation");return e._consumer.localDescription}))]}))}))})).catch((function(t){throw Zr.error("["+n+"] unable to set local offer",t),e.log("callError","setLocalDescription-"+n),t})).then((function(r){return Fr(e,void 0,void 0,(function(){return Hr(this,(function(e){return Zr.debug("["+n+"] transmit local offer"),[2,this._signaling.allocateConsumer(r,t)]}))}))})).catch(this.close.bind(this))},t.prototype._acceptConsumerAnswer=function(e){return Fr(this,void 0,void 0,(function(){var t,n,r=this;return Hr(this,(function(i){if(!this._consumer)throw new Error("Interrupt allocation");return t="consumer",n=new RTCSessionDescription({type:"answer",sdp:e}),Zr.debug("["+t+"] set remote answer",{answer:n}),[2,this._consumer.setRemoteDescription(n).catch((function(e){throw Zr.error("["+t+"] unable to set remote answer",e),r.log("callError","setRemoteDescription-"+t),e}))]}))}))},t.prototype._acceptProducer=function(e){return Fr(this,void 0,void 0,(function(){var n,r,i=this;return Hr(this,(function(a){if(n="producer",r=new RTCSessionDescription({type:"offer",sdp:e}),this._producerOfferIsProcessing)return this._producerNextOffer=e,Zr.debug("["+n+"] wait until other remote offer is processed"),[2];if(this._producerOfferIsProcessing=!0,t._isUnifiedPlanEnabled()&&(Zr.debug("["+n+"] alter remote offer to 'unified plan'",{offer:r}),r=this._interop.toUnifiedPlan(r)),Zr.debug("["+n+"] set remote offer",{offer:r}),!this._producer)throw new Error("Interrupt allocation");return this._producer.setRemoteDescription(r).catch((function(e){throw Zr.error("["+n+"] unable to set remote offer",e),i.log("callError","setRemoteDescription-"+n),e})).then((function(){return Fr(i,void 0,void 0,(function(){var e=this;return Hr(this,(function(t){if(Zr.debug("["+n+"] create local answer"),!this._producer)throw new Error("Interrupt allocation");return[2,this._producer.createAnswer().catch((function(t){throw Zr.error("["+n+"] unable to create answer",t),e.log("callError","createAnswer-"+n),t}))]}))}))})).then((function(e){return e.sdp=si.patchSDP(e.sdp,!1,xi.isBrokenH264()),e})).then((function(e){return Fr(i,void 0,void 0,(function(){var t=this;return Hr(this,(function(r){if(Zr.debug("["+n+"] set local answer",{answer:e}),!this._producer)throw new Error("Interrupt allocation");return[2,this._producer.setLocalDescription(e).catch((function(e){throw Zr.error("["+n+"] unable to set local answer",e),t.log("callError","setLocalDescription-"+n),e})).then((function(){return e}))]}))}))})).then((function(e){return Fr(i,void 0,void 0,(function(){var i;return Hr(this,(function(a){return i=e,t._isUnifiedPlanEnabled()&&(Zr.log("["+n+"] alter local answer to 'plan b'",{answer:e}),i=this._interop.toPlanB(e)),Zr.debug("["+n+"] transmit local answer",{answer:i}),this._updateSSRCMap(r),[2,this._signaling.acceptProducer(i,Object.keys(this._ssrcMap))]}))}))})).then((function(){if(Zr.debug("["+n+"] remote offer has been processed"),i._producerOfferIsProcessing=!1,i._producerNextOffer){Zr.debug("["+n+"] there is other unprocessed remote offer, process it");var e=i._producerNextOffer;return i._producerNextOffer=null,i._acceptProducer(e)}})).catch(this.close.bind(this)),[2]}))}))},t.prototype._onSignalingNotification=function(e){return Fr(this,void 0,void 0,(function(){var t;return Hr(this,(function(n){switch(n.label){case 0:if(!this._isOpen)return[2];switch(e.notification){case"producer-updated":return[3,1];case"consumer-answered":return[3,3];case"realloc-con":return[3,5]}return[3,6];case 1:return[4,this._acceptProducer(e.description)];case 2:return n.sent(),[3,6];case 3:return[4,this._acceptConsumerAnswer(e.description)];case 4:return n.sent(),[3,6];case 5:return(t=e.target?e.target.toLowerCase():null)&&"consumer"!==t||this._reconnect("consumer"),this._reconnect("producer"),[3,6];case 6:return[2]}}))}))},t.prototype._onAddTrack=function(e,t,n){var r=this;Zr.debug("["+t+"] remote track (added)",{track:n.track});var i=n.streams[0];i?(i.onremovetrack||(i.onremovetrack=function(e){r._triggerEvent("REMOTE_TRACK_REMOVED",i.id,i,e.track)}),i.getTracks().find((function(e){return e.id===n.track.id}))||i.addTrack(n.track),this._triggerEvent("REMOTE_TRACK_ADDED",i.id,i,n.track)):Zr.error("["+t+"] unable to get media stream from track event")},t._onSignalingStateChange=function(e,t,n){Zr.debug("["+t+"] signaling state changed",{state:e.signalingState},n)},t.prototype._onConnectionStateChange=function(e,t,n){var r=this;switch(Zr.debug("["+t+"] connection state changed",{state:e.connectionState},n),this.log("callIceConnectionState",e.connectionState),e.connectionState){case"failed":this._reconnectionPrevented?this.close(new Error("Ice connection failed")):this._signaling.requestRealloc(t);break;case"connecting":var i=this._getState(t);"IDLE"===i||"OPENED"===i?this._setState("CONNECTING",t):"checking"===e.iceConnectionState&&this._setState("RECONNECTING",t);break;case"disconnected":this._reconnectionPrevented?this.close(new Error("Ice connection disconnected")):this._setState("RECONNECTING",t);break;case"connected":this._setState("CONNECTED",t),si.getPeerConnectionHostInfo(e).then((function(e){e&&r.log("callIceConnectionType",e.type)}))}},t.prototype._onReplacedTrack=function(e,t){var n=this;this._consumer&&this._consumer.getSenders().forEach((function(e){e.track&&e.track.kind===t.kind&&(e.track.enabled=t.enabled,e.replaceTrack(t).catch((function(e){Zr.error("Unable to replace track",e),n.log("callError","replaceTrack-consumer")})))}))},t._isUnifiedPlanEnabled=function(){var e=xi.browserVersion(),t=xi.baseChromeVersion()?"Chrome":xi.browserName();return Kr.isUnifiedPlan(t,e)},t}(Fi),ba=function(e){function t(t,n,r){var i=e.call(this)||this;return i._allocated=[],i._opened=[],i._directTransports={},i._serverTransport=null,i._dtListeners={},i._stListeners=[],i._states={},i._signaling=n,i._mediaSource=r,i._topology=t,i.subscribe(i._signaling,"NOTIFICATION",i._onSignalingNotification.bind(i)),i}return Dr(t,e),t.prototype.allocate=function(e,t){void 0===t&&(t=!1),-1===this._allocated.indexOf(e)?(this._allocated.push(e),"DIRECT"===this._topology&&(this._directTransports[e]=this._createDirectTransport(e,t)),"SERVER"!==this._topology||this._serverTransport||(this._serverTransport=this._createServerTransport())):Zr.warn("The participant ["+e+"] has already had allocated transport")},t.prototype.open=function(e,t){if(void 0===t&&(t=null),-1===this._opened.indexOf(e))if(-1!==this._allocated.indexOf(e)){if(this._opened.push(e),"DIRECT"===this._topology){if(!this._directTransports[e])return void Zr.warn("Cannot find allocated direct transport for the participant ["+e+"]");this._directTransports[e].open(t)}"SERVER"===this._topology&&this._serverTransport&&(this._serverTransport.open(),this._setState(e,this._serverTransport.getState())),Zr.debug("The participant ["+e+"] transport opened")}else Zr.warn("The participant ["+e+"] has no allocated transport");else Zr.warn("The participant ["+e+"] has already had opened transport")},t.prototype.close=function(e){var t=this._allocated.indexOf(e),n=this._opened.indexOf(e);if(t<0&&Zr.warn("The participant ["+e+"] transport has already deallocated"),"DIRECT"===this._topology){if(!this._directTransports[e])return void Zr.warn("Cannot find allocated direct transport for the participant ["+e+"]");this._directTransports[e].close(),delete this._directTransports[e]}"SERVER"===this._topology&&this._setState(e,"CLOSED"),n>=0&&this._opened.splice(n,1),t>=0&&this._allocated.splice(t,1)},t.prototype.destroy=function(){var e;this.unsubscribe();for(var t=0,n=Object.values(this._dtListeners);t<n.length;t++)n[t].forEach((function(e){e.dispose()}));this._stListeners&&this._stListeners.forEach((function(e){e.dispose()}));for(var r=0,i=Object.keys(this._directTransports);r<i.length;r++)e=i[r],this._directTransports[e].close(),delete this._directTransports[e];this._directTransports={},this._serverTransport&&(this._serverTransport.close(),this._serverTransport=null),this._allocated=[],this._opened=[]},t.prototype.getTopology=function(){return this._topology},t.prototype.isAllocated=function(e){return this._allocated.indexOf(e)>=0},t.prototype.allocated=function(){return this._allocated.slice()},t.prototype.opened=function(){return this._opened.slice()},t.prototype._setStates=function(e,t){var n=this;e.forEach((function(e){n._setState(e,t)}))},t.prototype._setState=function(e,t){this._states[e]!==t&&(this._states[e]=t,this._triggerEvent("STATE_CHANGED",e,t))},t.prototype._onSignalingNotification=function(e){if("topology-changed"===e.notification)return this._onTopologyChanged(e)},t.prototype._onTopologyChanged=function(e){var t=this;if(e.topology!==this._topology){if(Zr.log("Topology changed "+this._topology+" -> "+e.topology),this.log("callTopologyChangeRequested",e.topology),this._topology=e.topology,"SERVER"===this._topology)if(this._serverTransport)this._serverTransport.allowRestart();else if(this._serverTransport=this._createServerTransport(),this._opened.length>0){for(var n=0,r=Object.values(this._directTransports);n<r.length;n++)r[n].preventRestart();this._serverTransport&&this._serverTransport.open()}if("DIRECT"===this._topology){var i=(e.offerTo||[]).map(String);this._allocated&&0!==this._allocated.length||Zr.warn("Topology changed to DIRECT, but the list of allocated participants is empty"),this._serverTransport&&this._serverTransport.preventRestart(),this._allocated.forEach((function(e){var n=i.indexOf(e)>=0;t._directTransports[e]?t._directTransports[e].allowRestart():t._directTransports[e]=t._createDirectTransport(e,n)})),this._opened.forEach((function(e){t._directTransports[e]?t._directTransports[e].open():Zr.warn("There is opened but not allocated transport ["+e+"]")}))}}},t.prototype._createDirectTransport=function(e,t){void 0===t&&(t=!1);var n=new ma(e,t,this._signaling,this._mediaSource);return this._dtListeners[e]&&this._dtListeners[e].length>0&&Zr.warn("The list of direct listeners for the participant ["+e+"] is not empty"),this._dtListeners[e]=[],this._dtListeners[e].push(n.addEventListener("REMOTE_TRACK_ADDED",this._onDirectRemoteTrackAdded.bind(this,e)),n.addEventListener("REMOTE_TRACK_REMOVED",this._onDirectRemoteTrackRemoved.bind(this,e)),n.addEventListener("REMOTE_DATA_STATS",this._onDirectRemoteDataStats.bind(this)),n.addEventListener("LOCAL_DATA_STATS",this._onDirectLocalDataStats.bind(this)),n.addEventListener("STATE_CHANGED",this._onDirectTransportChanged.bind(this,e)),n.addEventListener(this.EVENT_LOG,this._onTransportLog.bind(this))),n},t.prototype._createServerTransport=function(){var e=new _a(this._signaling,this._mediaSource);return this._stListeners&&this._stListeners.length>0&&Zr.warn("The list of server transport listeners is not empty"),this._stListeners=[],this._stListeners.push(e.addEventListener("REMOTE_TRACK_ADDED",this._onServerRemoteTrackAdded.bind(this)),e.addEventListener("REMOTE_TRACK_REMOVED",this._onServerRemoteTrackRemoved.bind(this)),e.addEventListener("REMOTE_STREAM_STALL",this._onServerRemoteStreamStall.bind(this)),e.addEventListener("REMOTE_DATA_STATS",this._onServerRemoteDataStats.bind(this)),e.addEventListener("LOCAL_DATA_STATS",this._onServerLocalDataStats.bind(this)),e.addEventListener("STATE_CHANGED",this._onServerTransportChanged.bind(this)),e.addEventListener(this.EVENT_LOG,this._onTransportLog.bind(this))),e},t.prototype._releaseAllDirectTransports=function(e){for(var t=0,n=Object.keys(this._directTransports);t<n.length;t++){var r=n[t];this._releaseDirectTransport(r,e)}},t.prototype._releaseDirectTransport=function(e,t){this._directTransports[e]&&(t&&this._directTransports[e].close(),delete this._directTransports[e]),this._dtListeners[e]&&this._dtListeners[e].forEach((function(e){e.dispose()})),delete this._dtListeners[e]},t.prototype._releaseServerTransport=function(e){this._serverTransport&&(e&&this._serverTransport.close(),this._serverTransport=null),this._stListeners&&(this._stListeners.forEach((function(e){e.dispose()})),this._stListeners=[])},t.prototype._onDirectTransportChanged=function(e,t){if("CONNECTED"===t&&"DIRECT"===this._topology&&this._releaseServerTransport(!0),("CLOSED"===t||"FAILED"===t)&&(this._releaseDirectTransport(e,!1),"DIRECT"===this._topology)){var n=this._opened.indexOf(e);n>=0&&this._opened.splice(n,1);var r=this._allocated.indexOf(e);r>=0&&this._allocated.splice(r,1)}"DIRECT"===this._topology&&this._setState(e,t)},t.prototype._onServerTransportChanged=function(e){var t=this._opened.slice();"CONNECTED"===e&&"SERVER"===this._topology&&this._releaseAllDirectTransports(!0),"CLOSED"!==e&&"FAILED"!==e||(this._releaseServerTransport(!1),"SERVER"===this._topology&&(this._allocated=[],this._opened=[])),"SERVER"===this._topology&&this._setStates(t,e)},t.prototype._onServerRemoteStreamStall=function(e,t){this._triggerEvent("REMOTE_STREAM_STALL",e,t)},t.prototype._onServerRemoteDataStats=function(e){this._triggerEvent("REMOTE_DATA_STATS",e)},t.prototype._onServerLocalDataStats=function(e){this._triggerEvent("LOCAL_DATA_STATS",e)},t.prototype._onDirectRemoteTrackAdded=function(e,t,n){this._triggerEvent("REMOTE_TRACK_ADDED",e,t,n)},t.prototype._onDirectRemoteTrackRemoved=function(e,t,n){this._triggerEvent("REMOTE_TRACK_REMOVED",e,t,n)},t.prototype._onDirectRemoteDataStats=function(e){this._triggerEvent("REMOTE_DATA_STATS",e)},t.prototype._onDirectLocalDataStats=function(e){this._triggerEvent("LOCAL_DATA_STATS",e)},t.prototype._onServerRemoteTrackAdded=function(e,t,n){this._triggerEvent("REMOTE_TRACK_ADDED",e,t,n)},t.prototype._onServerRemoteTrackRemoved=function(e,t,n){this._triggerEvent("REMOTE_TRACK_REMOVED",e,t,n)},t.prototype._onTransportLog=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.log.apply(this,Gr([e],t))},t}(Fi),ya=function(e){function t(t){var n=e.call(this)||this;return n._detectors={},n._interval=null,n.subscribe(t,"REMOTE_TRACK_ADDED",n._onRemoteTrackAdded.bind(n)),n.subscribe(t,"REMOTE_TRACK_REMOVED",n._onRemoteTrackRemoved.bind(n)),n}return Dr(t,e),t.prototype.destroy=function(){for(var e in this._interval&&(window.clearTimeout(this._interval),this._interval=null),this.unsubscribe(),this._detectors)this._detectors.hasOwnProperty(e)&&this._detectors[e].destroy();this._detectors={}},t.prototype._onRemoteTrackAdded=function(e,t,n){var r=this;if("audio"===n.kind&&(this._detectors[e]&&this._detectors[e].destroy(),this._detectors[e]=new Qi(t),!this._interval)){var i=function(){r._collectVolumes(),r._interval=window.setTimeout(i,Kr.voiceParams.interval)};this._interval=window.setTimeout(i,Kr.voiceParams.interval)}},t.prototype._onRemoteTrackRemoved=function(e,t,n){if("audio"===n.kind){var r=this._detectors[e];r&&r.stream===t&&(r.destroy(),delete this._detectors[e])}},t.prototype._collectVolumes=function(){var e={};for(var t in this._detectors)this._detectors.hasOwnProperty(t)&&(e[t]=this._detectors[t].getLevel());this._triggerEvent("VOLUMES_DETECTED",e)},t}(Fi),Ea=function(e){function t(t,n,r){var i=e.call(this)||this;return i._mediaSource=null,i._conversation=null,i._state="IDLE",i._participantState="CALLED",i._participants={},i._transport=null,i._debugInfo=null,i._volumesDetector=null,i._speakerDetector=null,i._localVolumeDetector=null,i._specListener=null,i._api=t,i._signaling=n,i._logger=new ea(t,r),i._logFn=i._logger.log.bind(i._logger),i._onUnload=function(){i._conversation&&i._api&&i._api.hangupConversation(i._conversation.id),i._logger&&i._logger.destroy()},window.addEventListener("unload",i._onUnload),i.onLog(i._signaling,i._logFn),i}return Dr(t,e),t.current=function(){return t._current},t.prototype.onStart=function(e,n,r,i,a){return void 0===i&&(i=""),void 0===a&&(a=!1),Fr(this,void 0,void 0,(function(){var o,s,c,u,l;return Hr(this,(function(d){switch(d.label){case 0:if(t._activationMutex)return Zr.warn("Conversation: there is already running activation"),[2];t._activationMutex=!0,d.label=1;case 1:return d.trys.push([1,8,,9]),this._mediaSource=this._createMediaSource(),[4,this._mediaSource.request(r)];case 2:return d.sent(),o=this._mediaSource.getMediaSettings().isVideoEnabled,n===Vi.CHAT||e.length>1?this._logger.log("callStartMultiparty",o?"video":"audio"):this._logger.log("callStart",o?"video":"audio"),[4,this._startConversation(e,n,"OUTGOING",o,i,a)];case 3:if(d.sent(),!this._conversation||!this._signaling)throw new Xi(zi.UNKNOWN_ERROR);return[4,this._registerParticipants()];case 4:if(d.sent(),this._allocateTransport(),this._createSpeakerDetector(),this._createSpecListener(),this._signaling.readyToSend(),Zr.debug("Outgoing call",{opponentIds:e,opponentType:n,withVideo:o}),Xr.onLocalStream(this._mediaSource.getStream(),this._mediaSource.getMediaSettings()),Xr.onConversation(this._conversation.externalId),this._toggleJoinAvailability(),this._changeFeatureSet(),this._changeNeedRate(),this._participantState="ACCEPTED",t._current=this,this._conversation.concurrent)return[3,5];for(s=0,c=Object.values(this._participants);s<c.length;s++)u=c[s],Xr.onParticipantStatus(u.externalId,"WAITING");return[3,7];case 5:return[4,this._acceptConcurrent(o)];case 6:d.sent(),d.label=7;case 7:return t._activationMutex=!1,[2,this._conversation];case 8:throw l=d.sent(),t._activationMutex=!1,this._close(l,"Unable to start conversation"),l;case 9:return[2]}}))}))},t.prototype.onJoin=function(e){return Fr(this,void 0,void 0,(function(){var n,r,i,a,o;return Hr(this,(function(s){switch(s.label){case 0:if(t._activationMutex)throw Zr.warn("Conversation: there is already running activation"),new Xi(zi.FAILED);t._activationMutex=!0,s.label=1;case 1:return s.trys.push([1,5,,6]),this._mediaSource=this._createMediaSource(),[4,this._mediaSource.request(e.needVideo)];case 2:return s.sent(),n=this._mediaSource.getMediaSettings().isVideoEnabled,this._logger.log("callJoinConversation",n?"video":"audio"),[4,this._joinConversation(e)];case 3:if(s.sent(),!this._conversation||!this._signaling)throw new Xi(zi.UNKNOWN_ERROR);return[4,this._registerParticipants()];case 4:for(s.sent(),this._allocateTransport(),this._createSpeakerDetector(),this._createSpecListener(),this._signaling.readyToSend(),Xr.onLocalStream(this._mediaSource.getStream(),this._mediaSource.getMediaSettings()),Xr.onConversation(this._conversation.externalId),this._toggleJoinAvailability(),this._changeNeedRate(),this._state="ACTIVE",this._participantState="ACCEPTED",this._changeFeatureSet(),t._current=this,r=0,i=Object.values(this._participants);r<i.length;r++)a=i[r],Xr.onParticipantStatus(a.externalId,"WAITING"),"CALLED"!==a.state&&"ACCEPTED"!==a.state||this._transport&&!this._transport.isAllocated(a.id)&&this._transport.allocate(a.id,!1),this._transport&&"ACCEPTED"===a.state&&this._transport.open(a.id,null);return t._activationMutex=!1,[2,this._conversation];case 5:throw o=s.sent(),t._activationMutex=!1,this._close(o,"Unable to join conversation"),o;case 6:return[2]}}))}))},t.prototype.onPush=function(e,n,r){return void 0===n&&(n="USER"),Fr(this,void 0,void 0,(function(){var i,a,o=this;return Hr(this,(function(s){switch(s.label){case 0:if(t._activationMutex)throw Zr.warn("Conversation: there is already running activation"),new Xi(zi.REJECTED);t._activationMutex=!0,s.label=1;case 1:return s.trys.push([1,4,,5]),[4,this._prepareConversation(e,n,r)];case 2:if(s.sent(),this._mediaSource=this._createMediaSource(),!this._conversation||!this._signaling)throw new Xi(zi.UNKNOWN_ERROR);if(!this._conversation.participants.find((function(e){return o._conversation&&"CALLED"===e.state&&e.id===o._conversation.userId})))throw Zr.log("Push rejected (there is an active call)"),this._logger.log("callPush","rejected"),new Xi(zi.REJECTED);return[4,this._registerParticipants()];case 3:return s.sent(),this._allocateTransport(),this._createSpeakerDetector(),this._createSpecListener(),this._signaling.readyToSend(),Xr.onConversation(this._conversation.externalId),i=this._mediaSource.getMediaSettings().isVideoEnabled,this._logger.log("callPush","accepted"),this._logger.log("callAcceptedOutgoing",i?"video":"audio"),t._current=this,t._activationMutex=!1,[3,5];case 4:throw a=s.sent(),t._activationMutex=!1,this._close(a,"Unable to handle inbound call push"),a;case 5:return[2]}}))}))},t.prototype._acceptConcurrent=function(e){return Fr(this,void 0,void 0,(function(){var t,n,r,i;return Hr(this,(function(a){switch(a.label){case 0:if(!this._mediaSource||!this._signaling||!this._conversation)throw new Xi(zi.UNKNOWN_ERROR);this._logger.log("callAcceptConcurrent",e?"video":"audio"),Zr.debug("Concurrent call",{conversationId:this._conversation.id}),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this._signaling.acceptCall(this._mediaSource.getMediaSettings())];case 2:for(a.sent(),Xr.onCallAccepted(),this._state="ACTIVE",this._participantState="ACCEPTED",this._changeFeatureSet(),t=0,n=Object.values(this._participants);t<n.length;t++)"CALLED"!==(r=n[t]).state&&"ACCEPTED"!==r.state||this._transport&&!this._transport.isAllocated(r.id)&&this._transport.allocate(r.id,!0),this._transport&&"ACCEPTED"===r.state&&this._transport.open(r.id);return[3,4];case 3:return i=a.sent(),this._close(i,"Unable to accept concurrent call"),[3,4];case 4:return[2]}}))}))},t.prototype.accept=function(e){return Fr(this,void 0,void 0,(function(){var t,n,r,i;return Hr(this,(function(a){switch(a.label){case 0:if(this._logger.log("callAcceptIncoming",e?"video":"audio"),Zr.debug("Accept incoming call",{withVideo:e}),!this._mediaSource||!this._signaling||!this._conversation)throw new Xi(zi.UNKNOWN_ERROR);a.label=1;case 1:return a.trys.push([1,4,,5]),[4,this._mediaSource.request(e)];case 2:return a.sent(),[4,this._signaling.acceptCall(this._mediaSource.getMediaSettings())];case 3:for(a.sent(),Xr.onCallAccepted(),Xr.onLocalStream(this._mediaSource.getStream(),this._mediaSource.getMediaSettings()),Xr.onConversation(this._conversation.externalId),this._toggleJoinAvailability(),this._changeNeedRate(),this._state="ACTIVE",this._participantState="ACCEPTED",this._changeFeatureSet(),t=0,n=Object.values(this._participants);t<n.length;t++)"CALLED"!==(r=n[t]).state&&"ACCEPTED"!==r.state||this._transport&&!this._transport.isAllocated(r.id)&&this._transport.allocate(r.id,!0),this._transport&&"ACCEPTED"===r.state&&this._transport.open(r.id),Xr.onParticipantStatus(r.externalId,"WAITING");return[2,this._conversation];case 4:throw i=a.sent(),this._close(i,"Unable to accept call"),i;case 5:return[2]}}))}))},t.prototype.decline=function(){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(e){switch(e.label){case 0:return Zr.debug("Decline incoming call"),this._logger.log("callDeclineIncoming",this._mediaSource&&this._mediaSource.getMediaSettings().isVideoEnabled?"video":"audio"),this._participantState="HUNGUP",this._signaling?[4,this._signaling.hangup(zi.REJECTED)]:[3,2];case 1:e.sent(),e.label=2;case 2:return this._close(new Xi(zi.REJECTED)),[2]}}))}))},t.prototype.hangup=function(){return Fr(this,void 0,void 0,(function(){var e;return Hr(this,(function(t){switch(t.label){case 0:return Zr.debug("Hangup"),e="ACTIVE"===this._state?zi.HUNGUP:zi.CANCELED,this._logger.log("callHangup",e),this._signaling?[4,this._signaling.hangup(e)]:[3,2];case 1:return t.sent(),this._close(new Xi(e)),[3,3];case 2:Xr.onHangup(new Xi(zi.HUNGUP),this._conversation&&this._conversation.id),t.label=3;case 3:return[2]}}))}))},t.prototype.addParticipant=function(e,t){return Fr(this,void 0,void 0,(function(){var n,r;return Hr(this,(function(i){switch(i.label){case 0:return this._signaling?[4,this._signaling.addParticipant(e,t)]:(this._close(new Xi(zi.UNKNOWN_ERROR),"Unable to add participant"),[2]);case 1:return n=i.sent(),r=null,"error"===n.type&&(r="call-unfeasible"===n.error?n.status:zi.UNKNOWN_ERROR),[4,this._onAddParticipant(e,r)];case 2:return i.sent(),[2]}}))}))},t.prototype.removeParticipant=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){switch(t.label){case 0:return this._signaling?[4,this._signaling.removeParticipant(e)]:[3,2];case 1:t.sent(),this._onRemoveParticipant(e),t.label=2;case 2:return[2]}}))}))},t.prototype._close=function(e,n){n&&Zr.error(n,e),Zr.debug("Close conversation",e),e.error?this._signaling&&this._signaling.hangup(zi.FAILED):this._logger.log("callError",e.hangup),t._activationMutex=!1;var r=this._conversation&&this._conversation.id;return-1!==[zi.CANCELED,zi.NOT_FRIENDS,zi.CALLEE_IS_OFFLINE,zi.CALLER_IS_BLOCKED].indexOf(e.hangup)||e.hangup===zi.REJECTED&&!e.remote?(Xr.onHangup(e,r),void this.destroy()):(e.hangup!==zi.HUNGUP||e.remote&&"CALLED"!==this._participantState)&&(e.hangup!==zi.MISSED||e.remote)?e.hangup!==zi.BUSY||e.remote?(this._state="CLOSE",this._participantState="HUNGUP",this._changeFeatureSet(),this._cleanupMediaSource(),this._cleanupParticipants(),this._cleanupTransport(),this._cleanupSpeakerDetector(),this._cleanupSpecListener(),this._cleanupSignaling(),this._conversation=null,t._current=null,void Xr.onHangup(e||new Xi(zi.UNKNOWN_ERROR),r)):(this._cleanupSignaling(),void this._cleanupMediaSource()):(Xr.onHangup(e,r),void this.destroy())},t.prototype.destroy=function(){var e=this._conversation&&this._conversation.id;Zr.debug("Destroy conversation",{conversationId:e}),this._cleanupMediaSource(),this._cleanupParticipants(),this._cleanupTransport(),this._cleanupSpeakerDetector(),this._cleanupSpecListener(),this._cleanupSignaling(),this._cleanupListeners(),this._logger.destroy(),this._conversation=null,t._current=null},t.prototype._getConversationParams=function(){return Fr(this,void 0,void 0,(function(){var e,t,n,r;return Hr(this,(function(i){switch(i.label){case 0:return[4,this._api.getConversationParams()];case 1:return e=i.sent(),Zr.debug("Api.getConversationParams",e),t=[],n=e.turn_server,(r=e.stun_server)&&t.push(r),n&&t.push(n),Kr.iceServers=t,Kr.wssBase=e.endpoint,Kr.wssToken=e.token,e.client_type&&(Kr.clientType=e.client_type),[2]}}))}))},t.prototype._startConversation=function(e,t,n,r,i,a){return void 0===r&&(r=!1),void 0===i&&(i=""),void 0===a&&(a=!1),Fr(this,void 0,void 0,(function(){var o,s,c;return Hr(this,(function(u){switch(u.label){case 0:return o=si.uuid(),Zr.debug("Conversation: start",{conversationId:o,opponentIds:e,opponentType:t,direction:n,withVideo:r}),[4,this._api.startConversation(o,e,t,r,i,a)];case 1:return s=u.sent(),Zr.debug("Api.startConversation",s),[4,this._getConversationParams()];case 2:return u.sent(),[4,this._connectSignaling(Yi.START,s)];case 3:return c=u.sent(),[4,this._setConversation(s,c,n)];case 4:return u.sent(),[2]}}))}))},t.prototype._joinConversation=function(e){return Fr(this,void 0,void 0,(function(){var t,n,r,i,a,o,s;return Hr(this,(function(c){switch(c.label){case 0:return t=e.conversationId,n=e.needVideo,r=void 0!==n&&n,i=e.chatId,a=e.joinLink,Zr.debug("Conversation: join",{conversationId:t,joinLink:a,needVideo:r}),t?[4,this._api.joinConversation(t,r,i)]:[3,2];case 1:return o=c.sent(),[3,5];case 2:return a?[4,this._api.joinConversationByLink(a,r)]:[3,4];case 3:return o=c.sent(),[3,5];case 4:throw new Xi(zi.UNKNOWN_ERROR);case 5:return Zr.debug("Api.joinConversation",o),[4,this._getConversationParams()];case 6:return c.sent(),[4,this._connectSignaling(Yi.JOIN,o)];case 7:return s=c.sent(),[4,this._setConversation(o,s,"JOINING")];case 8:return c.sent(),[2]}}))}))},t.prototype._prepareConversation=function(e,n,r){return void 0===n&&(n="USER"),Fr(this,void 0,void 0,(function(){var i,a,o;return Hr(this,(function(s){switch(s.label){case 0:return Zr.debug("Conversation: push",{conversationId:e,type:n,peerId:r}),[4,this._getConversationParams()];case 1:if(s.sent(),!(i=this._api.getUserId()))throw new Xi(zi.UNKNOWN_ERROR);return a={id:e,peerId:r,endpoint:Kr.wssBase+"?userId="+i+"&entityType="+n+"&conversationId="+e+"&token="+Kr.wssToken,is_concurrent:!1},[4,this._connectSignaling(Yi.ACCEPT,a)];case 2:return o=s.sent(),t._current&&"ACCEPTED"===t._current._participantState?(Zr.log("Push rejected (busy)"),this._logger.log("callPush","busy"),this._signaling&&this._signaling.hangup(zi.BUSY),[2,Promise.reject({hangup:zi.BUSY})]):(t._current&&(t._current.destroy(),t._current=null),[4,this._setConversation(a,o,"INCOMING",n)]);case 3:return s.sent(),[2]}}))}))},t.prototype._createParticipant=function(e){return Fr(this,void 0,void 0,(function(){var t,n;return Hr(this,(function(r){switch(r.label){case 0:return t=Object.assign({id:null,externalId:null,mediaSettings:null,participantState:null,state:null,remoteStream:null,remoteVideoTrack:null,remoteAudioTrack:null,mediaSource:null,platform:null,clientType:null},e),n=t,[4,this._api.userId(t.id)];case 1:return n.externalId=r.sent(),[2,t]}}))}))},t.prototype._setConversation=function(e,t,n,r){var i,a;return void 0===r&&(r="USER"),Fr(this,void 0,void 0,(function(){var o,s,c,u;return Hr(this,(function(l){switch(l.label){case 0:if(!(o=this._api.getUserId())){if(!(s=null===(a=null===(i=t.conversation)||void 0===i?void 0:i.participants)||void 0===a?void 0:a.find((function(e){return e.peerId&&e.peerId.id===t.peerId.id&&e.peerId.type===t.peerId.type}))))throw new Xi(zi.UNKNOWN_ERROR);o=String(s.id),r=s.idType,this._api.setUserId(o)}return c=si.composeId(o,r),[4,this._api.userId(c)];case 1:return u=l.sent(),this._conversation={userId:o,compositeUserId:c,externalId:u,acceptTime:t.conversation.acceptTime,features:t.conversation.features||[],id:t.conversation.id||e.id,participants:(t.conversation.participants||[]).map((function(e){return e.id=String(e.id),e})),participantsLimit:t.conversation.participantsLimit||30,topology:t.conversation.topology||"DIRECT",direction:n,concurrent:t.isConcurrent||e.is_concurrent||!1,needRate:!1,chatId:t.conversation.multichatId,permissions:[],recordInfo:null,joinLink:e.join_link},this._onRecordInfo(t.conversation.recordInfo),this._signaling.setConversationId(e.id),this._changeFeatureSet(),this._logDevices(),[2]}}))}))},t.prototype._createMediaSource=function(){var e=new ta;return this.subscribe(e,"SOURCE_CHANGED",this._onLocalMediaStreamChanged.bind(this)),this.onLog(e,this._logFn),e},t.prototype._connectSignaling=function(e,t){return Fr(this,void 0,void 0,(function(){var n;return Hr(this,(function(r){switch(r.label){case 0:return this._signaling.setEndpoint(t.endpoint),this.subscribe(this._signaling,"NOTIFICATION",this._onSignalingNotification.bind(this)),this.subscribe(this._signaling,"FAILED",this._onSignalingFailed.bind(this)),this.subscribe(this._signaling,"RECONNECT",this._onSignalingReconnect.bind(this)),[4,this._signaling.connect(e,t)];case 1:return n=r.sent(),Zr.debug("Signaling connected",n),[2,n]}}))}))},t.prototype._registerParticipants=function(){var e;return Fr(this,void 0,void 0,(function(){var t,n,r,i,a,o,s;return Hr(this,(function(c){switch(c.label){case 0:return this._conversation?(t=this._conversation.participants.map((function(e){return e.id})),[4,this._api.prepareUserIds(t)]):[2];case 1:c.sent(),n=0,r=this._conversation.participants,c.label=2;case 2:return n<r.length?(i=r[n],a=si.composeParticipantId(i),this._conversation&&a===this._conversation.compositeUserId?(this._conversation.permissions=i.permissions,Xr.onUserPermissions(i.permissions),[3,4]):"HUNGUP"===i.state||"REJECTED"===i.state?(this._removeParticipant(i,zi.HUNGUP),[3,4]):(o=this._participants,s=a,[4,this._createParticipant({id:a,mediaSettings:i.mediaSettings,participantState:null===(e=i.participantState)||void 0===e?void 0:e.state,state:i.state})])):[3,5];case 3:o[s]=c.sent(),c.label=4;case 4:return n++,[3,2];case 5:return[2]}}))}))},t.prototype._allocateTransport=function(){if(this._conversation&&this._signaling&&this._mediaSource){this._transport=new ba(this._conversation.topology,this._signaling,this._mediaSource),this._debugInfo=new Ji,this.subscribe(this._transport,"STATE_CHANGED",this._onTransportStateChanged.bind(this)),this.subscribe(this._transport,"REMOTE_TRACK_ADDED",this._onRemoteTrackAdded.bind(this)),this.subscribe(this._transport,"REMOTE_TRACK_REMOVED",this._onRemoteTrackRemoved.bind(this)),this.subscribe(this._transport,"REMOTE_STREAM_STALL",this._onRemoteStreamStall.bind(this)),this.subscribe(this._transport,"LOCAL_DATA_STATS",this._onLocalDataStats.bind(this)),this.onLog(this._transport,this._logFn),this.onLog(this._debugInfo,this._logFn);for(var e="OUTGOING"===this._conversation.direction&&!this._conversation.concurrent,t=0,n=Object.values(this._participants);t<n.length;t++){var r=n[t];"ACCEPTED"!==r.state&&"CALLED"!==r.state||this._transport.allocate(r.id,e)}}},t.prototype._createSpeakerDetector=function(){this._transport&&(this._volumesDetector=new ya(this._transport),this.subscribe(this._volumesDetector,"VOLUMES_DETECTED",this._onVolumesDetected.bind(this)),this._speakerDetector=new na(this._volumesDetector),this.subscribe(this._speakerDetector,"SPEAKER_CHANGED",this._onSpeakerChanged.bind(this)),this._localVolumeDetector=new Zi(this._mediaSource))},t.prototype._createSpecListener=function(){this._transport&&this._volumesDetector&&(this._specListener=new ra(this._transport,this._volumesDetector,this._participants),this.onLog(this._specListener,this._logFn))},t.prototype._logDevices=function(){var e=xi.getCameras().length,t=xi.getMicrophones().length;Zr.debug("Cameras: "+e+(xi.hasCameraPermission()?"✔":"✖")+", Microphones: "+t+(xi.hasMicrophonePermission()?"✔":"✖")),this._logger.log("callDevices",e+"_"+t)},t.prototype._removeParticipant=function(e,t){var n,r;"CALLED"!==e.state&&"ACCEPTED"!==e.state&&"CLOSE"!==this._state&&this._participants[e.id]&&(t===zi.HUNGUP?Xr.onParticipantStatus(e.externalId,"HANGUP"):Xr.onParticipantStatus(e.externalId,"ERROR",t),null===(n=e.mediaSource)||void 0===n||n.disconnect(),null===(r=e.remoteAudioTrack)||void 0===r||r.stop(),delete this._participants[e.id],Xr.onRemoteRemoved(e.externalId))},t.prototype._cleanupListeners=function(){this.unsubscribe(),window.removeEventListener("unload",this._onUnload)},t.prototype._cleanupMediaSource=function(){this._mediaSource&&(this._mediaSource.destroy(),this._mediaSource=null)},t.prototype._cleanupParticipants=function(){Object.values(this._participants).forEach((function(e){var t,n,r,i;null===(t=e.remoteStream)||void 0===t||t.getTracks().forEach((function(e){e.stop()})),null===(n=e.remoteAudioTrack)||void 0===n||n.stop(),null===(r=e.remoteVideoTrack)||void 0===r||r.stop(),null===(i=e.mediaSource)||void 0===i||i.disconnect()})),this._participants={}},t.prototype._cleanupTransport=function(){this._transport&&(this._transport.destroy(),this._transport=null),this._debugInfo&&(this._debugInfo.destroy(),this._debugInfo=null)},t.prototype._cleanupSpeakerDetector=function(){this._speakerDetector&&(this._speakerDetector.destroy(),this._speakerDetector=null),this._volumesDetector&&(this._volumesDetector.destroy(),this._volumesDetector=null),this._localVolumeDetector&&(this._localVolumeDetector.destroy(),this._localVolumeDetector=null)},t.prototype._cleanupSpecListener=function(){this._specListener&&(this._specListener.destroy(),this._specListener=null)},t.prototype._cleanupSignaling=function(){this._signaling&&this._signaling.close()},t.prototype._onAddParticipant=function(e,t){return Fr(this,void 0,void 0,(function(){var n,r,i;return Hr(this,(function(a){switch(a.label){case 0:return Zr.debug("Add new participant ["+e+"]"),!(n=this._participants[e])||"ACCEPTED"!==n.state&&"CALLED"!==n.state?n?[3,2]:(r=this._participants,i=e,[4,this._createParticipant({id:e})]):(Zr.warn("Participant ["+n.id+":"+n.state+"] is already in conversation"),[2]);case 1:r[i]=a.sent(),n=this._participants[e],a.label=2;case 2:return Xr.onParticipantStatus(n.externalId,"WAITING"),t?(n.state="HUNGUP",this._removeParticipant(n,t)):this._transport&&(n.state="CALLED",this._transport.allocate(n.id,!0),this._logger.log("callAddParticipant")),[2]}}))}))},t.prototype._onRemoveParticipant=function(e){Zr.debug("Remove participant ["+e+"]");var t=this._participants[e];t?(this._transport&&this._transport.close(t.id),this._logger.log("callRemoveParticipant")):Zr.warn("Participant ["+e+"] isn't in conversation")},t.prototype.changeDevice=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){return this._mediaSource?[2,this._mediaSource.changeDevice(e)]:[2,Promise.reject(qr.UNKNOWN)]}))}))},t.prototype.toggleScreenCapturing=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){return this._mediaSource?[2,this._mediaSource.toggleScreenCapturing(e)]:[2,Promise.reject(qr.UNKNOWN)]}))}))},t.prototype.setVideoStream=function(e,t){return void 0===t&&(t=!1),Fr(this,void 0,void 0,(function(){return Hr(this,(function(n){return this._mediaSource?[2,this._mediaSource.setVideoStream(e,t)]:[2]}))}))},t.prototype.toggleLocalVideo=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){return this._mediaSource?[2,this._mediaSource.toggleVideo(e)]:[2]}))}))},t.prototype.toggleLocalAudio=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){return this._mediaSource?[2,this._mediaSource.toggleAudio(e)]:[2]}))}))},t.prototype.changePriorities=function(e){return Fr(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,c,u,l;return Hr(this,(function(d){switch(d.label){case 0:if(e.length<2||!this._signaling)return[2];for(t={},n={},r=0,i=e;r<i.length;r++)a=i[r],o="object"==typeof a.uid?a.uid:Wi.fromId(a.uid),l=Wi.toString(o),n[l]=a.priority;for(s=0,c=Object.values(this._participants);s<c.length;s++)u=c[s],l=Wi.toString(u.externalId),n.hasOwnProperty(l)&&(t[u.id]=n[l]);return[4,this._signaling.changePriorities(t)];case 1:return d.sent(),[2]}}))}))},t.prototype.changeParticipantState=function(e){return Fr(this,void 0,void 0,(function(){var t,n,r,i,a;return Hr(this,(function(o){switch(o.label){case 0:for(t=0,n=Object.entries(e);t<n.length;t++)if(r=n[t],i=r[0],a=r[1],i.length>5||a.length>5)throw new Error("key/value max length is 5 chars, mappings with empty values (null or empty string) are discarded");return[4,this._signaling.changeParticipantState(e)];case 1:return o.sent(),[2]}}))}))},t.prototype.updateDisplayLayout=function(e){return Fr(this,void 0,void 0,(function(){var n,r,i,a,o,s,c,u,l,d;return Hr(this,(function(p){switch(p.label){case 0:if(e.length<1||!this._signaling)return[2];for(n={},r={},i=0,a=e;i<a.length;i++)o=a[i],s="object"==typeof o.uid?o.uid:Wi.fromId(o.uid),d=Wi.toString(s),r[d]=t._layoutToString(o);for(c=0,u=Object.values(this._participants);c<u.length;c++)l=u[c],d=Wi.toString(l.externalId),r.hasOwnProperty(d)&&(n[l.id]=r[d]);return[4,this._signaling.updateDisplayLayout(n)];case 1:return p.sent(),[2]}}))}))},t.prototype.muteParticipant=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!0),Fr(this,void 0,void 0,(function(){return Hr(this,(function(n){switch(n.label){case 0:return this._signaling&&this._conversation&&this._conversation.permissions.indexOf("MUTE_PARTICIPANTS")>-1?[4,this._signaling.switchParticipantMic(e,!t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.chatMessage=function(e,t){return void 0===t&&(t=null),Fr(this,void 0,void 0,(function(){return Hr(this,(function(n){switch(n.label){case 0:return this._signaling?[4,this._signaling.chatMessage(e,t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.chatHistory=function(e){return Fr(this,void 0,void 0,(function(){var t,n,r;return Hr(this,(function(i){switch(i.label){case 0:return this._signaling?[4,this._signaling.chatHistory(e)]:[3,5];case 1:t=i.sent(),n=t.messages.length-1,i.label=2;case 2:return n>=0?(r=t.messages[n],[4,this._onChatMessage(r)]):[3,5];case 3:i.sent(),i.label=4;case 4:return n--,[3,2];case 5:return[2]}}))}))},t.prototype.customData=function(e,t){return void 0===t&&(t=null),Fr(this,void 0,void 0,(function(){return Hr(this,(function(n){switch(n.label){case 0:return this._signaling?[4,this._signaling.customData(e,t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.createJoinLink=function(){return Fr(this,void 0,void 0,(function(){var e,t;return Hr(this,(function(n){switch(n.label){case 0:return this._conversation?[4,this._api.createJoinLink(this._conversation.id)]:[3,2];case 1:if(e=n.sent(),t=e.join_link)return this._conversation.joinLink=t,[2,t];n.label=2;case 2:return[2,Promise.reject()]}}))}))},t.prototype.removeJoinLink=function(){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(e){switch(e.label){case 0:return this._conversation?[4,this._api.removeJoinLink(this._conversation.id)]:[3,2];case 1:if(e.sent().success)return delete this._conversation.joinLink,[2];e.label=2;case 2:return[2,Promise.reject()]}}))}))},t.prototype.startStream=function(e,t,n,r,i){return void 0===e&&(e=!1),void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r="DIRECT_LINK"),void 0===i&&(i=null),Fr(this,void 0,void 0,(function(){var a,o;return Hr(this,(function(s){switch(s.label){case 0:return a={movieId:n,name:t,privacy:r,groupId:i,streamMovie:!e},[4,this._signaling.startStream(a)];case 1:return(o=s.sent()).error?[2,Promise.reject()]:[2,o]}}))}))},t.prototype.stopStream=function(){return Fr(this,void 0,void 0,(function(){var e;return Hr(this,(function(t){switch(t.label){case 0:return[4,this._signaling.stopStream()];case 1:return(e=t.sent()).error?[2,Promise.reject()]:[2,e]}}))}))},t.prototype.getStreamInfo=function(){return Fr(this,void 0,void 0,(function(){var e;return Hr(this,(function(t){switch(t.label){case 0:return[4,this._signaling.getRecordStatus()];case 1:return[2,{movieId:(e=t.sent()).recordMovieId,preview:e.recordMoviePreviewUrl}]}}))}))},t.prototype._onLocalMediaStreamChanged=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){switch(t.label){case 0:return Zr.debug("Local media stream changed",e.mediaSettings),Xr.onLocalStreamUpdate(e.mediaSettings,e.kind),this._signaling?[4,this._signaling.changeMediaSettings(e.mediaSettings)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t._layoutToString=function(e){var t="";return void 0!==e.priority&&(t+="p="+e.priority),void 0!==e.width&&void 0!==e.height&&(""!==t&&(t+=":"),t+="sz="+Math.round(e.width)+"x"+Math.round(e.height)),void 0!==e.fit&&(""!==t&&(t+=":"),t+="fit="+e.fit),t},t.prototype._changeRemoteMediaSettings=function(e,t){Zr.debug("Remote media settings changed ["+e+"]",t);var n=this._participants[e];n&&(n.mediaSettings=t,n.remoteStream&&n.remoteVideoTrack&&t.isVideoEnabled&&(n.remoteStream.addTrack(n.remoteVideoTrack),n.remoteVideoTrack=null),"ACTIVE"===this._state&&Xr.onRemoteMediaSettings(n.externalId,t),this._specListener&&this._specListener.onChangeRemoteMediaSettings(e,t))},t.prototype._changeRemoteParticipantState=function(e,t){Zr.debug("Remote participant state changed ["+e+"]",t);var n=this._participants[e];n&&(n.participantState=t||{},"ACTIVE"===this._state&&Xr.onRemoteParticipantState(n.externalId,n.participantState))},t.prototype._onSignalingNotification=function(e){switch(e.notification){case"accepted-call":return this._onAcceptedCall(e);case"hungup":return this._onHungup(e);case"participant-added":return this._onAddedParticipant(e);case"participant-joined":return this._onJoinedParticipant(e);case"closed-conversation":return this._onClosedConversation(e);case"media-settings-changed":return this._onMediaSettingsChanged(e);case"participant-state-changed":return this._onParticipantStateChanged(e);case"rate-call-data":return this._onNeedRate();case"feature-set-changed":return this._onFeatureSetChanged(e);case"multiparty-chat-created":return this._onMultipartyChatCreated(e);case"force-media-settings-change":return this._onForceMediaSettingsChange(e);case"registered-peer":return this._onPeerRegistered(e);case"switch-micro":return this._onMicSwitched(e);case"chat-message":return this._onChatMessage(e);case"custom-data":return this._onCustomData(e);case"record-started":return this._onRecordInfo(e.recordInfo);case"record-stopped":return this._onRecordInfo(null)}},t.prototype._onSignalingReconnect=function(e){var t,n;return Fr(this,void 0,void 0,(function(){var r,i,a,o,s,c,u,l,d,p,h,f;return Hr(this,(function(m){switch(m.label){case 0:if(!this._conversation)return[2];if(e.conversation.acceptTime&&(this._conversation.acceptTime=e.conversation.acceptTime),e.conversation.participantsLimit&&(this._conversation.participantsLimit=e.conversation.participantsLimit),e.conversation.features&&(this._conversation.features=e.conversation.features,this._changeFeatureSet()),e.conversation.topology,e.conversation.state,!e.conversation.participants)return[3,6];r=Object.keys(this._participants),i=[],a=0,o=e.conversation.participants,m.label=1;case 1:return a<o.length?(s=o[a],(c=si.composeParticipantId(s))===this._conversation.compositeUserId?[3,4]:(i.push(c),(u=this._participants[c])?[3,3]:[4,this._onJoinedParticipant({participantId:s.id,participantType:s.idType,mediaSettings:s.mediaSettings,participantState:null===(t=s.participantState)||void 0===t?void 0:t.state,state:s.state})])):[3,5];case 2:return m.sent(),[3,4];case 3:g=s.mediaSettings,v=u.mediaSettings,(g.isAudioEnabled!==v.isAudioEnabled||g.isVideoEnabled!==v.isVideoEnabled||g.isScreenSharingEnabled!==v.isScreenSharingEnabled||g.isDataEnabled!==v.isDataEnabled)&&this._changeRemoteMediaSettings(c,s.mediaSettings),l=(null===(n=s.participantState)||void 0===n?void 0:n.state)||{},d=u.participantState||{},si.comparePlainObjects(l,d)||this._changeRemoteParticipantState(c,l),m.label=4;case 4:return a++,[3,1];case 5:for(p=0,h=r;p<h.length;p++)f=h[p],i.indexOf(f)<0&&this._removeParticipant(this._participants[f],zi.HUNGUP);m.label=6;case 6:return this._onRecordInfo(e.conversation.recordInfo),[2]}var g,v}))}))},t.prototype._onSignalingFailed=function(e){Zr.error("Signaling failed",e),this._close(e)},t.prototype._onAcceptedCall=function(e){return Fr(this,void 0,void 0,(function(){var t,n,r,i,a;return Hr(this,(function(o){switch(o.label){case 0:return t=si.composeMessageId(e),n=si.getPeerIdString(e.peerId),Zr.debug("Participant accepted call ["+t+"]"),this._conversation&&t===this._conversation.compositeUserId?(this._close(new Xi(zi.MISSED),"Call accepted on other device"),[2]):(r=this._participants[t])?[3,2]:(i=this._participants,a=t,[4,this._createParticipant({id:t})]);case 1:i[a]=o.sent(),r=this._participants[t],o.label=2;case 2:return r.state="ACCEPTED",r.mediaSettings=e.mediaSettings,this._conversation&&"OUTGOING"===this._conversation.direction&&"IDLE"===this._state&&(this._state="ACTIVE",this._changeFeatureSet()),"ACTIVE"===this._state&&this._transport&&this._transport.open(r.id,n),this._changeRemoteMediaSettings(t,e.mediaSettings),this._changeRemoteParticipantState(t,null),[2]}}))}))},t.prototype._onHungup=function(e){Zr.debug("Participant hungup ["+e.participantId+"]",{reason:e.reason});var t=si.composeMessageId(e);if(this._conversation&&this._conversation.compositeUserId===t)this._close(new Xi(e.reason));else{var n=this._participants[t];n?(this._transport&&this._transport.close(t),n.state=e.reason===zi.REJECTED?"REJECTED":"HUNGUP","IDLE"!==this._state&&"ACTIVE"!==this._state||this._removeParticipant(n,zi.HUNGUP)):Zr.warn("Participant ["+t+"] isn't in conversation")}},t.prototype._onAddedParticipant=function(e){var t,n,r;return Fr(this,void 0,void 0,(function(){var i,a,o,s;return Hr(this,(function(c){switch(c.label){case 0:return Zr.debug("Participant added ["+e.participantId+"]"),i=si.composeMessageId(e),(a=this._participants[i])&&"HUNGUP"!==a.state&&"REJECTED"!==a.state?(Zr.debug("Participant ["+i+"] is already in conversation and is active"),[2]):a?[3,2]:(o=this._participants,s=i,[4,this._createParticipant({id:i})]);case 1:o[s]=c.sent(),a=this._participants[i],c.label=2;case 2:return a.state="CALLED",a.mediaSettings=null===(t=e.participant)||void 0===t?void 0:t.mediaSettings,a.participantState=null===(r=null===(n=e.participant)||void 0===n?void 0:n.participantState)||void 0===r?void 0:r.state,Xr.onParticipantStatus(a.externalId,"WAITING"),"ACTIVE"===this._state&&this._transport&&this._transport.allocate(a.id,!0),this._changeRemoteMediaSettings(i,a.mediaSettings),this._changeRemoteParticipantState(i,a.participantState),[2]}}))}))},t.prototype._onJoinedParticipant=function(e){var t,n;return Fr(this,void 0,void 0,(function(){var r,i,a,o;return Hr(this,(function(s){switch(s.label){case 0:return Zr.debug("Participant joined ["+e.participantId+"]"),r=si.composeMessageId(e),(i=this._participants[r])&&"ACCEPTED"===i.state?(Zr.warn("Participant ["+r+"] is already in conversation and is active"),[2]):i?[3,2]:(a=this._participants,o=r,[4,this._createParticipant({id:r})]);case 1:a[o]=s.sent(),i=this._participants[r],s.label=2;case 2:return this._conversation&&"OUTGOING"===this._conversation.direction&&"IDLE"===this._state&&(this._state="ACTIVE",this._changeFeatureSet()),i.state="ACCEPTED",i.mediaSettings=e.mediaSettings,i.participantState=null===(n=null===(t=e.participant)||void 0===t?void 0:t.participantState)||void 0===n?void 0:n.state,this._transport&&this._transport.isAllocated(i.id)?Xr.onParticipantStatus(i.externalId,"CONNECTED"):Xr.onParticipantStatus(i.externalId,"WAITING"),"ACTIVE"===this._state&&this._transport&&!this._transport.isAllocated(i.id)&&(this._transport.allocate(i.id,!0),this._transport.open(i.id)),this._changeRemoteMediaSettings(r,i.mediaSettings),this._changeRemoteParticipantState(r,i.participantState),[2]}}))}))},t.prototype._onClosedConversation=function(e){this._toggleJoinAvailability(),this._close(new Xi(e.reason,{remote:!0}))},t.prototype._onMediaSettingsChanged=function(e){var t=si.composeMessageId(e);this._changeRemoteMediaSettings(t,e.mediaSettings)},t.prototype._onParticipantStateChanged=function(e){var t,n=si.composeMessageId(e);this._changeRemoteParticipantState(n,null===(t=e.participantState)||void 0===t?void 0:t.state)},t.prototype._onNeedRate=function(){this._conversation&&(this._conversation.needRate=!0,this._changeNeedRate())},t.prototype._onFeatureSetChanged=function(e){this._conversation&&(this._conversation.features=e.features,this._changeFeatureSet())},t.prototype._onMultipartyChatCreated=function(e){this._conversation&&(this._conversation.chatId=e.chatId,this._toggleJoinAvailability(),Xr.onMultipartyChatCreated(this._conversation))},t.prototype._onForceMediaSettingsChange=function(e){return Fr(this,void 0,void 0,(function(){var t;return Hr(this,(function(n){switch(n.label){case 0:return this._mediaSource?(t=this._mediaSource.getMediaSettings()).isAudioEnabled===e.mediaSettings.isAudioEnabled?[3,2]:[4,this._mediaSource.toggleAudio(e.mediaSettings.isAudioEnabled)]:[2];case 1:n.sent(),n.label=2;case 2:return t.isVideoEnabled===e.mediaSettings.isVideoEnabled?[3,4]:[4,this._mediaSource.toggleVideo(e.mediaSettings.isVideoEnabled)];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))},t.prototype._onPeerRegistered=function(e){var t=si.composeMessageId(e);this._participants[t]&&(this._participants[t].clientType=e.clientType,this._participants[t].platform=e.platform)},t.prototype._onMicSwitched=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){switch(t.label){case 0:return[4,this.toggleLocalAudio(!e.mute)];case 1:return t.sent(),[2]}}))}))},t.prototype._onChatMessage=function(e){return Fr(this,void 0,void 0,(function(){var t,n;return Hr(this,(function(r){switch(r.label){case 0:return t=si.composeMessageId(e),this._participants[t]?(n=this._participants[t].externalId,[3,3]):[3,1];case 1:return[4,this._api.userId(t)];case 2:n=r.sent(),r.label=3;case 3:return Xr.onChatMessage(e.message,n,e.direct),[2]}}))}))},t.prototype._onCustomData=function(e){return Fr(this,void 0,void 0,(function(){var t,n;return Hr(this,(function(r){switch(r.label){case 0:return t=si.composeMessageId(e),this._participants[t]?(n=this._participants[t].externalId,[3,3]):[3,1];case 1:return[4,this._api.userId(t)];case 2:n=r.sent(),r.label=3;case 3:return Xr.onCustomData(e.data,n,e.direct),[2]}}))}))},t.prototype._onRecordInfo=function(e){return Fr(this,void 0,void 0,(function(){var t,n;return Hr(this,(function(r){switch(r.label){case 0:return this._conversation?(t=!1,!this._conversation.recordInfo!=!e?t=!0:this._conversation.recordInfo&&e&&(t=this._conversation.recordInfo.recordMovieId!==e.recordMovieId),t?e?[4,this._api.userId(e.initiator)]:[3,2]:[3,3]):[2];case 1:return n=r.sent(),Xr.onRecordStarted(n,e.recordMovieId,e.recordStartTime,e.recordType),[3,3];case 2:Xr.onRecordStopped(),r.label=3;case 3:return this._conversation.recordInfo=e,[2]}}))}))},t.prototype._changeFeatureSet=function(){if(this._conversation){var e="ACTIVE"===this._state,t=this._conversation.features.indexOf("ADD_PARTICIPANT")>=0;Xr.onCallState(e,t,this._conversation)}},t.prototype._changeNeedRate=function(){this._conversation&&this._conversation.needRate&&Xr.onRateNeeded()},t.prototype._onVolumesDetected=function(e){for(var t=[],n=0,r=Object.entries(e);n<r.length;n++){var i=r[n],a=i[0],o=i[1],s=this._participants[a];s&&s.externalId&&t.push({uid:s.externalId,volume:o.real})}Xr.onVolumesDetected(t)},t.prototype._onSpeakerChanged=function(e){Xr.onSpeakerChanged(this._participants[e].externalId)},t.prototype._onTransportStateChanged=function(e,t){return Fr(this,void 0,void 0,(function(){var n;return Hr(this,(function(r){switch(r.label){case 0:return(n=this._participants[e])?(Zr.debug("Transport state for participant ["+e+"] has changed: "+t),"CONNECTED"===t&&Xr.onParticipantStatus(n.externalId,"CONNECTED"),"CONNECTING"===t&&Xr.onParticipantStatus(n.externalId,"CONNECTING"),"RECONNECTING"===t&&Xr.onParticipantStatus(n.externalId,"RECONNECT"),"FAILED"!==t?[3,3]:this._transport&&0===this._transport.allocated().length?this._signaling?[4,this._signaling.hangup(zi.FAILED)]:[3,2]:[3,3]):(Zr.warn("Participant ["+e+"] isn't in conversation"),[2]);case 1:r.sent(),r.label=2;case 2:return this._close(new Xi(zi.FAILED),"Transport failed"),[3,3];case 3:return[2]}}))}))},t.prototype._onRemoteTrackAdded=function(e,t,n){var r,i;return Fr(this,void 0,void 0,(function(){var a,o,s,c;return Hr(this,(function(u){switch(u.label){case 0:return Zr.debug("Remote track added on the participant ["+e+"]",{kind:n.kind}),(a=this._participants[e])?[3,2]:(Zr.warn("Conversation: track added before participant ["+e+"]"),o=this._participants,s=e,[4,this._createParticipant({id:e,state:"CALLED"})]);case 1:o[s]=u.sent(),a=this._participants[e],Xr.onParticipantStatus(a.externalId,"WAITING"),u.label=2;case 2:return this._transport&&!this._transport.isAllocated(a.id)&&this._transport.allocate(a.id,!1),a.remoteStream!==t&&(a.remoteStream=t,Xr.onRemoteStream(a.externalId,t)),Kr.directAudioOutput&&"audio"===n.kind&&(null===(r=a.mediaSource)||void 0===r||r.disconnect(),null===(i=a.remoteAudioTrack)||void 0===i||i.stop(),c=xi.getAudioContext(),a.remoteAudioTrack=n.clone(),a.mediaSource=c.createMediaStreamSource(new MediaStream([a.remoteAudioTrack])),a.mediaSource.connect(c.destination)),a.mediaSettings&&(n&&!a.mediaSettings.isVideoEnabled&&"video"===n.kind&&(a.remoteVideoTrack=n,a.remoteStream.removeTrack(n)),this._changeRemoteMediaSettings(e,a.mediaSettings)),this._changeRemoteParticipantState(e,a.participantState),[2]}}))}))},t.prototype._onRemoteTrackRemoved=function(e,t,n){var r,i;if(Kr.directAudioOutput&&"audio"===n.kind){var a=this._participants[e];a&&(a.remoteStream&&a.remoteStream!==t||(null===(r=a.mediaSource)||void 0===r||r.disconnect(),a.mediaSource=null,null===(i=a.remoteAudioTrack)||void 0===i||i.stop(),a.remoteAudioTrack=null))}},t.prototype._onRemoteStreamStall=function(e,t){Object.values(this._participants).forEach((function(n){n.remoteStream&&"HUNGUP"!==n.state&&n.remoteStream.getAudioTracks().forEach((function(r){r.id===e.id&&(t?Xr.onParticipantStatus(n.externalId,"RECONNECT"):Xr.onParticipantStatus(n.externalId,"CONNECTED"))}))}))},t.prototype._onLocalDataStats=function(e){var t;this._debugInfo&&this._debugInfo.onLocalDataStats(e,null===(t=this._mediaSource)||void 0===t?void 0:t.getMediaSettings())},t.prototype._toggleJoinAvailability=function(){var e=this._conversation&&this._conversation.chatId,t=e&&"CLOSE"!==this._state||!1;e&&(Zr.debug("Toggle join availability",{available:t,chatId:e}),Xr.onJoinStatus(t,e))},t}(Fi);function Oa(e,t,n){if(void 0===t&&(t={}),void 0===n&&(n=!1),window.Blob&&window.navigator.sendBeacon){var r=Ta(e,t,n),i=new window.Blob([r],{type:"application/x-www-form-urlencoded"});window.navigator.sendBeacon(Kr.apiEnv.api+"fb.do",i)}}function Ca(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=!1),Fr(this,void 0,void 0,(function(){return Hr(this,(function(r){return[2,Sa(Ta(e,t,n))]}))}))}function Sa(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){return[2,new Promise((function(t,n){var r=new XMLHttpRequest;r.open("POST",Kr.apiEnv.api+"fb.do",!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(r.readyState===XMLHttpRequest.DONE){var e;try{e=JSON.parse(r.responseText)}catch(t){e={result:r.responseText}}200!==r.status||e.hasOwnProperty("error_msg")?n(e):t(e)}},r.send(e)}))]}))}))}function Ta(e,t,n){void 0===t&&(t={}),void 0===n&&(n=!1),t.method=e,t.format="JSON",t.application_key=Kr.apiKey,n||(zr.sessionKey?t.session_key=zr.sessionKey:zr.accessToken&&(t.access_token=zr.accessToken));for(var r=0,i=Object.entries(t);r<i.length;r++){var a=i[r],o=a[0];"object"==typeof(d=a[1])&&(t[o]=JSON.stringify(d))}for(var s="",c=0,u=Object.entries(t);c<u.length;c++){var l=u[c],d=(o=l[0],l[1]);s&&(s+="&"),s+=o+"="+encodeURIComponent(d)}return s}var wa,Ia=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._userId=null,t._externalUidsCache={},t}return Dr(t,e),t.prototype._callUnsafe=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=!1),Fr(this,void 0,void 0,(function(){var r,i=this;return Hr(this,(function(a){return[2,(r=function(a){return Fr(i,void 0,void 0,(function(){var i;return Hr(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,5]),[4,Ca(e,t,n)];case 1:return[2,o.sent()];case 2:return(i=o.sent()).hasOwnProperty("error_msg")?[3,4]:(a++,Zr.debug(e+" network error, attempt "+a+"..."),a<5?[4,si.delay(700*a)]:[3,4]);case 3:return o.sent(),[2,r(a)];case 4:throw Zr.warn(e,"error",i),i;case 5:return[2]}}))}))})(0)]}))}))},t.prototype._call=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=!1),Fr(this,void 0,void 0,(function(){var r,i;return Hr(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,10]),[4,this._callUnsafe(e,t,n)];case 1:return[2,a.sent()];case 2:switch(r=a.sent(),i=qr.API,r.error_code){case 102:case 103:case 104:return[3,3];case 1101:return[3,5];case 1102:return[3,6];case 1103:return[3,7];case 1104:case 1106:return[3,8]}return[3,9];case 3:return[4,this.authorize()];case 4:return a.sent(),[2,this._callUnsafe(e,t,n)];case 5:return i=zi.SERVICE_DISABLED,[3,9];case 6:return i=zi.CALLEE_IS_OFFLINE,[3,9];case 7:return i=zi.NOT_FRIENDS,[3,9];case 8:return i=zi.EXTERNAL_API_ERROR,[3,9];case 9:throw new Xi(i,{message:r.error_msg,code:r.error_code});case 10:return[2]}}))}))},t.prototype._getCurrentUser=function(){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(e){return[2,this._call("users.getCurrentUser")]}))}))},t.prototype.userId=function(e){return Fr(this,void 0,void 0,(function(){var t,n,r,i;return Hr(this,(function(a){switch(a.label){case 0:return t=si.decomposeId(e).id,zr.isEmpty()?[2,Wi.fromId(t)]:this._externalUidsCache.hasOwnProperty(t)?[3,2]:(r=(n=Object).assign,i=[this._externalUidsCache],[4,this._getExternalIdsByOkIds([t])]);case 1:r.apply(n,i.concat([a.sent()])),a.label=2;case 2:return[2,Wi.fromString(this._externalUidsCache[t])]}}))}))},t.prototype.prepareUserIds=function(e){return Fr(this,void 0,void 0,(function(){var t,n,r;return Hr(this,(function(i){switch(i.label){case 0:return zr.isEmpty()?[3,2]:(n=(t=Object).assign,r=[this._externalUidsCache],[4,this._getExternalIdsByOkIds(e)]);case 1:n.apply(t,r.concat([i.sent()])),i.label=2;case 2:return[2]}}))}))},t.prototype.authorize=function(){return Fr(this,void 0,void 0,(function(){var e,t,n=this;return Hr(this,(function(r){return this._uuid||((e=ni.get("uuid"))||(e=si.uuid(),ni.set("uuid",e)),this._uuid=String(e)),t={session_data:{version:2,device_id:this._uuid,client_version:Kr.appVersion,client_type:"SDK_JS"}},Kr.authToken&&(t.session_data.auth_token=Kr.authToken,t.session_data.version=3),[2,this._callUnsafe("auth.anonymLogin",t,!0).then((function(e){e.uid&&(n._userId=String(e.uid)),zr.sessionKey=e.session_key,zr.sessionSecretKey=e.session_secret_key})).catch((function(e){throw 401===e.error_code&&Xr.onTokenExpired(),new Xi(qr.AUTH,{message:e.error_msg,code:e.error_code})}))]}))}))},t.prototype.log=function(e){Oa("log.externalLog",{collector:"ok.mobile.apps.video",data:JSON.stringify({application:Kr.appName+":2.1.8",platform:Kr.platform,items:e})})},t.prototype.init=function(){!function(){if(!Kr.apiAppId||!Kr.apiKey)throw new Xi(qr.API,{message:"Required arguments apiAppId/apiAppKey not passed"})}()},t.prototype.joinConversation=function(e,t,n){return void 0===t&&(t=!1),Fr(this,void 0,void 0,(function(){var r;return Hr(this,(function(i){return r={conversationId:e,isVideo:t},n&&(r.chatId=n),[2,this._call("vchat.joinConversation",r)]}))}))},t.prototype.createConversation=function(e,t){return void 0===t&&(t=""),Fr(this,void 0,void 0,(function(){var n;return Hr(this,(function(r){return n={conversationId:e,createJoinLink:!0,isVideo:!1},t&&(n.payload=t),[2,this._startConversation(n)]}))}))},t.prototype.startConversation=function(e,t,n,r,i,a){return void 0===r&&(r=!1),void 0===i&&(i=""),void 0===a&&(a=!1),Fr(this,void 0,void 0,(function(){var o;return Hr(this,(function(s){if(o={conversationId:e,isVideo:r},t&&t.length)switch(n){case Vi.USER:o.uids=t.join(",");break;case Vi.GROUP:o.gid=t[0];break;case Vi.CHAT:o.chatId=t[0]}return a&&(o.createJoinLink=!0),i&&(o.payload=i),[2,this._startConversation(o)]}))}))},t.prototype._startConversation=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){return[2,this._call("vchat.startConversation",e)]}))}))},t.prototype.createJoinLink=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){return[2,this._call("vchat.createJoinLink",{conversationId:e})]}))}))},t.prototype.removeJoinLink=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){return[2,this._call("vchat.removeJoinLink",{conversationId:e})]}))}))},t.prototype.getAnonymTokenByLink=function(e,t){return Fr(this,void 0,void 0,(function(){var n,r;return Hr(this,(function(i){switch(i.label){case 0:return n={joinLink:e},t&&(n.anonymName=t),[4,this._call("vchat.getAnonymTokenByLink",n)];case 1:return r=i.sent(),this._userId=String(r.uid),[2,r.token]}}))}))},t.prototype.joinConversationByLink=function(e,t){return void 0===t&&(t=!1),Fr(this,void 0,void 0,(function(){var n;return Hr(this,(function(r){return n={joinLink:e,isVideo:t},Kr.anonymToken&&(n.anonymToken=Kr.anonymToken),[2,this._call("vchat.joinConversationByLink",n)]}))}))},t.prototype.getOkIdsByExternalIds=function(e){return Fr(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,c,u,l,d,p=this;return Hr(this,(function(h){switch(h.label){case 0:for(t=Wi.fromIds(e),n=[],r={methods:[]},i=[],a=Object.keys(this._externalUidsCache),o=Object.values(this._externalUidsCache),s=0,c=t;s<c.length;s++)u=c[s],l=Wi.toString(u),(d=o.indexOf(l))>-1?n.push(a[d]):(i.push(l),r.methods.push({"vchat.getOkIdByExternalId":{params:{externalId:u.id,anonym:u.type===Ki.ANONYM},onError:"SKIP"}}));return r.methods.length?[4,this._call("batch.executeV2",r)]:[2,n];case 1:return h.sent().forEach((function(e,t){if(e.ok){var r=String(e.ok.ok_id);p._externalUidsCache[r]=i[t],n.push(r)}})),[2,n]}}))}))},t.prototype.getConversationParams=function(){return Fr(this,void 0,void 0,(function(){var e;return Hr(this,(function(t){return e={},Kr.anonymToken&&(e.anonymToken=Kr.anonymToken),[2,this._call("vchat.getConversationParams",e)]}))}))},t.prototype.getUserId=function(){return this._userId},t.prototype.setUserId=function(e){this._userId=e},t.prototype.hangupConversation=function(e){var t={conversationId:e,reason:zi.HUNGUP};Kr.anonymToken&&(t.anonymToken=Kr.anonymToken),Oa("vchat.hangupConversation",t)},t.prototype._getExternalIdsByOkIds=function(e){return Fr(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,c,u,l;return Hr(this,(function(d){switch(d.label){case 0:t={},d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this._call("vchat.getExternalIdsByOkIds",{uids:e.join(",")})];case 2:if((n=d.sent()).external_ids)for(r=0,i=Object.entries(n.external_ids);r<i.length;r++)a=i[r],u=a[0],l=a[1],t[u]=Wi.fromIdToString(l,Ki.USER);if(n.anonym_ids)for(o=0,s=Object.entries(n.anonym_ids);o<s.length;o++)c=s[o],u=c[0],l=c[1],t[u]=Wi.fromIdToString(l,Ki.ANONYM);return[2,t];case 3:return d.sent(),[2,t];case 4:return[2]}}))}))},t}(Ui);!function(e){e.RECOVER="recover",e.ACCEPT_CALL="accept-call",e.ADD_PARTICIPANT="add-participant",e.REMOVE_PARTICIPANT="remove-participant",e.HANGUP="hangup",e.TRANSMIT_DATA="transmit-data",e.ACCEPT_PRODUCER="accept-producer",e.ALLOCATE_CONSUMER="allocate-consumer",e.CHANGE_MEDIA_SETTINGS="change-media-settings",e.CHANGE_PARTICIPANT_STATE="change-participant-state",e.CHANGE_STREAM_PRIORITIES="change-streams-priorities",e.UPDATE_DISPLAY_LAYOUT="update-display-layout",e.REPORT_PERF_STAT="report-perf-stat",e.RECORD_START="record-start",e.RECORD_STOP="record-stop",e.RECORD_GET_STATUS="record-get-status",e.SWITCH_MICRO="switch-micro",e.SWITCH_TOPOLOGY="switch-topology",e.REQUEST_REALLOC="request-realloc",e.CHAT_MESSAGE="chat-message",e.CHAT_HISTORY="chat-history",e.CUSTOM_DATA="custom-data"}(wa||(wa={}));var Pa,ja,ka=wa,Aa=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.socket=null,t.sequence=1,t.lastStamp=0,t.commandsQueue=[],t.incomingCache=[],t.responseHandlers={},t.reconnectCount=0,t.conversationResolve=null,t.conversationReject=null,t.connected=!1,t.listenersReady=!1,t.postfix="&platform="+Kr.platform+"&appVersion="+Kr.appVersion+"&version="+Kr.protocolVersion+"&device="+Kr.device,t.peerId=null,t.conversationId=null,t.reconnectTimer=0,t.connectionMessageWaitTimer=0,t.doctorTimer=0,t}return Dr(t,e),t.prototype.setEndpoint=function(e){this.endpoint=e},t.prototype.setConversationId=function(e){this.conversationId=e},t.prototype.connect=function(e){return Fr(this,void 0,void 0,(function(){var t=this;return Hr(this,(function(n){return this.postfix+="&clientType="+Kr.clientType,[2,new Promise((function(n,r){if(t.socket&&t.socket.readyState<WebSocket.CLOSING)return t.log("callSocketAction","already_opened"),void r(Error("Socket already opened"));t.conversationResolve=function(e){n(e),t.conversationResolve=null,t.conversationReject=null},t.conversationReject=function(e){r(e),t.conversationResolve=null,t.conversationReject=null},t._connect(e)}))]}))}))},t.prototype._send=function(e,t){return void 0===t&&(t={}),Fr(this,void 0,void 0,(function(){var n,r=this;return Hr(this,(function(i){return t.participantId&&(n=this._decomposeId(t.participantId),t=Object.assign({},t,{participantId:n.id,participantType:n.type})),[2,new Promise((function(n,i){if(!r.socket)return r.log("callSocketAction","not_opened"),Zr.warn("Socket not opened"),void i(new Error("Socket not opened"));r.socket.readyState>WebSocket.OPEN&&(r.log("callSocketAction","invalid_state"),Zr.warn("Invalid state "+r.socket.readyState)),r.commandsQueue.push({sequence:r.sequence++,name:e,params:t,responseTimer:0,resolve:n,reject:i}),r.socket.readyState===WebSocket.OPEN&&r._handleCommandsQueue()}))]}))}))},t.prototype.hangup=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){return[2,this._send(ka.HANGUP,{reason:e}).catch((function(){}))]}))}))},t.prototype.sendCandidate=function(e,t){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(n){return[2,this._send(ka.TRANSMIT_DATA,{participantId:e,data:{candidate:t}})]}))}))},t.prototype.sendSdp=function(e,t){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(n){return[2,this._send(ka.TRANSMIT_DATA,{participantId:e,data:{sdp:t}})]}))}))},t.prototype.acceptCall=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){return[2,this._send(ka.ACCEPT_CALL,{mediaSettings:e})]}))}))},t.prototype.changeMediaSettings=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){return[2,this._send(ka.CHANGE_MEDIA_SETTINGS,{mediaSettings:e})]}))}))},t.prototype.changeParticipantState=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){return[2,this._send(ka.CHANGE_PARTICIPANT_STATE,{participantState:{state:e}})]}))}))},t.prototype.addParticipant=function(e,t){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(n){return[2,this._send(ka.ADD_PARTICIPANT,Br({participantId:e},t))]}))}))},t.prototype.removeParticipant=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){return[2,this._send(ka.REMOVE_PARTICIPANT,{participantId:e})]}))}))},t.prototype.allocateConsumer=function(e,t){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(n){return[2,this._send(ka.ALLOCATE_CONSUMER,{description:e.sdp,capabilities:t})]}))}))},t.prototype.acceptProducer=function(e,t){return Fr(this,void 0,void 0,(function(){var n;return Hr(this,(function(r){return n={description:e.sdp},t&&(n.ssrcs=t),[2,this._send(ka.ACCEPT_PRODUCER,n)]}))}))},t.prototype.changePriorities=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){return[2,this._send(ka.CHANGE_STREAM_PRIORITIES,{typedPriorities:e}).catch((function(){}))]}))}))},t.prototype.updateDisplayLayout=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){return[2,this._send(ka.UPDATE_DISPLAY_LAYOUT,{layouts:e}).catch((function(){}))]}))}))},t.prototype.startStream=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){return[2,this._send(ka.RECORD_START,e)]}))}))},t.prototype.stopStream=function(){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(e){return[2,this._send(ka.RECORD_STOP)]}))}))},t.prototype.getRecordStatus=function(){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(e){return[2,this._send(ka.RECORD_GET_STATUS)]}))}))},t.prototype.switchParticipantMic=function(e,t){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(n){return[2,this._send(ka.SWITCH_MICRO,{eId:e,all:null===e,muteTarget:!t})]}))}))},t.prototype.switchTopology=function(e,t){return void 0===t&&(t=!1),Fr(this,void 0,void 0,(function(){return Hr(this,(function(n){return[2,this._send(ka.SWITCH_TOPOLOGY,{topology:e,force:t})]}))}))},t.prototype.requestRealloc=function(e){return Fr(this,void 0,void 0,(function(){var t;return Hr(this,(function(n){return t={},e&&(t.target=e.toUpperCase()),[2,this._send(ka.REQUEST_REALLOC,t)]}))}))},t.prototype.reportPerfStat=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){return[2,this._send(ka.REPORT_PERF_STAT,{report:e})]}))}))},t.prototype.chatMessage=function(e,t){return void 0===t&&(t=null),Fr(this,void 0,void 0,(function(){return Hr(this,(function(n){return[2,this._send(ka.CHAT_MESSAGE,{message:e,participantId:t})]}))}))},t.prototype.chatHistory=function(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){return[2,this._send(ka.CHAT_HISTORY,{count:e})]}))}))},t.prototype.customData=function(e,t){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(n){return[2,this._send(ka.CUSTOM_DATA,{data:e,participantId:t})]}))}))},t.prototype.close=function(){this.socket&&this.socket.readyState<WebSocket.CLOSING&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket.close(),this.socket=null),this._stopWaitConnectionMessage(),this._stopDoctor(),clearTimeout(this.reconnectTimer)},t.prototype.readyToSend=function(){this.listenersReady=!0,this._handleCachedMessages()},t.prototype._decomposeId=function(e){return si.decomposeId(e)},t.prototype._connect=function(e){if(!(this.socket&&this.socket.readyState<WebSocket.CLOSING)){var t=e?"&tgt="+e:"";Zr.debug("Connecting to "+this.endpoint+this.postfix+t),this.socket=new WebSocket(this.endpoint+this.postfix+t),this.socket.onopen=this._onOpen.bind(this),this.socket.onmessage=this._onMessage.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this._startDoctor()}},t.prototype._recover=function(){var e=this;new Promise((function(n,r){if(!e.socket||e.socket.readyState!==WebSocket.OPEN)return Zr.warn("Socket not opened"),void r(new Error("Socket not opened"));var i={sequence:e.sequence++,name:"recover",params:{stamp:e.lastStamp},responseTimer:0,resolve:n,reject:r},a=Object.assign({command:i.name,sequence:i.sequence},i.params);i.responseTimer=window.setTimeout(e._handleCommandResponse.bind(e,!1,a),t.WAIT_RESPONSE_DELAY),e.responseHandlers[i.sequence]=i,e.socket.send(JSON.stringify(a))})).then((function(t){t.error||t.messages.forEach(e._handleMessage.bind(e)),e._handleCommandsQueue()}))},t.prototype._onOpen=function(){this.log("callSocketAction","opened"),this._waitConnectionMessage(),this._startDoctor()},t.prototype._onMessage=function(e){if(this._startDoctor(),"ping"!==e.data)try{this._handleMessage(JSON.parse(e.data))}catch(t){this.log("callSocketAction","parse_error"),Zr.error("Unable to parse message",t,e.data)}else this.socket&&this.socket.readyState===WebSocket.OPEN&&this.socket.send("pong")},t.prototype._handleMessage=function(e){"notification"===e.type?"connection"===e.notification?(this.connected=!0,this.reconnectCount=0,this.endpoint=e.endpoint,e.peerId&&this.peerId!==e.peerId.id&&(this.postfix+="&peerId="+e.peerId.id,this.peerId=e.peerId.id),this._stopWaitConnectionMessage(),this.conversationResolve?this.conversationResolve(e):this._triggerEvent("RECONNECT",e),this.lastStamp?(this._handleCachedMessages(),this._recover()):this._handleCommandsQueue()):this.connected&&this.listenersReady?this._triggerEvent("NOTIFICATION",e):this.incomingCache.push(e):"response"!==e.type&&"error"!==e.type||!this.responseHandlers[e.sequence]?"error"===e.type?"service-unavailable"===e.error&&e.recoverable?(this.log("callSocketAction","service-unavailable"),this._reconnect()):e.sequence&&e.recoverable||(this.connected||"invalid-token"===e.error?(this.log("callSocketAction","error-"+e.error),this._throwError(new Error("Signaling error: "+e.error))):"conversation-ended"===e.error?this._triggerEvent("NOTIFICATION",{notification:"closed-conversation",reason:e.reason}):(this.conversationReject&&this.conversationReject(new Xi(qr.SIGNALING_FAILED,{message:"Unable to connect to the signaling: "+e.error})),this.close())):(this.log("callSocketAction","unknown_message"),Zr.warn("Unhandled message",e)):this._handleCommandResponse(!0,e),this.lastStamp=e.stamp||this.lastStamp},t.prototype._handleCachedMessages=function(){for(;this.incomingCache.length>0;){var e=this.incomingCache.pop();this._handleMessage(e)}},t.prototype._throwError=function(e){this._triggerEvent("FAILED",e)},t.prototype._onError=function(e){this.log("callSocketAction","error"),Zr.error("Error",e)},t.prototype._onClose=function(e){this.log("callSocketAction","closed"),Zr.debug("Connection closed",{code:e.code,reason:e.reason}),this.connected=!1,this._stopDoctor(),this.socket&&this.reconnectCount++<t.RECONNECT_MAX_COUNT?this._reconnect():this.socket&&(Object.values(this.responseHandlers).forEach((function(e){window.clearTimeout(e.responseTimer),e.reject(new Error("Connection closed"))})),this.commandsQueue=[],this.responseHandlers={},this.socket=null,this.lastStamp=0,this.listenersReady=!1,this._throwError(new Error("Connection closed")))},t.prototype._reconnect=function(){var e=Math.min(t.RECONNECT_MAX_DELAY,t.RECONNECT_DELAY*Math.pow(2,this.reconnectCount-1));Zr.log("Reconnect websocket after "+e+"ms ("+this.reconnectCount+")"),this.log("callSocketAction","reconnect"),this.reconnectTimer=window.setTimeout(this._connect.bind(this,Yi.RETRY),e)},t.prototype._handleCommandResponse=function(e,t){if(this.responseHandlers.hasOwnProperty(t.sequence)){var n=this.responseHandlers[t.sequence];window.clearTimeout(n.responseTimer),e?n.resolve(t):(this.log("callSocketAction","response-timeout"),n.reject(new Error("Response timeout ["+n.name+"]"))),delete this.responseHandlers[t.sequence]}},t.prototype._handleCommandsQueue=function(){for(;this.commandsQueue.length>0;){var e=this.commandsQueue.shift();if(this.socket&&this.socket.readyState===WebSocket.OPEN){var n=Object.assign({command:e.name,sequence:e.sequence},e.params);e.responseTimer=window.setTimeout(this._handleCommandResponse.bind(this,!1,n),t.WAIT_RESPONSE_DELAY),this.responseHandlers[e.sequence]=e,this.socket.send(JSON.stringify(n))}else e.reject(new Error("Invalid state or socket already closed"))}},t.prototype._waitConnectionMessage=function(){var e=this;this.connectionMessageWaitTimer=window.setTimeout((function(){e.conversationReject&&e.conversationReject(new Xi(qr.SIGNALING_FAILED,{message:"Unable to connect to the signaling: connection timeout"}))}),t.WAIT_CONNECTION_DELAY)},t.prototype._stopWaitConnectionMessage=function(){window.clearTimeout(this.connectionMessageWaitTimer),this.connectionMessageWaitTimer=0},t.prototype._startDoctor=function(){var e=this;this._stopDoctor(),this.doctorTimer=window.setTimeout((function(){Zr.warn("Socket is dead, trying to reconnect"),e.close(),e._connect(Yi.RETRY)}),t.WAIT_MESSAGE_DELAY)},t.prototype._stopDoctor=function(){window.clearTimeout(this.doctorTimer),this.doctorTimer=0},t.RECONNECT_DELAY=Kr.signalingReconnectDelay,t.RECONNECT_MAX_DELAY=Kr.signalingReconnectMaxDelay,t.RECONNECT_MAX_COUNT=Kr.signalingReconnectMaxCount,t.WAIT_CONNECTION_DELAY=Kr.waitConnectionDelay,t.WAIT_RESPONSE_DELAY=Kr.waitResponseDelay,t.WAIT_MESSAGE_DELAY=Kr.waitMessageDelay,t}(Hi),Ra=null,La={getCameras:xi.getCameras,getMicrophones:xi.getMicrophones,getOutput:xi.getOutput,hasCamera:xi.hasCamera,hasMicrophone:xi.hasMicrophone,getSavedCamera:xi.getSavedCamera,getSavedMicrophone:xi.getSavedMicrophone,getSavedOutput:xi.getSavedOutput,hasCameraPermission:xi.hasCameraPermission,hasMicrophonePermission:xi.hasMicrophonePermission,hasPermissions:xi.hasPermissions,getUserMedia:xi.getUserMedia,getUserVideo:xi.getUserVideo,getUserAudio:xi.getUserAudio,saveDeviceId:xi.saveDeviceId,isBrowserSupported:xi.isBrowserSupported,isScreenCapturingSupported:xi.isScreenCapturingSupported,os:xi.os,isMobile:xi.isMobile,browserName:xi.browserName,browserVersion:xi.browserVersion,baseChromeVersion:xi.baseChromeVersion,getAudioContext:xi.getAudioContext};function Na(e){ja=e}function Ma(e){Pa=e}function Da(e){Ra=e}function xa(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){switch(t.label){case 0:return Kr.set(e),ja||Na(new Ia),Pa||Ma((function(){return new Aa})),[4,xi.init()];case 1:if(t.sent(),!xi.isBrowserSupported())throw new Xi(qr.UNSUPPORTED);if(!xi.hasMicrophone()&&!Kr.allowMissingMic)throw new Xi(qr.MIC_NOT_FOUND);return ja.init(),[2]}}))}))}function Ua(e,t,n,r){return void 0===t&&(t=!1),void 0===n&&(n=""),void 0===r&&(r=!1),Fr(this,void 0,void 0,(function(){var i,a;return Hr(this,(function(o){switch(o.label){case 0:return i=[],a=[],Array.isArray(e)?i=e.length?e:[]:e&&(i=[e]),i.length?[4,ja.getOkIdsByExternalIds(i)]:[3,2];case 1:a=o.sent(),o.label=2;case 2:return[2,Ba(a,Vi.USER,t,n,r)]}}))}))}function Ba(e,t,n,r,i){return void 0===t&&(t=Vi.USER),void 0===n&&(n=!1),void 0===r&&(r=""),void 0===i&&(i=!1),Fr(this,void 0,void 0,(function(){return Hr(this,(function(a){return[2,new Ea(ja,Pa(),Ra).onStart(e,t,n,r,i)]}))}))}function Fa(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){return[2,Ha(e)]}))}))}function Ha(e,t,n){return void 0===t&&(t="USER"),Fr(this,void 0,void 0,(function(){return Hr(this,(function(r){return[2,new Ea(ja,Pa(),Ra).onPush(e,t,n)]}))}))}function Ga(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){return e&&(Kr.authToken=e),[2,ja.authorize()]}))}))}function Va(e){return Fr(this,void 0,void 0,(function(){var t;return Hr(this,(function(n){return(t=Ea.current())?[2,t.accept(e)]:[2]}))}))}function qa(){return Fr(this,void 0,void 0,(function(){var e;return Hr(this,(function(t){return(e=Ea.current())?[2,e.decline()]:[2]}))}))}function za(e,t){return void 0===t&&(t=!1),Fr(this,void 0,void 0,(function(){return Hr(this,(function(n){return[2,Ka(e,t)]}))}))}function Ka(e,t,n){return void 0===t&&(t=!1),Fr(this,void 0,void 0,(function(){return Hr(this,(function(r){return[2,new Ea(ja,Pa(),Ra).onJoin({conversationId:e,needVideo:t,chatId:n})]}))}))}function Wa(e,t,n){return void 0===t&&(t=!1),Fr(this,void 0,void 0,(function(){return Hr(this,(function(r){return n&&(Kr.anonymToken=n),[2,new Ea(ja,Pa(),Ra).onJoin({joinLink:e,needVideo:t})]}))}))}function Ya(){return Fr(this,void 0,void 0,(function(){var e;return Hr(this,(function(t){return(e=Ea.current())?[2,e.hangup()]:[2]}))}))}function $a(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){switch(t.label){case 0:return[4,ja.getOkIdsByExternalIds([e])];case 1:return[2,Ja(t.sent()[0])]}}))}))}function Ja(e,t){return Fr(this,void 0,void 0,(function(){var n;return Hr(this,(function(r){switch(r.label){case 0:return(n=Ea.current())?[4,n.addParticipant(si.composeId(e,"USER"),t)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))}function Xa(e){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){switch(t.label){case 0:return[4,ja.getOkIdsByExternalIds([e])];case 1:return[2,Qa(t.sent()[0])]}}))}))}function Qa(e){return Fr(this,void 0,void 0,(function(){var t;return Hr(this,(function(n){switch(n.label){case 0:return(t=Ea.current())?[4,t.removeParticipant(si.composeId(e,"USER"))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function Za(e,t){return Fr(this,void 0,void 0,(function(){var n,r;return Hr(this,(function(i){switch(i.label){case 0:return[4,xi.saveDeviceId(e,t)];case 1:return n=i.sent(),r=Ea.current(),n&&r?[2,r.changeDevice(e)]:[2,Promise.reject()]}}))}))}function eo(e){return Fr(this,void 0,void 0,(function(){var t;return Hr(this,(function(n){return(t=Ea.current())?[2,t.toggleScreenCapturing(e)]:[2,Promise.reject()]}))}))}function to(e,t){return void 0===t&&(t=!1),Fr(this,void 0,void 0,(function(){var n;return Hr(this,(function(r){switch(r.label){case 0:return(n=Ea.current())?[4,n.setVideoStream(e,t)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))}function no(e){return Fr(this,void 0,void 0,(function(){var t;return Hr(this,(function(n){switch(n.label){case 0:return(t=Ea.current())?[4,t.toggleLocalVideo(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function ro(e){return Fr(this,void 0,void 0,(function(){var t;return Hr(this,(function(n){switch(n.label){case 0:return(t=Ea.current())?[4,t.toggleLocalAudio(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function io(e){return Fr(this,void 0,void 0,(function(){var t;return Hr(this,(function(n){switch(n.label){case 0:return(t=Ea.current())?[4,t.changePriorities(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function ao(e){return Fr(this,void 0,void 0,(function(){var t;return Hr(this,(function(n){switch(n.label){case 0:return(t=Ea.current())?[4,t.changeParticipantState(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function oo(e){return Fr(this,void 0,void 0,(function(){var t;return Hr(this,(function(n){switch(n.label){case 0:return(t=Ea.current())?[4,t.updateDisplayLayout(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function so(e,t){return void 0===e&&(e=null),Fr(this,void 0,void 0,(function(){var t,n;return Hr(this,(function(r){switch(r.label){case 0:return t=null,e?[4,ja.getOkIdsByExternalIds([e])]:[3,2];case 1:n=r.sent(),t=n[0],r.label=2;case 2:return[2,co(t)]}}))}))}function co(e,t){return void 0===e&&(e=null),void 0===t&&(t=!0),Fr(this,void 0,void 0,(function(){var n,r;return Hr(this,(function(i){switch(i.label){case 0:return(n=Ea.current())?(r=e?si.composeId(e,"USER"):null,[4,n.muteParticipant(r,t)]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))}function uo(e,t){return void 0===t&&(t=null),Fr(this,void 0,void 0,(function(){var n,r;return Hr(this,(function(i){switch(i.label){case 0:return n=null,t?[4,ja.getOkIdsByExternalIds([t])]:[3,2];case 1:r=i.sent(),n=r[0],i.label=2;case 2:return[2,lo(e,n)]}}))}))}function lo(e,t){return void 0===t&&(t=null),Fr(this,void 0,void 0,(function(){var n,r;return Hr(this,(function(i){switch(i.label){case 0:return(n=Ea.current())?(r=t?si.composeId(t,"USER"):null,[4,n.chatMessage(e,r)]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))}function po(e){return void 0===e&&(e=10),Fr(this,void 0,void 0,(function(){var t;return Hr(this,(function(n){return(t=Ea.current())?[2,t.chatHistory(e)]:[2]}))}))}function ho(e,t){return void 0===t&&(t=null),Fr(this,void 0,void 0,(function(){var n,r;return Hr(this,(function(i){switch(i.label){case 0:return n=null,t?[4,ja.getOkIdsByExternalIds([t])]:[3,2];case 1:r=i.sent(),n=r[0],i.label=2;case 2:return[2,fo(e,n)]}}))}))}function fo(e,t){return void 0===t&&(t=null),Fr(this,void 0,void 0,(function(){var n,r;return Hr(this,(function(i){switch(i.label){case 0:return(n=Ea.current())?(r=t?si.composeId(t,"USER"):null,[4,n.customData(e,r)]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))}function mo(e){return void 0===e&&(e=""),Fr(this,void 0,void 0,(function(){return Hr(this,(function(t){switch(t.label){case 0:return[4,ja.createConversation(si.uuid(),e)];case 1:return[2,t.sent().join_link]}}))}))}function go(){return Fr(this,void 0,void 0,(function(){var e;return Hr(this,(function(t){return(e=Ea.current())?[2,e.createJoinLink()]:[2,Promise.reject()]}))}))}function vo(){return Fr(this,void 0,void 0,(function(){var e;return Hr(this,(function(t){return(e=Ea.current())?[2,e.removeJoinLink()]:[2,Promise.reject()]}))}))}function _o(e,t){return Fr(this,void 0,void 0,(function(){return Hr(this,(function(n){return[2,ja.getAnonymTokenByLink(e,t)]}))}))}function bo(e,t,n,r,i){return void 0===e&&(e=!1),void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r="DIRECT_LINK"),void 0===i&&(i=null),Fr(this,void 0,void 0,(function(){var a;return Hr(this,(function(o){return(a=Ea.current())?[2,a.startStream(e,t,n,r,i)]:[2,Promise.reject()]}))}))}function yo(){return Fr(this,void 0,void 0,(function(){var e;return Hr(this,(function(t){return(e=Ea.current())?[2,e.stopStream()]:[2,Promise.reject()]}))}))}function Eo(){return Fr(this,void 0,void 0,(function(){var e;return Hr(this,(function(t){return(e=Ea.current())?[2,e.getStreamInfo()]:[2,Promise.reject()]}))}))}function Oo(e){Zr.toggle(e)}var Co=function(e){return e<0},So=function(e){return e.isAnonym?{id:e.peerId.toString(),type:Ki.ANONYM}:e.peerId.toString()},To=function(e,t,n,r,i){var a,o,s;void 0===i&&(i=!1);var c=r.peerId===e.me,u=!!(null===(o=null===(a=e.callData)||void 0===a?void 0:a.permissions)||void 0===o?void 0:o.MUTE_PARTICIPANTS),l=de(e.peer),d=[];return!c&&i&&d.push({href:r.link,text:Object(ie.getLang)("calls_go_to_profile")}),c||Co(r.peerId)||r.isAnonym||Co(e.me)||d.push({text:Object(ie.getLang)("calls_go_to_chat_with_participant"),onClick:function(){n({type:"change_ui_mode",mode:g.COLLAPSED}),n({type:"management",isOpen:!1}),Object(M.navigateToConvo)(r.peerId)}}),!c&&l&&e.isUpdateEnabled&&!Co(e.me)&&d.push({text:Object(ie.getLang)("calls_participant_menu_kick"),onClick:function(){return t.removeParticipant(So(r))}}),!c&&l&&e.isUpdateEnabled&&(null===(s=r.mediaSettings)||void 0===s?void 0:s.isAudioEnabled)&&u&&!Co(e.me)&&d.push({text:Object(ie.getLang)("calls_participant_menu_mute"),onClick:function(){return t.muteParticipant(So(r))}}),d},wo=function(e,t){var n=e.participants[t];return n&&(n.peerId===e.me||!!n.status)};function Io(e,t){var n,r,i,a=e.pinnedParticipant||e.orator;if(a)return e.participants[a];for(var o=0,s=Object.values(e.participants);o<s.length;o++){var c=s[o];if(c.peerId!==e.me&&c.wasConnected&&(i||(i=c),!t||(null===(n=c.mediaSettings)||void 0===n?void 0:n.isVideoEnabled)))return c}var u=e.participants[e.me];return!i&&t&&(null===(r=u.mediaSettings)||void 0===r?void 0:r.isVideoEnabled)?u:i}function Po(){return(Po=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function jo(e){var t,n,r,i,a,o=e.SDK,s=e.state,c=e.dispatch,u=s.peer,l=de(u),p=l?s.callData.conversation:s.participants[u],h=s.participants[s.me],f=h.mediaSettings||{},m=Pe(s),v=m.length>1,y=v||f.isVideoEnabled,E=l||m.length>2,O=E&&y&&!s.isOratorMode,C=E&&y&&s.isOratorMode,S=s.uiMode===g.FULLSCREEN,T=d.useMemo(()=>o.browser.isScreenCapturingSupported()&&s.isUpdateEnabled,[]),w=s.isUpdateEnabled&&(null===(t=s.callData)||void 0===t?void 0:t.canFinishCall),I=d.useCallback(()=>{var e=Object(M.getProgress)(),t=e.showProgress,n=e.hideProgress;return t(),Promise.all([Sn(s,c,s.peer,s.callData.conversation),Cn(s,c)]).then(()=>{n(),c({type:"group_call_setup",open:!0})}).catch(e=>{console.error(e),n()})},[s.peer]),P=()=>{pe(o,!0).then(()=>{c({type:"toggle_popup",data:"settings"})}).catch(e=>{o.browser.hasMicrophonePermission()?c({type:"toggle_popup",data:"settings"}):Object(M.showPermissionsError)(!1,!0)})},j=d.useCallback(()=>{c({type:"change_ui_mode",mode:g.COLLAPSED})},[]),k=d.useCallback(()=>{c({type:"toggle_orator_mode",isOratorMode:!s.isOratorMode})},[s.isOratorMode]),A=d.useCallback(()=>{c({type:"toggle_participants_aside",isShownParticipantsAside:!s.isShownParticipantsAside})},[s.isShownParticipantsAside]),R=d.useCallback((e,t)=>{c({type:"set_pinned_participant",pinnedParticipant:s.pinnedParticipant===t?null:t})},[s.pinnedParticipant]),L=d.useCallback(()=>{c({type:"management",isOpen:!0})},[]),N=d.useCallback(()=>{var e=!f.isVideoEnabled||f.isScreenSharingEnabled;f.isScreenSharingEnabled&&o.captureScreen(!1),(e?pe(o,!0):Promise.resolve()).then(()=>o.toggleLocalVideo(e))},[f]),D=d.useCallback(()=>{f.isScreenSharingEnabled||!s.screenSharer?o.captureScreen(!f.isScreenSharingEnabled):c({type:"call_notification",notification:{type:_.NO_SIMULTANEOUS_SHARING}})},[f.isScreenSharingEnabled,s.screenSharer]),x=d.useCallback(()=>{c({type:"change_ui_mode",mode:g.COLLAPSED}),Object(M.navigateToConvo)(s.peer)},[s.peer]),U=d.useCallback(()=>{c({type:"call_notification",notification:null})},[]),B=d.useCallback(()=>{o.changeParticipantState({hand:h.statusData.hand?b.LOWERED:b.RAISED}),c({type:"change_participant_state",participantId:h.peerId,data:Po({},h.statusData,{hand:!h.statusData.hand})})},[h.statusData.hand]),F=d.useCallback(()=>{c({type:"toggle_popup",data:"exit"})},[]),H=d.useCallback(()=>{c({type:"change_ui_mode",mode:S?g.DEFAULT:g.FULLSCREEN})},[s.uiMode]),G=d.createElement(en,{state:s}),V=[{text:Object(ie.getLang)("calls_call_menu_settings"),key:"settings",onClick:P}];return s.callData.permissions.MUTE_PARTICIPANTS&&v&&V.push({text:Object(ie.getLang)("calls_call_menu_mute_all"),key:"muteAll",onClick:o.muteParticipant}),d.createElement(ue,{onClose:o.hangup,isCautionBoxShown:!0,onBackdropClick:s.isUpdateEnabled?j:void 0},d.createElement(Kt,{id:u,state:s,title:p.tab||"",photo:p.photo||"",disablePhoto:y,description:G,info:(i=G,a=l?m.length:void 0,d.createElement(d.Fragment,null,i,!!a&&d.createElement(d.Fragment,null," · ",Object(ie.getLang)("calls_participants_plural",a)))),callMenuActions:V,isVideoEnabled:f.isVideoEnabled&&!f.isScreenSharingEnabled,isAudioEnabled:f.isAudioEnabled,isScreenSharingEnabled:f.isScreenSharingEnabled,isOratorMode:s.isOratorMode,isFullScreen:S,onToggleVideo:N,onToggleAudio:()=>{var e;(null===(e=s.notification)||void 0===e?void 0:e.type)===_.SPEAKING_ON_MUTE&&U(),o.toggleLocalAudio(!f.isAudioEnabled)},onToggleScreenShare:D,isGroupCall:l,onLeaveCall:w?F:o.hangup,canAddParticipants:Object(le.isChatPeer)(u),onAddParticipants:I,onOpenSettings:P,onCollapseCall:j,onToggleOratorMode:k,onFullScreenToggle:H,onChat:x,onHandClick:B,isParticipantControlShown:s.isUpdateEnabled,isParticipantControlActive:s.isManagementOpen,isLayoutSwitchShown:l&&v,isHandRaised:h.statusData.hand,isHandControlShown:s.isUpdateEnabled&&l,isChatControlShown:!!u,isScreenShareControlShown:T,isUpdateEnabled:s.isUpdateEnabled,onParticipantsClick:L,notification:d.createElement(un,{state:s,dispatch:c})},!E&&d.createElement(at,(n=s.participants,r=s.me,Object.values(n).reduce((e,t)=>{var n=t.mediaSettings||{};return r===t.peerId?(e.hasAudio=!!n.isAudioEnabled,e.hasVideo=!!n.isVideoEnabled,e.isSharingScreen=!!n.isScreenSharingEnabled,e.stream=t.stream,e.id=t.peerId,e.name=Object(ie.getLang)("calls_own_label"),e.wasConnected=t.wasConnected):(e.opponentHasAudio=!!n.isAudioEnabled,e.opponentHasVideo=!!n.isVideoEnabled,e.opponentIsSharingScreen=!!n.isScreenSharingEnabled,e.opponentStream=t.stream,e.opponentPhoto=t.photo,e.opponentId=t.peerId,e.opponentName=t.name,e.opponentWasConnected=t.wasConnected),e},{}))),O&&d.createElement(Wt,{limit:s.participantLimit},m.map((e,t,n)=>{var r,i=e.mediaSettings||{},a=i.isVideoEnabled,u=i.isAudioEnabled,l=i.isScreenSharingEnabled,p=e.peerId===s.me?Object(ie.getLang)("calls_own_label"):e.shortName?e.shortName:e.name;return d.createElement(it,{id:e.peerId,key:e.peerId,isInfoShown:!0,isMe:e.peerId===s.me,isHandRaised:null===(r=e.statusData)||void 0===r?void 0:r.hand,hasVideo:a,hasAudio:u,isSharingScreen:l,isSpeaking:!!s.speakers[e.peerId],stream:e.stream,photo:e.photo,photoSize:n.length<=8||S?"s":"xs",name:p,status:s.isUpdateEnabled?e.status:d.createElement(Qt,{participant:e}),wasConnected:e.wasConnected,actions:To(s,o,c,e,!0)})})),C&&d.createElement(Yt,{orator:ko(s),onToggleParticipantsAside:A,isShownParticipantsAside:s.isShownParticipantsAside},m.map(e=>{var t,n=e.mediaSettings||{},r=n.isVideoEnabled,i=n.isAudioEnabled,a=n.isScreenSharingEnabled,u=e.peerId===s.me,l=u?Object(ie.getLang)("calls_own_label"):e.shortName?e.shortName:e.name;return d.createElement(it,{id:e.peerId,key:e.peerId,isInfoShown:!0,isMe:u,isPinned:e.peerId===s.pinnedParticipant,isHandRaised:null===(t=e.statusData)||void 0===t?void 0:t.hand,hasVideo:r,hasAudio:i,isSharingScreen:a,useDirectAudio:s.useDirectAudio,isSpeaking:!!s.speakers[e.peerId],stream:e.stream,photo:e.photo,photoSize:"xxs",name:l,status:e.status,wasConnected:e.wasConnected,onClickParticipant:R,actions:To(s,o,c,e,!0)})})),E&&!y&&d.createElement(Fe.default,null,d.createElement(X,{id:u,photo:p.photo||"",size:"l",waves:!0,alt:p.tab||""}))))}function ko(e){var t=e.participants[e.pinnedParticipant||e.orator||e.me],n=t.mediaSettings||{},r=n.isVideoEnabled,i=n.isAudioEnabled,a=n.isScreenSharingEnabled,o=t.peerId===e.me;return d.createElement(it,{id:t.peerId,key:t.peerId,isInfoShown:!0,isMe:o,hasVideo:r,hasAudio:i,isSharingScreen:a,useDirectAudio:e.useDirectAudio,stream:t.stream,photo:t.photo,photoSize:"l",name:o?Object(ie.getLang)("calls_own_label"):t.name,status:t.status,wasConnected:t.wasConnected,allowContain:!0})}var Ao=function(e){var t=e.children;return p.a.createElement("div",{className:"CollapsedCall"},t)},Ro=function(e){var t=e.id,n=e.photo,r=e.title,i=e.status,a=e.isIncoming,o=e.onClick,s=e.children;return p.a.createElement("div",{className:"CallWidget",onClick:o},p.a.createElement($,{id:t,photo:n,className:"CallWidget__background"}),p.a.createElement(X,{id:t,photo:n,size:"xs",waves:a,alt:r||""}),p.a.createElement("h1",{className:"CallWidget__name"},p.a.createElement(Q.default,{className:""},r)),p.a.createElement("div",{className:"CallWidget__status"},i),s)};function Lo(e){var t=e.id,n=e.photo,r=e.photoSize,i=e.name,a=e.status;return d.createElement(Fe.default,{className:"ParticipantCard"},d.createElement(X,{id:t,photo:n,size:r,alt:i||""}),d.createElement("h2",{className:"ParticipantCard__name"},d.createElement(Q.default,null,i)),d.createElement("div",{className:"ParticipantCard__status"},a))}function No(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Mo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Mo(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Mo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Do(e){var t=e.id,n=e.isInfoShown,r=e.photo,i=void 0===r?"":r,a=e.hasVideo,o=e.hasAudio,s=e.isSharingScreen,c=e.useDirectAudio,u=e.stream,l=e.isMe,p=e.photoSize,h=e.name,f=e.status,m=e.wasConnected,g=No(d.useState(!1),2),v=g[0],_=g[1];d.useEffect(()=>{a&&u||_(!1)},[a,u,v]);var b=!(a&&u)||!v;return d.createElement("article",{className:"Participant"},b&&d.createElement($,{id:t,photo:i},n&&d.createElement(Lo,{id:t,photo:i,photoSize:p,name:h,status:f}),!n&&d.createElement(Fe.default,null,d.createElement(X,{id:t,photo:i,size:p,alt:h||""}))),(!c||a)&&d.createElement(Be,{hasVideo:a,stream:u,isMe:l,isVideoVisible:v,isScreenShareStream:s,setVideoVisibility:_}),(m||l)&&d.createElement("footer",{className:"Participant__status"},!o&&d.createElement("span",{className:"Participant__statusIcon Participant__statusIcon--mic"}),!a&&d.createElement("span",{className:"Participant__statusIcon Participant__statusIcon--cam"})))}var xo=function(e){var t=e.localVideoStream,n=e.isLocalAudioEnabled,r=e.isLocalScreenSharing,i=e.participantId,a=e.isMe,o=e.isWithVideo,s=e.isWithAudio,c=e.isScreenSharing,u=e.stream,l=e.photo,h=e.name,f=e.onRestoreCall,m=e.onToggleAudio,g=e.isUpdateEnabled,v=e.children,_=Object(d.useState)(!1),b=_[0],y=_[1];Object(d.useEffect)((function(){t||y(!1)}),[t,b]);var E=Object(d.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),f()}),[f]),O=Object(d.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),m()}),[m]),C=Object(D.classNames)("CallVideoWidget",{"CallVideoWidget--interactive":g});return p.a.createElement("div",{className:C,onClick:g?f:void 0},t&&p.a.createElement(Be,{stream:t,hasVideo:!0,isMe:!0,isVideoVisible:b,isScreenShareStream:r,setVideoVisibility:y,className:"CallVideoWidget__local",allowContain:!0}),p.a.createElement(Do,{id:i,hasVideo:o,hasAudio:s,isSharingScreen:c,isMe:a,stream:u,photo:l,name:h,photoSize:"s"}),v,p.a.createElement(ut,{alignX:"l",alignY:"b",size:"s",className:"CallVideoWidget__buttons"},p.a.createElement(re.default,{position:"t",align:"left",marginTop:6,text:Object(ie.getLang)(n?"calls_mute":"calls_unmute")},p.a.createElement(ne,{type:n?"mute":"unmute",onClick:O}))),p.a.createElement(ut,{alignX:"r",alignY:"b",size:"s",className:"CallVideoWidget__buttons"},p.a.createElement(re.default,{position:"t",align:"right",text:Object(ie.getLang)("calls_restore"),marginTop:6},p.a.createElement(ne,{type:"restore",onClick:E}))))},Uo=function(){return(Uo=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Bo=function(e){var t,n=e.state,r=e.dispatch,i=e.SDK,a=n.peer,o=n.useDirectAudio,s=je(n),c=de(a),u=n.isUpdateEnabled,h=c?n.callData.conversation:n.participants[a],f=n.participants[n.me],m=c?Io(n,s):n.participants[a],v=(null===(t=f.mediaSettings)||void 0===t?void 0:t.isVideoEnabled)&&m&&m.peerId!==n.me,_=Object(d.useCallback)((function(){r({type:"change_ui_mode",mode:g.DEFAULT})}),[]),b=Object(d.useCallback)((function(){var e;i.toggleLocalAudio(!(null===(e=f.mediaSettings)||void 0===e?void 0:e.isAudioEnabled))}),[n]);return p.a.createElement(Ao,null,n.mode===l.INCOMING&&p.a.createElement(Ro,{id:a,title:h.tab,photo:h.photo||"",status:Object(ie.getLang)("calls_incoming_collapsed"),isIncoming:!0,onClick:_}),n.mode===l.CALL&&!s&&p.a.createElement(Ro,{id:m?m.peerId:h.peerId,title:h.tab,photo:m?m.photo:h.photo,status:p.a.createElement(en,{state:n}),onClick:_},!o&&Pe(n).map((function(e){var t=e.peerId,r=e.stream;return t!==n.me?p.a.createElement(Be,{key:t,stream:r}):null}))),n.mode===l.CALL&&s&&p.a.createElement(xo,Uo({localVideoStream:v?f.stream:void 0,isLocalAudioEnabled:f.mediaSettings.isAudioEnabled,isLocalScreenSharing:f.mediaSettings.isScreenSharingEnabled},function(e,t,n){return e?{participantId:e.peerId,isMe:e.peerId===n,isWithVideo:e.mediaSettings.isVideoEnabled,isWithAudio:e.mediaSettings.isAudioEnabled,isScreenSharing:e.mediaSettings.isScreenSharingEnabled,stream:e.stream,photo:e.photo,name:e.name}:{participantId:t.peerId,isMe:!1,isWithVideo:!1,isWithAudio:!1,isScreenSharing:!1,stream:void 0,photo:t.photo,name:t.tab}}(m,h,n.me),{onRestoreCall:_,onToggleAudio:b,isUpdateEnabled:u}),!o&&Pe(n).map((function(e){var t=e.peerId,r=e.stream,i=t===n.me,a=m&&t===m.peerId;return i||a?null:p.a.createElement(Be,{key:t,stream:r})}))))};function Fo(){return(Fo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Ho(e){var t=d.useRef(),n={incoming:d.useRef(null),outgoing:d.useRef(null),connecting:d.useRef(null),connected:d.useRef(null),end:d.useRef(null)},r={controls:!1,preload:"auto"},i=d.useCallback(e=>{var t=n[e].current;t&&t.paused&&t.play().catch(()=>{})},[]),a=d.useCallback(e=>{var t=n[e].current;t&&!t.paused&&(t.pause(),t.currentTime=0)},[]),o=d.useCallback(()=>{Object.keys(n).forEach(a)},[]),s=d.useCallback(e=>{var t=n[e].current;if(t){var r=t.volume;t.volume=0,t.play(),t.pause(),t.currentTime=0,t.volume=r}},[]);return d.useEffect(()=>(ve.browser.safari&&document.body.addEventListener("mousedown",(function e(){Object.keys(n).forEach(s),document.body.removeEventListener("mousedown",e)})),()=>{o(),Object(M.resumeGlobalMedia)()}),[]),d.useEffect(()=>{var n=t.current||e.state,r=e.state;n.mode!==r.mode&&(n.mode!==l.READY||r.mode!==l.INCOMING&&r.mode!==l.CALL||Object(M.pauseGlobalMedia)(),n.mode===l.INCOMING&&a("incoming"),r.mode===l.INCOMING&&i("incoming"),r.mode!==l.READY||n.mode!==l.INCOMING&&n.mode!==l.CALL||(o(),i("end"),Object(M.resumeGlobalMedia)()));var s=r.me,c=n.participants,u=r.participants,d=c[s].status,p=u[s].status;d!==p&&(d===v.CONNECTING&&a("connecting"),p===v.CONNECTING&&i("connecting"));var h=Object.keys(u).some(e=>c[e]&&c[e].status===v.CONNECTED),f=Object.keys(u).some(e=>{var t=c[e],n=u[e];return t&&t.status!==n.status&&n.status===v.CONNECTED});!h&&f&&i("connected"),r.mode===l.CALL&&(!function(e,t){for(var n=!1,r=0,i=Object.values(e);r<i.length;r++){var a=i[r];if(a.id!==t){if(a.status===v.CONNECTED)return!1;a.status===v.WAITING&&(n=!0)}}return n}(u,s)?a("outgoing"):i("outgoing")),t.current=e.state},[e.state]),d.createElement(d.Fragment,null,d.createElement("audio",Fo({src:"/mp3/call_incoming.mp3",ref:n.incoming,loop:!0},r)),d.createElement("audio",Fo({src:"/mp3/call_outgoing.mp3",ref:n.outgoing,loop:!0},r)),d.createElement("audio",Fo({src:"/mp3/call_connected.mp3",ref:n.connected,loop:!1},r)),d.createElement("audio",Fo({src:"/mp3/call_connecting.mp3",ref:n.connecting,loop:!0},r)),d.createElement("audio",Fo({src:"/mp3/call_end.mp3",ref:n.end,loop:!1},r)))}var Go=n("Ht+d"),Vo=n("Xq7/"),qo=n("7ZXl"),zo=function(e){var t=e.title,n=e.onCloseModal,r=e.hint,i=e.actionButtons,a=e.isWithBackButton,o=e.onBackClick,s=e.children;return p.a.createElement(oe.default,{className:"CallManagementModal",disableBodyScroll:!0,onClose:n},p.a.createElement(Vo.ModalHeader,{title:t,onClose:n,appearance:"blue",backText:a?Object(ie.getLang)("global_back"):void 0,onBack:o}),p.a.createElement("div",{className:"CallManagementModal__content"},p.a.Children.toArray(s).map((function(e,t){return p.a.createElement("div",{className:"CallManagementModal__section",key:t},e)}))),(i||r)&&p.a.createElement(qo.ModalFooter,{actionButtons:i||null,hint:r}))},Ko=n("FABD"),Wo=function(e){var t=e.tokens,n=e.onRemoveToken,r=e.value,i=e.onChange,a=e.onSelect,o=e.renderSuggest,s=e.data;return p.a.createElement(Ko.default,{className:"CallsMultiSelect",tokens:t,removeTokenPlaceholder:Object(ie.getLang)("calls_remove_token"),onRemoveToken:n,placeholder:Object(ie.getLang)("calls_search_participants_placeholder"),value:r,onChange:i,onSelect:a,useInfiniteScroll:!1,hasMore:!1,virtualized:!1,loadMore:function(){},notFoundText:Object(ie.getLang)("calls_participants_not_found"),autoFocus:!0,isSearching:!1,renderSuggest:o,data:s})},Yo=n("t7n3"),$o=function(e){var t=e.headingElement,n=void 0===t?"h3":t,r=e.extra,i=e.className,a=e.children,o=n;return p.a.createElement("header",{className:Object(D.classNames)("ListHeader",i)},p.a.createElement(o,{className:"ListHeader__text"},a),p.a.createElement("span",{className:"ListHeader__extra"},r))},Jo=n("xGYt"),Xo=n("NsuH");function Qo(e){var t=e.member,n=e.selected,r=e.disabled,i=Object(D.classNames)("ParticipantSuggest",{"ParticipantSuggest--selected":n,"ParticipantSuggest--disabled":r});return d.createElement("div",{className:i,"data-id":t.id},d.createElement(Xo.default,{size:"34",title:t.name,photo:t.photo}))}Qo.defaultProps={selected:!1,disabled:!1};var Zo=function(){return(Zo=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},es=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},ts=function(e){var t=e.children,n=e.className,r=es(e,["children","className"]);return p.a.createElement("button",Zo({className:Object(D.classNames)("ListMore",n)},r),t)},ns=function(){return(ns=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},rs=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},is=function(e){var t=rs(e,[]);return p.a.createElement("svg",ns({width:"16",height:"16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),p.a.createElement("path",{d:"M9.3 9.99c.93-.93 2.32-.75 3.63.35.94.79.82 2.85-1.18 3.12s-4.11-.7-6.32-2.9c-2.2-2.2-3.1-4.1-2.9-6.3a1.8 1.8 0 013.12-1.18c1.06 1.25 1.38 2.6.36 3.62-.48.48-.67.6-.56.91.41 1.1 2.19 2.65 2.94 2.93.35.13.46-.1.9-.55z"}))},as=function(e){var t=e.data,n=e.onClick,r=e.selected,i=e.disabled;if("type"in t)switch(t.type){case u.HEADER:return p.a.createElement($o,{className:"CallsSearchResult CallsSearchResult--header",extra:t.count},t.text);case u.SELECT_ALL:return p.a.createElement("div",{className:"CallsSearchResult CallsSearchResult--select"},p.a.createElement(Go.default,{appearance:"secondary",wide:!0,onClick:n},p.a.createElement("span",{className:"CallsSearchResult__icon"},p.a.createElement(is,null)),t.text));case u.MEMBERS_MORE:case u.FRIENDS_MORE:return p.a.createElement(ts,{onClick:n},t.text)}return p.a.createElement(Jo.default,{"data-id":t.peerId,onClick:n,selectable:!i},p.a.createElement(Qo,{member:t,selected:r,disabled:i}))},os=function(){return(os=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},ss=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)r[i]=a[o];return r},cs=function(e){var t=e.state,n=e.onChange,r=t.isUpdateEnabled,i=(t.preselectedIds||[]).filter((function(e){return!Co(e)})),a=Object(d.useState)(i),o=a[0],s=a[1],c=Object(d.useState)(""),l=c[0],h=c[1],f=Object(d.useState)({}),m=f[0],g=f[1],v=Object(d.useState)(!1),_=v[0],b=v[1],y=Object(d.useState)(!1),E=y[0],O=y[1],C=Object(d.useState)(r?function(e,t){var n=e.reduce((function(e,t){return e[t.id]=!0,e}),{});return t.filter((function(e){return!n[e.id]}))}(t.chatMembers,t.friends):[])[0],S=Object(d.useState)(function(e,t){return[].concat(t,e).reduce((function(e,t){return e[t.id]=t,e}),{})}(t.chatMembers,C))[0],T=Object(d.useCallback)((function(e){return e.name}),[]),w=Object(d.useCallback)((function(e){return e.peerId}),[]),I=ce(ss(t.chatMembers,C),T,w),P=Object(d.useCallback)((function(e){return e?I.search(e):r?function(e,t,n,r,i){var a={type:u.MEMBERS_MORE,text:Object(ie.getLang)("calls_show_all_members")},o={type:u.FRIENDS_MORE,text:Object(ie.getLang)("calls_show_all_friends")},s={type:u.HEADER,text:Object(ie.getLang)("calls_chat_members"),count:e.length},c={type:u.HEADER,text:Object(ie.getLang)("calls_friends")},l={type:u.SELECT_ALL,text:Object(ie.getLang)("calls_call_all")},d=[];if(e.length>0)if(d.push(s),e.length<=i&&d.push(l),n||e.length<=5)d.push.apply(d,e);else{for(var p=0;p<5;p++)d.push(e[p]);d.push(a)}if(d.push(c),r||t.length<=10)d.push.apply(d,t);else{for(p=0;p<10;p++)d.push(t[p]);d.push(o)}return d}(t.chatMembers,C,_,E,t.participantLimit):t.chatMembers}),[t,_,E]),j=Object(d.useState)(P(l)),k=j[0],A=j[1],R=function(e){s(e),n(e)},L=Object(d.useCallback)((function(e){return R(ss(o,[+e]))}),[o]),N=Object(d.useCallback)((function(e){return R(o.filter((function(t){return t!==+e})))}),[o]),M=Pe(t).map((function(e){return{id:e.peerId.toString(),text:Object(Yo.unclean)(e.name),locked:!0}})).concat(o.map((function(e){return{text:Object(Yo.unclean)(S[e].name),id:e.toString(),locked:!1}}))),D=function(e){return m&&m[e]||wo(t,e)},x=function(e){return!!wo(t,e)||!D(e)&&(M.length>=t.participantLimit||!Object(le.isUserPeer)(e))};Object(d.useEffect)((function(){g(o.reduce((function(e,t){return e[t]=!0,e}),{}))}),[]),Object(d.useEffect)((function(){A(P(l))}),[o,_,E]);var U=Object(d.useCallback)((function(e){h(e.target.value),A(P(e.target.value))}),[]),B=Object(d.useCallback)((function(e){var t;return N(e),g(os(os({},m),((t={})[e]=!1,t))),Promise.resolve()}),[m]),F=Object(d.useCallback)((function(e){var t,n;return D(e)?(N(e),g(os(os({},m),((t={})[e]=!1,t)))):x(e)||(L(e),g(os(os({},m),((n={})[e]=!0,n))),h(""),A(P(""))),Promise.resolve()}),[o,t,m]),H=Object(d.useCallback)((function(){var e=Pe(t).reduce((function(e,t){return e[t.peerId]=!0,e}),{}),n=t.chatMembers.reduce((function(t,n){var r=n.peerId;return e[r]||m[r]||x(r)||t.push(r),t}),[]);R(ss(o,n)),g(os(os({},m),n.reduce((function(e,t){return e[t]=!0,e}),{})))}),[t,o,m]),G=Object(d.useCallback)((function(e,t){if(!("type"in e))return t;switch(e.type){case u.SELECT_ALL:return function(){return H()};case u.MEMBERS_MORE:return function(){return b(!0)};case u.FRIENDS_MORE:return function(){return O(!0)};default:return function(){}}}),[H]);return p.a.createElement(Wo,{tokens:M,onRemoveToken:B,value:l,onChange:U,onSelect:F,renderSuggest:function(e,t){return p.a.createElement(as,{data:e,onClick:G(e,t),selected:D(e.peerId||0),disabled:x(e.peerId||0),key:e.peerId||e.text})},data:k})};var us=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)r[i]=a[o];return r},ls=function(e){var t=e.SDK,n=e.state,r=e.dispatch,i=e.isWithBackButton,a=e.onBackClick,o=Object(d.useState)(n.preselectedIds||[]),s=o[0],c=o[1],u=Object(d.useState)(Pe(n).length)[0]+s.length,l=function(){r({type:"group_call_setup",open:!1,preselectedIds:null}),r({type:"management",isOpen:!1})},h=0===u,f=Object(d.useCallback)((function(){l(),s.forEach(t.addParticipant);var e=Se(function(e,t){var n=e.chatData||e.callData.conversation,r=t.reduce((function(t,n){return e.participants[n]||t.set(n,!0),t}),new Map);if(0===r.size)return[n,[]];var i=e.chatMembers.length<e.friends.length?e.chatMembers:e.friends,a=e.chatMembers.length<e.friends.length?e.friends:e.chatMembers,o=i.reduce((function(e,t){return r.get(t.id)&&(e.smallerListData.push(t),e.smallerListMap.set(t.id,!0)),e}),{smallerListData:[],smallerListMap:new Map}),s=o.smallerListData,c=o.smallerListMap;if(s.length===r.size)return[n,s];var u=a.filter((function(e){return!c.get(e.id)&&r.get(e.id)}));return[n,us(s,u)]}(n,s)),i=e[0],a=e[1];r({type:"load_peer",conversation:i,members:a})}),[s]);return p.a.createElement(zo,{title:Object(ie.getLang)("calls_add_participants_to_call"),onCloseModal:l,actionButtons:p.a.createElement(Go.default,{key:"add",disabled:h,onClick:f},Object(ie.getLang)("global_add")),hint:ds(u,n.participantLimit),isWithBackButton:i,onBackClick:i?a:function(){}},p.a.createElement(cs,{state:n,onChange:c}))};function ds(e,t){return e<2?Object(ie.getLang)("calls_management_add_warning"):Object(ie.getLang)("calls_selected").replace("{selected}",e).replace("{limit}",t)}var ps=n("aFGQ"),hs=function(){return(hs=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},fs=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},ms=function(e){var t=e.isSingleLine,n=e.className,r=e.children,i=fs(e,["isSingleLine","className","children"]),a=Object(D.classNames)("InputStub",n,{"InputStub--singleLine":t});return p.a.createElement("div",hs({className:a},i),r)};function gs(){return(gs=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var vs=d.useRef,_s=d.useEffect;function bs(e){var t=e.cameras,n=e.mics,r=e.currentCamId,i=e.currentMicId,a=e.isCamAvailable,o=e.isMicAvailable,s=e.onCameraChange,c=e.onMicChange,u=vs(null),l=vs(null),p=vs(null),h=vs(null),f={controls:!1,crossOrigin:"anonymous",playsInline:"playsinline"};return Es({kind:"video",mediaElRef:u,streamRef:p,deviceId:r,isActive:a}),Es({kind:"audio",mediaElRef:l,streamRef:h,deviceId:i,isActive:o}),d.createElement("div",{className:"CallSettings"},d.createElement("div",{className:"CallSettings__camera"},a?d.createElement("video",gs({ref:u},f,{className:"CallSettings__cameraStream CallSettings__cameraContent"})):d.createElement("div",{className:"CallSettings__cameraStub CallSettings__cameraContent"},Object(ie.getLang)("calls_no_camera"))),o&&d.createElement("audio",gs({ref:l},f)),d.createElement("div",{className:"CallSettings__block"},d.createElement("div",{className:"CallSettings__label"},d.createElement("span",{className:"CallSettings__labelContent"},Object(ie.getLang)("calls_settings_camera"))),a?d.createElement(ps.default,{options:t.map(ys),value:r,onChange:e=>{var t=e.selected;return s(t.value)},appearance:"secondary",className:"CallSettings__field"}):d.createElement(ms,{className:"CallSettings__field"},Object(ie.getLang)("calls_settings_no_camera"))),d.createElement("div",{className:"CallSettings__block"},d.createElement("div",{className:"CallSettings__label"},d.createElement("span",{className:"CallSettings__labelContent"},Object(ie.getLang)("calls_settings_mic"))),o?d.createElement(ps.default,{options:n.map(ys),value:i,onChange:e=>{var t=e.selected;return c(t.value)},appearance:"secondary",className:"CallSettings__field"}):d.createElement(ms,{className:"CallSettings__field"},Object(ie.getLang)("calls_settings_no_mic"))))}function ys(e){return{value:e.deviceId,label:e.label}}function Es(e){var t=e.kind,n=e.mediaElRef,r=e.streamRef,i=e.deviceId,a=e.isActive,o={video:!1,audio:!1};_s(()=>{a&&navigator.mediaDevices.getUserMedia(gs({},o,{[t]:{deviceId:i}})).then(e=>{var t=r.current;t&&t.getTracks().forEach(e=>e.stop());var i=n.current;i&&(r.current=e,i.srcObject=e,i.volume=0,i.play(),Re(n))}).catch(e=>{console.error("Error occurred: "+e)})},[i,a]),_s(()=>()=>{var e=r.current;e&&e.getTracks().forEach(e=>e.stop());var t=n.current;t&&(t.srcObject=null)},[])}bs.defaultProps={cameras:[],mics:[],currentCamId:"",currentMicId:"",isCamAvailable:!1,isMicAvailable:!1};var Os=n("0toi");function Cs(e){var t=e.onClose,n=e.onSubmit,r=e.children;return d.createElement(Os.default,{onClose:t,title:Object(ie.getLang)("calls_settings"),appearance:"blue",actionButtons:d.createElement(d.Fragment,null,d.createElement(Go.default,{onClick:t,appearance:"tertiary"},Object(ie.getLang)("global_cancel")),d.createElement(Go.default,{onClick:n},Object(ie.getLang)("global_save"))),className:"CallSettingsModal"},r)}function Ss(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ts(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ts(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ts(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ws=d.useState;function Is(e){var t=e.SDK,n=e.state,r=e.dispatch,i=t.browser.getCameras(),a=t.browser.getMicrophones(),o=t.browser.hasCamera()&&t.browser.hasCameraPermission(),s=t.browser.hasMicrophone()&&t.browser.hasMicrophonePermission(),c=t.browser.getSavedCamera(),u=t.browser.getSavedMicrophone(),p=o&&(c&&c.deviceId||i[0].deviceId),h=s&&(u&&u.deviceId||a[0].deviceId),f=Ss(ws(p),2),m=f[0],g=f[1],v=Ss(ws(h),2),_=v[0],b=v[1];return d.createElement(Cs,{onClose:()=>{r({type:"toggle_popup"})},onSubmit:()=>{var e=[Promise.resolve()];!c&&p===m&&n.mode!==l.READY&&!n.participants[n.me].mediaSettings.isVideoEnabled||c&&c.deviceId===m||e.push(t.changeDevice("videoinput",m)),u&&u.deviceId===_||e.push(t.changeDevice("audioinput",_)),Promise.all(e).then(()=>{r({type:"toggle_popup"})}).catch(e=>{console.error("Device change failed",e),r({type:"toggle_popup"})})}},d.createElement(bs,{mics:a,cameras:i,currentCamId:m,currentMicId:_,isCamAvailable:o,isMicAvailable:s,onCameraChange:e=>g(e),onMicChange:e=>b(e)}))}class Ps extends d.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){switch(this.props.state.mode){case l.CALL:this.props.SDK.hangup();break;case l.INCOMING:this.props.SDK.declineCall()}this.props.dispatch({type:y,mode:l.READY}),this.setState({hasError:!1})}render(){return this.state.hasError?null:this.props.children}}var js=n("bCCX"),ks=function(){return Math.random().toString(36).substring(7).split("").join(".")},As={INIT:"@@redux/INIT"+ks(),REPLACE:"@@redux/REPLACE"+ks(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+ks()}};function Rs(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function Ls(e,t,n){var r;if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function.");if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error("Expected the enhancer to be a function.");return n(Ls)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var i=e,a=t,o=[],s=o,c=!1;function u(){s===o&&(s=o.slice())}function l(){if(c)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return a}function d(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(c)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribelistener for more details.");var t=!0;return u(),s.push(e),function(){if(t){if(c)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribelistener for more details.");t=!1,u();var n=s.indexOf(e);s.splice(n,1),o=null}}}function p(e){if(!Rs(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(c)throw new Error("Reducers may not dispatch actions.");try{c=!0,a=i(a,e)}finally{c=!1}for(var t=o=s,n=0;n<t.length;n++){(0,t[n])()}return e}function h(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");i=e,p({type:As.REPLACE})}function f(){var e,t=d;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function n(){e.next&&e.next(l())}return n(),{unsubscribe:t(n)}}})[js.default]=function(){return this},e}return p({type:As.INIT}),(r={dispatch:p,subscribe:d,getState:l,replaceReducer:h})[js.default]=f,r}function Ns(){return(Ns=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var Ms=p.a.createContext(void 0),Ds=function(e){var t=e.name,n=e.initialState,r=void 0===n?{}:n,i=e.children,a=Object(d.useMemo)((function(){if("undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__){var e={},n=Ls((function(t,n){var r,i,a=n.type.split("/")[0],o=/\/_init$/.test(n.type),s=/\/_teardown$/.test(n.type)?(r=t,i=a,Object.keys(r).filter((function(e){return e!==i})).reduce((function(e,t){return e[t]=r[t],e}),{})):Ns({},t);return Object.keys(e).reduce((function(r,i){var s=e[i],c=t[i],u=n.payload,l=a===i;return r[i]=l?o?n.payload:s(c,u):c,r}),s)}),r,window.__REDUX_DEVTOOLS_EXTENSION__({name:t||"React state",actionsBlacklist:["/_init","/_teardown"]}));return n.registerHookedReducer=function(t,r,i){return e[i]=t,n.dispatch({type:i+"/_init",payload:r}),function(){delete e[i],n.dispatch({type:i+"/_teardown"})}},n}}),[]);return Object(d.useEffect)((function(){a&&a.dispatch({type:"REINSPECT/@@INIT",payload:{}})}),[]),p.a.createElement(Ms.Provider,{value:a},i)};function xs(e,t,n,r){var i=Object(d.useMemo)((function(){var e=n.getState()[r];return void 0===e?t:e}),[]),a=Object(d.useState)(i),o=a[0],s=a[1],c=Object(d.useMemo)((function(){return function(e){e&&"object"==typeof e&&"string"==typeof e.type?n.dispatch({type:r+"/"+e.type,payload:e}):n.dispatch({type:r,payload:e})}}),[]);return Object(d.useEffect)((function(){var t=n.registerHookedReducer(e,i,r),a=o,c=n.subscribe((function(){var e=n.getState()[r];a!==e&&s(e),a=e}));return function(){c(),t()}}),[]),[o,c]}var Us,Bs=n("enZq");!function(e){e.BLUE="blue",e.GREEN="green",e.GRAY="gray",e.RED="red"}(Us||(Us={}));var Fs,Hs=function(e){var t=e.icon,n=e.color;return p.a.createElement("div",{className:Object(D.classNames)("ListIcon","ListIcon--"+n)},t)},Gs=function(){return(Gs=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Vs=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},qs=function(e){var t=Vs(e,[]);return p.a.createElement("svg",Gs({width:"14",height:"14",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t,{"aria-hidden":"true"}),p.a.createElement("path",{d:"M6.022 9.184a.837.837 0 01-1.187-.001 3.861 3.861 0 010-5.419l2.618-2.643a3.772 3.772 0 015.366 0c1.261 1.274 1.557 3.033.67 4.508-.296.49-.947.47-1.325.09-.275-.276-.254-.707-.077-1.019.465-.817.24-1.683-.456-2.379a2.094 2.094 0 00-2.997 0L6.023 4.956a2.143 2.143 0 00-.001 3.025.83.83 0 010 1.202zm1.95-3.166c.833.835.832 2.19-.001 3.025L5.36 11.68a2.094 2.094 0 01-2.998 0c-.695-.696-.91-1.555-.446-2.371.178-.313.199-.744-.076-1.019-.379-.38-1.03-.4-1.325.09-.888 1.474-.602 3.226.659 4.5a3.772 3.772 0 005.367 0l2.617-2.643a3.861 3.861 0 000-5.419.837.837 0 00-1.187 0 .83.83 0 000 1.2z"}))},zs=function(e){var t=e.text,n=e.onCopyDone,r=e.children,i=Object(d.useRef)(null),a=Object(d.useCallback)((function(e){i.current.focus(),i.current.select(),document.execCommand("copy"),e.preventDefault(),e.stopPropagation(),n&&n()}),[n]);return p.a.createElement("div",{className:"CopyText",onClick:a},p.a.createElement("input",{type:"text",readOnly:!0,value:t||"",ref:i,className:"CopyText__input"}),r)},Ks=n("754W"),Ws=n("XTb9"),Ys=function(e){var t=e.value,n=e.copyText,r=e.doneText,i=e.className,a=Object(d.useState)(!1),o=a[0],s=a[1],c=Object(d.useCallback)((function(){s(!0)}),[]),u=Object(d.useCallback)((function(){s(!1)}),[]),l=Object(D.classNames)("ListCopyControl",i,{"ListCopyControl--copied":o});return p.a.createElement("div",{className:l},p.a.createElement(zs,{text:t,onCopyDone:c},p.a.createElement(Ks.default,{className:"ListCopyControl__copyButton"},n)),p.a.createElement(Ws.default,{shown:o,callback:u,className:"ListCopyControl__copyDone"},r))},$s=function(e){var t=e.isLinkBlockShown,n=e.onLinkBlockClick,r=e.callUrlLink;return p.a.createElement(Bs.default,null,t&&p.a.createElement(Jo.default,{onClick:n,chevron:!0,icon:p.a.createElement(Hs,{icon:p.a.createElement(qs,null),color:Us.GREEN})},Object(ie.getLang)("calls_menu_link"),r&&p.a.createElement(Ys,{value:r,copyText:Object(ie.getLang)("calls_menu_link_copy"),doneText:Object(ie.getLang)("calls_menu_link_copied")})))},Js=n("dLHM"),Xs=n("Q3mP"),Qs=function(e){var t=e.link,n=e.isLinkLoading,r=Object(d.useState)(!1),i=r[0],a=r[1],o=Object(d.useCallback)((function(){return a(!0)}),[]),s=Object(d.useCallback)((function(){return a(!1)}),[]);return p.a.createElement("div",{className:"CallLink"},p.a.createElement("p",{className:"CallLink__info"},Object(ie.getLang)("calls_management_link_info")),n?p.a.createElement(ms,{className:"CallLink__input"},p.a.createElement(Xs.default,null)):p.a.createElement(Js.default,{readOnly:"readonly",className:"CallLink__input",value:t}),p.a.createElement(zs,{text:t,onCopyDone:o},p.a.createElement(Go.default,{disabled:n},Object(ie.getLang)("calls_link_copy"))),p.a.createElement(Ws.default,{className:"CallLink__copied",shown:i,callback:s},Object(ie.getLang)("calls_link_copied")))},Zs=n("grKM"),ec=function(e){var t=e.searchQuery,n=e.onSearchChange,r=e.length,i=e.children;return p.a.createElement("div",{className:"CallParticipantList"},p.a.createElement(Zs.BlockSearchInput,{value:t,placeholder:Object(ie.getLang)("calls_search_participants_placeholder"),onChange:n,onInput:n,onPaste:n,className:"CallParticipantList__input"}),p.a.createElement($o,{extra:r||""},Object(ie.getLang)("calls_participant_list_header")),p.a.createElement(Bs.default,{border:!1,className:"CallParticipantList__list"},i))},tc=function(){return(tc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},nc=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},rc=function(e){var t=e.element,n=void 0===t?"span":t,r=e.alt,i=e.className,a=nc(e,["element","alt","className"]),o=n,s=Object(D.classNames)("ListActionsControl",i);return p.a.createElement(o,tc({"aria-label":r,className:s},a),p.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"5",viewBox:"0 0 10 5",fill:"currentColor","aria-hidden":"true"},p.a.createElement("path",{d:"M5 4.8c-.2 0-.3 0-.4-.1l-4.3-3.2c-.3-.3-.4-.8-.2-1.1.2-.3.7-.4 1-.2l3.9 2.9 3.8-2.9c.3-.3.8-.2 1 .1.3.3.2.8-.1 1.1l-4.2 3.2c-.2.1-.3.2-.5.2z"})))},ic=n("As6E"),ac=function(e){var t=e.state,n=e.SDK,r=e.dispatch,i=e.participant,a=To(t,n,r,i);return a.length>0?p.a.createElement(ic.default,{position:"b",align:"right",trigger:"hover",marginTop:-8,marginLeft:1,data:a},p.a.createElement(rc,null)):null},oc=function(){return(oc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},sc=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},cc=function(e){var t=sc(e,[]);return p.a.createElement("svg",oc({height:"13",width:"12",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 13",fill:"currentColor"},t),p.a.createElement("path",{d:"M3.497 5.06v.44a2.501 2.501 0 002.91 2.467l1.199 1.198a4.005 4.005 0 01-5.521-2.822.75.75 0 00-1.469.314A5.508 5.508 0 005.25 10.95v1.301a.75.75 0 001.501 0v-1.3a5.472 5.472 0 001.973-.669l1.25 1.25a.751.751 0 001.062-1.061L1.88 1.32A.75.75 0 10.82 2.38l2.677 2.68zM9.672 7.097l1.117 1.117a5.463 5.463 0 00.594-1.557.75.75 0 10-1.468-.314 3.963 3.963 0 01-.243.754zM3.827 1.258l4.644 4.64c.02-.13.031-.263.031-.398v-3a2.502 2.502 0 00-4.675-1.242z"}))},uc=function(){return(uc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},lc=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},dc=function(e){var t=lc(e,[]);return p.a.createElement("svg",uc({width:"15",height:"15",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),p.a.createElement("path",{d:"M2.75 3a.75.75 0 01.75.75V7.5a.5.5 0 001 0V2A.75.75 0 016 2v4.75a.5.5 0 001 0v-5.5a.75.75 0 011.5 0v5.5a.5.5 0 001 0V2.5a.75.75 0 011.5 0v7.25l1.614-1.796a.9.9 0 011.36 1.177c-.73.873-2.044 2.449-2.809 3.367C9.913 14 8.08 14.5 6.701 14.5 2.2 14.5 2 11.47 2 10.444V3.75A.75.75 0 012.75 3z"}))},pc=function(){return p.a.createElement("div",{className:"VolumeMeterAnimation"})},hc=function(e){var t=e.showSpeaking,n=e.showAudioDisabled,r=e.showRaisedHand,i=e.showConnecting;return p.a.createElement("span",{className:"ParticipantIndicators"},t&&p.a.createElement("span",{className:"ParticipantIndicators__item"},p.a.createElement(pc,null)),n&&p.a.createElement("span",{className:"ParticipantIndicators__item"},p.a.createElement(cc,{className:"ParticipantIndicators__muted"})),r&&p.a.createElement("span",{className:"ParticipantIndicators__item"},p.a.createElement(dc,{className:"ParticipantIndicators__hand"})),i&&p.a.createElement("span",{className:"ParticipantIndicators__item"},p.a.createElement(He,null)))},fc=function(){return(fc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},mc=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},gc=function(e){var t=e.className,n=e.children,r=mc(e,["className","children"]),i=Object(D.classNames)("ListAddControl",t);return p.a.createElement("button",fc({className:i},r),p.a.createElement("span",{className:"ListAddControl__icon"},p.a.createElement("svg",{height:"16",viewBox:"0 0 16 16",width:"16",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0},p.a.createElement("path",{d:"M9 7h6c.552 0 1 .448 1 1s-.448 1-1 1h-6v6c0 .552-.448 1-1 1s-1-.448-1-1v-6h-6c-.552 0-1-.448-1-1s.448-1 1-1h6v-6c0-.552.448-1 1-1s1 .448 1 1z",fill:"currentColor"}))),n)},vc=function(e){var t=e.state,n=e.SDK,r=e.dispatch,i=e.onAddClick,a=function(e){return Object.values(e.participants).reduce((function(t,n){return(n.peerId===e.me||n.status)&&(t[0].push(n),n.name&&t[1].push(n)),t}),[[],[]])}(t),o=a[0],s=a[1],c=Object(d.useState)(""),u=c[0],l=c[1],h=Object(d.useCallback)((function(e){return e.name}),[]),f=Object(d.useCallback)((function(e){return e.peerId}),[]),m=ce(s,h,f),g=u?m.search(u):o,_=Object(d.useCallback)((function(e){l(e.target.value)}),[]),b=!Co(t.me)&&(de(t.peer)||t.participants[t.peer].wasConnected);return p.a.createElement(ec,{searchQuery:u,onSearchChange:_,length:g.length},!u&&b&&p.a.createElement(Jo.default,{selectable:!1,border:!1,key:"add"},p.a.createElement(gc,{onClick:i},Object(ie.getLang)("calls_add_participants"))),g.length>0&&g.map((function(e){var i,a,o=e.peerId!==t.me&&e.status===v.WAITING,s=!o&&!(null===(i=e.mediaSettings)||void 0===i?void 0:i.isAudioEnabled),c=!o&&(null===(a=e.statusData)||void 0===a?void 0:a.hand),u=!!t.speakers[e.peerId],l=o||s||c||u;return p.a.createElement(Jo.default,{selectable:!1,border:!1,key:e.peerId,aside:p.a.createElement(p.a.Fragment,null,l&&p.a.createElement(hc,{showSpeaking:u,showRaisedHand:c,showAudioDisabled:s,showConnecting:o,key:"indicators"}),p.a.createElement(ac,{state:t,SDK:n,dispatch:r,participant:e,key:"menu"}))},p.a.createElement(Xo.default,{photo:p.a.createElement(X,{id:e.peerId,photo:e.photo,alt:e.name||"",size:"xxxs"}),title:e.name,href:e.link,target:"_blank"}))})),u&&0===g.length&&p.a.createElement(Fe.default,null,Object(ie.getLang)("calls_participants_not_found")))};function _c(e,t,n){var r=Object(M.getProgress)(),i=r.showProgress,a=r.hideProgress,o=t.callData.callId,s=function(){return t.imHash},c=function(e){return n({type:"update_hash",hash:e}),e};i(),Le(_n,(function(e){return Me(s,c,e)}))(o).catch((function(e){console.error(e),n({type:"error",text:Object(ge.getLang)("calls_error_force_call_finish")})})).finally(a)}!function(e){e[e.MAIN=0]="MAIN",e[e.CALL_LINK=1]="CALL_LINK",e[e.ADD_PARTICIPANTS=2]="ADD_PARTICIPANTS"}(Fs||(Fs={}));var bc=function(e){var t,n,r=e.SDK,i=e.state,a=e.dispatch,o=Object(d.useState)(i.callData.callUrlLink),s=o[0],c=o[1],u=Object(d.useState)(Fs.MAIN),l=u[0],h=u[1],f=Object(d.useState)(!1),m=f[0],g=f[1],v=null===(t=i.callData.conversation)||void 0===t?void 0:t.canAddMembers,_=i.isUpdateEnabled&&(null===(n=i.callData)||void 0===n?void 0:n.canFinishCall),b=Object(d.useCallback)((function(){a({type:"management",isOpen:!1})}),[]),y=Object(d.useCallback)((function(){h(Fs.MAIN)}),[]),E=Object(d.useCallback)((function(){if(h(Fs.CALL_LINK),!s){var e=i.callData.callId,t=function(){return i.imHash},n=function(e){return a({type:"update_hash",hash:e}),e};g(!0),Le(gn,(function(e){return Me(t,n,e)}))(e).then((function(e){var t=e[0];c(t),g(!1),a({type:"call_state",callData:{callUrlLink:t}})})).catch((function(e){console.error(e),g(!1),Object(M.showError)(Object(ie.getLang)("calls_get_url_link_error_text")),h(Fs.MAIN)}))}}),[i.callData.callId,s]),O=Object(d.useCallback)((function(){var e=Object(M.getProgress)(),t=e.showProgress,n=e.hideProgress;t();var r=[Cn(i,a)].concat(Object(le.isChatPeer)(i.peer)?[Sn(i,a,i.peer,i.callData.conversation)]:[]);return Promise.all(r).then((function(){n(),h(Fs.ADD_PARTICIPANTS)})).catch((function(e){console.error(e),n()}))}),[i.peer,i.callData]),C=Object(d.useCallback)((function(){a({type:"toggle_popup"}),_c(0,i,a)}),[i.callData.callId,i.imHash]);return p.a.createElement(p.a.Fragment,null,l===Fs.MAIN&&p.a.createElement(zo,{title:Object(ie.getLang)("calls_management_participants"),actionButtons:(_?[p.a.createElement(Go.default,{onClick:C,key:"forceCallFinish",appearance:"secondary"},Object(ie.getLang)("calls_force_call_finish"))]:[]).concat([p.a.createElement(Go.default,{onClick:r.hangup,key:"leave"},Object(ie.getLang)("calls_leave_call"))]),onCloseModal:b},p.a.createElement($s,{isLinkBlockShown:v,onLinkBlockClick:E,callUrlLink:s}),p.a.createElement(vc,{state:i,SDK:r,dispatch:a,onAddClick:O})),l===Fs.CALL_LINK&&p.a.createElement(zo,{title:Object(ie.getLang)("calls_management_link"),hint:Object(ie.getLang)("calls_management_add_warning"),onCloseModal:b,isWithBackButton:!0,onBackClick:y},p.a.createElement(Qs,{link:s,isLinkLoading:m})),l===Fs.ADD_PARTICIPANTS&&p.a.createElement(ls,{state:i,SDK:r,dispatch:a,isWithBackButton:!0,onBackClick:y}))},yc=function(e){var t=e.children;return p.a.createElement("h2",{className:"JoinHeader"},t)},Ec=function(e){var t=e.children;return p.a.createElement("div",{className:"VisuallyHidden"},t)},Oc=function(e){var t=e.items;return p.a.createElement("figure",{className:"AvatarsStack"},p.a.createElement(Ec,null,p.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg"},p.a.createElement("defs",null,p.a.createElement("clipPath",{id:"users-mask"},p.a.createElement("path",{d:"M43.56 8.25a25 25 0 100 33.5A27.88 27.88 0 0138 25c0-6.28 2.07-12.08 5.56-16.75z"}))))),t.map((function(e,t){return"src"in e?p.a.createElement("img",{src:e.src,className:"AvatarsStack__item",alt:e.alt,key:e.key||t}):p.a.createElement(J.ConversationNoPhoto,{text:e.text,id:e.id,size:"50",className:"AvatarsStack__item",key:e.key||t})})))},Cc=function(){return(Cc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Sc=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Tc=function(e){var t=Sc(e,[]);return p.a.createElement("svg",Cc({width:"16",height:"16",fill:"currentColor"},t,{xmlns:"http://www.w3.org/2000/svg"}),p.a.createElement("path",{d:"M3.14 3C1.96 3 1 3.96 1 5.14v5.72C1 12.04 1.96 13 3.14 13h5.72c1.18 0 2.14-.96 2.14-2.14V5.14C11 3.96 10.04 3 8.86 3H3.14zM14.95 4.87c.23-.17.55 0 .55.28v5.7c0 .28-.32.45-.55.28L12 9.01V6.99l2.95-2.12z"}))},wc=function(e){var t=e.isAnonym,n=e.title,r=e.label,i=e.items,a=e.onChangeName,o=e.name,s=e.namePlaceholder,c=e.joinWithVideoText,u=e.joinWithAudioText,l=e.onJoinWithVideo,d=e.onJoinWithAudio,h=e.disabled,f=e.inputDisabled;return p.a.createElement("div",{className:Object(D.classNames)("JoinScreen",{"JoinScreen--anonym":t})},p.a.createElement(yc,null,p.a.createElement(Q.default,{className:""},n)),p.a.createElement("div",{className:"JoinScreen__members"},p.a.createElement(Oc,{items:i}),p.a.createElement("div",{className:"JoinScreen__membersLabel"},r)),p.a.createElement("footer",{className:"JoinScreen__footer"},t&&p.a.createElement(Js.default,{onChange:a,className:"JoinScreen__input",value:o,placeholder:s,disabled:f,maxLength:50,onKeyDown:function(e){"Enter"===e.key&&l()}}),p.a.createElement(Go.default,{appearance:"primary",onClick:l,disabled:h,type:"submit"},p.a.createElement(Tc,{className:"JoinScreen__icon"}),p.a.createElement("span",null,c)),p.a.createElement(Go.default,{appearance:"primary",title:u,"aria-label":u,onClick:d,disabled:h},p.a.createElement(is,{className:"JoinScreen__icon"}))))},Ic=n("yqpO"),Pc=n("S6+Z"),jc=function(e){var t=e.ownerId,n=e.isAnonym,r=e.joinLink,i=e.vkJoinLink,a=e.title,o=e.members,s=e.conversationData,c=e.withPopup,u=e.onClose,l=e.bridge,h=Object(d.useState)(""),f=h[0],m=h[1],g=Object(d.useState)(null),v=g[0],_=g[1],b=Object(d.useState)(!1),y=b[0],E=b[1],O=o?o.slice(0,3).map((function(e){return e.photo_100?{src:e.photo_100,alt:e.firstName,key:e.peerId}:{id:e.peerId,text:e.firstName.slice(0,1)}})):[],C=Object(d.useCallback)((function(e){m(e.target.value)}),[]),S=Object(d.useCallback)((function(e){if(n)return function(e,t,n,r,i){if(e)return Promise.resolve(e);return((e,t,n)=>Object(pn.post)(me.CONTROLLER,{act:"a_get_anonym_call_token",join_link:e,user_id:t,name:n}))(n,r,i).then((function(e){var n=e[0];return t(n),Promise.resolve(n)}))}(v,_,i,t,f).then((function(e){return function(e,t,n,r){if(t)return Promise.resolve();var i=r.callsCredentials,a=r.calls1To1Enabled,o=r.callsJoinEnabled,s=r.callsUpdateEnabled,c=r.participantLimit,u=r.imHash;return e.init(i,u,c,a,o,s).then((function(){return n(!0)}))}(l,y,E,e)})).then((function(){return l.joinCallByLink(0,r,null,e)})).catch((function(e){var t="string"==typeof e?e:Object(ie.getLang)("global_unknow_error");Object(M.showError)(t)}));u&&u(),l.joinCallByLink(s.peerId,r,[s,o],e)}),[r,u,f,v,y]),T=Object(d.useCallback)((function(){u&&u()}),[u]),w=Object(d.useMemo)((function(){var e=Object(Yo.clean)(Object(be.decodeHTMLEntities)(a)),t=Object(Pc.emojiRegex)();return e.replace(t,Ic.emojiReplace)}),[a]),I=p.a.createElement(wc,{isAnonym:n,name:f,onChangeName:C,namePlaceholder:Object(ie.getLang)("calls_name_placeholder"),title:w,label:De(o||[],O),items:O,joinWithVideoText:Object(ie.getLang)("calls_join_with_video"),joinWithAudioText:Object(ie.getLang)("calls_join_with_audio"),onJoinWithVideo:function(){return S(!0)},onJoinWithAudio:function(){return S(!1)},disabled:n&&!f.trim(),inputDisabled:!!v});return c?p.a.createElement(oe.default,{onClose:T},p.a.createElement(Vo.ModalHeader,{appearance:"blue",title:Object(ie.getLang)("calls_invite"),onClose:T}),I):I};var kc,Ac=function(e){var t=e.children;return p.a.createElement("div",{className:"ErrorPopupText"},t)},Rc=function(e){var t=e.title,n=e.text,r=e.onClose;return p.a.createElement(Os.default,{appearance:"blue",title:t||Object(ie.getLang)("calls_oops"),onClose:r,actionButtons:p.a.createElement(Go.default,{onClick:r},Object(ie.getLang)("global_close"))},p.a.createElement(Ac,null,n||Object(ie.getLang)("global_error")))},Lc=function(e){var t=e.onClose,n=e.actionButtons;return p.a.createElement(Os.default,{onClose:t,title:Object(ie.getLang)("calls_exit_menu"),appearance:"blue",actionButtons:n,className:"CallExitModal"},p.a.createElement("div",{className:"CallExitModal__text"},Object(ie.getLang)("calls_sure_leave_call")))},Nc=function(e){var t=e.SDK,n=e.state,r=e.dispatch,i=Object(d.useCallback)((function(){r({type:"toggle_popup"}),_c(0,n,r)}),[n.callData.callId,n.imHash]),a=Object(d.useCallback)((function(){r({type:"toggle_popup"})}),[]);return p.a.createElement(Lc,{onClose:a,actionButtons:[p.a.createElement(Go.default,{onClick:i,key:"forceCallFinish",appearance:"secondary"},Object(ie.getLang)("calls_force_call_finish")),p.a.createElement(Go.default,{onClick:t.hangup,key:"leave"},Object(ie.getLang)("calls_leave_call"))]})};!function(e){e.CONTAIN="cn",e.COVER="cv"}(kc||(kc={}));function Mc(e,t,n){return e.uiMode===g.COLLAPSED?function(e){var t=je(e),n=Io(e,t);return Pe(e).reduce((function(e,t){var r=t.peerId,i=t.mediaSettings;return r===(null==n?void 0:n.peerId)&&(null==i?void 0:i.isVideoEnabled)?e.set(t.peerId,{fit:kc.CONTAIN,width:265,height:200,priority:2,uid:So(n)}):e.set(t.peerId,{fit:kc.CONTAIN,width:0,height:0,priority:-1,uid:So(t)}),e}),new Map)}(e):e.isOratorMode?function(e,t,n){var r=e.pinnedParticipant||e.orator||e.me;return Pe(e).reduce((function(i,a){var o=a.peerId,s=a.mediaSettings;if(r===o&&(null==s?void 0:s.isVideoEnabled)){var c=e.uiMode===g.FULLSCREEN;i.set(a.peerId,{fit:kc.CONTAIN,width:c?t:900,height:c?n:504,priority:3,uid:So(a)})}else(null==s?void 0:s.isVideoEnabled)?i.set(a.peerId,{fit:(null==s?void 0:s.isScreenSharingEnabled)?kc.CONTAIN:kc.COVER,width:140,height:140,priority:1,uid:So(a)}):i.set(a.peerId,{fit:kc.COVER,width:0,height:0,priority:-1,uid:So(a)});return i}),new Map)}(e,t,n):function(e,t,n){var r=e.uiMode===g.FULLSCREEN,i=r?t:900,a=r?n:504,o=Pe(e),s=function(e,t,n){switch(n){case 1:return t;case 2:return Math.round(e/2);case 3:return Math.round(e/3);case 4:case 5:case 6:return Math.round(t/2);case 7:case 8:return Math.round(e/4);case 9:case 10:return Math.round(e/5);case 11:case 12:case 13:case 14:case 15:return Math.round(t/3);default:return Math.round(e/6)}}(i,a,o.length),c=s<200?1:2;return o.reduce((function(e,t){var n;return(null===(n=t.mediaSettings)||void 0===n?void 0:n.isVideoEnabled)?e.set(t.peerId,{fit:kc.COVER,width:s,height:s,priority:c,uid:So(t)}):e.set(t.peerId,{fit:kc.COVER,width:0,height:0,priority:-1,uid:So(t)}),e}),new Map)}(e,t,n)}var Dc=function(e,t){var n=Object(d.useState)([0,0]),r=n[0],i=r[0],a=r[1],o=n[1],s=Object(d.useCallback)(Object(Pt.throttle)(xc,1e3),[]),c=Object(d.useRef)(new Map),u=Object(d.useRef)([]);Object(d.useEffect)((function(){var e=function(){return o([window.innerWidth,window.innerHeight])};return e(),window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[]),Object(d.useEffect)((function(){if(t.mode===l.CALL){var n=Mc(t,i,a),r=function(e,t){var n=[];return t.forEach((function(t,r){var i,a,o=e.get(r);o&&(a=t,(i=o).fit===a.fit&&i.width===a.width&&i.height==i.height&&i.priority===a.priority)||n.push(t)})),n}(c.current,n);r.length>0&&s(e,t,r,c,n,u)}}),[i,a,t])};function xc(e,t,n,r,i,a){if(t.mode!==l.CALL)return r.current=new Map,void(a.current=[]);a.current=n,r.current=i,e.updateDisplayLayout(n)}var Uc=function(){return(Uc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function Bc(e){var t=e.participant,n=p.a.useRef(null);return p.a.useEffect((function(){n.current&&(n.current.srcObject=t.stream)}),[t.stream,t.status]),t.stream?p.a.createElement("audio",Uc({key:t.peerId,ref:n},{autoPlay:!0,controls:!1,crossOrigin:"anonymous",playsInline:"playsinline",preload:"metadata"})):null}var Fc=function(e){var t=e.state,n=Pe(t);return p.a.createElement(p.a.Fragment,null,!t.useDirectAudio&&n.map((function(e){return e.peerId!==t.me&&e.stream?p.a.createElement(Bc,{participant:e,key:e.peerId}):null})))};function Hc(){return(Hc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Gc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Vc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Vc(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Vc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function qc(e){var t=e.SDK,n=e.bridge,r=e.useLongpoll,i=e.useSDK,a=e.imHash,o=e.participantLimit,s=e.me,c=e.isJoinAvailable,u=e.isUpdateEnabled,p=e.useDirectAudio,h=Gc(function(e,t){var n,r=arguments.length<=2?void 0:arguments[2];2==(arguments.length<=2?0:arguments.length-2)?(r=arguments.length<=2?void 0:arguments[2],n=arguments.length<=3?void 0:arguments[3]):"string"==typeof(arguments.length<=2?void 0:arguments[2])||"number"==typeof(arguments.length<=2?void 0:arguments[2])?n=arguments.length<=2?void 0:arguments[2]:(r=arguments.length<=2?void 0:arguments[2],n=arguments.length<=3?void 0:arguments[3]);var i=Object(d.useContext)(Ms),a=r?r(t):t;return i&&n?xs(e,a,i,n):Object(d.useReducer)(e,t,r)}(R,k(s,a,{participantLimit:o,isJoinAvailable:c,isUpdateEnabled:u,useDirectAudio:p}),e=>e,"calls"),2),f=h[0],m=h[1],v=d.useRef(f),_=d.useCallback(()=>{m({type:y,mode:l.READY})},[]);return d.useEffect(()=>{v.current=f},[f]),d.useEffect(()=>{i(v,m),r(t,v,m)},[]),function(e,t,n,r){void 0===r&&(r=[]);var i=document.documentElement.requestFullscreen||document.documentElement.webkitRequestFullscreen;if(i){var a=!document.documentElement.requestFullscreen,o=a?document.webkitExitFullscreen:document.exitFullscreen,s=a?"webkitfullscreenchange":"fullscreenchange",c=a?"webkitFullscreenElement":"fullscreenElement";Object(d.useEffect)((function(){var e=function(){document.fullscreenElement?t&&t():n&&n()};return document.addEventListener(s,e),function(){return document.removeEventListener(s,e)}}),[]),Object(d.useEffect)((function(){e&&!document[c]?i.call(document.documentElement):!e&&document[c]&&o.call(document)}),r)}}(f.uiMode===g.FULLSCREEN&&f.mode===l.CALL,()=>{},()=>{v.current.uiMode===g.FULLSCREEN&&m({type:"change_ui_mode",mode:g.DEFAULT})},[f.uiMode,f.mode]),Dc(t,f),d.createElement(Ps,{SDK:t,state:f,dispatch:m},Object(M.tabIsMaster)()&&d.createElement(Ho,{state:f}),f.mode===l.CALL&&f.uiMode!==g.COLLAPSED&&d.createElement(jo,{SDK:t,state:f,dispatch:m}),f.mode===l.INCOMING&&f.uiMode!==g.COLLAPSED&&d.createElement(he,{SDK:t,state:f,dispatch:m}),f.mode!==l.READY&&f.uiMode===g.COLLAPSED&&d.createElement(Bo,{SDK:t,state:f,dispatch:m}),f.mode===l.JOIN&&d.createElement(jc,Hc({},f.join,{bridge:n,withPopup:!0,onClose:_})),f.mode===l.ERROR&&d.createElement(Rc,{title:f.error.title,text:f.error.text,onClose:_}),f.groupCallSetup&&d.createElement(ls,{SDK:t,state:f,dispatch:m}),f.isManagementOpen&&d.createElement(bc,{SDK:t,state:f,dispatch:m}),"settings"===f.popup&&d.createElement(Is,{SDK:t,state:f,dispatch:m}),"exit"===f.popup&&d.createElement(Nc,{SDK:t,state:f,dispatch:m}),f.mode===l.CALL&&d.createElement(Fc,{state:f}))}var zc=n("f01n"),Kc=function(){return(Kc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Wc={timeStart:null,entryPoint:null,startType:null,isGroupCall:!1,hadVideoEnabled:!1,isOutgoingCall:!1,connectionStep:null};var Yc=function(){return Wc},$c=function(e){var t,n,r,i;Wc=Kc(Kc(Kc({},Wc),e),{connectionStep:(t=e.connectionStep,n=Wc.connectionStep,(r={})[v.WAITING]=1,r[v.CONNECTING]=2,r[v.CONNECTED]=3,i=r,t&&i[t]&&i[t]>(i[n]||0)?t:n)})},Jc=function(){Wc={timeStart:null,entryPoint:null,startType:null,isGroupCall:!1,hadVideoEnabled:!1,isOutgoingCall:!1,connectionStep:null}},Xc=n("MhhX");function Qc(){return(Qc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Zc(e,t,n,r){if(void 0!==window.Notifier){var i=Notifier.getLpInstance(),a=e.is1to1Supported;i.onData((function(){for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];var c=n.current;eu(c,r,o,a).then(()=>{o.forEach(i=>{switch(i.type){case zc.INCOMING_CALL:if(tu(c,i,a))t.processPush(i.payload.call_id).then(()=>{var e=JSON.parse(Object(Yo.decodeHtml)(i.payload.payload)),t=e.is_video?m.VIDEO:m.AUDIO;r({type:y,mode:l.INCOMING,peerId:we(i.payload),data:Qc({},i.payload,{type:t,payload:e})}),$c({timeStart:Date.now(),startType:t})}).catch(t=>{if(e.debug)if("object"==typeof t){var n=t.hangup,r=t.message;console.error("Push process error",n,r)}else console.error("Push process error",t)});else if(i.type===zc.INCOMING_CALL&&e.debug){console.warn("Incoming push skipped:",(()=>{switch(!0){case!i.payload.call_id:return"old lib call";case!Object(M.tabIsMaster)():return"not master tab";case c.mode===l.CALL||c.mode===l.INCOMING:return"already in a call";case!Ie(i)&&!a:return"1-1 not available"}})(),i)}break;case zc.ADD_MESSAGE:var o=Object(le.isChatPeer)(n.current.peer),s=n.current.callData.callId;if(o||!Object(Xc.isActiveGroupCallMessage)(i))return;var u=i.peerId;if(s===i.kludges.attach1_call_id)return Tn(n,r,u);break;case zc.CONVERSATION_UPDATED:var d=i.peerId,p=i.updateType;if(n.current.peer!==d)return;if(p!==zc.MAIL_CHAT_UPDATE_TYPE_CALL_IN_PROGRESS_CHANGED)return;void 0!==n.current.callData.canFinishCall&&n.current.callData.hasUrlLink||wn(n,r,d)}})}).catch(n=>{e.debug&&console.error("Resource loading error",n),o.forEach(n=>{switch(n.type){case zc.INCOMING_CALL:if(!tu(c,n,a)||Object(M.tabIsIdle)())return;Object(M.showIncomingHandlingError)(()=>{t.processPush(n.payload.call_id).then(()=>{t.declineCall()}).catch(t=>{e.debug&&console.error("Delayed by error push process error",t)})})}})})}))}}function eu(e,t,n,r){var i=n.reduce((n,i)=>{switch(i.type){case zc.INCOMING_CALL:if(!tu(e,i,r))return;var a=Ie(i),o=(u=i.payload,l=u.caller_info,d=l.first_name+" "+l.last_name,{peerId:+l.user_id,name:d,tab:d,photo:l.photo_400});if(a){var s=function(e){var t=e.chat_info;return{peerId:2e9+t.chat_id,tab:t.title,name:t.title,photo:t.photo_400}}(i.payload);t({type:"load_peer",conversation:s,members:[o]}),s.photo&&n.push(Object(M.preloadImage)(s.photo));var c=function(e,t,n){var r=ln(e,t),i=r[0],a=r[1];return Le(hn,Me.bind(null,i,a))(n).then((function(e){var n=e[0],r=e[1];Object(M.preloadImagesFromResponse)([n,r]).catch(console.error),t({type:"load_peer",conversation:n,members:r})}))}(e,t,s.peerId);n.push(c)}else t({type:"load_peer",conversation:o,members:[o]});o.photo&&n.push(Object(M.preloadImage)(o.photo))}var u,l,d;return n},[]);return Promise.all(i)}function tu(e,t,n){return function(e,t){return!(!e.payload.call_id||!Ie(e)&&!t)}(t,n)&&e.mode!==l.INCOMING&&e.mode!==l.CALL&&Object(M.tabIsMaster)()}function nu(e){var t=e.onVolumeLevelReached,n=e.needCheckMicEnabled,r=e.vectorLength,i=e.muteMicLevelDetection,a=e.callbackFactorStep,o=e.sensitivityCoefficient,s=e.debugCallback,c=function(e){var t=[],n=0;return function(r){if(t.push(r),n+=r,t.length>e){var i=t.shift();n-=i||0}return n/t.length}}(r),u=0;return function(e,r){s&&s(arguments),0!==u&&r&&(u=0);var l=c(e);n&&r||e/l>(1+u)/o&&e>i&&(u+=a,t())}}function ru(e,t){var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;var i=function(e,t){return parseInt(e)-parseInt(t)},a=n.sort(i),o=r.sort(i);return a.every((function(e,t){return e===o[t]}))}var iu=n("tGJf");function au(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ou(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ou(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ou(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function su(e){iu.vkLocalStorage.setItem("calls_token",e)}function cu(){return iu.vkLocalStorage.getItem("calls_token")}var uu=n("Bj12");function lu(e,t,n,r){var i,a,o,s=Yc(),c=s.startType,u=s.entryPoint,l=s.timeStart,d=s.isGroupCall,p=s.hadVideoEnabled,h=s.isOutgoingCall,f=!e||e===w&&!n,g={type:c&&function(e,t,n){var r;r=e===m.VIDEO?t?E.GROUP_VIDEO:E.VIDEO:n?t?E.GROUP_AUDIO_TO_VIDEO:E.AUDIO_TO_VIDEO:t?E.GROUP_AUDIO:E.AUDIO;return r}(c,d,p),result:f?O.SUCCESS:O.FAIL,failReason:f?null:du(e,n),callSource:u,totalDuration:l?Date.now()-l:0};h&&(r&&console.log(g),i=t,o=[(a=g).type||"",a.result,a.failReason||"",a.callSource||"",a.totalDuration],Object(uu.saveStatlogEvents)({name:"call_stats",value:i,keys:o}))}function du(e,t){var n=Yc().isOutgoingCall,r=Yc().connectionStep;switch(!0){case t:return C.CONNECTION_LOST;case e===T:return C.LOCAL_DECLINE;case"REJECTED"===e:return C.REMOTE_DECLINE;case"BUSY"===e:return C.REMOTE_BUSY;case e===I:return n?C.REMOTE_TIMEOUT:null;case r===v.CONNECTING:return C.REMOTE_FAILED_ACCEPT;case!r:return C.REMOTE_NO_CONNECT;default:return null}}function pu(){return(pu=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function hu(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return fu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return fu(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function mu(e,t,n,r,i,a,o){var s,c,u,d,p,h=a.current,f=h.me,g=3,E=!1,O={apiKey:i.key,apiEnv:i.is_dev?"VIDEOTEST":"PROD",anonymToken:i.is_anonym&&i.token,voiceParams:{speakerLevelMultiplier:1.3,smoothing:.5},directAudioOutput:!!h.useDirectAudio,onLocalStream:(t,n)=>{e.debug&&console.warn("onLocalStream",t,n),o({type:"stream",participantId:f,data:t}),o({type:"media_settings",participantId:f,data:n}),$c({hadVideoEnabled:n.isVideoEnabled})},onLocalStreamUpdate:(t,n)=>{e.debug&&console.warn("onLocalStreamUpdate",t,n);var r=a.current.participants[f].mediaSettings;o({type:"media_settings",participantId:f,data:t}),t.isScreenSharingEnabled!==r.isScreenSharingEnabled&&Cu(o,t.isScreenSharingEnabled,f),$c({hadVideoEnabled:t.isVideoEnabled})},onRemoteStream:(t,n)=>{e.debug&&console.warn("onRemoteStream",t.id,n),o({type:"stream",participantId:t.id,data:n})},onConversation:t=>{if(e.debug&&console.warn("onConversation",t),!a.current.callData.ts){var n=Date.now();o({type:"time_start",data:n})}e.isInActiveCall=!0,wn(a,o,a.current.peer)},onRemoteMediaSettings:(t,n)=>{var r,i;e.debug&&console.warn("onRemoteMediaSettings",t.id,n);var s=+t.id,c=a.current;o({type:"media_settings",participantId:s,data:n});var u=!!(null===(r=c.participants[s])||void 0===r||null===(i=r.mediaSettings)||void 0===i?void 0:i.isScreenSharingEnabled);n.isScreenSharingEnabled!==u&&Cu(o,n.isScreenSharingEnabled,s,!0),$c({hadVideoEnabled:n.isVideoEnabled})},onParticipantStatus:(t,n,r)=>{var i=+t.id,s=a.current;if(e.debug&&console.warn("onParticipantStatus",i,n,r),!s.participants[i]){o({type:"load_peer",members:[{peerId:i,mediaSettings:{isAudioEnabled:!1,isVideoEnabled:!1,isScreenSharingEnabled:!1},isAnonym:"ANONYM"===t.type}]});var c="ANONYM"===t.type?[-Math.abs(i)]:[i],u=s.callData.callId,l={withConversation:!a.current.callData.conversation,awaitImages:!0};In(a,o,u,c,l)}o({type:"update_user_status",participantId:i,status:n,data:r}),$c({connectionStep:n})},onUserPermissions:t=>{e.debug&&console.warn("onUserPermissions",t),o({type:"call_state",callData:{permissions:t.reduce((e,t)=>(e[t]=!0,e),{})}})},onPermissionsRequested:()=>{e.debug&&console.warn("onPermissionsRequested")},onRemoteRemoved:t=>{e.debug&&console.warn("onRemoteRemoved",t.id),o({type:"remove_user",participantId:+t.id})},onCallState:(t,n,r)=>{e.debug&&console.warn("onCallState",t,n,r);var i=r.id;i&&a.current.callData.callId||(o({type:"call_state",callData:{callId:i}}),a.current.peer||In(a,o,i,[],{withConversation:!0,withChatMembers:!0,withCallParticipants:!0,awaitImages:!0}))},onRateNeeded:()=>{e.debug&&console.warn("onRateNeeded")},onSpeakerChanged:t=>{var n=t.id;e.debug&&console.warn("onSpeakerChanged",n),o({type:"set_orator",orator:+n})},onJoinStatus:(t,n)=>{e.debug&&console.warn("onJoinStatus",t,n)},onHangup:(t,n)=>{var r=t.hangup;e.debug&&console.warn("onHangup",r,n);var i=r&&-1===[T,I,w,P].indexOf(r);a.current.mode===l.CALL&&i?(o({type:"hangup",data:r}),Object(fe.pause)(2).then(()=>{o({type:y,mode:l.READY})})):o({type:y,mode:l.READY}),e.isInActiveCall=!1,lu(r,n,function(e){return!!Object.values(e.participants).find(e=>e.status===v.RECONNECT)}(a.current),e.debug),Jc()},onCallAccepted:()=>{e.debug&&console.warn("onCallAccepted")},onTokenExpired:()=>{e.debug&&console.warn("onTokenExpired"),(e.tokenAttempts||0)<3&&(!function(e,t,n,r){var i=()=>n.current.imHash,a=e=>(r({type:"update_hash",hash:e}),e);(function(e,t){var n=cu();return n?e.authorize(n).then(()=>t.authorized=!0):Promise.reject()})(e,t).catch(()=>function(e,t,n,r){return Le(mn,Me.bind(null,n,r),Ne)().then(n=>{var r=hu(n,1)[0];return e.authorize(r).then(()=>su(r)).then(()=>t.authorized=!0)})}(e,t,i,a)).catch(e=>console.log("Could not authorize with token request",e))}(t,e,a,o),e.tokenAttempts=(e.tokenAttempts||0)+1)},onDeviceChange:()=>{e.debug&&console.warn("onDeviceChange")},onMultipartyChatCreated:()=>{e.debug&&console.warn("onMultipartyChatCreated")},onFingerprintChange:t=>{e.debug&&console.warn("onFingerprintChange",t)},onVolumesDetected:(s={onUpdate(e){o({type:"set_speakers",data:e})},volumeLevelDetection:.25,debugCallback:()=>{e.debug}},c=s.onUpdate,u=s.volumeLevelDetection,d=s.debugCallback,p={},function(e){d&&d(arguments);var t=e.reduce((function(e,t){var n=t.uid.id;return t.volume>u&&(e[n]=!0),e}),{});ru(p,t)||(c(t),p=t)}),onLocalVolume:nu({onVolumeLevelReached:()=>{o({type:"call_notification",notification:{type:_.SPEAKING_ON_MUTE}})},needCheckMicEnabled:!0,muteMicLevelDetection:.25,vectorLength:5,callbackFactorStep:0,sensitivityCoefficient:.45,debugCallback:()=>{e.debug}}),onChatMessage:(t,n,r)=>{e.debug&&console.warn("onChatMessage",t,n,r)},onCustomData:(t,n)=>{e.debug&&console.warn("onCustomData",t,n)},onNetworkStatus:n=>{var r;e.debug&&console.warn("onNetworkStatus",n),n||(!E&&(null===(r=a.current.participants[f].mediaSettings)||void 0===r?void 0:r.isVideoEnabled)&&g--,g>0||E?o({type:"call_notification",notification:{type:_.BAD_NETWORK_CONNECTION}}):(E=!0,t.toggleLocalVideo(!1).catch(console.error),o({type:"call_notification",notification:{type:_.BAD_NETWORK_CONNECTION_DISABLE_CAMERA}})))},onDebugMessage:function(t){if(e.debug){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];console.warn("onDebugMessage",t,...r)}},onRemoteParticipantState:(t,n)=>{var r,i,s;e.debug&&console.warn("onRemoteParticipantState",t,n);var c=function(e){return e.hand?pu({},e,{hand:e.hand===b.RAISED}):e}(n),u=t.id,l=!!(null===(r=a.current.participants[u])||void 0===r||null===(i=r.statusData)||void 0===i?void 0:i.hand),d=!!(null===(s=a.current.participants[u])||void 0===s?void 0:s.name);o({type:"change_participant_state",participantId:u,data:c}),c.hand&&!l&&d&&o({type:"call_notification",notification:{type:_.RAISED_HAND,data:u}})}};e.authorized=!1,e.call=function(e,t,n,r){return(i,a,o,s,c)=>{if(e.isInActiveCall)return!1;var u=Object(M.getProgress)(),d=u.showProgress,p=u.hideProgress;return Promise.resolve().then(()=>gu(e)).then(()=>vu(t,a,r)).then(()=>d()).then(()=>bu(n,r,i,o)).then(e=>Promise.all([Object(M.preloadImagesFromResponse)(e),_u(t,n,a,i,s)])).then(()=>{p(),$c({timeStart:Date.now(),isOutgoingCall:!0,entryPoint:c,startType:a?m.VIDEO:m.AUDIO}),r({type:y,mode:l.CALL,peerId:i})}).then(()=>yu(n,r,i,o)).catch(n=>{p(),Ou(n,t,e,de(i),a)})}}(e,t,a,o),e.startGroupCall=function(e,t,n,r){return(i,a,o,s,c)=>{if(e.isInActiveCall)return!1;var u=Object(M.getProgress)(),d=u.showProgress,p=u.hideProgress;return Promise.resolve().then(()=>gu(e)).then(()=>vu(t,s,r)).then(()=>d()).then(()=>bu(n,r,i,a)).then(e=>Promise.all([Sn(n.current,r,i,e[0]),Cn(n.current,r)])).then(()=>_u(t,n,s,i)).then(()=>{p(),r({type:y,mode:l.CALL,peerId:i}),r({type:"group_call_setup",open:!0,peerId:i,preselectedIds:o}),$c({timeStart:Date.now(),isOutgoingCall:!0,startType:s?m.VIDEO:m.AUDIO,entryPoint:c,isGroupCall:!0})}).then(()=>yu(n,r,i,a)).catch(e=>{console.error(e),p()})}}(e,t,a,o),e.startCall=function(e,t,n,r){return(i,a)=>{if(e.isInActiveCall)return!1;var o=Object(M.getProgress)(),s=o.showProgress,c=o.hideProgress,u={peerId:0,canAddMembers:!0,tab:Object(ge.getLang)("calls_new_call_title"),photo:"/images/call_convo_stub.png"};return Promise.resolve().then(()=>gu(e)).then(()=>vu(t,i,r)).then(()=>s()).then(()=>Promise.all([_u(t,n,i),Object(M.preloadImagesFromResponse)([u])])).then(()=>{c(),$c({timeStart:Date.now(),isOutgoingCall:!0,entryPoint:a,startType:i?m.VIDEO:m.AUDIO,isGroupCall:!0}),r({type:"load_peer",conversation:u,members:[],peerId:0}),r({type:y,mode:l.CALL}),r({type:"management",isOpen:!0})}).catch(n=>{c(),Ou(n,t,e,!0,i)})}}(e,t,a,o),e.joinCallByLink=function(e,t,n,r){return function(i,a,o){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e.isInActiveCall)return!1;var c=Object(M.getProgress)(),u=c.showProgress,d=c.hideProgress;return Promise.resolve().then(()=>gu(e)).then(()=>vu(t,s,r)).then(()=>u()).then(()=>Co(n.current.me)?t.joinCallByLink(a,s).then(e=>{var t=e.id;return In(n,r,t,[],{withConversation:!0,withCallParticipants:!0})}):bu(n,r,i,o).then(e=>Promise.all([Object(M.preloadImagesFromResponse)(e),t.joinCallByLink(a,s)]))).then(()=>{d(),r({type:y,mode:l.CALL,peerId:i})}).then(()=>yu(n,r,i,o)).catch(n=>{console.error(n),d(),Ou(n,t,e,de(i),s)})}}(e,t,a,o),e.showJoinPopup=function(e,t,n){var r=Object(M.getProgress)(),i=r.showProgress,a=r.hideProgress;return e=>{var r=t.current.mode;return r===l.CALL||r===l.INCOMING?Promise.reject().catch(()=>Object(M.showError)(Object(ge.getLang)("calls_already_in_call_error"))):(i(),(e=>Object(pn.post)(me.CONTROLLER,{act:"a_get_call_preview",join_link:e}))(e).then(e=>{var t=hu(e,1)[0];a(),n({type:"join",data:t})}).catch(()=>{a(),n({type:"error",text:Object(ge.getLang)("calls_join_error_text")})}))}}(0,a,o);var C,S,j;return(i.token?Promise.resolve(i.token):(C=()=>a.current.imHash,S=e=>(o({type:"update_hash",hash:e}),e),(j=cu())?Promise.resolve(j):Le(mn,Me.bind(null,C,S),Ne)().then(e=>au(e,1)[0]))).then(i=>{t.init(O).then(()=>Co(a.current.me)?Promise.resolve():t.authorize(i).then(()=>su(i)).then(()=>e.authorized=!0)).then(n).catch(e=>{r(e),console.error(e)})}),t}function gu(e){return e.authorized||Co(e.id)?Promise.resolve():Promise.reject(-1)}function vu(e,t,n){return pe(e,t).catch(()=>(Object(M.showPermissionsError)(t,!0),Promise.reject(-2)))}function _u(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],a=t.current.isUpdateEnabled,o=Ae(r,n,a);return r?de(r)?e.call(i.filter(e=>Object(le.isUserPeer)(e)&&e!==t.current.me),n,o,!0):e.call(r,n,o):e.call(void 0,n,o,!0)}function bu(e,t,n,r){var i=!!r;return i||n?(i?Promise.resolve(Se(r)):Le(hn,Me.bind(null,()=>e.current.imHash,e=>(t({type:"update_hash",hash:e}),e)))(n).then(Te)).then(e=>{var r=hu(e,2),i=r[0],a=r[1];return t({type:"load_peer",conversation:i,members:a,peerId:n}),e}):Promise.reject("Cannot load data")}function yu(e,t,n,r){if(!!!r||!n)return Promise.resolve();return Le(hn,Me.bind(null,()=>e.current.imHash,e=>(t({type:"update_hash",hash:e}),e)))(n).then(M.preloadImagesFromResponse).then(e=>{var n=hu(Te(e),2),r=n[0],i=n[1];t({type:"load_peer",conversation:r,members:i})})}function Eu(e,t){switch(!0){case(e=>{var t=e||{},n=t.hangup,r=t.message;return n&&r&&"EXTERNAL_API_ERROR"===n})(e):return function(e,t){var n=Ee(e.split(" : "),2),r=n[0],i=n[1];if("VCHAT_EXTERNAL_API_ERROR"!==r||!i)return Object(ge.getLang)("global_sorry_error");switch(+i){case 928:return Object(ge.getLang)("calls_privacy_error");case 948:return t?Object(ge.getLang)("calls_chat_busy_error"):Object(ge.getLang)("calls_busy_error");case 9:return Object(ge.getLang)("calls_flood_error");case 1:case 8:case 10:case 923:default:return Object(ge.getLang)("calls_start_error")}}(e.message,t);case(e=>"number"==typeof e)(e):case(e=>!!e)(e):default:return Object(ge.getLang)("global_sorry_error")}}function Ou(e,t,n,r,i){var a=Eu(e,r);return t.hangup(),n.debug&&e&&console.error(e),-2===e?Object(M.showPermissionsError)(i,!0):Object(M.showError)(a),Promise.reject(a)}function Cu(e,t,n,r){t&&e({type:"toggle_orator_mode",isOratorMode:!0}),e({type:"set_pinned_participant",pinnedParticipant:t?n:null}),e({type:"set_screen_sharer",participantId:t?n:null}),t&&r&&e({type:"call_notification",notification:{type:_.SCREEN_SHARING_STARTED}})}function Su(){return(Su=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}window.Calls={init(e,t,n,r,i,a){if(!La.isBrowserSupported()){var o=()=>Object(M.showError)(Object(ge.getLang)("calls_unsupported_browser_error"));return this.call=o,this.startGroupCall=o,this.startCall=o,this.joinCallByLink=o,void(this.showJoinPopup=o)}return this.is1to1Supported=r,this.id=window.vk.id||e.me.peerId,new Promise((r,o)=>{var s=function(e){var t=document.getElementById(e);if(t)return t;var n=document.createElement("section");return n.setAttribute("id",e),document.body.appendChild(n),n}("calls");h.render(d.createElement(Ds,{name:"calls"},d.createElement(qc,{bridge:this,SDK:c,useLongpoll:Zc.bind(null,this),useSDK:mu.bind(null,this,c,r,o,e),me:e.me,imHash:t,participantLimit:n,isJoinAvailable:i,isUpdateEnabled:a})),s)}).catch(e=>{console.warn("Could not init calls",e)})},showJoinScreen(e,t){if(!La.isBrowserSupported())return Object(M.showError)(Object(ge.getLang)("calls_unsupported_browser_error"));var n=document.querySelector(t);h.render(d.createElement(Ds,{name:"join-call"},d.createElement(jc,Su({},e,{withPopup:!1,bridge:this}))),n)},debug:!1,setDebug(e){this.debug=e,Oo(e)}};try{stManager.done(jsc("web/calls.js"))}catch(e){}},zMZw:function(e,t,n){var r=n("k76L");t.write=function(e,t){return void 0!==e&&void 0!==e.media&&Array.isArray(e.media)&&e.media.forEach((function(e){void 0!==e.sources&&0!==Object.keys(e.sources).length&&(e.ssrcs=[],Object.keys(e.sources).forEach((function(t){var n=e.sources[t];Object.keys(n).forEach((function(r){e.ssrcs.push({id:t,attribute:r,value:n[r]})}))})),delete e.sources),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&e.ssrcGroups.forEach((function(e){void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&(e.ssrcs=e.ssrcs.join(" "))}))})),void 0!==e&&void 0!==e.groups&&Array.isArray(e.groups)&&e.groups.forEach((function(e){void 0!==e.mids&&Array.isArray(e.mids)&&(e.mids=e.mids.join(" "))})),r.write(e,t)},t.parse=function(e){var t=r.parse(e);return void 0!==t&&void 0!==t.media&&Array.isArray(t.media)&&t.media.forEach((function(e){void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&(e.sources={},e.ssrcs.forEach((function(t){e.sources[t.id]||(e.sources[t.id]={}),e.sources[t.id][t.attribute]=t.value})),delete e.ssrcs),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&e.ssrcGroups.forEach((function(e){"string"==typeof e.ssrcs&&(e.ssrcs=e.ssrcs.split(" "))}))})),void 0!==t&&void 0!==t.groups&&Array.isArray(t.groups)&&t.groups.forEach((function(e){"string"==typeof e.mids&&(e.mids=e.mids.split(" "))})),t}}});